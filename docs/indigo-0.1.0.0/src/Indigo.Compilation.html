<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | This module contains everything related to compilation from Indigo to Lorentz,</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- including plain Indigo code, as well as Indigo contracts.</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Indigo.Compilation</span><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Indigo.Compilation.html#compileIndigo"><span class="hs-identifier hs-var">compileIndigo</span></a><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Indigo.Compilation.html#IndigoContract"><span class="hs-identifier hs-type">IndigoContract</span></a><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Indigo.Compilation.html#IndigoContract%27"><span class="hs-identifier hs-type">IndigoContract'</span></a><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Indigo.Compilation.html#compileIndigoContract"><span class="hs-identifier hs-var">compileIndigoContract</span></a><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Indigo.Compilation.html#Ops"><span class="hs-identifier hs-type">Ops</span></a><span>
</span><a name="line-11"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Indigo.Compilation.html#HasSideEffects"><span class="hs-identifier hs-type">HasSideEffects</span></a><span>
</span><a name="line-12"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Indigo.Compilation.html#operationsVar"><span class="hs-identifier hs-var">operationsVar</span></a><span>
</span><a name="line-13"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Indigo.Compilation.html#HasStorage"><span class="hs-identifier hs-type">HasStorage</span></a><span>
</span><a name="line-14"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Indigo.Compilation.html#storageVar"><span class="hs-identifier hs-var">storageVar</span></a><span>
</span><a name="line-15"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Reflection</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Given</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">give</span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Singletons</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SingI</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Typeable</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-type">:~:</span><span class="hs-special">)</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">eqT</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="Indigo.Lorentz.html"><span class="hs-identifier">Indigo.Lorentz</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="Indigo.Prelude.html"><span class="hs-identifier">Indigo.Prelude</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="Indigo.State.html"><span class="hs-identifier">Indigo.State</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Lorentz.Instr</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Lorentz.Macro</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util.Peano</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-29"></a><span class="hs-comment">-- Utility for compatibility with Lorentz</span><span>
</span><a name="line-30"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">type</span><span> </span><a name="Ops"><a href="Indigo.Compilation.html#Ops"><span class="hs-identifier">Ops</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Operation</span><span class="hs-special">]</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-comment">-- | Type of a function with `n` `Var` arguments and `IndigoM inp out a` result.</span><span>
</span><a name="line-35"></a><span class="hs-comment">-- Note that the arguments are the first `n` elements of the `inp` stack in</span><span>
</span><a name="line-36"></a><span class="hs-comment">-- inverse order, for example:</span><span>
</span><a name="line-37"></a><span class="hs-comment">-- `IndigoWithParams ('S ('S 'Z)) '[a, b, c] out x` is the same as:</span><span>
</span><a name="line-38"></a><span class="hs-comment">-- `Var b -&gt; Var a -&gt; IndigoM '[a, b, c] out x`</span><span>
</span><a name="line-39"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="IndigoWithParams"><a href="Indigo.Compilation.html#IndigoWithParams"><span class="hs-identifier">IndigoWithParams</span></a></a><span> </span><a name="local-6989586621679199920"><a href="#local-6989586621679199920"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679199921"><a href="#local-6989586621679199921"><span class="hs-identifier">inp</span></a></a><span> </span><a name="local-6989586621679199922"><a href="#local-6989586621679199922"><span class="hs-identifier">out</span></a></a><span> </span><a name="local-6989586621679199923"><a href="#local-6989586621679199923"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-40"></a><span>  </span><span class="hs-identifier">IndigoWithParams</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Z</span><span> </span><a href="#local-6989586621679199924"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621679199925"><span class="hs-identifier hs-type">out</span></a><span> </span><a href="#local-6989586621679199926"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Indigo.State.html#IndigoM"><span class="hs-identifier hs-type">IndigoM</span></a><span> </span><a href="#local-6989586621679199924"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621679199925"><span class="hs-identifier hs-type">out</span></a><span> </span><a href="#local-6989586621679199926"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-41"></a><span>  </span><span class="hs-identifier">IndigoWithParams</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">S</span><span> </span><a href="#local-6989586621679199927"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679199928"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621679199929"><span class="hs-identifier hs-type">out</span></a><span> </span><a href="#local-6989586621679199930"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Indigo.State.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">At</span><span> </span><a href="#local-6989586621679199927"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679199928"><span class="hs-identifier hs-type">inp</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Indigo.Compilation.html#IndigoWithParams"><span class="hs-identifier hs-type">IndigoWithParams</span></a><span> </span><a href="#local-6989586621679199927"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679199928"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621679199929"><span class="hs-identifier hs-type">out</span></a><span> </span><a href="#local-6989586621679199930"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-comment">-- | Typeable and stack size constraint for the parameters of an `IndigoWithParams`</span><span>
</span><a name="line-44"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="AreIndigoParams"><a href="Indigo.Compilation.html#AreIndigoParams"><span class="hs-identifier">AreIndigoParams</span></a></a><span> </span><a name="local-6989586621679199915"><a href="#local-6989586621679199915"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679199916"><a href="#local-6989586621679199916"><span class="hs-identifier">stk</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Constraint</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-45"></a><span>  </span><span class="hs-identifier">AreIndigoParams</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Z</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Constraint</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span>  </span><span class="hs-identifier">AreIndigoParams</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">S</span><span> </span><a href="#local-6989586621679199918"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679199919"><span class="hs-identifier hs-type">stk</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Indigo.State.html#TypeValue"><span class="hs-identifier hs-type">TypeValue</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">At</span><span> </span><a href="#local-6989586621679199918"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679199919"><span class="hs-identifier hs-type">stk</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">RequireLongerThan</span><span> </span><a href="#local-6989586621679199919"><span class="hs-identifier hs-type">stk</span></a><span> </span><a href="#local-6989586621679199918"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">,</span><span> </span><a href="Indigo.Compilation.html#AreIndigoParams"><span class="hs-identifier hs-type">AreIndigoParams</span></a><span> </span><a href="#local-6989586621679199918"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679199919"><span class="hs-identifier hs-type">stk</span></a><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-comment">-- | Converts an 'IndigoWithParams' to its form without input 'Var's, alongside</span><span>
</span><a name="line-49"></a><span class="hs-comment">-- the 'MetaData' to use it with.</span><span>
</span><a name="line-50"></a><span class="hs-comment">-- If there is an 'Ops' to the bottom of the stack it also assigns a 'Var' to it</span><span>
</span><a name="line-51"></a><span class="hs-identifier">fromIndigoWithParams</span><span>
</span><a name="line-52"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Indigo.Compilation.html#AreIndigoParams"><span class="hs-identifier hs-type">AreIndigoParams</span></a><span> </span><a href="#local-6989586621679199941"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679199942"><span class="hs-identifier hs-type">inp</span></a><span class="hs-special">,</span><span> </span><a href="Indigo.State.html#TypeValue"><span class="hs-identifier hs-type">TypeValue</span></a><span> </span><a href="#local-6989586621679199943"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Indigo.Compilation.html#IndigoWithParams"><span class="hs-identifier hs-type">IndigoWithParams</span></a><span> </span><a href="#local-6989586621679199941"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679199942"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621679199944"><span class="hs-identifier hs-type">out</span></a><span> </span><a href="#local-6989586621679199943"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-54"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Indigo.State.html#MetaData"><span class="hs-identifier hs-type">MetaData</span></a><span> </span><a href="#local-6989586621679199942"><span class="hs-identifier hs-type">inp</span></a><span>
</span><a name="line-55"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><a href="#local-6989586621679199941"><span class="hs-identifier hs-type">n</span></a><span>
</span><a name="line-56"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Indigo.State.html#IndigoM"><span class="hs-identifier hs-type">IndigoM</span></a><span> </span><a href="#local-6989586621679199942"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621679199944"><span class="hs-identifier hs-type">out</span></a><span> </span><a href="#local-6989586621679199943"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Indigo.State.html#MetaData"><span class="hs-identifier hs-type">MetaData</span></a><span> </span><a href="#local-6989586621679199942"><span class="hs-identifier hs-type">inp</span></a><span class="hs-special">)</span><span>
</span><a name="line-57"></a><a name="fromIndigoWithParams"><a href="Indigo.Compilation.html#fromIndigoWithParams"><span class="hs-identifier">fromIndigoWithParams</span></a></a><span> </span><a name="local-6989586621679199945"><a href="#local-6989586621679199945"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621679199946"><a href="#local-6989586621679199946"><span class="hs-identifier">md</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-58"></a><span>  </span><span class="hs-identifier hs-var">SZ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679199945"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">,</span><span> </span><a href="Indigo.Compilation.html#assignVarToOps"><span class="hs-identifier hs-var">assignVarToOps</span></a><span> </span><a href="#local-6989586621679199946"><span class="hs-identifier hs-var">md</span></a><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span>  </span><span class="hs-identifier hs-var">SS</span><span> </span><a name="local-6989586621679199947"><a href="#local-6989586621679199947"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679199948"><a href="#local-6989586621679199948"><span class="hs-identifier">md2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679199949"><a href="#local-6989586621679199949"><span class="hs-identifier">var</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Indigo.State.html#withVarAt"><span class="hs-identifier hs-var">withVarAt</span></a><span> </span><a href="#local-6989586621679199946"><span class="hs-identifier hs-var">md</span></a><span> </span><a href="#local-6989586621679199947"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">in</span><span> </span><a href="Indigo.Compilation.html#fromIndigoWithParams"><span class="hs-identifier hs-var">fromIndigoWithParams</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679199945"><span class="hs-identifier hs-var">code</span></a><span> </span><a href="#local-6989586621679199949"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679199948"><span class="hs-identifier hs-var">md2</span></a><span> </span><a href="#local-6989586621679199947"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-comment">-- | Assigns a variable to the 'Ops' list at the bottom of the stack iff there is</span><span>
</span><a name="line-62"></a><span class="hs-comment">-- one and it does not have one already. Otherwise returns the same 'MetaData'</span><span>
</span><a name="line-63"></a><span class="hs-identifier">assignVarToOps</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Indigo.State.html#MetaData"><span class="hs-identifier hs-type">MetaData</span></a><span> </span><a href="#local-6989586621679199940"><span class="hs-identifier hs-type">inp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Indigo.State.html#MetaData"><span class="hs-identifier hs-type">MetaData</span></a><span> </span><a href="#local-6989586621679199940"><span class="hs-identifier hs-type">inp</span></a><span>
</span><a name="line-64"></a><a name="assignVarToOps"><a href="Indigo.Compilation.html#assignVarToOps"><span class="hs-identifier">assignVarToOps</span></a></a><span> </span><a name="local-6989586621679199950"><a href="#local-6989586621679199950"><span class="hs-identifier">md</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Indigo.State.html#MetaData"><span class="hs-identifier hs-var">MetaData</span></a><span> </span><a name="local-6989586621679199951"><a href="#local-6989586621679199951"><span class="hs-identifier">stk</span></a></a><span> </span><a name="local-6989586621679199952"><a href="#local-6989586621679199952"><span class="hs-identifier">vRef</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679199951"><span class="hs-identifier hs-var">stk</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-65"></a><span>  </span><span class="hs-identifier hs-var">RNil</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679199950"><span class="hs-identifier hs-var">md</span></a><span>
</span><a name="line-66"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><span class="hs-operator hs-var">:&amp;</span><span> </span><span class="hs-identifier hs-var">RNil</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Indigo.Compilation.html#assingVarIfOps"><span class="hs-identifier hs-var">assingVarIfOps</span></a><span> </span><a href="#local-6989586621679199950"><span class="hs-identifier hs-var">md</span></a><span>
</span><a name="line-67"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679199953"><a href="#local-6989586621679199953"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-operator hs-var">:&amp;</span><span> </span><a name="local-6989586621679199954"><a href="#local-6989586621679199954"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Indigo.Compilation.html#assignVarToOps"><span class="hs-identifier hs-var">assignVarToOps</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Indigo.State.html#MetaData"><span class="hs-identifier hs-var">MetaData</span></a><span> </span><a href="#local-6989586621679199954"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621679199952"><span class="hs-identifier hs-var">vRef</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-68"></a><span>    </span><a href="Indigo.State.html#MetaData"><span class="hs-identifier hs-var">MetaData</span></a><span> </span><a name="local-6989586621679199955"><a href="#local-6989586621679199955"><span class="hs-identifier">xs'</span></a></a><span> </span><a name="local-6989586621679199956"><a href="#local-6989586621679199956"><span class="hs-identifier">vRef'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Indigo.State.html#MetaData"><span class="hs-identifier hs-var">MetaData</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679199953"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">:&amp;</span><span> </span><a href="#local-6989586621679199955"><span class="hs-identifier hs-var">xs'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679199956"><span class="hs-identifier hs-var">vRef'</span></a><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-identifier">assingVarIfOps</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679199939"><a href="#local-6989586621679199939"><span class="hs-identifier">x</span></a></a><span class="hs-operator">.</span><span> </span><a href="Indigo.State.html#MetaData"><span class="hs-identifier hs-type">MetaData</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><a href="#local-6989586621679199939"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Indigo.State.html#MetaData"><span class="hs-identifier hs-type">MetaData</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><a href="#local-6989586621679199939"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">]</span><span>
</span><a name="line-71"></a><a name="assingVarIfOps"><a href="Indigo.Compilation.html#assingVarIfOps"><span class="hs-identifier">assingVarIfOps</span></a></a><span> </span><a name="local-6989586621679199957"><a href="#local-6989586621679199957"><span class="hs-identifier">md</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Indigo.State.html#MetaData"><span class="hs-identifier hs-var">MetaData</span></a><span> </span><a name="local-6989586621679199958"><a href="#local-6989586621679199958"><span class="hs-identifier">stk</span></a></a><span> </span><a name="local-6989586621679199959"><a href="#local-6989586621679199959"><span class="hs-identifier">vRef</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679199958"><span class="hs-identifier hs-var">stk</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-72"></a><span>  </span><span class="hs-special">(</span><a href="Indigo.State.html#Ref"><span class="hs-identifier hs-var">Ref</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-operator hs-var">:&amp;</span><span> </span><span class="hs-identifier hs-var">RNil</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679199957"><span class="hs-identifier hs-var">md</span></a><span>
</span><a name="line-73"></a><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Indigo.State.html#NoRef"><span class="hs-identifier hs-var">NoRef</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Indigo.State.html#StkEl"><span class="hs-identifier hs-type">StkEl</span></a><span> </span><a href="#local-6989586621679199939"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">:&amp;</span><span> </span><span class="hs-identifier hs-var">RNil</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">eqT</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679199939"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">@</span><a href="Indigo.Compilation.html#Ops"><span class="hs-identifier hs-type">Ops</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-74"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679199957"><span class="hs-identifier hs-var">md</span></a><span>
</span><a name="line-75"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Refl</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Indigo.State.html#MetaData"><span class="hs-identifier hs-var">MetaData</span></a><span> </span><span class="hs-special">(</span><a href="Indigo.State.html#Ref"><span class="hs-identifier hs-var">Ref</span></a><span> </span><span class="hs-special">(</span><a href="Indigo.State.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621679199959"><span class="hs-identifier hs-var">vRef</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">:&amp;</span><span> </span><span class="hs-identifier hs-var">RNil</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679199959"><span class="hs-identifier hs-var">vRef</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span class="hs-comment">-- | Compile Indigo code to Lorentz.</span><span>
</span><a name="line-78"></a><span class="hs-comment">--</span><span>
</span><a name="line-79"></a><span class="hs-comment">-- Note: it is necessary to specify the number of parameters (using the first</span><span>
</span><a name="line-80"></a><span class="hs-comment">-- type variable) of the Indigo function. Also, these should be on the top of</span><span>
</span><a name="line-81"></a><span class="hs-comment">-- the input stack in inverse order (see `IndigoWithParams`).</span><span>
</span><a name="line-82"></a><span class="hs-identifier">compileIndigo</span><span>
</span><a name="line-83"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679199935"><a href="#local-6989586621679199935"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679199936"><a href="#local-6989586621679199936"><span class="hs-identifier">inp</span></a></a><span> </span><a name="local-6989586621679199937"><a href="#local-6989586621679199937"><span class="hs-identifier">out</span></a></a><span> </span><a name="local-6989586621679199938"><a href="#local-6989586621679199938"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-84"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SingI</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ToPeano</span><span> </span><a href="#local-6989586621679199935"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Default</span><span> </span><span class="hs-special">(</span><a href="Indigo.State.html#MetaData"><span class="hs-identifier hs-type">MetaData</span></a><span> </span><a href="#local-6989586621679199936"><span class="hs-identifier hs-type">inp</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-85"></a><span>     </span><a href="Indigo.Compilation.html#AreIndigoParams"><span class="hs-identifier hs-type">AreIndigoParams</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ToPeano</span><span> </span><a href="#local-6989586621679199935"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679199936"><span class="hs-identifier hs-type">inp</span></a><span class="hs-special">,</span><span> </span><a href="Indigo.State.html#TypeValue"><span class="hs-identifier hs-type">TypeValue</span></a><span> </span><a href="#local-6989586621679199938"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Indigo.Compilation.html#IndigoWithParams"><span class="hs-identifier hs-type">IndigoWithParams</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ToPeano</span><span> </span><a href="#local-6989586621679199935"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679199936"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621679199937"><span class="hs-identifier hs-type">out</span></a><span> </span><a href="#local-6989586621679199938"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-87"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">inp</span><span> </span><span class="hs-operator hs-type">:-&gt;</span><span> </span><a href="#local-6989586621679199937"><span class="hs-identifier hs-type">out</span></a><span>
</span><a name="line-88"></a><a name="compileIndigo"><a href="Indigo.Compilation.html#compileIndigo"><span class="hs-identifier">compileIndigo</span></a></a><span> </span><a name="local-6989586621679199960"><a href="#local-6989586621679199960"><span class="hs-identifier">paramCode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">gcCode</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">runIndigoM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679199961"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Indigo.State.html#IndigoM"><span class="hs-identifier hs-type">IndigoM</span></a><span> </span><a href="#local-6989586621679199936"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621679199937"><span class="hs-identifier hs-type">out</span></a><span> </span><a href="#local-6989586621679199938"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679199962"><span class="hs-identifier hs-var">md</span></a><span>
</span><a name="line-89"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679199961"><a href="#local-6989586621679199961"><span class="hs-identifier">code</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679199962"><a href="#local-6989586621679199962"><span class="hs-identifier">md</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Indigo.Compilation.html#fromIndigoWithParams"><span class="hs-identifier hs-var">fromIndigoWithParams</span></a><span> </span><a href="#local-6989586621679199960"><span class="hs-identifier hs-var">paramCode</span></a><span> </span><span class="hs-identifier hs-var">def</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sing</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-type">ToPeano</span><span> </span><a href="#local-6989586621679199935"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">-- | Allows to get a variable with operations</span><span>
</span><a name="line-93"></a><span class="hs-keyword">type</span><span> </span><a name="HasSideEffects"><a href="Indigo.Compilation.html#HasSideEffects"><span class="hs-identifier">HasSideEffects</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Given</span><span> </span><span class="hs-special">(</span><a href="Indigo.State.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><a href="Indigo.Compilation.html#Ops"><span class="hs-identifier hs-type">Ops</span></a><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- | Allows to get a variable with storage</span><span>
</span><a name="line-96"></a><span class="hs-keyword">type</span><span> </span><a name="HasStorage"><a href="Indigo.Compilation.html#HasStorage"><span class="hs-identifier">HasStorage</span></a></a><span> </span><a name="local-6989586621679199914"><a href="#local-6989586621679199914"><span class="hs-identifier">st</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Given</span><span> </span><span class="hs-special">(</span><a href="Indigo.State.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><a href="#local-6989586621679199914"><span class="hs-identifier hs-type">st</span></a><span class="hs-special">)</span><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-comment">-- | A utility type for a contract written in Indigo.</span><span>
</span><a name="line-99"></a><span class="hs-comment">--</span><span>
</span><a name="line-100"></a><span class="hs-comment">-- Note that is a more restrictive type than what is needed for compilation with</span><span>
</span><a name="line-101"></a><span class="hs-comment">-- 'compileIndigoContract' and it's mainly intended to hide arbitrary outputs and</span><span>
</span><a name="line-102"></a><span class="hs-comment">-- be similar to Lorentz's 'ContractCode'.</span><span>
</span><a name="line-103"></a><span class="hs-keyword">type</span><span> </span><a name="IndigoContract"><a href="Indigo.Compilation.html#IndigoContract"><span class="hs-identifier">IndigoContract</span></a></a><span> </span><a name="local-6989586621679199912"><a href="#local-6989586621679199912"><span class="hs-identifier">param</span></a></a><span> </span><a name="local-6989586621679199913"><a href="#local-6989586621679199913"><span class="hs-identifier">st</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Indigo.Compilation.html#IndigoContract%27"><span class="hs-identifier hs-type">IndigoContract'</span></a><span> </span><a href="#local-6989586621679199912"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679199913"><span class="hs-identifier hs-type">st</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><a href="#local-6989586621679199912"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679199913"><span class="hs-identifier hs-type">st</span></a><span class="hs-special">,</span><span> </span><a href="Indigo.Compilation.html#Ops"><span class="hs-identifier hs-type">Ops</span></a><span class="hs-special">]</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-comment">-- | Type of a contract that can be compiled to Lorentz with 'compileIndigoContract'.</span><span>
</span><a name="line-106"></a><span class="hs-keyword">type</span><span> </span><a name="IndigoContract%27"><a href="Indigo.Compilation.html#IndigoContract%27"><span class="hs-identifier">IndigoContract'</span></a></a><span> </span><a name="local-6989586621679199909"><a href="#local-6989586621679199909"><span class="hs-identifier">param</span></a></a><span> </span><a name="local-6989586621679199910"><a href="#local-6989586621679199910"><span class="hs-identifier">st</span></a></a><span> </span><a name="local-6989586621679199911"><a href="#local-6989586621679199911"><span class="hs-identifier">out</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-107"></a><span>  </span><span class="hs-special">(</span><a href="Indigo.Compilation.html#HasStorage"><span class="hs-identifier hs-type">HasStorage</span></a><span> </span><a href="#local-6989586621679199910"><span class="hs-identifier hs-type">st</span></a><span class="hs-special">,</span><span> </span><a href="Indigo.Compilation.html#HasSideEffects"><span class="hs-identifier hs-type">HasSideEffects</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Indigo.State.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><a href="#local-6989586621679199909"><span class="hs-identifier hs-type">param</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Indigo.State.html#IndigoM"><span class="hs-identifier hs-type">IndigoM</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><a href="#local-6989586621679199909"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679199910"><span class="hs-identifier hs-type">st</span></a><span class="hs-special">,</span><span> </span><a href="Indigo.Compilation.html#Ops"><span class="hs-identifier hs-type">Ops</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679199911"><span class="hs-identifier hs-type">out</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-comment">-- | Compile Indigo code to Lorentz contract.</span><span>
</span><a name="line-110"></a><span class="hs-comment">-- Drop elements from the stack to return only [Operation] and Storage.</span><span>
</span><a name="line-111"></a><span class="hs-identifier">compileIndigoContract</span><span>
</span><a name="line-112"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679199932"><a href="#local-6989586621679199932"><span class="hs-identifier">param</span></a></a><span> </span><a name="local-6989586621679199933"><a href="#local-6989586621679199933"><span class="hs-identifier">st</span></a></a><span> </span><a name="local-6989586621679199934"><a href="#local-6989586621679199934"><span class="hs-identifier">out</span></a></a><span> </span><span class="hs-operator">.</span><span>
</span><a name="line-113"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Indigo.State.html#TypeValue"><span class="hs-identifier hs-type">TypeValue</span></a><span> </span><a href="#local-6989586621679199932"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">,</span><span> </span><a href="Indigo.State.html#TypeValue"><span class="hs-identifier hs-type">TypeValue</span></a><span> </span><a href="#local-6989586621679199933"><span class="hs-identifier hs-type">st</span></a><span>
</span><a name="line-114"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-115"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Indigo.Compilation.html#IndigoContract%27"><span class="hs-identifier hs-type">IndigoContract'</span></a><span> </span><a href="#local-6989586621679199932"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679199933"><span class="hs-identifier hs-type">st</span></a><span> </span><a href="#local-6989586621679199934"><span class="hs-identifier hs-type">out</span></a><span>
</span><a name="line-116"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ContractCode</span><span> </span><a href="#local-6989586621679199932"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679199933"><span class="hs-identifier hs-type">st</span></a><span>
</span><a name="line-117"></a><a name="compileIndigoContract"><a href="Indigo.Compilation.html#compileIndigoContract"><span class="hs-identifier">compileIndigoContract</span></a></a><span> </span><a name="local-6989586621679199963"><a href="#local-6989586621679199963"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-118"></a><span>  </span><span class="hs-identifier hs-var">L.nil</span><span> </span><span class="hs-operator hs-var">#</span><span> </span><span class="hs-identifier hs-var">L.swap</span><span> </span><span class="hs-operator hs-var">#</span><span> </span><span class="hs-identifier hs-var">L.unpair</span><span> </span><span class="hs-operator hs-var">#</span><span>
</span><a name="line-119"></a><span>  </span><span class="hs-special">(</span><a href="Indigo.State.html#cleanGenCode"><span class="hs-identifier hs-var">cleanGenCode</span></a><span> </span><a href="#local-6989586621679199965"><span class="hs-identifier hs-var">runIndigoOpsCode</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">#</span><span>
</span><a name="line-120"></a><span>  </span><span class="hs-identifier hs-var">L.drop</span><span> </span><span class="hs-operator hs-var">#</span><span> </span><span class="hs-identifier hs-var">L.swap</span><span> </span><span class="hs-operator hs-var">#</span><span> </span><span class="hs-identifier hs-var">L.pair</span><span>
</span><a name="line-121"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-122"></a><span>    </span><span class="hs-identifier">everythingGiven</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Indigo.State.html#IndigoM"><span class="hs-identifier hs-type">IndigoM</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><a href="#local-6989586621679199932"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679199933"><span class="hs-identifier hs-type">st</span></a><span class="hs-special">,</span><span> </span><a href="Indigo.Compilation.html#Ops"><span class="hs-identifier hs-type">Ops</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679199934"><span class="hs-identifier hs-type">out</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-123"></a><span>    </span><a name="local-6989586621679199964"><a href="#local-6989586621679199964"><span class="hs-identifier">everythingGiven</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">give</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Indigo.State.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><a href="Indigo.Compilation.html#Ops"><span class="hs-identifier hs-type">Ops</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679199968"><span class="hs-identifier hs-var">varOps</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">give</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Indigo.State.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><a href="#local-6989586621679199933"><span class="hs-identifier hs-type">st</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679199969"><span class="hs-identifier hs-var">varSt</span></a><span> </span><a href="#local-6989586621679199963"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679199970"><span class="hs-identifier hs-var">varParam</span></a><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span>    </span><a name="local-6989586621679199965"><a href="#local-6989586621679199965"><span class="hs-identifier">runIndigoOpsCode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runIndigoM</span><span> </span><a href="#local-6989586621679199964"><span class="hs-identifier hs-var">everythingGiven</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Indigo.State.html#MetaData"><span class="hs-identifier hs-var">MetaData</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span>
</span><a name="line-126"></a><span>    </span><a name="local-6989586621679199966"><a href="#local-6989586621679199966"><span class="hs-identifier">mdStack</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Indigo.State.html#Ref"><span class="hs-identifier hs-var">Ref</span></a><span> </span><a href="#local-6989586621679199970"><span class="hs-identifier hs-var">varParam</span></a><span> </span><span class="hs-operator hs-var">:&amp;</span><span> </span><a href="Indigo.State.html#Ref"><span class="hs-identifier hs-var">Ref</span></a><span> </span><a href="#local-6989586621679199969"><span class="hs-identifier hs-var">varSt</span></a><span> </span><span class="hs-operator hs-var">:&amp;</span><span> </span><a href="Indigo.State.html#Ref"><span class="hs-identifier hs-var">Ref</span></a><span> </span><a href="#local-6989586621679199968"><span class="hs-identifier hs-var">varOps</span></a><span> </span><span class="hs-operator hs-var">:&amp;</span><span> </span><span class="hs-identifier hs-var">RNil</span><span>
</span><a name="line-127"></a><span>    </span><a name="local-6989586621679199967"><a href="#local-6989586621679199967"><span class="hs-identifier">mdRefCount</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-128"></a><span>    </span><a name="local-6989586621679199968"><a href="#local-6989586621679199968"><span class="hs-identifier">varOps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Indigo.State.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-129"></a><span>    </span><a name="local-6989586621679199969"><a href="#local-6989586621679199969"><span class="hs-identifier">varSt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Indigo.State.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-130"></a><span>    </span><a name="local-6989586621679199970"><a href="#local-6989586621679199970"><span class="hs-identifier">varParam</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Indigo.State.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span class="hs-comment">-- | Return a variable which refers to a stack cell with storage</span><span>
</span><a name="line-133"></a><span class="hs-identifier">storageVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Indigo.Compilation.html#HasStorage"><span class="hs-identifier hs-type">HasStorage</span></a><span> </span><a href="#local-6989586621679199931"><span class="hs-identifier hs-type">st</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Indigo.State.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><a href="#local-6989586621679199931"><span class="hs-identifier hs-type">st</span></a><span>
</span><a name="line-134"></a><a name="storageVar"><a href="Indigo.Compilation.html#storageVar"><span class="hs-identifier">storageVar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">given</span><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span class="hs-comment">-- | Return a variable which refers to a stack cell with operations</span><span>
</span><a name="line-137"></a><span class="hs-identifier">operationsVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Indigo.Compilation.html#HasSideEffects"><span class="hs-identifier hs-type">HasSideEffects</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Indigo.State.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><a href="Indigo.Compilation.html#Ops"><span class="hs-identifier hs-type">Ops</span></a><span>
</span><a name="line-138"></a><a name="operationsVar"><a href="Indigo.Compilation.html#operationsVar"><span class="hs-identifier">operationsVar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">given</span><span>
</span><a name="line-139"></a></pre></body></html>