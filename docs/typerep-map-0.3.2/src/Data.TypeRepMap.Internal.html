<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes   #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE BangPatterns          #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE CPP                   #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE DataKinds             #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE GADTs                 #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE InstanceSigs          #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE KindSignatures        #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE MagicHash             #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE PolyKinds             #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE Rank2Types            #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies          #-}</span><span>
</span><a name="line-12"></a><span class="hs-pragma">{-# LANGUAGE TypeInType            #-}</span><span>
</span><a name="line-13"></a><span class="hs-pragma">{-# LANGUAGE ViewPatterns          #-}</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 806
</span><span class="hs-pragma">{-# LANGUAGE QuantifiedConstraints #-}</span><span>
</span><a name="line-17"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- {-# OPTIONS_GHC -ddump-simpl -dsuppress-idinfo -dsuppress-coercions -dsuppress-type-applications -dsuppress-uniques -dsuppress-module-prefixes #-}</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-comment">{- | Internal API for 'TypeRepMap' and operations on it. The functions here do
not have any stability guarantees and can change between minor versions.

If you need to use this module for purposes other than tests,
create an issue.
-}</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.TypeRepMap.Internal</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.DeepSeq</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.ST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ST</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">runST</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Zip</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mzip</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Function</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">on</span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Kind</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Type.Equality</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-type">:~:</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TestEquality</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">intercalate</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nubBy</span><span class="hs-special">)</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Primitive.Array</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Array</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MutableArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">indexArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mapArray'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sizeofArray</span><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>                             </span><span class="hs-identifier hs-var">thawArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unsafeFreezeArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">writeArray</span><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Primitive.PrimArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">PrimArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">indexPrimArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sizeofPrimArray</span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Semigroup</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Semigroup</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Base</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Any</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">*#</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+#</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;#</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Exts</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IsList</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">inline</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sortWith</span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Fingerprint</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fingerprint</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Prim</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">eqWord#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ltWord#</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Word</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Type.Reflection</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SomeTypeRep</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TypeRep</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">typeRep</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">withTypeable</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Type.Reflection.Unsafe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeRepFingerprint</span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Unsafe.Coerce</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unsafeCoerce</span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map.Strict</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">GHC.Exts</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">GHC</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromList</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">toList</span><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-comment">{- |

'TypeRepMap' is a heterogeneous data structure similar in its essence to
'Data.Map.Map' with types as keys, where each value has the type of its key. In
addition to that, each value is wrapped in an interpretation @f@.

Here is an example of using 'Prelude.Maybe' as an interpretation, with a
comparison to 'Data.Map.Map':

@
 'Data.Map.Map' 'Prelude.String' ('Prelude.Maybe' 'Prelude.String')          'TypeRepMap' 'Prelude.Maybe'
---------------------------       ---------------------
 \&quot;Int\&quot;  -&gt; Just \&quot;5\&quot;                 'Prelude.Int'  -&gt; Just 5
 \&quot;Bool\&quot; -&gt; Just \&quot;True\&quot;              'Prelude.Bool' -&gt; Just 'Prelude.True'
 \&quot;Char\&quot; -&gt; Nothing                  'Prelude.Char' -&gt; Nothing
@

The runtime representation of 'TypeRepMap' is an array, not a tree. This makes
'lookup' significantly more efficient.

-}</span><span>
</span><a name="line-76"></a><span class="hs-keyword">data</span><span> </span><a name="TypeRepMap"><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier">TypeRepMap</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679037207"><a href="#local-6989586621679037207"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679037206"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-77"></a><span>  </span><a name="TypeRepMap"><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier">TypeRepMap</span></a></a><span>
</span><a name="line-78"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="fingerprintAs"><a href="Data.TypeRepMap.Internal.html#fingerprintAs"><span class="hs-identifier">fingerprintAs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">PrimArray</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ first components of key fingerprints</span><span>
</span><a name="line-79"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="fingerprintBs"><a href="Data.TypeRepMap.Internal.html#fingerprintBs"><span class="hs-identifier">fingerprintBs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">PrimArray</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ second components of key fingerprints</span><span>
</span><a name="line-80"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="trAnys"><a href="Data.TypeRepMap.Internal.html#trAnys"><span class="hs-identifier">trAnys</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Array</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- ^ values stored in the map</span><span>
</span><a name="line-81"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="trKeys"><a href="Data.TypeRepMap.Internal.html#trKeys"><span class="hs-identifier">trKeys</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Array</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- ^ typerep keys</span><span>
</span><a name="line-82"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-83"></a><span>  </span><span class="hs-comment">-- ^ an unsafe constructor for 'TypeRepMap'</span><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037594"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-86"></a><span>   </span><a name="local-8214565720323791752"><span class="hs-identifier">rnf</span></a><span> </span><a name="local-6989586621679037595"><a href="#local-6989586621679037595"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">rnf</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#keys"><span class="hs-identifier hs-var">keys</span></a><span> </span><a href="#local-6989586621679037595"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-comment">-- | Shows only keys.</span><span>
</span><a name="line-89"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037430"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-90"></a><span>    </span><a name="local-8214565720323790326"><span class="hs-identifier">show</span></a><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-var">TypeRepMap</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;TypeRepMap [&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679037435"><span class="hs-identifier hs-var">showKeys</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;]&quot;</span><span>
</span><a name="line-91"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-92"></a><span>        </span><span class="hs-identifier">showKeys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-93"></a><span>        </span><a name="local-6989586621679037435"><a href="#local-6989586621679037435"><span class="hs-identifier">showKeys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">intercalate</span><span> </span><span class="hs-string">&quot;, &quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapArray'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.TypeRepMap.Internal.html#anyToTypeRep"><span class="hs-identifier hs-var">anyToTypeRep</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679037434"><span class="hs-identifier hs-var">trKeys</span></a><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- | Uses 'union' to combine 'TypeRepMap's.</span><span>
</span><a name="line-96"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Semigroup</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037429"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-97"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">&lt;&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037429"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037429"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037429"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-98"></a><span>    </span><span class="hs-special">(</span><a name="local-3458764513820541482"><span class="hs-operator">&lt;&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#union"><span class="hs-identifier hs-var">union</span></a><span>
</span><a name="line-99"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&lt;&gt;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037428"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-102"></a><span>    </span><a name="local-3458764513820541483"><span class="hs-identifier">mempty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-var">TypeRepMap</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-103"></a><span>    </span><a name="local-3458764513820541484"><span class="hs-identifier">mappend</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">mempty</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">mappend</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 806
</span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679037291"><a href="#local-6989586621679037291"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679037291"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679037290"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037291"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037290"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-109"></a><span>    </span><a name="local-6989586621679037292"><a href="#local-6989586621679037292"><span class="hs-identifier">tm1</span></a></a><span> </span><a name="local-3458764513820541095"><span class="hs-operator">==</span></a><span> </span><a name="local-6989586621679037293"><a href="#local-6989586621679037293"><span class="hs-identifier">tm2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#size"><span class="hs-identifier hs-var">size</span></a><span> </span><a href="#local-6989586621679037292"><span class="hs-identifier hs-var">tm1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Data.TypeRepMap.Internal.html#size"><span class="hs-identifier hs-var">size</span></a><span> </span><a href="#local-6989586621679037293"><span class="hs-identifier hs-var">tm2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679037294"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-110"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-111"></a><span>        </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-112"></a><span>        </span><a name="local-6989586621679037294"><a href="#local-6989586621679037294"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679037295"><a href="#local-6989586621679037295"><span class="hs-identifier">i</span></a></a><span>
</span><a name="line-113"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679037295"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Data.TypeRepMap.Internal.html#size"><span class="hs-identifier hs-var">size</span></a><span> </span><a href="#local-6989586621679037292"><span class="hs-identifier hs-var">tm1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-114"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">testEquality</span><span> </span><a href="#local-6989586621679037296"><span class="hs-identifier hs-var">tr1i</span></a><span> </span><a href="#local-6989586621679037297"><span class="hs-identifier hs-var">tr2i</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-115"></a><span>                  </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-116"></a><span>                  </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Refl</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037300"><span class="hs-identifier hs-var">repEq</span></a><span> </span><a href="#local-6989586621679037296"><span class="hs-identifier hs-var">tr1i</span></a><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#fromAny"><span class="hs-identifier hs-var">fromAny</span></a><span> </span><a href="#local-6989586621679037298"><span class="hs-identifier hs-var">tv1i</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#fromAny"><span class="hs-identifier hs-var">fromAny</span></a><span> </span><a href="#local-6989586621679037299"><span class="hs-identifier hs-var">tv2i</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679037294"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679037295"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-118"></a><span>            </span><span class="hs-identifier">tr1i</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeRep</span><span> </span><a href="#local-6989586621679037301"><span class="hs-identifier hs-type">x</span></a><span>
</span><a name="line-119"></a><span>            </span><a name="local-6989586621679037296"><a href="#local-6989586621679037296"><span class="hs-identifier">tr1i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#anyToTypeRep"><span class="hs-identifier hs-var">anyToTypeRep</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">indexArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">trKeys</span><span> </span><a href="#local-6989586621679037292"><span class="hs-identifier hs-var">tm1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679037295"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span>            </span><span class="hs-identifier">tr2i</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeRep</span><span> </span><a href="#local-6989586621679037302"><span class="hs-identifier hs-type">y</span></a><span>
</span><a name="line-122"></a><span>            </span><a name="local-6989586621679037297"><a href="#local-6989586621679037297"><span class="hs-identifier">tr2i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#anyToTypeRep"><span class="hs-identifier hs-var">anyToTypeRep</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">indexArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">trKeys</span><span> </span><a href="#local-6989586621679037293"><span class="hs-identifier hs-var">tm2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679037295"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span>            </span><span class="hs-identifier">tv1i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tv2i</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Any</span><span>
</span><a name="line-125"></a><span>            </span><a name="local-6989586621679037298"><a href="#local-6989586621679037298"><span class="hs-identifier">tv1i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">indexArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">trAnys</span><span> </span><a href="#local-6989586621679037292"><span class="hs-identifier hs-var">tm1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679037295"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-126"></a><span>            </span><a name="local-6989586621679037299"><a href="#local-6989586621679037299"><span class="hs-identifier">tv2i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">indexArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">trAnys</span><span> </span><a href="#local-6989586621679037293"><span class="hs-identifier hs-var">tm2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679037295"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span>            </span><span class="hs-identifier">repEq</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeRep</span><span> </span><a href="#local-6989586621679037303"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037290"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037303"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037290"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037303"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-129"></a><span>            </span><a name="local-6989586621679037300"><a href="#local-6989586621679037300"><span class="hs-identifier">repEq</span></a></a><span> </span><a name="local-6989586621679037304"><a href="#local-6989586621679037304"><span class="hs-identifier">tr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withTypeable</span><span> </span><a href="#local-6989586621679037304"><span class="hs-identifier hs-var">tr</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span>
</span><a name="line-130"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-132"></a><span class="hs-comment">-- | Returns the list of 'Fingerprint's from 'TypeRepMap'.</span><span>
</span><a name="line-133"></a><span class="hs-identifier">toFingerprints</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037645"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">]</span><span>
</span><a name="line-134"></a><a name="toFingerprints"><a href="Data.TypeRepMap.Internal.html#toFingerprints"><span class="hs-identifier">toFingerprints</span></a></a><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-var">TypeRepMap</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-135"></a><span>    </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-identifier hs-var">Fingerprint</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.toList</span><span> </span><a href="#local-6989586621679037646"><span class="hs-identifier hs-var">fingerprintAs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.toList</span><span> </span><a href="#local-6989586621679037647"><span class="hs-identifier hs-var">fingerprintBs</span></a><span class="hs-special">)</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-comment">{- |

A 'TypeRepMap' with no values stored in it.

prop&gt; size empty == 0
prop&gt; member @a empty == False

-}</span><span>
</span><a name="line-145"></a><span class="hs-identifier">empty</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037644"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-146"></a><a name="empty"><a href="Data.TypeRepMap.Internal.html#empty"><span class="hs-identifier">empty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-147"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">empty</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span class="hs-comment">{- |

Construct a 'TypeRepMap' with a single element.

prop&gt; size (one x) == 1
prop&gt; member @a (one (x :: f a)) == True

-}</span><span>
</span><a name="line-157"></a><span class="hs-identifier">one</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679037642"><a href="#local-6989586621679037642"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679037643"><a href="#local-6989586621679037643"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679037642"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679037643"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037642"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037643"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-158"></a><a name="one"><a href="Data.TypeRepMap.Internal.html#one"><span class="hs-identifier">one</span></a></a><span> </span><a name="local-6989586621679037838"><a href="#local-6989586621679037838"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#insert"><span class="hs-identifier hs-var">insert</span></a><span> </span><a href="#local-6989586621679037838"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="Data.TypeRepMap.Internal.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-159"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">one</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span class="hs-comment">{- |

Insert a value into a 'TypeRepMap'.

prop&gt; size (insert v tm) &gt;= size tm
prop&gt; member @a (insert (x :: f a) tm) == True

-}</span><span>
</span><a name="line-169"></a><span class="hs-identifier">insert</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679037640"><a href="#local-6989586621679037640"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679037641"><a href="#local-6989586621679037641"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679037640"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679037641"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037640"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037641"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037641"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-170"></a><a name="insert"><a href="Data.TypeRepMap.Internal.html#insert"><span class="hs-identifier">insert</span></a></a><span> </span><a name="local-6989586621679037839"><a href="#local-6989586621679037839"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#fromTriples"><span class="hs-identifier hs-var">fromTriples</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679037842"><span class="hs-identifier hs-var">addX</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.TypeRepMap.Internal.html#toTriples"><span class="hs-identifier hs-var">toTriples</span></a><span>
</span><a name="line-171"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-172"></a><span>    </span><span class="hs-identifier">tripleX</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span>    </span><a name="local-6989586621679037840"><a href="#local-6989586621679037840"><span class="hs-identifier">tripleX</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679037841"><a href="#local-6989586621679037841"><span class="hs-identifier">fpX</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#calcFp"><span class="hs-identifier hs-var">calcFp</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679037640"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.TypeRepMap.Internal.html#toAny"><span class="hs-identifier hs-var">toAny</span></a><span> </span><a href="#local-6989586621679037839"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unsafeCoerce</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">typeRep</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679037640"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-174"></a><span>
</span><a name="line-175"></a><span>    </span><span class="hs-identifier">addX</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-176"></a><span>    </span><a name="local-6989586621679037842"><a href="#local-6989586621679037842"><span class="hs-identifier">addX</span></a></a><span> </span><a name="local-6989586621679037843"><a href="#local-6989586621679037843"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679037840"><span class="hs-identifier hs-var">tripleX</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Data.TypeRepMap.Internal.html#deleteByFst"><span class="hs-identifier hs-var">deleteByFst</span></a><span> </span><a href="#local-6989586621679037841"><span class="hs-identifier hs-var">fpX</span></a><span> </span><a href="#local-6989586621679037843"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-177"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">insert</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-178"></a><span>
</span><a name="line-179"></a><span class="hs-comment">-- Extract the kind of a type. We use it to work around lack of syntax for</span><span>
</span><a name="line-180"></a><span class="hs-comment">-- inferred type variables (which are not subject to type applications).</span><span>
</span><a name="line-181"></a><span class="hs-keyword">type</span><span> </span><a name="KindOf"><a href="Data.TypeRepMap.Internal.html#KindOf"><span class="hs-identifier">KindOf</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679037205"><a href="#local-6989586621679037205"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679037204"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679037204"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-comment">{- | Delete a value from a 'TypeRepMap'.

prop&gt; size (delete @a tm) &lt;= size tm
prop&gt; member @a (delete @a tm) == False

&gt;&gt;&gt; tm = delete @Bool $ insert (Just True) $ one (Just 'a')
&gt;&gt;&gt; size tm
1
&gt;&gt;&gt; member @Bool tm
False
&gt;&gt;&gt; member @Char tm
True
-}</span><span>
</span><a name="line-196"></a><span class="hs-identifier">delete</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679037638"><a href="#local-6989586621679037638"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679037639"><a href="#local-6989586621679037639"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.TypeRepMap.Internal.html#KindOf"><span class="hs-identifier hs-type">KindOf</span></a><span> </span><a href="#local-6989586621679037638"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679037638"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037639"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037639"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-197"></a><a name="delete"><a href="Data.TypeRepMap.Internal.html#delete"><span class="hs-identifier">delete</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#fromTriples"><span class="hs-identifier hs-var">fromTriples</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.TypeRepMap.Internal.html#deleteByFst"><span class="hs-identifier hs-var">deleteByFst</span></a><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#typeFp"><span class="hs-identifier hs-var">typeFp</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679037638"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.TypeRepMap.Internal.html#toTriples"><span class="hs-identifier hs-var">toTriples</span></a><span>
</span><a name="line-198"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">delete</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-comment">{- |
Update a value at a specific key with the result of the provided function. When
the key is not a member of the map, the original map is returned.

&gt;&gt;&gt; trmap = fromList @(TypeRepMap Identity) [WrapTypeable $ Identity &quot;a&quot;]
&gt;&gt;&gt; lookup @String $ adjust (fmap (++ &quot;ww&quot;)) trmap
Just (Identity &quot;aww&quot;)
-}</span><span>
</span><a name="line-208"></a><span class="hs-identifier">adjust</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679037636"><a href="#local-6989586621679037636"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679037637"><a href="#local-6989586621679037637"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679037636"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679037637"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037636"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037637"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037636"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037637"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037637"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-209"></a><a name="adjust"><a href="Data.TypeRepMap.Internal.html#adjust"><span class="hs-identifier">adjust</span></a></a><span> </span><a name="local-6989586621679037844"><a href="#local-6989586621679037844"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621679037845"><a href="#local-6989586621679037845"><span class="hs-identifier">tr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Data.TypeRepMap.Internal.html#cachedBinarySearch"><span class="hs-identifier hs-var">cachedBinarySearch</span></a><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#typeFp"><span class="hs-identifier hs-var">typeFp</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679037636"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fingerprintAs</span><span> </span><a href="#local-6989586621679037845"><span class="hs-identifier hs-var">tr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fingerprintBs</span><span> </span><a href="#local-6989586621679037845"><span class="hs-identifier hs-var">tr</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-210"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037845"><span class="hs-identifier hs-var">tr</span></a><span>
</span><a name="line-211"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679037975"><a href="#local-6989586621679037975"><span class="hs-identifier">i</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037845"><span class="hs-identifier hs-var">tr</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">trAnys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679037846"><span class="hs-identifier hs-var">changeAnyArr</span></a><span> </span><a href="#local-6989586621679037975"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">trAnys</span><span> </span><a href="#local-6989586621679037845"><span class="hs-identifier hs-var">tr</span></a><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><a name="line-212"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-213"></a><span>    </span><span class="hs-identifier">changeAnyArr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Array</span><span> </span><span class="hs-identifier hs-type">Any</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Array</span><span> </span><span class="hs-identifier hs-type">Any</span><span>
</span><a name="line-214"></a><span>    </span><a name="local-6989586621679037846"><a href="#local-6989586621679037846"><span class="hs-identifier">changeAnyArr</span></a></a><span> </span><a name="local-6989586621679037847"><a href="#local-6989586621679037847"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679037848"><a href="#local-6989586621679037848"><span class="hs-identifier">trAs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">runST</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-215"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679037958"><a href="#local-6989586621679037958"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sizeofArray</span><span> </span><a href="#local-6989586621679037848"><span class="hs-identifier hs-var">trAs</span></a><span>
</span><a name="line-216"></a><span>        </span><a name="local-6989586621679037959"><a href="#local-6989586621679037959"><span class="hs-identifier">mutArr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">thawArray</span><span> </span><a href="#local-6989586621679037848"><span class="hs-identifier hs-var">trAs</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679037958"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-217"></a><span>        </span><a name="local-6989586621679037974"><a href="#local-6989586621679037974"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.TypeRepMap.Internal.html#toAny"><span class="hs-identifier hs-var">toAny</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679037844"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.TypeRepMap.Internal.html#fromAny"><span class="hs-identifier hs-var">fromAny</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">readArray</span><span> </span><a href="#local-6989586621679037959"><span class="hs-identifier hs-var">mutArr</span></a><span> </span><a href="#local-6989586621679037847"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-218"></a><span>        </span><span class="hs-identifier hs-var">writeArray</span><span> </span><a href="#local-6989586621679037959"><span class="hs-identifier hs-var">mutArr</span></a><span> </span><a href="#local-6989586621679037847"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679037974"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-219"></a><span>        </span><span class="hs-identifier hs-var">unsafeFreezeArray</span><span> </span><a href="#local-6989586621679037959"><span class="hs-identifier hs-var">mutArr</span></a><span>
</span><a name="line-220"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">adjust</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span class="hs-comment">{- | Map over the elements of a 'TypeRepMap'.

&gt;&gt;&gt; tm = insert (Identity True) $ one (Identity 'a')
&gt;&gt;&gt; lookup @Bool tm
Just (Identity True)
&gt;&gt;&gt; lookup @Char tm
Just (Identity 'a')
&gt;&gt;&gt; tm2 = hoist ((:[]) . runIdentity) tm
&gt;&gt;&gt; lookup @Bool tm2
Just [True]
&gt;&gt;&gt; lookup @Char tm2
Just &quot;a&quot;
-}</span><span>
</span><a name="line-235"></a><span class="hs-identifier">hoist</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679037635"><a href="#local-6989586621679037635"><span class="hs-identifier">x</span></a></a><span class="hs-operator">.</span><span> </span><a href="#local-6989586621679037633"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037635"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037634"><span class="hs-identifier hs-type">g</span></a><span> </span><a href="#local-6989586621679037635"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037633"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037634"><span class="hs-identifier hs-type">g</span></a><span>
</span><a name="line-236"></a><a name="hoist"><a href="Data.TypeRepMap.Internal.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><a name="local-6989586621679037976"><a href="#local-6989586621679037976"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-var">TypeRepMap</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a name="local-6989586621679037978"><a href="#local-6989586621679037978"><span class="hs-identifier">bs</span></a></a><span> </span><a name="local-6989586621679037979"><a href="#local-6989586621679037979"><span class="hs-identifier">ans</span></a></a><span> </span><a name="local-6989586621679037980"><a href="#local-6989586621679037980"><span class="hs-identifier">ks</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-var">TypeRepMap</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-6989586621679037978"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapArray'</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#toAny"><span class="hs-identifier hs-var">toAny</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679037976"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.TypeRepMap.Internal.html#fromAny"><span class="hs-identifier hs-var">fromAny</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679037979"><span class="hs-identifier hs-var">ans</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679037980"><span class="hs-identifier hs-var">ks</span></a><span>
</span><a name="line-237"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">hoist</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span class="hs-identifier">hoistA</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-6989586621679037629"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679037632"><a href="#local-6989586621679037632"><span class="hs-identifier">x</span></a></a><span class="hs-operator">.</span><span> </span><a href="#local-6989586621679037630"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037632"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037629"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679037631"><span class="hs-identifier hs-type">g</span></a><span> </span><a href="#local-6989586621679037632"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037630"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037629"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037631"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-240"></a><a name="hoistA"><a href="Data.TypeRepMap.Internal.html#hoistA"><span class="hs-identifier">hoistA</span></a></a><span> </span><a name="local-6989586621679037981"><a href="#local-6989586621679037981"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-var">TypeRepMap</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a name="local-6989586621679037983"><a href="#local-6989586621679037983"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-6989586621679037984"><a href="#local-6989586621679037984"><span class="hs-identifier">ans</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679037985"><a href="#local-6989586621679037985"><span class="hs-identifier">ks</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679037986"><a href="#local-6989586621679037986"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-var">TypeRepMap</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-6989586621679037983"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Data.TypeRepMap.Internal.html#toAny"><span class="hs-identifier hs-var">toAny</span></a><span> </span><a href="#local-6989586621679037986"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679037985"><span class="hs-identifier hs-var">ks</span></a><span class="hs-special">)</span><span>
</span><a name="line-241"></a><span>    </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679037981"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.TypeRepMap.Internal.html#fromAny"><span class="hs-identifier hs-var">fromAny</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679037984"><span class="hs-identifier hs-var">ans</span></a><span>
</span><a name="line-242"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">hoistA</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-243"></a><span>
</span><a name="line-244"></a><span class="hs-identifier">hoistWithKey</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679037626"><a href="#local-6989586621679037626"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679037627"><a href="#local-6989586621679037627"><span class="hs-identifier">g</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679037628"><a href="#local-6989586621679037628"><span class="hs-identifier">x</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679037628"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679037626"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037628"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037627"><span class="hs-identifier hs-type">g</span></a><span> </span><a href="#local-6989586621679037628"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037626"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037627"><span class="hs-identifier hs-type">g</span></a><span>
</span><a name="line-245"></a><a name="hoistWithKey"><a href="Data.TypeRepMap.Internal.html#hoistWithKey"><span class="hs-identifier">hoistWithKey</span></a></a><span> </span><a name="local-6989586621679038397"><a href="#local-6989586621679038397"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-var">TypeRepMap</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a name="local-6989586621679038399"><a href="#local-6989586621679038399"><span class="hs-identifier">bs</span></a></a><span> </span><a name="local-6989586621679038400"><a href="#local-6989586621679038400"><span class="hs-identifier">ans</span></a></a><span> </span><a name="local-6989586621679038401"><a href="#local-6989586621679038401"><span class="hs-identifier">ks</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-var">TypeRepMap</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-6989586621679038399"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621679038402"><span class="hs-identifier hs-var">newAns</span></a><span> </span><a href="#local-6989586621679038401"><span class="hs-identifier hs-var">ks</span></a><span>
</span><a name="line-246"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-247"></a><span>    </span><a name="local-6989586621679038402"><a href="#local-6989586621679038402"><span class="hs-identifier">newAns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapArray'</span><span> </span><a href="#local-6989586621679038403"><span class="hs-identifier hs-var">mapAns</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mzip</span><span> </span><a href="#local-6989586621679038400"><span class="hs-identifier hs-var">ans</span></a><span> </span><a href="#local-6989586621679038401"><span class="hs-identifier hs-var">ks</span></a><span class="hs-special">)</span><span>
</span><a name="line-248"></a><span>    </span><a name="local-6989586621679038403"><a href="#local-6989586621679038403"><span class="hs-identifier">mapAns</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679038406"><a href="#local-6989586621679038406"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679038407"><a href="#local-6989586621679038407"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#toAny"><span class="hs-identifier hs-var">toAny</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679038404"><span class="hs-identifier hs-var">withTr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unsafeCoerce</span><span> </span><a href="#local-6989586621679038407"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.TypeRepMap.Internal.html#fromAny"><span class="hs-identifier hs-var">fromAny</span></a><span> </span><a href="#local-6989586621679038406"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span>    </span><span class="hs-identifier">withTr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679038405"><a href="#local-6989586621679038405"><span class="hs-identifier">x</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">TypeRep</span><span> </span><a href="#local-6989586621679038405"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037626"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679038405"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037627"><span class="hs-identifier hs-type">g</span></a><span> </span><a href="#local-6989586621679038405"><span class="hs-identifier hs-type">x</span></a><span>
</span><a name="line-251"></a><span>    </span><a name="local-6989586621679038404"><a href="#local-6989586621679038404"><span class="hs-identifier">withTr</span></a></a><span> </span><a name="local-6989586621679038408"><a href="#local-6989586621679038408"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withTypeable</span><span> </span><a href="#local-6989586621679038408"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621679038397"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-252"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">hoistWithKey</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-253"></a><span>
</span><a name="line-254"></a><span class="hs-comment">-- | The union of two 'TypeRepMap's using a combining function.</span><span>
</span><a name="line-255"></a><span class="hs-identifier">unionWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679037624"><a href="#local-6989586621679037624"><span class="hs-identifier">f</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679037625"><a href="#local-6989586621679037625"><span class="hs-identifier">x</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679037625"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679037624"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037625"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037624"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037625"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037624"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037625"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037624"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037624"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037624"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-256"></a><a name="unionWith"><a href="Data.TypeRepMap.Internal.html#unionWith"><span class="hs-identifier">unionWith</span></a></a><span> </span><a name="local-6989586621679038409"><a href="#local-6989586621679038409"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679038410"><a href="#local-6989586621679038410"><span class="hs-identifier">m1</span></a></a><span> </span><a name="local-6989586621679038411"><a href="#local-6989586621679038411"><span class="hs-identifier">m2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#fromTriples"><span class="hs-identifier hs-var">fromTriples</span></a><span>
</span><a name="line-257"></a><span>                  </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679038415"><span class="hs-identifier hs-var">toTripleList</span></a><span>
</span><a name="line-258"></a><span>                  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Map.unionWith</span><span> </span><a href="#local-6989586621679038413"><span class="hs-identifier hs-var">combine</span></a><span>
</span><a name="line-259"></a><span>                                  </span><span class="hs-special">(</span><a href="#local-6989586621679038414"><span class="hs-identifier hs-var">fromTripleList</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.TypeRepMap.Internal.html#toTriples"><span class="hs-identifier hs-var">toTriples</span></a><span> </span><a href="#local-6989586621679038410"><span class="hs-identifier hs-var">m1</span></a><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>                                  </span><span class="hs-special">(</span><a href="#local-6989586621679038414"><span class="hs-identifier hs-var">fromTripleList</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.TypeRepMap.Internal.html#toTriples"><span class="hs-identifier hs-var">toTriples</span></a><span> </span><a href="#local-6989586621679038411"><span class="hs-identifier hs-var">m2</span></a><span class="hs-special">)</span><span>
</span><a name="line-261"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-262"></a><span>    </span><span class="hs-identifier">f'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679038416"><a href="#local-6989586621679038416"><span class="hs-identifier">x</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">TypeRep</span><span> </span><a href="#local-6989586621679038416"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037624"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679038416"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037624"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679038416"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037624"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679038416"><span class="hs-identifier hs-type">x</span></a><span>
</span><a name="line-263"></a><span>    </span><a name="local-6989586621679038412"><a href="#local-6989586621679038412"><span class="hs-identifier">f'</span></a></a><span> </span><a name="local-6989586621679038423"><a href="#local-6989586621679038423"><span class="hs-identifier">tr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withTypeable</span><span> </span><a href="#local-6989586621679038423"><span class="hs-identifier hs-var">tr</span></a><span> </span><a href="#local-6989586621679038409"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-264"></a><span>
</span><a name="line-265"></a><span>    </span><span class="hs-identifier">combine</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Any</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Any</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Any</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">)</span><span>
</span><a name="line-266"></a><span>    </span><a name="local-6989586621679038413"><a href="#local-6989586621679038413"><span class="hs-identifier">combine</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679038424"><a href="#local-6989586621679038424"><span class="hs-identifier">av</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679038425"><a href="#local-6989586621679038425"><span class="hs-identifier">ak</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679038426"><a href="#local-6989586621679038426"><span class="hs-identifier">bv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#toAny"><span class="hs-identifier hs-var">toAny</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679038412"><span class="hs-identifier hs-var">f'</span></a><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#fromAny"><span class="hs-identifier hs-var">fromAny</span></a><span> </span><a href="#local-6989586621679038425"><span class="hs-identifier hs-var">ak</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#fromAny"><span class="hs-identifier hs-var">fromAny</span></a><span> </span><a href="#local-6989586621679038424"><span class="hs-identifier hs-var">av</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#fromAny"><span class="hs-identifier hs-var">fromAny</span></a><span> </span><a href="#local-6989586621679038426"><span class="hs-identifier hs-var">bv</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679038425"><span class="hs-identifier hs-var">ak</span></a><span class="hs-special">)</span><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span>    </span><span class="hs-identifier">fromTripleList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679038417"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679038417"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679038418"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679038419"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map.Map</span><span> </span><a href="#local-6989586621679038417"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679038418"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679038419"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-269"></a><span>    </span><a name="local-6989586621679038414"><a href="#local-6989586621679038414"><span class="hs-identifier">fromTripleList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.fromList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679038534"><a href="#local-6989586621679038534"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679038535"><a href="#local-6989586621679038535"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679038536"><a href="#local-6989586621679038536"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679038534"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679038535"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679038536"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span>    </span><span class="hs-identifier">toTripleList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map.Map</span><span> </span><a href="#local-6989586621679038420"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679038421"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679038422"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679038420"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679038421"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679038422"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-272"></a><span>    </span><a name="local-6989586621679038415"><a href="#local-6989586621679038415"><span class="hs-identifier">toTripleList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679038537"><a href="#local-6989586621679038537"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679038538"><a href="#local-6989586621679038538"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679038539"><a href="#local-6989586621679038539"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679038537"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679038538"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679038539"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Map.toList</span><span>
</span><a name="line-273"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unionWith</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-comment">-- | The (left-biased) union of two 'TypeRepMap's. It prefers the first map when</span><span>
</span><a name="line-276"></a><span class="hs-comment">-- duplicate keys are encountered, i.e. @'union' == 'unionWith' const@.</span><span>
</span><a name="line-277"></a><span class="hs-identifier">union</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037623"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037623"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037623"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-278"></a><a name="union"><a href="Data.TypeRepMap.Internal.html#union"><span class="hs-identifier">union</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#unionWith"><span class="hs-identifier hs-var">unionWith</span></a><span> </span><span class="hs-identifier hs-var">const</span><span>
</span><a name="line-279"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">union</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-comment">{- | Check if a value of the given type is present in a 'TypeRepMap'.

&gt;&gt;&gt; member @Char $ one (Identity 'a')
True
&gt;&gt;&gt; member @Bool $ one (Identity 'a')
False
-}</span><span>
</span><a name="line-288"></a><span class="hs-identifier">member</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679037621"><a href="#local-6989586621679037621"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679037622"><a href="#local-6989586621679037622"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.TypeRepMap.Internal.html#KindOf"><span class="hs-identifier hs-type">KindOf</span></a><span> </span><a href="#local-6989586621679037621"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679037621"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037622"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-289"></a><a name="member"><a href="Data.TypeRepMap.Internal.html#member"><span class="hs-identifier">member</span></a></a><span> </span><a name="local-6989586621679038540"><a href="#local-6989586621679038540"><span class="hs-identifier">tm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Data.TypeRepMap.Internal.html#lookup"><span class="hs-identifier hs-var">lookup</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679037621"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679038540"><span class="hs-identifier hs-var">tm</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-290"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-291"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-292"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">member</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-293"></a><span>
</span><a name="line-294"></a><span class="hs-comment">{- | Lookup a value of the given type in a 'TypeRepMap'.

&gt;&gt;&gt; x = lookup $ insert (Identity (11 :: Int)) empty
&gt;&gt;&gt; x :: Maybe (Identity Int)
Just (Identity 11)
&gt;&gt;&gt; x :: Maybe (Identity ())
Nothing
-}</span><span>
</span><a name="line-302"></a><span class="hs-identifier">lookup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679037619"><a href="#local-6989586621679037619"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679037620"><a href="#local-6989586621679037620"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679037619"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037620"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679037620"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037619"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-303"></a><a name="lookup"><a href="Data.TypeRepMap.Internal.html#lookup"><span class="hs-identifier">lookup</span></a></a><span> </span><a name="local-6989586621679038541"><a href="#local-6989586621679038541"><span class="hs-identifier">tVect</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#fromAny"><span class="hs-identifier hs-var">fromAny</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">trAnys</span><span> </span><a href="#local-6989586621679038541"><span class="hs-identifier hs-var">tVect</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">indexArray</span><span class="hs-special">`</span><span class="hs-special">)</span><span>
</span><a name="line-304"></a><span>           </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#cachedBinarySearch"><span class="hs-identifier hs-var">cachedBinarySearch</span></a><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#typeFp"><span class="hs-identifier hs-var">typeFp</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679037619"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-305"></a><span>                                  </span><span class="hs-special">(</span><span class="hs-identifier">fingerprintAs</span><span> </span><a href="#local-6989586621679038541"><span class="hs-identifier hs-var">tVect</span></a><span class="hs-special">)</span><span>
</span><a name="line-306"></a><span>                                  </span><span class="hs-special">(</span><span class="hs-identifier">fingerprintBs</span><span> </span><a href="#local-6989586621679038541"><span class="hs-identifier hs-var">tVect</span></a><span class="hs-special">)</span><span>
</span><a name="line-307"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">lookup</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-comment">-- | Get the amount of elements in a 'TypeRepMap'.</span><span>
</span><a name="line-310"></a><span class="hs-identifier">size</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037618"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-311"></a><a name="size"><a href="Data.TypeRepMap.Internal.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sizeofPrimArray</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">fingerprintAs</span><span>
</span><a name="line-312"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">size</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-313"></a><span>
</span><a name="line-314"></a><span class="hs-comment">-- | Return the list of 'SomeTypeRep' from the keys.</span><span>
</span><a name="line-315"></a><span class="hs-identifier">keys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037617"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">SomeTypeRep</span><span class="hs-special">]</span><span>
</span><a name="line-316"></a><a name="keys"><a href="Data.TypeRepMap.Internal.html#keys"><span class="hs-identifier">keys</span></a></a><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-var">TypeRepMap</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">SomeTypeRep</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.TypeRepMap.Internal.html#anyToTypeRep"><span class="hs-identifier hs-var">anyToTypeRep</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679038545"><span class="hs-identifier hs-var">trKeys</span></a><span>
</span><a name="line-317"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">keys</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span class="hs-comment">-- | Binary searched based on this article</span><span>
</span><a name="line-320"></a><span class="hs-comment">-- http://bannalia.blogspot.com/2015/06/cache-friendly-binary-search.html</span><span>
</span><a name="line-321"></a><span class="hs-comment">-- with modification for our two-vector search case.</span><span>
</span><a name="line-322"></a><span class="hs-identifier">cachedBinarySearch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Fingerprint</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">PrimArray</span><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">PrimArray</span><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-323"></a><a name="cachedBinarySearch"><a href="Data.TypeRepMap.Internal.html#cachedBinarySearch"><span class="hs-identifier">cachedBinarySearch</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Fingerprint</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">W64#</span><span> </span><a name="local-6989586621679038546"><a href="#local-6989586621679038546"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">W64#</span><span> </span><a name="local-6989586621679038547"><a href="#local-6989586621679038547"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679038548"><a href="#local-6989586621679038548"><span class="hs-identifier">fpAs</span></a></a><span> </span><a name="local-6989586621679038549"><a href="#local-6989586621679038549"><span class="hs-identifier">fpBs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">inline</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679038550"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">0#</span><span class="hs-special">)</span><span>
</span><a name="line-324"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-325"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-326"></a><span>    </span><a name="local-6989586621679038550"><a href="#local-6989586621679038550"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679038552"><a href="#local-6989586621679038552"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679038552"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&lt;#</span><span> </span><a href="#local-6989586621679038551"><span class="hs-identifier hs-var">len</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-327"></a><span>        </span><span class="hs-number">0#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-328"></a><span>        </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-var">W64#</span><span> </span><a name="local-6989586621679038553"><a href="#local-6989586621679038553"><span class="hs-identifier">valA</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">indexPrimArray</span><span> </span><a href="#local-6989586621679038548"><span class="hs-identifier hs-var">fpAs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I#</span><span> </span><a href="#local-6989586621679038552"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679038546"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">ltWord#</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679038553"><span class="hs-identifier hs-var">valA</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-329"></a><span>            </span><span class="hs-number">0#</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679038546"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqWord#</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679038553"><span class="hs-identifier hs-var">valA</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-330"></a><span>                </span><span class="hs-number">0#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679038550"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2#</span><span> </span><span class="hs-operator hs-var">*#</span><span> </span><a href="#local-6989586621679038552"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+#</span><span> </span><span class="hs-number">2#</span><span class="hs-special">)</span><span>
</span><a name="line-331"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-var">W64#</span><span> </span><a name="local-6989586621679038554"><a href="#local-6989586621679038554"><span class="hs-identifier">valB</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">indexPrimArray</span><span> </span><a href="#local-6989586621679038549"><span class="hs-identifier hs-var">fpBs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I#</span><span> </span><a href="#local-6989586621679038552"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679038547"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqWord#</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679038554"><span class="hs-identifier hs-var">valB</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-332"></a><span>                    </span><span class="hs-number">0#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679038547"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">ltWord#</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679038554"><span class="hs-identifier hs-var">valB</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-333"></a><span>                        </span><span class="hs-number">0#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679038550"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2#</span><span> </span><span class="hs-operator hs-var">*#</span><span> </span><a href="#local-6989586621679038552"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+#</span><span> </span><span class="hs-number">2#</span><span class="hs-special">)</span><span>
</span><a name="line-334"></a><span>                        </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679038550"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2#</span><span> </span><span class="hs-operator hs-var">*#</span><span> </span><a href="#local-6989586621679038552"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+#</span><span> </span><span class="hs-number">1#</span><span class="hs-special">)</span><span>
</span><a name="line-335"></a><span>                    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I#</span><span> </span><a href="#local-6989586621679038552"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-336"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679038550"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2#</span><span> </span><span class="hs-operator hs-var">*#</span><span> </span><a href="#local-6989586621679038552"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+#</span><span> </span><span class="hs-number">1#</span><span class="hs-special">)</span><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span>    </span><span class="hs-identifier">len</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int#</span><span>
</span><a name="line-339"></a><span>    </span><a name="local-6989586621679038551"><a href="#local-6989586621679038551"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-var">I#</span><span> </span><a name="local-6989586621679038555"><a href="#local-6989586621679038555"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sizeofPrimArray</span><span> </span><a href="#local-6989586621679038548"><span class="hs-identifier hs-var">fpAs</span></a><span> </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679038555"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-340"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">cachedBinarySearch</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-343"></a><span class="hs-comment">-- Internal functions</span><span>
</span><a name="line-344"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-345"></a><span>
</span><a name="line-346"></a><span class="hs-identifier">toAny</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679037615"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037616"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Any</span><span>
</span><a name="line-347"></a><a name="toAny"><a href="Data.TypeRepMap.Internal.html#toAny"><span class="hs-identifier">toAny</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafeCoerce</span><span>
</span><a name="line-348"></a><span>
</span><a name="line-349"></a><span class="hs-identifier">fromAny</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Any</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037613"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037614"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-350"></a><a name="fromAny"><a href="Data.TypeRepMap.Internal.html#fromAny"><span class="hs-identifier">fromAny</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafeCoerce</span><span>
</span><a name="line-351"></a><span>
</span><a name="line-352"></a><span class="hs-identifier">anyToTypeRep</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Any</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeRep</span><span> </span><a href="#local-6989586621679037612"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-353"></a><a name="anyToTypeRep"><a href="Data.TypeRepMap.Internal.html#anyToTypeRep"><span class="hs-identifier">anyToTypeRep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafeCoerce</span><span>
</span><a name="line-354"></a><span>
</span><a name="line-355"></a><span class="hs-identifier">typeFp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679037611"><a href="#local-6989586621679037611"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679037611"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Fingerprint</span><span>
</span><a name="line-356"></a><a name="typeFp"><a href="Data.TypeRepMap.Internal.html#typeFp"><span class="hs-identifier">typeFp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeRepFingerprint</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">typeRep</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679037611"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-357"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">typeFp</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-358"></a><span>
</span><a name="line-359"></a><span class="hs-identifier">toTriples</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037610"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-360"></a><a name="toTriples"><a href="Data.TypeRepMap.Internal.html#toTriples"><span class="hs-identifier">toTriples</span></a></a><span> </span><a name="local-6989586621679038568"><a href="#local-6989586621679038568"><span class="hs-identifier">tm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip3</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#toFingerprints"><span class="hs-identifier hs-var">toFingerprints</span></a><span> </span><a href="#local-6989586621679038568"><span class="hs-identifier hs-var">tm</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">trAnys</span><span> </span><a href="#local-6989586621679038568"><span class="hs-identifier hs-var">tm</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">trKeys</span><span> </span><a href="#local-6989586621679038568"><span class="hs-identifier hs-var">tm</span></a><span class="hs-special">)</span><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span class="hs-identifier">deleteByFst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679037607"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679037607"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679037607"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679037608"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679037609"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679037607"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679037608"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679037609"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-363"></a><a name="deleteByFst"><a href="Data.TypeRepMap.Internal.html#deleteByFst"><span class="hs-identifier">deleteByFst</span></a></a><span> </span><a name="local-6989586621679038569"><a href="#local-6989586621679038569"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679038569"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.TypeRepMap.Internal.html#fst3"><span class="hs-identifier hs-var">fst3</span></a><span class="hs-special">)</span><span>
</span><a name="line-364"></a><span>
</span><a name="line-365"></a><span class="hs-identifier">nubByFst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679037604"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679037604"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679037605"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679037606"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679037604"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679037605"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679037606"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-366"></a><a name="nubByFst"><a href="Data.TypeRepMap.Internal.html#nubByFst"><span class="hs-identifier">nubByFst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nubBy</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">on</span><span class="hs-special">`</span><span> </span><a href="Data.TypeRepMap.Internal.html#fst3"><span class="hs-identifier hs-var">fst3</span></a><span class="hs-special">)</span><span>
</span><a name="line-367"></a><span>
</span><a name="line-368"></a><span class="hs-identifier">fst3</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679037601"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679037602"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679037603"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037601"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-369"></a><a name="fst3"><a href="Data.TypeRepMap.Internal.html#fst3"><span class="hs-identifier">fst3</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679038570"><a href="#local-6989586621679038570"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679038570"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-370"></a><span>
</span><a name="line-371"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- Functions for testing and benchmarking</span><span>
</span><a name="line-373"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-374"></a><span>
</span><a name="line-375"></a><span class="hs-comment">-- | Existential wrapper around 'Typeable' indexed by @f@ type parameter.</span><span>
</span><a name="line-376"></a><span class="hs-comment">-- Useful for 'TypeRepMap' structure creation form list of 'WrapTypeable's.</span><span>
</span><a name="line-377"></a><span class="hs-keyword">data</span><span> </span><a name="WrapTypeable"><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier">WrapTypeable</span></a></a><span> </span><a name="local-6989586621679036750"><a href="#local-6989586621679036750"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-378"></a><span>    </span><a name="WrapTypeable"><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier">WrapTypeable</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679036751"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679036752"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679036751"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier hs-type">WrapTypeable</span></a><span> </span><a href="#local-6989586621679036752"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-379"></a><span>
</span><a name="line-380"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier hs-type">WrapTypeable</span></a><span> </span><a href="#local-6989586621679037288"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-381"></a><span>    </span><a name="local-8214565720323790326"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier hs-var">WrapTypeable</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679037288"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037289"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.TypeRepMap.Internal.html#calcFp"><span class="hs-identifier hs-var">calcFp</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679037289"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span class="hs-identifier">wrapTypeable</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeRep</span><span> </span><a href="#local-6989586621679037599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679037600"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier hs-type">WrapTypeable</span></a><span> </span><a href="#local-6989586621679037600"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-384"></a><a name="wrapTypeable"><a href="Data.TypeRepMap.Internal.html#wrapTypeable"><span class="hs-identifier">wrapTypeable</span></a></a><span> </span><a name="local-6989586621679038571"><a href="#local-6989586621679038571"><span class="hs-identifier">tr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withTypeable</span><span> </span><a href="#local-6989586621679038571"><span class="hs-identifier hs-var">tr</span></a><span> </span><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier hs-var">WrapTypeable</span></a><span>
</span><a name="line-385"></a><span>
</span><a name="line-386"></a><span class="hs-comment">{- |

prop&gt; fromList . toList == 'id'

Creates 'TypeRepMap' from a list of 'WrapTypeable's.

&gt;&gt;&gt; show $ fromList [WrapTypeable $ Identity True, WrapTypeable $ Identity 'a']
TypeRepMap [Bool, Char]


-}</span><span>
</span><a name="line-397"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">IsList</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037208"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-398"></a><span>    </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Item</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037208"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier hs-type">WrapTypeable</span></a><span> </span><a href="#local-6989586621679037208"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span>    </span><span class="hs-identifier">fromList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier hs-type">WrapTypeable</span></a><span> </span><a href="#local-6989586621679037208"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037208"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-401"></a><span>    </span><a name="local-3458764513820541127"><span class="hs-identifier">fromList</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#fromTriples"><span class="hs-identifier hs-var">fromTriples</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679037284"><a href="#local-6989586621679037284"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679037209"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679037284"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679037210"><span class="hs-identifier hs-var">an</span></a><span> </span><a href="#local-6989586621679037284"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679037211"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679037284"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-402"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-403"></a><span>        </span><span class="hs-identifier">fp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier hs-type">WrapTypeable</span></a><span> </span><a href="#local-6989586621679037208"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Fingerprint</span><span>
</span><a name="line-404"></a><span>        </span><a name="local-6989586621679037209"><a href="#local-6989586621679037209"><span class="hs-identifier">fp</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier hs-var">WrapTypeable</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679037208"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037281"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#calcFp"><span class="hs-identifier hs-var">calcFp</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679037281"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-405"></a><span>
</span><a name="line-406"></a><span>        </span><span class="hs-identifier">an</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier hs-type">WrapTypeable</span></a><span> </span><a href="#local-6989586621679037208"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Any</span><span>
</span><a name="line-407"></a><span>        </span><a name="local-6989586621679037210"><a href="#local-6989586621679037210"><span class="hs-identifier">an</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier hs-var">WrapTypeable</span></a><span> </span><a name="local-6989586621679037282"><a href="#local-6989586621679037282"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#toAny"><span class="hs-identifier hs-var">toAny</span></a><span> </span><a href="#local-6989586621679037282"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-408"></a><span>
</span><a name="line-409"></a><span>        </span><span class="hs-identifier">k</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier hs-type">WrapTypeable</span></a><span> </span><a href="#local-6989586621679037208"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Any</span><span>
</span><a name="line-410"></a><span>        </span><a name="local-6989586621679037211"><a href="#local-6989586621679037211"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier hs-var">WrapTypeable</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679037208"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679037283"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafeCoerce</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">typeRep</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679037283"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-411"></a><span>
</span><a name="line-412"></a><span>    </span><span class="hs-identifier">toList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037208"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier hs-type">WrapTypeable</span></a><span> </span><a href="#local-6989586621679037208"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">]</span><span>
</span><a name="line-413"></a><span>    </span><a name="local-3458764513820541429"><span class="hs-identifier">toList</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679037285"><span class="hs-identifier hs-var">toWrapTypeable</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.TypeRepMap.Internal.html#toTriples"><span class="hs-identifier hs-var">toTriples</span></a><span>
</span><a name="line-414"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-415"></a><span>        </span><span class="hs-identifier">toWrapTypeable</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#WrapTypeable"><span class="hs-identifier hs-type">WrapTypeable</span></a><span> </span><a href="#local-6989586621679037208"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-416"></a><span>        </span><a name="local-6989586621679037285"><a href="#local-6989586621679037285"><span class="hs-identifier">toWrapTypeable</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679037286"><a href="#local-6989586621679037286"><span class="hs-identifier">an</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679037287"><a href="#local-6989586621679037287"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#wrapTypeable"><span class="hs-identifier hs-var">wrapTypeable</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unsafeCoerce</span><span> </span><a href="#local-6989586621679037287"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.TypeRepMap.Internal.html#fromAny"><span class="hs-identifier hs-var">fromAny</span></a><span> </span><a href="#local-6989586621679037286"><span class="hs-identifier hs-var">an</span></a><span class="hs-special">)</span><span>
</span><a name="line-417"></a><span>
</span><a name="line-418"></a><span class="hs-identifier">calcFp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679037598"><a href="#local-6989586621679037598"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679037598"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Fingerprint</span><span>
</span><a name="line-419"></a><a name="calcFp"><a href="Data.TypeRepMap.Internal.html#calcFp"><span class="hs-identifier">calcFp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeRepFingerprint</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">typeRep</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679037598"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-420"></a><span>
</span><a name="line-421"></a><span class="hs-identifier">fromTriples</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Any</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-type">TypeRepMap</span></a><span> </span><a href="#local-6989586621679037597"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-422"></a><a name="fromTriples"><a href="Data.TypeRepMap.Internal.html#fromTriples"><span class="hs-identifier">fromTriples</span></a></a><span> </span><a name="local-6989586621679038572"><a href="#local-6989586621679038572"><span class="hs-identifier">kvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.TypeRepMap.Internal.html#TypeRepMap"><span class="hs-identifier hs-var">TypeRepMap</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.fromList</span><span> </span><a href="#local-6989586621679038573"><span class="hs-identifier hs-var">fpAs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.fromList</span><span> </span><a href="#local-6989586621679038574"><span class="hs-identifier hs-var">fpBs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.fromList</span><span> </span><a href="#local-6989586621679038576"><span class="hs-identifier hs-var">ans</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GHC.fromList</span><span> </span><a href="#local-6989586621679038577"><span class="hs-identifier hs-var">ks</span></a><span class="hs-special">)</span><span>
</span><a name="line-423"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-424"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679038573"><a href="#local-6989586621679038573"><span class="hs-identifier">fpAs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679038574"><a href="#local-6989586621679038574"><span class="hs-identifier">fpBs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Fingerprint</span><span> </span><a name="local-6989586621679038578"><a href="#local-6989586621679038578"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679038579"><a href="#local-6989586621679038579"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679038578"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679038579"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679038575"><span class="hs-identifier hs-var">fps</span></a><span>
</span><a name="line-425"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679038575"><a href="#local-6989586621679038575"><span class="hs-identifier">fps</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679038576"><a href="#local-6989586621679038576"><span class="hs-identifier">ans</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679038577"><a href="#local-6989586621679038577"><span class="hs-identifier">ks</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unzip3</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.TypeRepMap.Internal.html#fromSortedList"><span class="hs-identifier hs-var">fromSortedList</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">sortWith</span><span> </span><a href="Data.TypeRepMap.Internal.html#fst3"><span class="hs-identifier hs-var">fst3</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.TypeRepMap.Internal.html#nubByFst"><span class="hs-identifier hs-var">nubByFst</span></a><span> </span><a href="#local-6989586621679038572"><span class="hs-identifier hs-var">kvs</span></a><span>
</span><a name="line-426"></a><span>
</span><a name="line-427"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-428"></a><span class="hs-comment">-- Tree-like conversion</span><span>
</span><a name="line-429"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-430"></a><span>
</span><a name="line-431"></a><span class="hs-identifier">fromSortedList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679037596"><a href="#local-6989586621679037596"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679037596"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679037596"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-432"></a><a name="fromSortedList"><a href="Data.TypeRepMap.Internal.html#fromSortedList"><span class="hs-identifier">fromSortedList</span></a></a><span> </span><a name="local-6989586621679038580"><a href="#local-6989586621679038580"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">runST</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-433"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679038590"><a href="#local-6989586621679038590"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679038580"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-434"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679039714"><a href="#local-6989586621679039714"><span class="hs-identifier">arrOrigin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromListN</span><span> </span><a href="#local-6989586621679038590"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679038580"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-435"></a><span>    </span><a name="local-6989586621679039715"><a href="#local-6989586621679039715"><span class="hs-identifier">arrResult</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">thawArray</span><span> </span><a href="#local-6989586621679039714"><span class="hs-identifier hs-var">arrOrigin</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679038590"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-436"></a><span>    </span><a href="#local-6989586621679038581"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679038590"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679039715"><span class="hs-identifier hs-var">arrResult</span></a><span> </span><a href="#local-6989586621679039714"><span class="hs-identifier hs-var">arrOrigin</span></a><span>
</span><a name="line-437"></a><span>    </span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">unsafeFreezeArray</span><span> </span><a href="#local-6989586621679039715"><span class="hs-identifier hs-var">arrResult</span></a><span>
</span><a name="line-438"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-439"></a><span>    </span><span class="hs-comment">-- state monad could be used here, but it's another dependency</span><span>
</span><a name="line-440"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679038582"><a href="#local-6989586621679038582"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MutableArray</span><span> </span><a href="#local-6989586621679038582"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679037596"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Array</span><span> </span><a href="#local-6989586621679037596"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679038582"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-441"></a><span>    </span><a name="local-6989586621679038581"><a href="#local-6989586621679038581"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679038583"><a href="#local-6989586621679038583"><span class="hs-identifier">len</span></a></a><span> </span><a name="local-6989586621679038584"><a href="#local-6989586621679038584"><span class="hs-identifier">result</span></a></a><span> </span><a name="local-6989586621679038585"><a href="#local-6989586621679038585"><span class="hs-identifier">origin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$</span><span> </span><a href="#local-6989586621679038586"><span class="hs-identifier hs-var">loop</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-442"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-443"></a><span>        </span><span class="hs-identifier">loop</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679038582"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-444"></a><span>        </span><a name="local-6989586621679038586"><a href="#local-6989586621679038586"><span class="hs-identifier">loop</span></a></a><span> </span><a name="local-6989586621679038587"><a href="#local-6989586621679038587"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679038588"><a href="#local-6989586621679038588"><span class="hs-identifier">first</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-445"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679038587"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679038583"><span class="hs-identifier hs-var">len</span></a><span>
</span><a name="line-446"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679038588"><span class="hs-identifier hs-var">first</span></a><span>
</span><a name="line-447"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-448"></a><span>                </span><a name="local-6989586621679038589"><a href="#local-6989586621679038589"><span class="hs-identifier">newFirst</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679038586"><span class="hs-identifier hs-var">loop</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679038587"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679038588"><span class="hs-identifier hs-var">first</span></a><span>
</span><a name="line-449"></a><span>                </span><span class="hs-identifier hs-var">writeArray</span><span> </span><a href="#local-6989586621679038584"><span class="hs-identifier hs-var">result</span></a><span> </span><a href="#local-6989586621679038587"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">indexArray</span><span> </span><a href="#local-6989586621679038585"><span class="hs-identifier hs-var">origin</span></a><span> </span><a href="#local-6989586621679038589"><span class="hs-identifier hs-var">newFirst</span></a><span class="hs-special">)</span><span>
</span><a name="line-450"></a><span>                </span><a href="#local-6989586621679038586"><span class="hs-identifier hs-var">loop</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679038587"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679038589"><span class="hs-identifier hs-var">newFirst</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-451"></a></pre></body></html>