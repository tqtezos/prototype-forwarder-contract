<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP, TemplateHaskell #-}</span><span>
</span><a name="line-2"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.Haskell.TH.Extras</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>
</span><a name="line-5"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Generics</span><span>
</span><a name="line-6"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span>
</span><a name="line-7"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language.Haskell.TH</span><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language.Haskell.TH.Syntax</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-identifier">intIs64</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-11"></a><a name="intIs64"><a href="Language.Haskell.TH.Extras.html#intIs64"><span class="hs-identifier">intIs64</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maxBound</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">2</span><span class="hs-operator hs-var">^</span><span class="hs-number">32</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-identifier">replace</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679031504"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679031504"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679031504"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031504"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-14"></a><a name="replace"><a href="Language.Haskell.TH.Extras.html#replace"><span class="hs-identifier">replace</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ap</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-identifier">composeExprs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ExpQ</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ExpQ</span><span>
</span><a name="line-17"></a><a name="composeExprs"><a href="Language.Haskell.TH.Extras.html#composeExprs"><span class="hs-identifier">composeExprs</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[|</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-special">|]</span><span>
</span><a name="line-18"></a><span class="hs-identifier">composeExprs</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679036500"><a href="#local-6989586621679036500"><span class="hs-identifier">f</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036500"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-19"></a><span class="hs-identifier">composeExprs</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679036501"><a href="#local-6989586621679036501"><span class="hs-identifier">f</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679036502"><a href="#local-6989586621679036502"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[|</span><span> </span><span class="">$f</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">$(</span><a href="Language.Haskell.TH.Extras.html#composeExprs"><span class="hs-identifier hs-var">composeExprs</span></a><span> </span><a href="#local-6989586621679036502"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-identifier">nameOfCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Con</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-22"></a><a name="nameOfCon"><a href="Language.Haskell.TH.Extras.html#nameOfCon"><span class="hs-identifier">nameOfCon</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NormalC</span><span>  </span><a name="local-6989586621679036505"><a href="#local-6989586621679036505"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036505"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-23"></a><span class="hs-identifier">nameOfCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecC</span><span>     </span><a name="local-6989586621679036506"><a href="#local-6989586621679036506"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036506"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-24"></a><span class="hs-identifier">nameOfCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixC</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036507"><a href="#local-6989586621679036507"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036507"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-25"></a><span class="hs-identifier">nameOfCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForallC</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036508"><a href="#local-6989586621679036508"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Extras.html#nameOfCon"><span class="hs-identifier hs-var">nameOfCon</span></a><span> </span><a href="#local-6989586621679036508"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-26"></a><span class="hs-cpp">#if defined(__GLASGOW_HASKELL__) &amp;&amp; __GLASGOW_HASKELL__ &gt;= 800
</span><span class="hs-identifier">nameOfCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GadtC</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679036509"><a href="#local-6989586621679036509"><span class="hs-identifier">name</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036509"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-28"></a><span class="hs-identifier">nameOfCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecGadtC</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679036510"><a href="#local-6989586621679036510"><span class="hs-identifier">name</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036510"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-29"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-31"></a><span class="hs-comment">-- |WARNING: discards binders in GADTs and existentially-quantified constructors</span><span>
</span><a name="line-32"></a><span class="hs-identifier">argTypesOfCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Con</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span>
</span><a name="line-33"></a><a name="argTypesOfCon"><a href="Language.Haskell.TH.Extras.html#argTypesOfCon"><span class="hs-identifier">argTypesOfCon</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NormalC</span><span>  </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036511"><a href="#local-6989586621679036511"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679036511"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-34"></a><span class="hs-identifier">argTypesOfCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecC</span><span>     </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036527"><a href="#local-6989586621679036527"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679036528"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679036528"><a href="#local-6989586621679036528"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679036527"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">]</span><span>
</span><a name="line-35"></a><span class="hs-identifier">argTypesOfCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixC</span><span> </span><a name="local-6989586621679036529"><a href="#local-6989586621679036529"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036530"><a href="#local-6989586621679036530"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679036529"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679036530"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">]</span><span>
</span><a name="line-36"></a><span class="hs-identifier">argTypesOfCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForallC</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036531"><a href="#local-6989586621679036531"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Extras.html#argTypesOfCon"><span class="hs-identifier hs-var">argTypesOfCon</span></a><span> </span><a href="#local-6989586621679036531"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-37"></a><span class="hs-cpp">#if defined(__GLASGOW_HASKELL__) &amp;&amp; __GLASGOW_HASKELL__ &gt;= 800
</span><span class="hs-identifier">argTypesOfCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GadtC</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036532"><a href="#local-6989586621679036532"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679036532"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-39"></a><span class="hs-identifier">argTypesOfCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecGadtC</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036533"><a href="#local-6989586621679036533"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679036534"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679036534"><a href="#local-6989586621679036534"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679036533"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">]</span><span>
</span><a name="line-40"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-42"></a><span class="hs-identifier">nameOfBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyVarBndr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-43"></a><span class="hs-cpp">#if defined(__GLASGOW_HASKELL__) &amp;&amp; __GLASGOW_HASKELL__ &gt;= 700
</span><a name="nameOfBinder"><a href="Language.Haskell.TH.Extras.html#nameOfBinder"><span class="hs-identifier">nameOfBinder</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PlainTV</span><span> </span><a name="local-6989586621679036535"><a href="#local-6989586621679036535"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036535"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-45"></a><span class="hs-identifier">nameOfBinder</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">KindedTV</span><span> </span><a name="local-6989586621679036536"><a href="#local-6989586621679036536"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036536"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-46"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">nameOfBinder</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">id</span><span>
</span><a name="line-48"></a><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">TyVarBndr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Name</span><span>
</span><a name="line-49"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-51"></a><span class="hs-identifier">varsBoundInCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Con</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVarBndr</span><span class="hs-special">]</span><span>
</span><a name="line-52"></a><a name="varsBoundInCon"><a href="Language.Haskell.TH.Extras.html#varsBoundInCon"><span class="hs-identifier">varsBoundInCon</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForallC</span><span> </span><a name="local-6989586621679036537"><a href="#local-6989586621679036537"><span class="hs-identifier">bndrs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036538"><a href="#local-6989586621679036538"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036537"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Language.Haskell.TH.Extras.html#varsBoundInCon"><span class="hs-identifier hs-var">varsBoundInCon</span></a><span> </span><a href="#local-6989586621679036538"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-53"></a><span class="hs-identifier">varsBoundInCon</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-identifier">namesBoundInPat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>
</span><a name="line-56"></a><a name="namesBoundInPat"><a href="Language.Haskell.TH.Extras.html#namesBoundInPat"><span class="hs-identifier">namesBoundInPat</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarP</span><span> </span><a name="local-6989586621679036539"><a href="#local-6989586621679036539"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679036539"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span>
</span><a name="line-57"></a><span class="hs-identifier">namesBoundInPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TupP</span><span> </span><a name="local-6989586621679036540"><a href="#local-6989586621679036540"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036540"><span class="hs-identifier hs-var">pats</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="Language.Haskell.TH.Extras.html#namesBoundInPat"><span class="hs-identifier hs-var">namesBoundInPat</span></a><span>
</span><a name="line-58"></a><span class="hs-identifier">namesBoundInPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConP</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036541"><a href="#local-6989586621679036541"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036541"><span class="hs-identifier hs-var">pats</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="Language.Haskell.TH.Extras.html#namesBoundInPat"><span class="hs-identifier hs-var">namesBoundInPat</span></a><span>
</span><a name="line-59"></a><span class="hs-identifier">namesBoundInPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixP</span><span> </span><a name="local-6989586621679036542"><a href="#local-6989586621679036542"><span class="hs-identifier">p1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036543"><a href="#local-6989586621679036543"><span class="hs-identifier">p2</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Extras.html#namesBoundInPat"><span class="hs-identifier hs-var">namesBoundInPat</span></a><span> </span><a href="#local-6989586621679036542"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Language.Haskell.TH.Extras.html#namesBoundInPat"><span class="hs-identifier hs-var">namesBoundInPat</span></a><span> </span><a href="#local-6989586621679036543"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-60"></a><span class="hs-identifier">namesBoundInPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TildeP</span><span> </span><a name="local-6989586621679036544"><a href="#local-6989586621679036544"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Extras.html#namesBoundInPat"><span class="hs-identifier hs-var">namesBoundInPat</span></a><span> </span><a href="#local-6989586621679036544"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-61"></a><span class="hs-identifier">namesBoundInPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AsP</span><span> </span><a name="local-6989586621679036545"><a href="#local-6989586621679036545"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679036546"><a href="#local-6989586621679036546"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036545"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Language.Haskell.TH.Extras.html#namesBoundInPat"><span class="hs-identifier hs-var">namesBoundInPat</span></a><span> </span><a href="#local-6989586621679036546"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-62"></a><span class="hs-identifier">namesBoundInPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecP</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036547"><a href="#local-6989586621679036547"><span class="hs-identifier">fieldPats</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679036547"><span class="hs-identifier hs-var">fieldPats</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="Language.Haskell.TH.Extras.html#namesBoundInPat"><span class="hs-identifier hs-var">namesBoundInPat</span></a><span>
</span><a name="line-63"></a><span class="hs-identifier">namesBoundInPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListP</span><span> </span><a name="local-6989586621679036548"><a href="#local-6989586621679036548"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036548"><span class="hs-identifier hs-var">pats</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="Language.Haskell.TH.Extras.html#namesBoundInPat"><span class="hs-identifier hs-var">namesBoundInPat</span></a><span>
</span><a name="line-64"></a><span class="hs-identifier">namesBoundInPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigP</span><span> </span><a name="local-6989586621679036549"><a href="#local-6989586621679036549"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Extras.html#namesBoundInPat"><span class="hs-identifier hs-var">namesBoundInPat</span></a><span> </span><a href="#local-6989586621679036549"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-cpp">#if defined(__GLASGOW_HASKELL__) &amp;&amp; __GLASGOW_HASKELL__ &gt;= 612
</span><span class="hs-identifier">namesBoundInPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BangP</span><span> </span><a name="local-6989586621679036550"><a href="#local-6989586621679036550"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Extras.html#namesBoundInPat"><span class="hs-identifier hs-var">namesBoundInPat</span></a><span> </span><a href="#local-6989586621679036550"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-68"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-70"></a><span class="hs-cpp">#if defined(__GLASGOW_HASKELL__) &amp;&amp; __GLASGOW_HASKELL__ &gt;= 700
</span><span class="hs-identifier">namesBoundInPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ViewP</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036551"><a href="#local-6989586621679036551"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Extras.html#namesBoundInPat"><span class="hs-identifier hs-var">namesBoundInPat</span></a><span> </span><a href="#local-6989586621679036551"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-72"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-74"></a><span class="hs-cpp">#if defined(__GLASGOW_HASKELL__) &amp;&amp; __GLASGOW_HASKELL__ &gt;= 702
</span><span class="hs-identifier">namesBoundInPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">UnboxedTupP</span><span> </span><a name="local-6989586621679036552"><a href="#local-6989586621679036552"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036552"><span class="hs-identifier hs-var">pats</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="Language.Haskell.TH.Extras.html#namesBoundInPat"><span class="hs-identifier hs-var">namesBoundInPat</span></a><span>
</span><a name="line-76"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-78"></a><span class="hs-identifier">namesBoundInPat</span><span> </span><span class="hs-identifier">_</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-identifier">namesBoundInDec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Dec</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>
</span><a name="line-82"></a><a name="namesBoundInDec"><a href="Language.Haskell.TH.Extras.html#namesBoundInDec"><span class="hs-identifier">namesBoundInDec</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FunD</span><span> </span><a name="local-6989586621679036553"><a href="#local-6989586621679036553"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679036553"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span>
</span><a name="line-83"></a><span class="hs-identifier">namesBoundInDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ValD</span><span> </span><a name="local-6989586621679036554"><a href="#local-6989586621679036554"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                      </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Extras.html#namesBoundInPat"><span class="hs-identifier hs-var">namesBoundInPat</span></a><span> </span><a href="#local-6989586621679036554"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-cpp">#if defined(__GLASGOW_HASKELL__) &amp;&amp; __GLASGOW_HASKELL__ &gt;= 800
</span><span class="hs-identifier">namesBoundInDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DataD</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036555"><a href="#local-6989586621679036555"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679036555"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span>
</span><a name="line-87"></a><span class="hs-identifier">namesBoundInDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NewtypeD</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036556"><a href="#local-6989586621679036556"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679036556"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span>
</span><a name="line-88"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">namesBoundInDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DataD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">name</span><span class="hs-special">]</span><span>
</span><a name="line-90"></a><span class="hs-identifier">namesBoundInDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NewtypeD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">name</span><span class="hs-special">]</span><span>
</span><a name="line-91"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-93"></a><span class="hs-identifier">namesBoundInDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TySynD</span><span> </span><a name="local-6989586621679036557"><a href="#local-6989586621679036557"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679036557"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span>
</span><a name="line-94"></a><span class="hs-identifier">namesBoundInDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClassD</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036558"><a href="#local-6989586621679036558"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679036558"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span>
</span><a name="line-95"></a><span class="hs-identifier">namesBoundInDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForeignD</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ImportF</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679036559"><a href="#local-6989586621679036559"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679036559"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-cpp">#if defined(__GLASGOW_HASKELL__)
#if __GLASGOW_HASKELL__ &gt;= 800
</span><span class="hs-identifier">namesBoundInDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OpenTypeFamilyD</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeFamilyHead</span><span> </span><a name="local-6989586621679036560"><a href="#local-6989586621679036560"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679036560"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span>
</span><a name="line-100"></a><span class="hs-identifier">namesBoundInDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClosedTypeFamilyD</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeFamilyHead</span><span> </span><a name="local-6989586621679036561"><a href="#local-6989586621679036561"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679036561"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span>
</span><a name="line-101"></a><span class="hs-cpp">#elif __GLASGOW_HASKELL__ &gt;= 612
</span><span class="hs-identifier">namesBoundInDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">FamilyD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">name</span><span class="hs-special">]</span><span>
</span><a name="line-103"></a><span class="hs-cpp">#endif
#endif
</span><span>
</span><a name="line-106"></a><span class="hs-identifier">namesBoundInDec</span><span> </span><span class="hs-identifier">_</span><span>                                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-identifier">genericalizeName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-109"></a><a name="genericalizeName"><a href="Language.Haskell.TH.Extras.html#genericalizeName"><span class="hs-identifier">genericalizeName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nameBase</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-comment">-- Genericalize all names defined at the top level, to fix the lunacy introduced in GHC 7.2.</span><span>
</span><a name="line-112"></a><span class="hs-comment">-- Why they should be fresh is beyond me; it really seems absurd because there is no way whatsoever</span><span>
</span><a name="line-113"></a><span class="hs-comment">-- to refer to names known to be bound in [d||] quotes other than to scrounge around inside the</span><span>
</span><a name="line-114"></a><span class="hs-comment">-- generated 'Dec's.</span><span>
</span><a name="line-115"></a><span class="hs-identifier">genericalizeDecs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>
</span><a name="line-116"></a><a name="genericalizeDecs"><a href="Language.Haskell.TH.Extras.html#genericalizeDecs"><span class="hs-identifier">genericalizeDecs</span></a></a><span> </span><a name="local-6989586621679036562"><a href="#local-6989586621679036562"><span class="hs-identifier">decs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">everywhere</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkT</span><span> </span><a href="#local-6989586621679036565"><span class="hs-identifier hs-var">fixName</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679036562"><span class="hs-identifier hs-var">decs</span></a><span>
</span><a name="line-117"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-118"></a><span>        </span><span class="hs-comment">-- get all names bound in the decs and make them generic</span><span>
</span><a name="line-119"></a><span>        </span><span class="hs-comment">-- at every occurence in decs.</span><span>
</span><a name="line-120"></a><span>        </span><a name="local-6989586621679036563"><a href="#local-6989586621679036563"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036562"><span class="hs-identifier hs-var">decs</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="Language.Haskell.TH.Extras.html#namesBoundInDec"><span class="hs-identifier hs-var">namesBoundInDec</span></a><span>
</span><a name="line-121"></a><span>        </span><a name="local-6989586621679036564"><a href="#local-6989586621679036564"><span class="hs-identifier">genericalizedNames</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679036566"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Extras.html#genericalizeName"><span class="hs-identifier hs-var">genericalizeName</span></a><span> </span><a href="#local-6989586621679036566"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679036566"><a href="#local-6989586621679036566"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679036563"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">]</span><span>
</span><a name="line-122"></a><span>        </span><a name="local-6989586621679036565"><a href="#local-6989586621679036565"><span class="hs-identifier">fixName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Extras.html#replace"><span class="hs-identifier hs-var">replace</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679036564"><span class="hs-identifier hs-var">genericalizedNames</span></a><span class="hs-special">)</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-identifier">headOfType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-125"></a><a name="headOfType"><a href="Language.Haskell.TH.Extras.html#headOfType"><span class="hs-identifier">headOfType</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForallT</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679037044"><a href="#local-6989586621679037044"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Extras.html#headOfType"><span class="hs-identifier hs-var">headOfType</span></a><span> </span><a href="#local-6989586621679037044"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-126"></a><span class="hs-identifier">headOfType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarT</span><span> </span><a name="local-6989586621679037045"><a href="#local-6989586621679037045"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679037045"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-127"></a><span class="hs-identifier">headOfType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConT</span><span> </span><a name="local-6989586621679037046"><a href="#local-6989586621679037046"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679037046"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-128"></a><span class="hs-identifier">headOfType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TupleT</span><span> </span><a name="local-6989586621679037047"><a href="#local-6989586621679037047"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tupleTypeName</span><span> </span><a href="#local-6989586621679037047"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-129"></a><span class="hs-identifier">headOfType</span><span> </span><span class="hs-identifier hs-var">ArrowT</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">''</span><span class="hs-special">(</span><span class="hs-glyph">-&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-130"></a><span class="hs-identifier">headOfType</span><span> </span><span class="hs-identifier hs-var">ListT</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">''</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-131"></a><span class="hs-identifier">headOfType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppT</span><span> </span><a name="local-6989586621679037048"><a href="#local-6989586621679037048"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Extras.html#headOfType"><span class="hs-identifier hs-var">headOfType</span></a><span> </span><a href="#local-6989586621679037048"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-cpp">#if defined(__GLASGOW_HASKELL__) &amp;&amp; __GLASGOW_HASKELL__ &gt;= 612
</span><span class="hs-identifier">headOfType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigT</span><span> </span><a name="local-6989586621679037049"><a href="#local-6989586621679037049"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Extras.html#headOfType"><span class="hs-identifier hs-var">headOfType</span></a><span> </span><a href="#local-6989586621679037049"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-135"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-137"></a><span class="hs-cpp">#if defined(__GLASGOW_HASKELL__) &amp;&amp; __GLASGOW_HASKELL__ &gt;= 702
</span><span class="hs-identifier">headOfType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">UnboxedTupleT</span><span> </span><a name="local-6989586621679037050"><a href="#local-6989586621679037050"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unboxedTupleTypeName</span><span> </span><a href="#local-6989586621679037050"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-139"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-141"></a><span class="hs-identifier">occursInType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-142"></a><a name="occursInType"><a href="Language.Haskell.TH.Extras.html#occursInType"><span class="hs-identifier">occursInType</span></a></a><span> </span><a name="local-6989586621679037051"><a href="#local-6989586621679037051"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679037052"><a href="#local-6989586621679037052"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679037052"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-143"></a><span>        </span><span class="hs-identifier hs-var">ForallT</span><span> </span><a name="local-6989586621679037053"><a href="#local-6989586621679037053"><span class="hs-identifier">bndrs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679037054"><a href="#local-6989586621679037054"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-144"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679037051"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Language.Haskell.TH.Extras.html#nameOfBinder"><span class="hs-identifier hs-var">nameOfBinder</span></a><span> </span><a href="#local-6989586621679037053"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-146"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-147"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Extras.html#occursInType"><span class="hs-identifier hs-var">occursInType</span></a><span> </span><a href="#local-6989586621679037051"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679037054"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-148"></a><span>        </span><span class="hs-identifier hs-var">VarT</span><span> </span><a name="local-6989586621679038199"><a href="#local-6989586621679038199"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-149"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679038199"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679037051"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-150"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-151"></a><span>        </span><span class="hs-identifier hs-var">AppT</span><span> </span><a name="local-6989586621679038200"><a href="#local-6989586621679038200"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679038201"><a href="#local-6989586621679038201"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Extras.html#occursInType"><span class="hs-identifier hs-var">occursInType</span></a><span> </span><a href="#local-6989586621679037051"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679038200"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="Language.Haskell.TH.Extras.html#occursInType"><span class="hs-identifier hs-var">occursInType</span></a><span> </span><a href="#local-6989586621679037051"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679038201"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-152"></a><span class="hs-cpp">#if defined(__GLASGOW_HASKELL__) &amp;&amp; __GLASGOW_HASKELL__ &gt;= 612
</span><span>        </span><span class="hs-identifier hs-var">SigT</span><span> </span><a name="local-6989586621679038202"><a href="#local-6989586621679038202"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Extras.html#occursInType"><span class="hs-identifier hs-var">occursInType</span></a><span> </span><a href="#local-6989586621679037051"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679038202"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-154"></a><span class="hs-cpp">#endif
</span><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a></pre></body></html>