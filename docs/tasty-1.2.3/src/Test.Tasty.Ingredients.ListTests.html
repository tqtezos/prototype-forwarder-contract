<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Ingredient for listing test names</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE CPP, GeneralizedNewtypeDeriving, DeriveDataTypeable #-}</span><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Test.Tasty.Ingredients.ListTests</span><span>
</span><a name="line-4"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Test.Tasty.Ingredients.ListTests.html#ListTests"><span class="hs-identifier hs-type">ListTests</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Test.Tasty.Ingredients.ListTests.html#testsNames"><span class="hs-identifier hs-var">testsNames</span></a><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Test.Tasty.Ingredients.ListTests.html#listingTests"><span class="hs-identifier hs-var">listingTests</span></a><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Proxy</span><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Typeable</span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Options.Applicative</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><a href="Test.Tasty.Core.html"><span class="hs-identifier">Test.Tasty.Core</span></a><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><a href="Test.Tasty.Options.html"><span class="hs-identifier">Test.Tasty.Options</span></a><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><a href="Test.Tasty.Ingredients.html"><span class="hs-identifier">Test.Tasty.Ingredients</span></a><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-comment">-- | This option, when set to 'True', specifies that we should run in the</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- &#171;list tests&#187; mode</span><span>
</span><a name="line-19"></a><span class="hs-keyword">newtype</span><span> </span><a name="ListTests"><a href="Test.Tasty.Ingredients.ListTests.html#ListTests"><span class="hs-identifier">ListTests</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ListTests"><a href="Test.Tasty.Ingredients.ListTests.html#ListTests"><span class="hs-identifier">ListTests</span></a></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-20"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span class="hs-keyword">instance</span><span> </span><a href="Test.Tasty.Options.html#IsOption"><span class="hs-identifier hs-type">IsOption</span></a><span> </span><a href="Test.Tasty.Ingredients.ListTests.html#ListTests"><span class="hs-identifier hs-type">ListTests</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-22"></a><span>  </span><a name="local-8214565720323809932"><a href="Test.Tasty.Options.html#defaultValue"><span class="hs-identifier">defaultValue</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.Tasty.Ingredients.ListTests.html#ListTests"><span class="hs-identifier hs-var">ListTests</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-23"></a><span>  </span><a name="local-8214565720323809933"><a href="Test.Tasty.Options.html#parseValue"><span class="hs-identifier">parseValue</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Test.Tasty.Ingredients.ListTests.html#ListTests"><span class="hs-identifier hs-var">ListTests</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Test.Tasty.Options.html#safeReadBool"><span class="hs-identifier hs-var">safeReadBool</span></a><span>
</span><a name="line-24"></a><span>  </span><a name="local-8214565720323809934"><a href="Test.Tasty.Options.html#optionName"><span class="hs-identifier">optionName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-string">&quot;list-tests&quot;</span><span>
</span><a name="line-25"></a><span>  </span><a name="local-8214565720323809935"><a href="Test.Tasty.Options.html#optionHelp"><span class="hs-identifier">optionHelp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-string">&quot;Do not run the tests; just print their names&quot;</span><span>
</span><a name="line-26"></a><span>  </span><a name="local-8214565720323809936"><a href="Test.Tasty.Options.html#optionCLParser"><span class="hs-identifier">optionCLParser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.Tasty.Options.html#mkFlagCLParser"><span class="hs-identifier hs-var">mkFlagCLParser</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">short</span><span> </span><span class="hs-char">'l'</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Test.Tasty.Ingredients.ListTests.html#ListTests"><span class="hs-identifier hs-var">ListTests</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-comment">-- | Obtain the list of all tests in the suite</span><span>
</span><a name="line-29"></a><span class="hs-identifier">testsNames</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Test.Tasty.Options.html#OptionSet"><span class="hs-identifier hs-type">OptionSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Test.Tasty.Core.html#TestTree"><span class="hs-identifier hs-type">TestTree</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Test.Tasty.Core.html#TestName"><span class="hs-identifier hs-type">TestName</span></a><span class="hs-special">]</span><span>
</span><a name="line-30"></a><a name="testsNames"><a href="Test.Tasty.Ingredients.ListTests.html#testsNames"><span class="hs-identifier">testsNames</span></a></a><span> </span><span class="hs-comment">{- opts -}</span><span> </span><span class="hs-comment">{- tree -}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-31"></a><span>  </span><a href="Test.Tasty.Core.html#foldTestTree"><span class="hs-identifier hs-var">foldTestTree</span></a><span>
</span><a name="line-32"></a><span>    </span><a href="Test.Tasty.Core.html#trivialFold"><span class="hs-identifier hs-var">trivialFold</span></a><span>
</span><a name="line-33"></a><span>      </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">foldSingle</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679081704"><a href="#local-6989586621679081704"><span class="hs-identifier">_opts</span></a></a><span> </span><a name="local-6989586621679081705"><a href="#local-6989586621679081705"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679081706"><a href="#local-6989586621679081706"><span class="hs-identifier">_test</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679081705"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span>
</span><a name="line-34"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">foldGroup</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679081707"><a href="#local-6989586621679081707"><span class="hs-identifier">groupName</span></a></a><span> </span><a name="local-6989586621679081708"><a href="#local-6989586621679081708"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679081707"><span class="hs-identifier hs-var">groupName</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679081708"><span class="hs-identifier hs-var">names</span></a><span>
</span><a name="line-35"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-comment">-- | The ingredient that provides the test listing functionality</span><span>
</span><a name="line-38"></a><span class="hs-identifier">listingTests</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Test.Tasty.Ingredients.html#Ingredient"><span class="hs-identifier hs-type">Ingredient</span></a><span>
</span><a name="line-39"></a><a name="listingTests"><a href="Test.Tasty.Ingredients.ListTests.html#listingTests"><span class="hs-identifier">listingTests</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.Tasty.Ingredients.html#TestManager"><span class="hs-identifier hs-var">TestManager</span></a><span> </span><span class="hs-special">[</span><a href="Test.Tasty.Options.html#Option"><span class="hs-identifier hs-var">Option</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="Test.Tasty.Ingredients.ListTests.html#ListTests"><span class="hs-identifier hs-type">ListTests</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-40"></a><span>  </span><span class="hs-glyph">\</span><a name="local-6989586621679081709"><a href="#local-6989586621679081709"><span class="hs-identifier">opts</span></a></a><span> </span><a name="local-6989586621679081710"><a href="#local-6989586621679081710"><span class="hs-identifier">tree</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-41"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Test.Tasty.Options.html#lookupOption"><span class="hs-identifier hs-var">lookupOption</span></a><span> </span><a href="#local-6989586621679081709"><span class="hs-identifier hs-var">opts</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-42"></a><span>      </span><a href="Test.Tasty.Ingredients.ListTests.html#ListTests"><span class="hs-identifier hs-var">ListTests</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-43"></a><span>      </span><a href="Test.Tasty.Ingredients.ListTests.html#ListTests"><span class="hs-identifier hs-var">ListTests</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-44"></a><span>        </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-identifier hs-var">putStrLn</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Test.Tasty.Ingredients.ListTests.html#testsNames"><span class="hs-identifier hs-var">testsNames</span></a><span> </span><a href="#local-6989586621679081709"><span class="hs-identifier hs-var">opts</span></a><span> </span><a href="#local-6989586621679081710"><span class="hs-identifier hs-var">tree</span></a><span>
</span><a name="line-45"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-46"></a></pre></body></html>