<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP, RankNTypes #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 706
</span><span class="hs-pragma">{-# LANGUAGE PolyKinds #-}</span><span>
</span><a name="line-5"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-7"></a><span class="hs-comment">{-| A monad morphism is a natural transformation:

&gt; morph :: forall a . m a -&gt; n a

    ... that obeys the following two laws:

&gt; morph $ do x &lt;- m  =  do x &lt;- morph m
&gt;            f x           morph (f x)
&gt;
&gt; morph (return x) = return x

    ... which are equivalent to the following two functor laws:

&gt; morph . (f &gt;=&gt; g) = morph . f &gt;=&gt; morph . g
&gt;
&gt; morph . return = return

    Examples of monad morphisms include:

    * 'lift' (from 'MonadTrans')

    * 'squash' (See below)

    * @'hoist' f@ (See below), if @f@ is a monad morphism

    * @(f . g)@, if @f@ and @g@ are both monad morphisms

    * 'id'

    Monad morphisms commonly arise when manipulating existing monad transformer
    code for compatibility purposes.  The 'MFunctor', 'MonadTrans', and
    'MMonad' classes define standard ways to change monad transformer stacks:

    * 'lift' introduces a new monad transformer layer of any type.

    * 'squash' flattens two identical monad transformer layers into a single
      layer of the same type.

    * 'hoist' maps monad morphisms to modify deeper layers of the monad
       transformer stack.

-}</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control.Monad.Morph</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-51"></a><span>    </span><span class="hs-comment">-- * Functors over Monads</span><span>
</span><a name="line-52"></a><span>    </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>    </span><a href="Control.Monad.Morph.html#generalize"><span class="hs-identifier hs-var">generalize</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>    </span><span class="hs-comment">-- * Monads over Monads</span><span>
</span><a name="line-55"></a><span>    </span><a href="Control.Monad.Morph.html#MMonad"><span class="hs-identifier hs-type">MMonad</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>    </span><span class="hs-identifier hs-type">MonadTrans</span><span class="hs-special">(</span><span class="hs-identifier hs-var">lift</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>    </span><a href="Control.Monad.Morph.html#squash"><span class="hs-identifier hs-var">squash</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>    </span><span class="hs-special">(</span><a href="Control.Monad.Morph.html#%3E%7C%3E"><span class="hs-operator hs-var">&gt;|&gt;</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>    </span><span class="hs-special">(</span><a href="Control.Monad.Morph.html#%3C%7C%3C"><span class="hs-operator hs-var">&lt;|&lt;</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-60"></a><span>    </span><span class="hs-special">(</span><a href="Control.Monad.Morph.html#%3D%3C%7C"><span class="hs-operator hs-var">=&lt;|</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>    </span><span class="hs-special">(</span><a href="Control.Monad.Morph.html#%7C%3E%3D"><span class="hs-operator hs-var">|&gt;=</span></a><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span>    </span><span class="hs-comment">-- * Tutorial</span><span>
</span><a name="line-64"></a><span>    </span><span class="hs-comment">-- $tutorial</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span>    </span><span class="hs-comment">-- ** Generalizing base monads</span><span>
</span><a name="line-67"></a><span>    </span><span class="hs-comment">-- $generalize</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span>    </span><span class="hs-comment">-- ** Monad morphisms</span><span>
</span><a name="line-70"></a><span>    </span><span class="hs-comment">-- $mmorph</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span>    </span><span class="hs-comment">-- ** Mixing diverse transformers</span><span>
</span><a name="line-73"></a><span>    </span><span class="hs-comment">-- $interleave</span><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span>    </span><span class="hs-comment">-- ** Embedding transformers</span><span>
</span><a name="line-76"></a><span>    </span><span class="hs-comment">-- $embed</span><span>
</span><a name="line-77"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Trans.Class</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadTrans</span><span class="hs-special">(</span><span class="hs-identifier hs-var">lift</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Trans.Error</span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">E</span><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Trans.Except</span><span>        </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Ex</span><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Trans.Identity</span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">I</span><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Trans.List</span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L</span><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Trans.Maybe</span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Trans.Reader</span><span>        </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">R</span><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Trans.RWS.Lazy</span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">RWS</span><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Trans.RWS.Strict</span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">RWS'</span><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Trans.State.Lazy</span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">S</span><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Trans.State.Strict</span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">S'</span><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Trans.Writer.Lazy</span><span>   </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">W'</span><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Trans.Writer.Strict</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">W</span><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Monoid</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monoid</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Functor.Compose</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Compose</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Compose</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Functor.Identity</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">runIdentity</span><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Functor.Product</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Product</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Pair</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Applicative.Backwards</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Backwards</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Backwards</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Applicative.Lift</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Lift</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Pure</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Other</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-comment">-- For documentation</span><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Exception</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">try</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IOException</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">=&lt;&lt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;=&gt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=&lt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">join</span><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Functor.Identity</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Identity</span><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-comment">{-| A functor in the category of monads, using 'hoist' as the analog of 'fmap':

&gt; hoist (f . g) = hoist f . hoist g
&gt;
&gt; hoist id = id
-}</span><span>
</span><a name="line-110"></a><span class="hs-keyword">class</span><span> </span><a name="MFunctor"><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier">MFunctor</span></a></a><span> </span><a name="local-6989586621679027996"><a href="#local-6989586621679027996"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-111"></a><span>    </span><span class="hs-comment">{-| Lift a monad morphism from @m@ to @n@ into a monad morphism from
        @(t m)@ to @(t n)@

        The first argument to `hoist` must be a monad morphism, even though the
        type system does not enforce this
    -}</span><span>
</span><a name="line-117"></a><span>    </span><a name="hoist"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679027997"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679028000"><a href="#local-6989586621679028000"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a href="#local-6989586621679027997"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679028000"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679027998"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679028000"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679027996"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679027997"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679027999"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679027996"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679027998"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679027999"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">E.ErrorT</span><span> </span><a href="#local-6989586621679029403"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-120"></a><span>    </span><a name="local-8214565720323802895"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><a name="local-6989586621679029404"><a href="#local-6989586621679029404"><span class="hs-identifier">nat</span></a></a><span> </span><a name="local-6989586621679029405"><a href="#local-6989586621679029405"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">E.ErrorT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029404"><span class="hs-identifier hs-var">nat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">E.runErrorT</span><span> </span><a href="#local-6989586621679029405"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ex.ExceptT</span><span> </span><a href="#local-6989586621679029400"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-123"></a><span>    </span><a name="local-8214565720323802895"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><a name="local-6989586621679029401"><a href="#local-6989586621679029401"><span class="hs-identifier">nat</span></a></a><span> </span><a name="local-6989586621679029402"><a href="#local-6989586621679029402"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Ex.ExceptT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029401"><span class="hs-identifier hs-var">nat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Ex.runExceptT</span><span> </span><a href="#local-6989586621679029402"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><span class="hs-identifier hs-type">I.IdentityT</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-126"></a><span>    </span><a name="local-8214565720323802895"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><a name="local-6989586621679029398"><a href="#local-6989586621679029398"><span class="hs-identifier">nat</span></a></a><span> </span><a name="local-6989586621679029399"><a href="#local-6989586621679029399"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">I.IdentityT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029398"><span class="hs-identifier hs-var">nat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">I.runIdentityT</span><span> </span><a href="#local-6989586621679029399"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><span class="hs-identifier hs-type">L.ListT</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-129"></a><span>    </span><a name="local-8214565720323802895"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><a name="local-6989586621679029396"><a href="#local-6989586621679029396"><span class="hs-identifier">nat</span></a></a><span> </span><a name="local-6989586621679029397"><a href="#local-6989586621679029397"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L.ListT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029396"><span class="hs-identifier hs-var">nat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">L.runListT</span><span> </span><a href="#local-6989586621679029397"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><span class="hs-identifier hs-type">M.MaybeT</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-132"></a><span>    </span><a name="local-8214565720323802895"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><a name="local-6989586621679029394"><a href="#local-6989586621679029394"><span class="hs-identifier">nat</span></a></a><span> </span><a name="local-6989586621679029395"><a href="#local-6989586621679029395"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M.MaybeT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029394"><span class="hs-identifier hs-var">nat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">M.runMaybeT</span><span> </span><a href="#local-6989586621679029395"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">R.ReaderT</span><span> </span><a href="#local-6989586621679029390"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-135"></a><span>    </span><a name="local-8214565720323802895"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><a name="local-6989586621679029391"><a href="#local-6989586621679029391"><span class="hs-identifier">nat</span></a></a><span> </span><a name="local-6989586621679029392"><a href="#local-6989586621679029392"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">R.ReaderT</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679029393"><a href="#local-6989586621679029393"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029391"><span class="hs-identifier hs-var">nat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">R.runReaderT</span><span> </span><a href="#local-6989586621679029392"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679029393"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">RWS.RWST</span><span> </span><a href="#local-6989586621679029383"><span class="hs-identifier hs-type">r</span></a><span> </span><a href="#local-6989586621679029384"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-6989586621679029385"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-138"></a><span>    </span><a name="local-8214565720323802895"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><a name="local-6989586621679029386"><a href="#local-6989586621679029386"><span class="hs-identifier">nat</span></a></a><span> </span><a name="local-6989586621679029387"><a href="#local-6989586621679029387"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">RWS.RWST</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679029388"><a href="#local-6989586621679029388"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679029389"><a href="#local-6989586621679029389"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029386"><span class="hs-identifier hs-var">nat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">RWS.runRWST</span><span> </span><a href="#local-6989586621679029387"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679029388"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679029389"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">RWS'.RWST</span><span> </span><a href="#local-6989586621679029376"><span class="hs-identifier hs-type">r</span></a><span> </span><a href="#local-6989586621679029377"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-6989586621679029378"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-141"></a><span>    </span><a name="local-8214565720323802895"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><a name="local-6989586621679029379"><a href="#local-6989586621679029379"><span class="hs-identifier">nat</span></a></a><span> </span><a name="local-6989586621679029380"><a href="#local-6989586621679029380"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">RWS'.RWST</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679029381"><a href="#local-6989586621679029381"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679029382"><a href="#local-6989586621679029382"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029379"><span class="hs-identifier hs-var">nat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">RWS'.runRWST</span><span> </span><a href="#local-6989586621679029380"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679029381"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679029382"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">S.StateT</span><span> </span><a href="#local-6989586621679029372"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-144"></a><span>    </span><a name="local-8214565720323802895"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><a name="local-6989586621679029373"><a href="#local-6989586621679029373"><span class="hs-identifier">nat</span></a></a><span> </span><a name="local-6989586621679029374"><a href="#local-6989586621679029374"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.StateT</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679029375"><a href="#local-6989586621679029375"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029373"><span class="hs-identifier hs-var">nat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">S.runStateT</span><span> </span><a href="#local-6989586621679029374"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679029375"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">S'.StateT</span><span> </span><a href="#local-6989586621679029368"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-147"></a><span>    </span><a name="local-8214565720323802895"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><a name="local-6989586621679029369"><a href="#local-6989586621679029369"><span class="hs-identifier">nat</span></a></a><span> </span><a name="local-6989586621679029370"><a href="#local-6989586621679029370"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S'.StateT</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679029371"><a href="#local-6989586621679029371"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029369"><span class="hs-identifier hs-var">nat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">S'.runStateT</span><span> </span><a href="#local-6989586621679029370"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679029371"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">W.WriterT</span><span> </span><a href="#local-6989586621679029365"><span class="hs-identifier hs-type">w</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-150"></a><span>    </span><a name="local-8214565720323802895"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><a name="local-6989586621679029366"><a href="#local-6989586621679029366"><span class="hs-identifier">nat</span></a></a><span> </span><a name="local-6989586621679029367"><a href="#local-6989586621679029367"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">W.WriterT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029366"><span class="hs-identifier hs-var">nat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">W.runWriterT</span><span> </span><a href="#local-6989586621679029367"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">W'.WriterT</span><span> </span><a href="#local-6989586621679029362"><span class="hs-identifier hs-type">w</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-153"></a><span>    </span><a name="local-8214565720323802895"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><a name="local-6989586621679029363"><a href="#local-6989586621679029363"><span class="hs-identifier">nat</span></a></a><span> </span><a name="local-6989586621679029364"><a href="#local-6989586621679029364"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">W'.WriterT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029363"><span class="hs-identifier hs-var">nat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">W'.runWriterT</span><span> </span><a href="#local-6989586621679029364"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621679029359"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Compose</span><span> </span><a href="#local-6989586621679029359"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-156"></a><span>    </span><a name="local-8214565720323802895"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><a name="local-6989586621679029360"><a href="#local-6989586621679029360"><span class="hs-identifier">nat</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Compose</span><span> </span><a name="local-6989586621679029361"><a href="#local-6989586621679029361"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Compose</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679029360"><span class="hs-identifier hs-var">nat</span></a><span> </span><a href="#local-6989586621679029361"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Product</span><span> </span><a href="#local-6989586621679029355"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-159"></a><span>    </span><a name="local-8214565720323802895"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><a name="local-6989586621679029356"><a href="#local-6989586621679029356"><span class="hs-identifier">nat</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Pair</span><span> </span><a name="local-6989586621679029357"><a href="#local-6989586621679029357"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679029358"><a href="#local-6989586621679029358"><span class="hs-identifier">g</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Pair</span><span> </span><a href="#local-6989586621679029357"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029356"><span class="hs-identifier hs-var">nat</span></a><span> </span><a href="#local-6989586621679029358"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><span class="hs-identifier hs-type">Backwards</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-162"></a><span>    </span><a name="local-8214565720323802895"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><a name="local-6989586621679029353"><a href="#local-6989586621679029353"><span class="hs-identifier">nat</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Backwards</span><span> </span><a name="local-6989586621679029354"><a href="#local-6989586621679029354"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Backwards</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029353"><span class="hs-identifier hs-var">nat</span></a><span> </span><a href="#local-6989586621679029354"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><span class="hs-identifier hs-type">Lift</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-165"></a><span>    </span><a name="local-8214565720323802895"><a href="Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Pure</span><span> </span><a name="local-6989586621679029350"><a href="#local-6989586621679029350"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Pure</span><span> </span><a href="#local-6989586621679029350"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-166"></a><span>    </span><span class="hs-identifier">hoist</span><span> </span><a name="local-6989586621679029351"><a href="#local-6989586621679029351"><span class="hs-identifier">nat</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Other</span><span> </span><a name="local-6989586621679029352"><a href="#local-6989586621679029352"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Other</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029351"><span class="hs-identifier hs-var">nat</span></a><span> </span><a href="#local-6989586621679029352"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-comment">-- | A function that @generalize@s the 'Identity' base monad to be any monad.</span><span>
</span><a name="line-169"></a><span class="hs-identifier">generalize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679029433"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Identity</span><span> </span><a href="#local-6989586621679029434"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029433"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679029434"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-170"></a><a name="generalize"><a href="Control.Monad.Morph.html#generalize"><span class="hs-identifier">generalize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">runIdentity</span><span>
</span><a name="line-171"></a><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="hs-pragma">generalize</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">{-| A monad in the category of monads, using 'lift' from 'MonadTrans' as the
    analog of 'return' and 'embed' as the analog of ('=&lt;&lt;'):

&gt; embed lift = id
&gt;
&gt; embed f (lift m) = f m
&gt;
&gt; embed g (embed f t) = embed (\m -&gt; embed g (f m)) t
-}</span><span>
</span><a name="line-182"></a><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><a href="Control.Monad.Morph.html#MFunctor"><span class="hs-identifier hs-type">MFunctor</span></a><span> </span><a href="#local-6989586621679027991"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadTrans</span><span> </span><a href="#local-6989586621679027991"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="MMonad"><a href="Control.Monad.Morph.html#MMonad"><span class="hs-identifier">MMonad</span></a></a><span> </span><a name="local-6989586621679027991"><a href="#local-6989586621679027991"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-183"></a><span>    </span><span class="hs-comment">{-| Embed a newly created 'MMonad' layer within an existing layer

        'embed' is analogous to ('=&lt;&lt;')
    -}</span><span>
</span><a name="line-187"></a><span>    </span><a name="embed"><a href="Control.Monad.Morph.html#embed"><span class="hs-identifier">embed</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679027992"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679027995"><a href="#local-6989586621679027995"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a href="#local-6989586621679027993"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679027995"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679027991"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679027992"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679027995"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679027991"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679027993"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679027994"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679027991"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679027992"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679027994"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-188"></a><span>
</span><a name="line-189"></a><span class="hs-comment">{-| Squash two 'MMonad' layers into a single layer

    'squash' is analogous to 'join'
-}</span><span>
</span><a name="line-193"></a><span class="hs-identifier">squash</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679029430"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Control.Monad.Morph.html#MMonad"><span class="hs-identifier hs-type">MMonad</span></a><span> </span><a href="#local-6989586621679029431"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679029431"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029431"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679029430"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679029432"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029431"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679029430"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679029432"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-194"></a><a name="squash"><a href="Control.Monad.Morph.html#squash"><span class="hs-identifier">squash</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Monad.Morph.html#embed"><span class="hs-identifier hs-var">embed</span></a><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-195"></a><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="hs-pragma">squash</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">2</span><span> </span><a href="Control.Monad.Morph.html#%3E%7C%3E"><span class="hs-operator hs-var">&gt;|&gt;</span></a><span class="hs-special">,</span><span> </span><a href="Control.Monad.Morph.html#%3D%3C%7C"><span class="hs-operator hs-var">=&lt;|</span></a><span>
</span><a name="line-198"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">2</span><span> </span><a href="Control.Monad.Morph.html#%3C%7C%3C"><span class="hs-operator hs-var">&lt;|&lt;</span></a><span class="hs-special">,</span><span> </span><a href="Control.Monad.Morph.html#%7C%3E%3D"><span class="hs-operator hs-var">|&gt;=</span></a><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-comment">{-| Compose two 'MMonad' layer-building functions

    ('&gt;|&gt;') is analogous to ('&gt;=&gt;')
-}</span><span>
</span><a name="line-204"></a><span class="hs-special">(</span><span class="hs-operator">&gt;|&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679029423"><span class="hs-identifier hs-type">m3</span></a><span class="hs-special">,</span><span> </span><a href="Control.Monad.Morph.html#MMonad"><span class="hs-identifier hs-type">MMonad</span></a><span> </span><a href="#local-6989586621679029424"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679029428"><a href="#local-6989586621679029428"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a href="#local-6989586621679029425"><span class="hs-identifier hs-type">m1</span></a><span> </span><a href="#local-6989586621679029428"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029424"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679029426"><span class="hs-identifier hs-type">m2</span></a><span> </span><a href="#local-6989586621679029428"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-207"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679029429"><a href="#local-6989586621679029429"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a href="#local-6989586621679029426"><span class="hs-identifier hs-type">m2</span></a><span> </span><a href="#local-6989586621679029429"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029424"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679029423"><span class="hs-identifier hs-type">m3</span></a><span> </span><a href="#local-6989586621679029429"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span>    </span><span class="hs-glyph">-&gt;</span><span>             </span><a href="#local-6989586621679029425"><span class="hs-identifier hs-type">m1</span></a><span> </span><a href="#local-6989586621679029427"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029424"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679029423"><span class="hs-identifier hs-type">m3</span></a><span> </span><a href="#local-6989586621679029427"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-209"></a><span class="hs-special">(</span><a name="local-6989586621679029435"><a href="#local-6989586621679029435"><span class="hs-identifier">f</span></a></a><span> </span><a name="%3E%7C%3E"><a href="Control.Monad.Morph.html#%3E%7C%3E"><span class="hs-operator">&gt;|&gt;</span></a></a><span> </span><a name="local-6989586621679029436"><a href="#local-6989586621679029436"><span class="hs-identifier">g</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679029437"><a href="#local-6989586621679029437"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Monad.Morph.html#embed"><span class="hs-identifier hs-var">embed</span></a><span> </span><a href="#local-6989586621679029436"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029435"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679029437"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&gt;|&gt;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-comment">{-| Equivalent to ('&gt;|&gt;') with the arguments flipped

    ('&lt;|&lt;') is analogous to ('&lt;=&lt;')
-}</span><span>
</span><a name="line-216"></a><span class="hs-special">(</span><span class="hs-operator">&lt;|&lt;</span><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679029416"><span class="hs-identifier hs-type">m3</span></a><span class="hs-special">,</span><span> </span><a href="Control.Monad.Morph.html#MMonad"><span class="hs-identifier hs-type">MMonad</span></a><span> </span><a href="#local-6989586621679029417"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-218"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679029421"><a href="#local-6989586621679029421"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a href="#local-6989586621679029418"><span class="hs-identifier hs-type">m2</span></a><span> </span><a href="#local-6989586621679029421"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029417"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679029416"><span class="hs-identifier hs-type">m3</span></a><span> </span><a href="#local-6989586621679029421"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-219"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679029422"><a href="#local-6989586621679029422"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a href="#local-6989586621679029419"><span class="hs-identifier hs-type">m1</span></a><span> </span><a href="#local-6989586621679029422"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029417"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679029418"><span class="hs-identifier hs-type">m2</span></a><span> </span><a href="#local-6989586621679029422"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-220"></a><span>    </span><span class="hs-glyph">-&gt;</span><span>             </span><a href="#local-6989586621679029419"><span class="hs-identifier hs-type">m1</span></a><span> </span><a href="#local-6989586621679029420"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029417"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679029416"><span class="hs-identifier hs-type">m3</span></a><span> </span><a href="#local-6989586621679029420"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-221"></a><span class="hs-special">(</span><a name="local-6989586621679029438"><a href="#local-6989586621679029438"><span class="hs-identifier">g</span></a></a><span> </span><a name="%3C%7C%3C"><a href="Control.Monad.Morph.html#%3C%7C%3C"><span class="hs-operator">&lt;|&lt;</span></a></a><span> </span><a name="local-6989586621679029439"><a href="#local-6989586621679029439"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679029440"><a href="#local-6989586621679029440"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Monad.Morph.html#embed"><span class="hs-identifier hs-var">embed</span></a><span> </span><a href="#local-6989586621679029438"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029439"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679029440"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&lt;|&lt;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span class="hs-comment">{-| An infix operator equivalent to 'embed'

    ('=&lt;|') is analogous to ('=&lt;&lt;')
-}</span><span>
</span><a name="line-228"></a><span class="hs-special">(</span><span class="hs-operator">=&lt;|</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679029411"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">,</span><span> </span><a href="Control.Monad.Morph.html#MMonad"><span class="hs-identifier hs-type">MMonad</span></a><span> </span><a href="#local-6989586621679029412"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679029415"><a href="#local-6989586621679029415"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a href="#local-6989586621679029413"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679029415"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029412"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679029411"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679029415"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029412"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679029413"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679029414"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029412"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679029411"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679029414"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-229"></a><span class="hs-special">(</span><a name="%3D%3C%7C"><a href="Control.Monad.Morph.html#%3D%3C%7C"><span class="hs-operator">=&lt;|</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Monad.Morph.html#embed"><span class="hs-identifier hs-var">embed</span></a><span>
</span><a name="line-230"></a><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">=&lt;|</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span class="hs-comment">{-| Equivalent to ('=&lt;|') with the arguments flipped

    ('|&gt;=') is analogous to ('&gt;&gt;=')
-}</span><span>
</span><a name="line-236"></a><span class="hs-special">(</span><span class="hs-operator">|&gt;=</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679029406"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">,</span><span> </span><a href="Control.Monad.Morph.html#MMonad"><span class="hs-identifier hs-type">MMonad</span></a><span> </span><a href="#local-6989586621679029407"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679029407"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679029408"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679029409"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679029410"><a href="#local-6989586621679029410"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a href="#local-6989586621679029408"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679029410"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029407"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679029406"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679029410"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029407"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679029406"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679029409"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-237"></a><a name="local-6989586621679029441"><a href="#local-6989586621679029441"><span class="hs-identifier">t</span></a></a><span> </span><a name="%7C%3E%3D"><a href="Control.Monad.Morph.html#%7C%3E%3D"><span class="hs-operator">|&gt;=</span></a></a><span> </span><a name="local-6989586621679029442"><a href="#local-6989586621679029442"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Monad.Morph.html#embed"><span class="hs-identifier hs-var">embed</span></a><span> </span><a href="#local-6989586621679029442"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679029441"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-238"></a><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">|&gt;=</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-239"></a><span>
</span><a name="line-240"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">E.Error</span><span> </span><a href="#local-6989586621679029343"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Monad.Morph.html#MMonad"><span class="hs-identifier hs-type">MMonad</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">E.ErrorT</span><span> </span><a href="#local-6989586621679029343"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-241"></a><span>    </span><a name="local-8214565720323802893"><a href="Control.Monad.Morph.html#embed"><span class="hs-identifier">embed</span></a></a><span> </span><a name="local-6989586621679029344"><a href="#local-6989586621679029344"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679029345"><a href="#local-6989586621679029345"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">E.ErrorT</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><a name="line-242"></a><span>        </span><a name="local-6989586621679029346"><a href="#local-6989586621679029346"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">E.runErrorT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029344"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">E.runErrorT</span><span> </span><a href="#local-6989586621679029345"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-243"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679029346"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-244"></a><span>            </span><span class="hs-identifier hs-var">Left</span><span>         </span><a name="local-6989586621679029347"><a href="#local-6989586621679029347"><span class="hs-identifier">e</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679029347"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-245"></a><span>            </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span>  </span><a name="local-6989586621679029348"><a href="#local-6989586621679029348"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679029348"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-246"></a><span>            </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679029349"><a href="#local-6989586621679029349"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679029349"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>
</span><a name="line-248"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MMonad"><span class="hs-identifier hs-type">MMonad</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ex.ExceptT</span><span> </span><a href="#local-6989586621679029195"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-249"></a><span>    </span><a name="local-8214565720323802893"><a href="Control.Monad.Morph.html#embed"><span class="hs-identifier">embed</span></a></a><span> </span><a name="local-6989586621679029196"><a href="#local-6989586621679029196"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679029197"><a href="#local-6989586621679029197"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Ex.ExceptT</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><a name="line-250"></a><span>        </span><a name="local-6989586621679029198"><a href="#local-6989586621679029198"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Ex.runExceptT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029196"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Ex.runExceptT</span><span> </span><a href="#local-6989586621679029197"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-251"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679029198"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-252"></a><span>            </span><span class="hs-identifier hs-var">Left</span><span>         </span><a name="local-6989586621679029340"><a href="#local-6989586621679029340"><span class="hs-identifier">e</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679029340"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-253"></a><span>            </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span>  </span><a name="local-6989586621679029341"><a href="#local-6989586621679029341"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679029341"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-254"></a><span>            </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679029342"><a href="#local-6989586621679029342"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679029342"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MMonad"><span class="hs-identifier hs-type">MMonad</span></a><span> </span><span class="hs-identifier hs-type">I.IdentityT</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-257"></a><span>    </span><a name="local-8214565720323802893"><a href="Control.Monad.Morph.html#embed"><span class="hs-identifier">embed</span></a></a><span> </span><a name="local-6989586621679029193"><a href="#local-6989586621679029193"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679029194"><a href="#local-6989586621679029194"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679029193"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">I.runIdentityT</span><span> </span><a href="#local-6989586621679029194"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MMonad"><span class="hs-identifier hs-type">MMonad</span></a><span> </span><span class="hs-identifier hs-type">L.ListT</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-260"></a><span>    </span><a name="local-8214565720323802893"><a href="Control.Monad.Morph.html#embed"><span class="hs-identifier">embed</span></a></a><span> </span><a name="local-6989586621679028064"><a href="#local-6989586621679028064"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679028065"><a href="#local-6989586621679028065"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L.ListT</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><a name="line-261"></a><span>        </span><a name="local-6989586621679028066"><a href="#local-6989586621679028066"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">L.runListT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028064"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">L.runListT</span><span> </span><a href="#local-6989586621679028065"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-262"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621679028066"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MMonad"><span class="hs-identifier hs-type">MMonad</span></a><span> </span><span class="hs-identifier hs-type">M.MaybeT</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-265"></a><span>    </span><a name="local-8214565720323802893"><a href="Control.Monad.Morph.html#embed"><span class="hs-identifier">embed</span></a></a><span> </span><a name="local-6989586621679028017"><a href="#local-6989586621679028017"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679028018"><a href="#local-6989586621679028018"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M.MaybeT</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><a name="line-266"></a><span>        </span><a name="local-6989586621679028019"><a href="#local-6989586621679028019"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">M.runMaybeT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028017"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">M.runMaybeT</span><span> </span><a href="#local-6989586621679028018"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-267"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679028019"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-268"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-269"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-270"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679028063"><a href="#local-6989586621679028063"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679028063"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span class="hs-keyword">instance</span><span> </span><a href="Control.Monad.Morph.html#MMonad"><span class="hs-identifier hs-type">MMonad</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">R.ReaderT</span><span> </span><a href="#local-6989586621679028013"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-273"></a><span>    </span><a name="local-8214565720323802893"><a href="Control.Monad.Morph.html#embed"><span class="hs-identifier">embed</span></a></a><span> </span><a name="local-6989586621679028014"><a href="#local-6989586621679028014"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679028015"><a href="#local-6989586621679028015"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">R.ReaderT</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679028016"><a href="#local-6989586621679028016"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">R.runReaderT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028014"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">R.runReaderT</span><span> </span><a href="#local-6989586621679028015"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679028016"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679028016"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="#local-6989586621679028007"><span class="hs-identifier hs-type">w</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Monad.Morph.html#MMonad"><span class="hs-identifier hs-type">MMonad</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">W.WriterT</span><span> </span><a href="#local-6989586621679028007"><span class="hs-identifier hs-type">w</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-276"></a><span>    </span><a name="local-8214565720323802893"><a href="Control.Monad.Morph.html#embed"><span class="hs-identifier">embed</span></a></a><span> </span><a name="local-6989586621679028008"><a href="#local-6989586621679028008"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679028009"><a href="#local-6989586621679028009"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">W.WriterT</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><a name="line-277"></a><span>        </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679028010"><a href="#local-6989586621679028010"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679028011"><a href="#local-6989586621679028011"><span class="hs-identifier">w1</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679028012"><a href="#local-6989586621679028012"><span class="hs-identifier">w2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">W.runWriterT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028008"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">W.runWriterT</span><span> </span><a href="#local-6989586621679028009"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-278"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028010"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mappend</span><span> </span><a href="#local-6989586621679028011"><span class="hs-identifier hs-var">w1</span></a><span> </span><a href="#local-6989586621679028012"><span class="hs-identifier hs-var">w2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span>
</span><a name="line-280"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="#local-6989586621679028001"><span class="hs-identifier hs-type">w</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Monad.Morph.html#MMonad"><span class="hs-identifier hs-type">MMonad</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">W'.WriterT</span><span> </span><a href="#local-6989586621679028001"><span class="hs-identifier hs-type">w</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-281"></a><span>    </span><a name="local-8214565720323802893"><a href="Control.Monad.Morph.html#embed"><span class="hs-identifier">embed</span></a></a><span> </span><a name="local-6989586621679028002"><a href="#local-6989586621679028002"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679028003"><a href="#local-6989586621679028003"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">W'.WriterT</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><a name="line-282"></a><span>        </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679028004"><a href="#local-6989586621679028004"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679028005"><a href="#local-6989586621679028005"><span class="hs-identifier">w1</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679028006"><a href="#local-6989586621679028006"><span class="hs-identifier">w2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">W'.runWriterT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028002"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">W'.runWriterT</span><span> </span><a href="#local-6989586621679028003"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-283"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028004"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mappend</span><span> </span><a href="#local-6989586621679028005"><span class="hs-identifier hs-var">w1</span></a><span> </span><a href="#local-6989586621679028006"><span class="hs-identifier hs-var">w2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><span class="hs-comment">{- $tutorial
    Monad morphisms solve the common problem of fixing monadic code after the
    fact without modifying the original source code or type signatures.  The
    following sections illustrate various examples of transparently modifying
    existing functions.
-}</span><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span class="hs-comment">{- $generalize
    Imagine that some library provided the following 'S.State' code:

&gt; import Control.Monad.Trans.State
&gt;
&gt; tick :: State Int ()
&gt; tick = modify (+1)

    ... but we would prefer to reuse @tick@ within a larger
    @('S.StateT' Int 'IO')@ block in order to mix in 'IO' actions.

    We could patch the original library to generalize @tick@'s type signature:

&gt; tick :: (Monad m) =&gt; StateT Int m ()

    ... but we would prefer not to fork upstream code if possible.  How could
    we generalize @tick@'s type without modifying the original code?

    We can solve this if we realize that 'S.State' is a type synonym for
    'S.StateT' with an 'Identity' base monad:

&gt; type State s = StateT s Identity

    ... which means that @tick@'s true type is actually:

&gt; tick :: StateT Int Identity ()

    Now all we need is a function that @generalize@s the 'Identity' base monad
    to be any monad:

&gt; import Data.Functor.Identity
&gt;
&gt; generalize :: (Monad m) =&gt; Identity a -&gt; m a
&gt; generalize m = return (runIdentity m)

    ... which we can 'hoist' to change @tick@'s base monad:

&gt; hoist :: (Monad m, MFunctor t) =&gt; (forall a . m a -&gt; n a) -&gt; t m b -&gt; t n b
&gt;
&gt; hoist generalize :: (Monad m, MFunctor t) =&gt; t Identity b -&gt; t m b
&gt;
&gt; hoist generalize tick :: (Monad m) =&gt; StateT Int m ()

    This lets us mix @tick@ alongside 'IO' using 'lift':

&gt; import Control.Monad.Morph
&gt; import Control.Monad.Trans.Class
&gt;
&gt; tock                        ::                   StateT Int IO ()
&gt; tock = do
&gt;     hoist generalize tick   :: (Monad      m) =&gt; StateT Int m  ()
&gt;     lift $ putStrLn &quot;Tock!&quot; :: (MonadTrans t) =&gt; t          IO ()

&gt;&gt;&gt; runStateT tock 0
Tock!
((), 1)

-}</span><span>
</span><a name="line-350"></a><span>
</span><a name="line-351"></a><span class="hs-comment">{- $mmorph
    Notice that @generalize@ is a monad morphism, and the following two proofs
    show how @generalize@ satisfies the monad morphism laws.  You can refer to
    these proofs as an example for how to prove a function obeys the monad
    morphism laws:

&gt; generalize (return x)
&gt;
&gt; -- Definition of 'return' for the Identity monad
&gt; = generalize (Identity x)
&gt;
&gt; -- Definition of 'generalize'
&gt; = return (runIdentity (Identity x))
&gt;
&gt; -- runIdentity (Identity x) = x
&gt; = return x

&gt; generalize $ do x &lt;- m
&gt;                 f x
&gt;
&gt; -- Definition of (&gt;&gt;=) for the Identity monad
&gt; = generalize (f (runIdentity m))
&gt;
&gt; -- Definition of 'generalize'
&gt; = return (runIdentity (f (runIdentity m)))
&gt;
&gt; -- Monad law: Left identity
&gt; = do x &lt;- return (runIdentity m)
&gt;      return (runIdentity (f x))
&gt;
&gt; -- Definition of 'generalize' in reverse
&gt; = do x &lt;- generalize m
&gt;      generalize (f x)
-}</span><span>
</span><a name="line-385"></a><span>
</span><a name="line-386"></a><span class="hs-comment">{- $interleave
    You can combine 'hoist' and 'lift' to insert arbitrary layers anywhere
    within a monad transformer stack.  This comes in handy when interleaving two
    diverse stacks.

    For example, we might want to combine the following @save@ function:

&gt; import Control.Monad.Trans.Writer
&gt;
&gt; -- i.e. :: StateT Int (WriterT [Int] Identity) ()
&gt; save    :: StateT Int (Writer  [Int]) ()
&gt; save = do
&gt;     n &lt;- get
&gt;     lift $ tell [n]

    ... with our previous @tock@ function:

&gt; tock :: StateT Int IO ()

    However, @save@ and @tock@ differ in two ways:

    * @tock@ lacks a 'W.WriterT' layer

    * @save@ has an 'Identity' base monad

    We can mix the two by inserting a 'W.WriterT' layer for @tock@ and
    generalizing @save@'s base monad:

&gt; import Control.Monad
&gt;
&gt; program ::                   StateT Int (WriterT [Int] IO) ()
&gt; program = replicateM_ 4 $ do
&gt;     hoist lift tock
&gt;         :: (MonadTrans t) =&gt; StateT Int (t             IO) ()
&gt;     hoist (hoist generalize) save
&gt;         :: (Monad      m) =&gt; StateT Int (WriterT [Int] m ) ()

&gt;&gt;&gt; execWriterT (runStateT program 0)
Tock!
Tock!
Tock!
Tock!
[1,2,3,4]

-}</span><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span class="hs-comment">{- $embed
    Suppose we decided to @check@ all 'IOException's using a combination of
    'try' and 'ErrorT':

&gt; import Control.Exception
&gt; import Control.Monad.Trans.Class
&gt; import Control.Monad.Trans.Error
&gt;
&gt; check :: IO a -&gt; ErrorT IOException IO a
&gt; check io = ErrorT (try io)

    ... but then we forget to use @check@ in one spot, mistakenly using 'lift'
    instead:

&gt; program :: ErrorT IOException IO ()
&gt; program = do
&gt;     str &lt;- lift $ readFile &quot;test.txt&quot;
&gt;     check $ putStr str

&gt;&gt;&gt; runErrorT program
*** Exception: test.txt: openFile: does not exist (No such file or directory)

    How could we go back and fix 'program' without modifying its source code?

    Well, @check@ is a monad morphism, but we can't 'hoist' it to modify the
    base monad because then we get two 'E.ErrorT' layers instead of one:

&gt; hoist check :: (MFunctor t) =&gt; t IO a -&gt; t (ErrorT IOException IO) a
&gt;
&gt; hoist check program :: ErrorT IOException (ErrorT IOException IO) ()

    We'd prefer to 'embed' all newly generated exceptions in the existing
    'E.ErrorT' layer:

&gt; embed check :: ErrorT IOException IO a -&gt; ErrorT IOException IO a
&gt;
&gt; embed check program :: ErrorT IOException IO ()

    This correctly checks the exceptions that slipped through the cracks:

&gt;&gt;&gt; import Control.Monad.Morph
&gt;&gt;&gt; runErrorT (embed check program)
Left test.txt: openFile: does not exist (No such file or directory)

-}</span><span>
</span><a name="line-477"></a></pre></body></html>