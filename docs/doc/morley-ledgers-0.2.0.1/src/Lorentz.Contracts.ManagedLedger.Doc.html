<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Documentation for ManagedLedger contract.</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Lorentz.Contracts.ManagedLedger.Doc</span><span>
</span><a name="line-4"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#contractDoc"><span class="hs-identifier hs-var">contractDoc</span></a><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#transferDoc"><span class="hs-identifier hs-var">transferDoc</span></a><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#approveDoc"><span class="hs-identifier hs-var">approveDoc</span></a><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#approveCASDoc"><span class="hs-identifier hs-var">approveCASDoc</span></a><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#getAllowanceDoc"><span class="hs-identifier hs-var">getAllowanceDoc</span></a><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#getBalanceDoc"><span class="hs-identifier hs-var">getBalanceDoc</span></a><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#getTotalSupplyDoc"><span class="hs-identifier hs-var">getTotalSupplyDoc</span></a><span>
</span><a name="line-11"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#setPauseDoc"><span class="hs-identifier hs-var">setPauseDoc</span></a><span>
</span><a name="line-12"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#setAdministratorDoc"><span class="hs-identifier hs-var">setAdministratorDoc</span></a><span>
</span><a name="line-13"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#getAdministratorDoc"><span class="hs-identifier hs-var">getAdministratorDoc</span></a><span>
</span><a name="line-14"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#mintDoc"><span class="hs-identifier hs-var">mintDoc</span></a><span>
</span><a name="line-15"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#burnDoc"><span class="hs-identifier hs-var">burnDoc</span></a><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#DTokenNotPausedOnly"><span class="hs-identifier hs-type">DTokenNotPausedOnly</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#DRequireRole"><span class="hs-identifier hs-type">DRequireRole</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Lorentz</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Fmt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">build</span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util.Markdown</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-identifier">contractDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Markdown</span><span>
</span><a name="line-28"></a><a name="contractDoc"><a href="Lorentz.Contracts.ManagedLedger.Doc.html#contractDoc"><span class="hs-identifier">contractDoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[md|
  This documentation describes a smart contract which implements
  [FA1.2 interface](https://gitlab.com/tzip/tzip/-/blob/c42e3f0f5e73669e84e615d69bee73281572eb0a/proposals/tzip-7/tzip-7.md).
  This contract also maintains an entity called _administrator_ which has an exclusive right to perform management operations like `Mint` and `Pause`.
  |]</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-identifier">transferDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Markdown</span><span>
</span><a name="line-35"></a><a name="transferDoc"><a href="Lorentz.Contracts.ManagedLedger.Doc.html#transferDoc"><span class="hs-identifier">transferDoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[md|
  Transfers tokens between two given accounts.

  This entrypoint serves multiple purposes:
  * When called with `&quot;from&quot;` account equal to the transaction sender, we assume that
  the user transfers their own money and this does not require approval.
  * Otherwise, the transaction sender must be previously authorized to transfer at least the requested number of tokens from the `&quot;from&quot;` account using the `approve` entrypoint.
  In this case current number of tokens that sender is allowed to withdraw from the `&quot;from&quot;` address is decreased by the number of transferred tokens.

  |]</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-identifier">approveDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Markdown</span><span>
</span><a name="line-47"></a><a name="approveDoc"><a href="Lorentz.Contracts.ManagedLedger.Doc.html#approveDoc"><span class="hs-identifier">approveDoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[md|
  When called with `(address :spender, nat :value)`
  parameters allows `spender` account to withdraw from the sender, multiple times,
  up to the `value` amount.
  Each call of `transfer` entrypoint decreases the allowance amount on the transferred amount of tokens unless `transfer` is called with `from` account equal to sender.

  If this entrypoint is called again, it overwrites the current allowance
  with `value`.

  Changing allowance value from non-zero value to a non-zero value is
  forbidden to prevent the [corresponding attack vector](https://docs.google.com/document/d/1YLPtQxZu1UAvO9cZ1O2RPXBbT0mooh4DYKjA_jp-RLM).
  |]</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-identifier">approveCASDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Markdown</span><span>
</span><a name="line-61"></a><a name="approveCASDoc"><a href="Lorentz.Contracts.ManagedLedger.Doc.html#approveCASDoc"><span class="hs-identifier">approveCASDoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[md|
  Compare the expected allowance value with the actual one and set a new one if they match.

  If the current amount of sender's tokens `spender` is allowed to spend is **not** equal to the `expected` value, this function fails with `allowanceMismatch` error.
  Otherwise it behaves as `approve` and does not prohibit changing allowance from non-zero to non-zero.
  |]</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-identifier">getAllowanceDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Markdown</span><span>
</span><a name="line-69"></a><a name="getAllowanceDoc"><a href="Lorentz.Contracts.ManagedLedger.Doc.html#getAllowanceDoc"><span class="hs-identifier">getAllowanceDoc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-70"></a><span>  </span><span class="hs-string">&quot;Returns the approval value between two given addresses.&quot;</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-identifier">getBalanceDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Markdown</span><span>
</span><a name="line-73"></a><a name="getBalanceDoc"><a href="Lorentz.Contracts.ManagedLedger.Doc.html#getBalanceDoc"><span class="hs-identifier">getBalanceDoc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-74"></a><span>  </span><span class="hs-string">&quot;Returns the balance of the address in the ledger.&quot;</span><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span class="hs-identifier">getTotalSupplyDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Markdown</span><span>
</span><a name="line-77"></a><a name="getTotalSupplyDoc"><a href="Lorentz.Contracts.ManagedLedger.Doc.html#getTotalSupplyDoc"><span class="hs-identifier">getTotalSupplyDoc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-78"></a><span>  </span><span class="hs-string">&quot;Returns total number of tokens.&quot;</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-identifier">setPauseDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Markdown</span><span>
</span><a name="line-81"></a><a name="setPauseDoc"><a href="Lorentz.Contracts.ManagedLedger.Doc.html#setPauseDoc"><span class="hs-identifier">setPauseDoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[md|
  This entrypoint pauses operations when the parameter is `True`,
  and resumes them when the parameter is `False`. During the pause,
  no contract can perform `transfer` or `approval` operations.
  |]</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-identifier">setAdministratorDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Markdown</span><span>
</span><a name="line-88"></a><a name="setAdministratorDoc"><a href="Lorentz.Contracts.ManagedLedger.Doc.html#setAdministratorDoc"><span class="hs-identifier">setAdministratorDoc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-89"></a><span>  </span><span class="hs-string">&quot;Change the current administrator.&quot;</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-identifier">getAdministratorDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Markdown</span><span>
</span><a name="line-92"></a><a name="getAdministratorDoc"><a href="Lorentz.Contracts.ManagedLedger.Doc.html#getAdministratorDoc"><span class="hs-identifier">getAdministratorDoc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-93"></a><span>  </span><span class="hs-string">&quot;This view returns the current administrator.&quot;</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-identifier">mintDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Markdown</span><span>
</span><a name="line-96"></a><a name="mintDoc"><a href="Lorentz.Contracts.ManagedLedger.Doc.html#mintDoc"><span class="hs-identifier">mintDoc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-97"></a><span>  </span><span class="hs-string">&quot;Produces tokens on the account associated with the given address.&quot;</span><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-identifier">burnDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Markdown</span><span>
</span><a name="line-100"></a><a name="burnDoc"><a href="Lorentz.Contracts.ManagedLedger.Doc.html#burnDoc"><span class="hs-identifier">burnDoc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-101"></a><span>  </span><span class="hs-string">&quot;Destroys the given amount of tokens on the account associated with \
  \the given address.&quot;</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-comment">-- | Mention that given action can be executed only when</span><span>
</span><a name="line-105"></a><span class="hs-comment">-- transfer-like operations are not paused.</span><span>
</span><a name="line-106"></a><span class="hs-keyword">data</span><span> </span><a name="DTokenNotPausedOnly"><a href="Lorentz.Contracts.ManagedLedger.Doc.html#DTokenNotPausedOnly"><span class="hs-identifier">DTokenNotPausedOnly</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="DTokenNotPausedOnly"><a href="Lorentz.Contracts.ManagedLedger.Doc.html#DTokenNotPausedOnly"><span class="hs-identifier">DTokenNotPausedOnly</span></a></a><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">DocItem</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#DTokenNotPausedOnly"><span class="hs-identifier hs-type">DTokenNotPausedOnly</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-109"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">DocItemPosition</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#DTokenNotPausedOnly"><span class="hs-identifier hs-type">DTokenNotPausedOnly</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1235</span><span>
</span><a name="line-110"></a><span>  </span><a name="local-8214565720323807061"><span class="hs-identifier">docItemSectionName</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-111"></a><span>  </span><a name="local-8214565720323807057"><span class="hs-identifier">docItemToMarkdown</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#DTokenNotPausedOnly"><span class="hs-identifier hs-var">DTokenNotPausedOnly</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-112"></a><span>    </span><span class="hs-identifier hs-var">mdSubsection</span><span> </span><span class="hs-string">&quot;Pausable&quot;</span><span>
</span><a name="line-113"></a><span>                 </span><span class="hs-string">&quot;Cannot be executed when token operations are paused.&quot;</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-comment">-- | Mention that entrypoint requires sender to have special privileges.</span><span>
</span><a name="line-116"></a><span class="hs-comment">--</span><span>
</span><a name="line-117"></a><span class="hs-comment">-- You provide textual description of these privileges, e.g. &quot;administrator&quot;</span><span>
</span><a name="line-118"></a><span class="hs-comment">-- or &quot;trusted&quot;.</span><span>
</span><a name="line-119"></a><span class="hs-keyword">data</span><span> </span><a name="DRequireRole"><a href="Lorentz.Contracts.ManagedLedger.Doc.html#DRequireRole"><span class="hs-identifier">DRequireRole</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="DRequireRole"><a href="Lorentz.Contracts.ManagedLedger.Doc.html#DRequireRole"><span class="hs-identifier">DRequireRole</span></a></a><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">DocItem</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#DRequireRole"><span class="hs-identifier hs-type">DRequireRole</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-122"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">DocItemPosition</span><span> </span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#DRequireRole"><span class="hs-identifier hs-type">DRequireRole</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1230</span><span>
</span><a name="line-123"></a><span>  </span><a name="local-8214565720323807061"><span class="hs-identifier">docItemSectionName</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-124"></a><span>  </span><a name="local-8214565720323807057"><span class="hs-identifier">docItemToMarkdown</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Contracts.ManagedLedger.Doc.html#DRequireRole"><span class="hs-identifier hs-var">DRequireRole</span></a><span> </span><span class="hs-keyword">role</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-125"></a><span>    </span><span class="hs-identifier hs-var">mdSubsection</span><span> </span><span class="hs-string">&quot;Authorization&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-126"></a><span>      </span><span class="hs-string">&quot;The sender has to be &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">mdTicked</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">build</span><span> </span><span class="hs-keyword">role</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;.&quot;</span><span>
</span><a name="line-127"></a></pre></body></html>