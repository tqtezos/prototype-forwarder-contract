<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Testing predicates for documentation of Lorentz contracts.</span><span>
</span><a name="line-2"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Lorentz.Test.Doc</span><span>
</span><a name="line-3"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-comment">-- * Test predicates</span><span>
</span><a name="line-4"></a><span>    </span><a href="Lorentz.Test.Doc.html#testLorentzDoc"><span class="hs-identifier hs-var">testLorentzDoc</span></a><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span>    </span><span class="hs-comment">-- * Individual test predicates</span><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Test.Doc.html#testDeclaresParameter"><span class="hs-identifier hs-var">testDeclaresParameter</span></a><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Test.Doc.html#testEachEntrypointIsDescribed"><span class="hs-identifier hs-var">testEachEntrypointIsDescribed</span></a><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Test.Doc.html#testParamBuildingStepsAreFinalized"><span class="hs-identifier hs-var">testParamBuildingStepsAreFinalized</span></a><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Test.Doc.html#testAllEntrypointsAreCallable"><span class="hs-identifier hs-var">testAllEntrypointsAreCallable</span></a><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Michelson.Doc.Test</span><span>
</span><a name="line-13"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Fmt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Buildable</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">blockListF</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fmt</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nameF</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pretty</span><span class="hs-special">)</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Test.HUnit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">assertBool</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">assertFailure</span><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.EntryPoints.Doc.html"><span class="hs-identifier">Lorentz.EntryPoints.Doc</span></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Michelson.Doc</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Michelson.Doc.Test</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util.Markdown</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util.Typeable</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-comment">-- | All ways of describing an entrypoint behaviour.</span><span>
</span><a name="line-25"></a><span class="hs-keyword">data</span><span> </span><a name="DocEpDescription"><a href="Lorentz.Test.Doc.html#DocEpDescription"><span class="hs-identifier">DocEpDescription</span></a></a><span>
</span><a name="line-26"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="DocEpDescription"><a href="Lorentz.Test.Doc.html#DocEpDescription"><span class="hs-identifier">DocEpDescription</span></a></a><span> </span><span class="hs-identifier hs-type">DDescription</span><span>
</span><a name="line-27"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DocEpReference"><a href="Lorentz.Test.Doc.html#DocEpReference"><span class="hs-identifier">DocEpReference</span></a></a><span> </span><a href="Lorentz.EntryPoints.Doc.html#DEntryPointReference"><span class="hs-identifier hs-type">DEntryPointReference</span></a><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Buildable</span><span> </span><a href="Lorentz.Test.Doc.html#DocEpDescription"><span class="hs-identifier hs-type">DocEpDescription</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-30"></a><span>  </span><a name="local-8214565720323800933"><span class="hs-identifier">build</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-31"></a><span>    </span><a href="Lorentz.Test.Doc.html#DocEpDescription"><span class="hs-identifier hs-var">DocEpDescription</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DDescription</span><span> </span><a name="local-6989586621679749523"><a href="#local-6989586621679749523"><span class="hs-identifier">txt</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-32"></a><span>      </span><span class="hs-string">&quot;description: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679749523"><span class="hs-identifier hs-var">txt</span></a><span>
</span><a name="line-33"></a><span>    </span><a href="Lorentz.Test.Doc.html#DocEpReference"><span class="hs-identifier hs-var">DocEpReference</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Doc.html#DEntryPointReference"><span class="hs-identifier hs-var">DEntryPointReference</span></a><span> </span><a name="local-6989586621679749524"><a href="#local-6989586621679749524"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Anchor</span><span> </span><a name="local-6989586621679749525"><a href="#local-6989586621679749525"><span class="hs-identifier">anchor</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-34"></a><span>      </span><span class="hs-string">&quot;reference \&quot;&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">build</span><span> </span><a href="#local-6989586621679749524"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;\&quot; (&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">build</span><span> </span><a href="#local-6989586621679749525"><span class="hs-identifier hs-var">anchor</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-comment">-- | Extract 'DocEpDescription's of a documentation block.</span><span>
</span><a name="line-37"></a><span class="hs-identifier">lookupDocEpDescription</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DocBlock</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Lorentz.Test.Doc.html#DocEpDescription"><span class="hs-identifier hs-type">DocEpDescription</span></a><span class="hs-special">]</span><span>
</span><a name="line-38"></a><a name="lookupDocEpDescription"><a href="Lorentz.Test.Doc.html#lookupDocEpDescription"><span class="hs-identifier">lookupDocEpDescription</span></a></a><span> </span><a name="local-6989586621679749526"><a href="#local-6989586621679749526"><span class="hs-identifier">block</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mconcat</span><span>
</span><a name="line-39"></a><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Lorentz.Test.Doc.html#DocEpDescription"><span class="hs-identifier hs-var">DocEpDescription</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">lookupDocBlockSection</span><span> </span><a href="#local-6989586621679749526"><span class="hs-identifier hs-var">block</span></a><span>
</span><a name="line-40"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Lorentz.Test.Doc.html#DocEpReference"><span class="hs-identifier hs-var">DocEpReference</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">lookupDocBlockSection</span><span> </span><a href="#local-6989586621679749526"><span class="hs-identifier hs-var">block</span></a><span>
</span><a name="line-41"></a><span>  </span><span class="hs-special">]</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-comment">-- | Check that contract documents its parameter.</span><span>
</span><a name="line-44"></a><span class="hs-identifier">testDeclaresParameter</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DocTest</span><span>
</span><a name="line-45"></a><a name="testDeclaresParameter"><a href="Lorentz.Test.Doc.html#testDeclaresParameter"><span class="hs-identifier">testDeclaresParameter</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-46"></a><span>  </span><span class="hs-identifier hs-var">mkDocTest</span><span> </span><span class="hs-string">&quot;Contract parameter is documented&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-47"></a><span>  </span><span class="hs-glyph">\</span><a name="local-6989586621679749529"><a href="#local-6989586621679749529"><span class="hs-identifier">contractDoc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-48"></a><span>    </span><span class="hs-identifier hs-var">assertBool</span><span> </span><span class="hs-string">&quot;No doc items describing contract parameter found&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-49"></a><span>      </span><span class="hs-identifier hs-var">or</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">forEachContractLayer</span><span> </span><a href="#local-6989586621679749529"><span class="hs-identifier hs-var">contractDoc</span></a><span> </span><a href="#local-6989586621679749527"><span class="hs-identifier hs-var">check</span></a><span>
</span><a name="line-50"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-51"></a><span>    </span><a name="local-6989586621679749527"><a href="#local-6989586621679749527"><span class="hs-identifier">check</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-52"></a><span>    </span><span class="hs-identifier">check</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679749528"><a href="#local-6989586621679749528"><span class="hs-identifier">sdi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-53"></a><span>      </span><span class="hs-comment">-- Currently the only way to document parameter (mentioning type of each arm)</span><span>
</span><a name="line-54"></a><span>      </span><span class="hs-comment">-- is using 'entryCase'. This may not suit for small contracts, then</span><span>
</span><a name="line-55"></a><span>      </span><span class="hs-comment">-- someone needs to invent another way to document parameter and also mention</span><span>
</span><a name="line-56"></a><span>      </span><span class="hs-comment">-- it below.</span><span>
</span><a name="line-57"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679749528"><span class="hs-identifier hs-var">sdi</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-58"></a><span>        </span><span class="hs-identifier hs-var">SomeDocItem</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">castIgnoringPhantom</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="Lorentz.EntryPoints.Doc.html#DEntryPoint"><span class="hs-identifier hs-var">DEntryPoint</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-59"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-comment">-- | Check that no group contains two 'DDescription' or 'DEntryPointReference'</span><span>
</span><a name="line-62"></a><span class="hs-comment">-- items.</span><span>
</span><a name="line-63"></a><span class="hs-comment">--</span><span>
</span><a name="line-64"></a><span class="hs-comment">-- This is a stricter version of 'testNoAdjacentDescriptions' test.</span><span>
</span><a name="line-65"></a><span class="hs-identifier">testNoAdjacentEpDescriptions</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DocTest</span><span>
</span><a name="line-66"></a><a name="testNoAdjacentEpDescriptions"><a href="Lorentz.Test.Doc.html#testNoAdjacentEpDescriptions"><span class="hs-identifier">testNoAdjacentEpDescriptions</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-67"></a><span>  </span><span class="hs-identifier hs-var">mkDocTest</span><span> </span><span class="hs-string">&quot;No two 'DDescription' appear under the same group&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-68"></a><span>  </span><span class="hs-glyph">\</span><a name="local-6989586621679750057"><a href="#local-6989586621679750057"><span class="hs-identifier">contractDoc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-69"></a><span>    </span><span class="hs-identifier hs-var">sequence_</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">forEachContractLayer</span><span> </span><a href="#local-6989586621679750057"><span class="hs-identifier hs-var">contractDoc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679750058"><a href="#local-6989586621679750058"><span class="hs-identifier">block</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-70"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="Lorentz.Test.Doc.html#lookupDocEpDescription"><span class="hs-identifier hs-var">lookupDocEpDescription</span></a><span> </span><a href="#local-6989586621679750058"><span class="hs-identifier hs-var">block</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-71"></a><span>        </span><a name="local-6989586621679750059"><a href="#local-6989586621679750059"><span class="hs-identifier">ds</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-72"></a><span>          </span><span class="hs-identifier hs-var">assertFailure</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmt</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-73"></a><span>             </span><span class="hs-identifier hs-var">nameF</span><span> </span><span class="hs-string">&quot;Found multiple adjacent entrypoint descriptions&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-74"></a><span>             </span><span class="hs-identifier hs-var">blockListF</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679750055"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">build</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679750059"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pass</span><span>
</span><a name="line-76"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-77"></a><span>      </span><a name="local-6989586621679750055"><a href="#local-6989586621679750055"><span class="hs-identifier">quotes</span></a></a><span> </span><a name="local-6989586621679750056"><a href="#local-6989586621679750056"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679750056"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-comment">-- | It's a common issue to forget to describe an entrypoint.</span><span>
</span><a name="line-80"></a><span class="hs-identifier">testEachEntrypointIsDescribed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DocTest</span><span>
</span><a name="line-81"></a><a name="testEachEntrypointIsDescribed"><a href="Lorentz.Test.Doc.html#testEachEntrypointIsDescribed"><span class="hs-identifier">testEachEntrypointIsDescribed</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-82"></a><span>  </span><span class="hs-identifier hs-var">mkDocTest</span><span> </span><span class="hs-string">&quot;Each entrypoint has 'DDescription'&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-83"></a><span>  </span><span class="hs-glyph">\</span><a name="local-6989586621679750284"><a href="#local-6989586621679750284"><span class="hs-identifier">contractDoc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-84"></a><span>    </span><span class="hs-identifier hs-var">sequence_</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">forEachContractLayer</span><span> </span><a href="#local-6989586621679750284"><span class="hs-identifier hs-var">contractDoc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679750285"><a href="#local-6989586621679750285"><span class="hs-identifier">mDocItem</span></a></a><span> </span><a name="local-6989586621679750286"><a href="#local-6989586621679750286"><span class="hs-identifier">block</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-85"></a><span>      </span><span class="hs-identifier">runMaybeT</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-86"></a><span>        </span><span class="hs-identifier hs-var">SomeDocItem</span><span> </span><a name="local-6989586621679750287"><a href="#local-6989586621679750287"><span class="hs-identifier">docItem</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">MaybeT</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679750285"><span class="hs-identifier hs-var">mDocItem</span></a><span>
</span><a name="line-87"></a><span>        </span><a name="local-6989586621679750288"><a href="#local-6989586621679750288"><span class="hs-identifier">dep</span></a></a><span class="hs-glyph">@</span><a href="Lorentz.EntryPoints.Doc.html#DEntryPoint"><span class="hs-identifier hs-var">DEntryPoint</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">MaybeT</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">castIgnoringPhantom</span><span> </span><a href="#local-6989586621679750287"><span class="hs-identifier hs-var">docItem</span></a><span>
</span><a name="line-88"></a><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Lorentz.Test.Doc.html#lookupDocEpDescription"><span class="hs-identifier hs-var">lookupDocEpDescription</span></a><span> </span><a href="#local-6989586621679750286"><span class="hs-identifier hs-var">block</span></a><span>
</span><a name="line-89"></a><span>        </span><span class="hs-identifier hs-var">MaybeT</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">assertFailure</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-90"></a><span>          </span><span class="hs-string">&quot;Entrypoint '&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">pretty</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">depName</span><span> </span><a href="#local-6989586621679750288"><span class="hs-identifier hs-var">dep</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;' does not contain \
          \any description.\n\
          \Put e.g. `doc $ DDescription \&quot;text\&quot;` in the entrypoint logic to \
          \fix this.&quot;</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- | Check that 'finalizeParamCallingDoc' is applied to the contract as it</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- always should.</span><span>
</span><a name="line-97"></a><span class="hs-identifier">testParamBuildingStepsAreFinalized</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DocTest</span><span>
</span><a name="line-98"></a><a name="testParamBuildingStepsAreFinalized"><a href="Lorentz.Test.Doc.html#testParamBuildingStepsAreFinalized"><span class="hs-identifier">testParamBuildingStepsAreFinalized</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-99"></a><span>  </span><span class="hs-identifier hs-var">mkDocTest</span><span> </span><span class="hs-string">&quot;'finalizeParamCallingDoc' is applied&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-100"></a><span>  </span><span class="hs-glyph">\</span><a name="local-6989586621679750289"><a href="#local-6989586621679750289"><span class="hs-identifier">contractDoc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-101"></a><span>    </span><span class="hs-identifier hs-var">sequence_</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">forEachContractDocItem</span><span> </span><a href="#local-6989586621679750289"><span class="hs-identifier hs-var">contractDoc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a href="Lorentz.EntryPoints.Doc.html#DEntryPointArg"><span class="hs-identifier hs-var">DEntryPointArg</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-102"></a><span>      </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Doc.html#areFinalizedParamBuildingSteps"><span class="hs-identifier hs-var">areFinalizedParamBuildingSteps</span></a><span> </span><a href="#local-6989586621679750291"><span class="hs-identifier hs-var">epaBuilding</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-103"></a><span>        </span><span class="hs-identifier hs-var">assertFailure</span><span>
</span><a name="line-104"></a><span>          </span><span class="hs-string">&quot;Found unfinalized param building steps, \
          \'How to call this entrypoint' section may be incorrect.\n\
          \Have you applied 'finalizeParamCallingDoc' to your contract?&quot;</span><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-comment">-- | Check that all documented entrypoints are callable.</span><span>
</span><a name="line-109"></a><span class="hs-comment">--</span><span>
</span><a name="line-110"></a><span class="hs-comment">-- Sometimes having such an entrypoint is fine, e.g. when you have an explicit</span><span>
</span><a name="line-111"></a><span class="hs-comment">-- default entrypoint deep in one arm then other arms (entire arms, not</span><span>
</span><a name="line-112"></a><span class="hs-comment">-- individual entrypoints within them) are uncallable unless also assigned a</span><span>
</span><a name="line-113"></a><span class="hs-comment">-- field annotation; for example see [doc for uncallable entrypoints] note.</span><span>
</span><a name="line-114"></a><span class="hs-comment">-- If this is your case, exclude this test suite with 'excludeDocTest'.</span><span>
</span><a name="line-115"></a><span class="hs-comment">-- But such situations are rare.</span><span>
</span><a name="line-116"></a><span class="hs-comment">--</span><span>
</span><a name="line-117"></a><span class="hs-comment">-- More often, this test failure indicates that entrypoints are documented</span><span>
</span><a name="line-118"></a><span class="hs-comment">-- incorrectly, e.g. `caseT` is used in some place instead of `entryCase`.</span><span>
</span><a name="line-119"></a><span class="hs-comment">-- Check whether printed building steps are correct.</span><span>
</span><a name="line-120"></a><span class="hs-comment">--</span><span>
</span><a name="line-121"></a><span class="hs-comment">-- NB: another, simplified example of case when disabling this test is</span><span>
</span><a name="line-122"></a><span class="hs-comment">-- justified:</span><span>
</span><a name="line-123"></a><span class="hs-comment">--</span><span>
</span><a name="line-124"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-125"></a><span class="hs-comment">-- data SubParam1 = Do1 | Default</span><span>
</span><a name="line-126"></a><span class="hs-comment">-- data SubParam2 = Do2 | Do3</span><span>
</span><a name="line-127"></a><span class="hs-comment">-- data Param = Arm1 SubParam1 | Arm2 SubParam2</span><span>
</span><a name="line-128"></a><span class="hs-comment">--   -- ^ with entrypoints derived via 'EpdRecursive'</span><span>
</span><a name="line-129"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-130"></a><span class="hs-comment">--</span><span>
</span><a name="line-131"></a><span class="hs-comment">-- In this case entire @Arm1@ and @Arm2@ are not true entrypoints, only @Default@</span><span>
</span><a name="line-132"></a><span class="hs-comment">-- and @Do{1,2,3}@ are, but @Arm1@ and @Arm2@ will still appear in documentation</span><span>
</span><a name="line-133"></a><span class="hs-comment">-- as entrypoints.</span><span>
</span><a name="line-134"></a><span class="hs-identifier">testAllEntrypointsAreCallable</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DocTest</span><span>
</span><a name="line-135"></a><a name="testAllEntrypointsAreCallable"><a href="Lorentz.Test.Doc.html#testAllEntrypointsAreCallable"><span class="hs-identifier">testAllEntrypointsAreCallable</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-136"></a><span>  </span><span class="hs-identifier hs-var">mkDocTest</span><span> </span><span class="hs-string">&quot;All entrypoints are callable&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-137"></a><span>  </span><span class="hs-glyph">\</span><a name="local-6989586621679750293"><a href="#local-6989586621679750293"><span class="hs-identifier">contractDoc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-138"></a><span>    </span><span class="hs-identifier hs-var">sequence_</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">forEachContractDocItem</span><span> </span><a href="#local-6989586621679750293"><span class="hs-identifier hs-var">contractDoc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a href="Lorentz.EntryPoints.Doc.html#DEntryPointArg"><span class="hs-identifier hs-var">DEntryPointArg</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-139"></a><span>      </span><span class="hs-identifier hs-var">forM_</span><span> </span><a href="#local-6989586621679750295"><span class="hs-identifier hs-var">epaBuilding</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-140"></a><span>        </span><a href="Lorentz.EntryPoints.Doc.html#PbsUncallable"><span class="hs-identifier hs-var">PbsUncallable</span></a><span> </span><a name="local-6989586621679750297"><a href="#local-6989586621679750297"><span class="hs-identifier">pbs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-141"></a><span>          </span><span class="hs-identifier hs-var">assertFailure</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmt</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-142"></a><span>            </span><span class="hs-string">&quot;Found an uncallable entrypoint.\n\
            \Dummy parameter building steps for it: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">blockListF</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679750297"><span class="hs-identifier hs-var">pbs</span></a><span class="hs-special">)</span><span>
</span><a name="line-144"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pass</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-comment">-- | Tests all properties.</span><span>
</span><a name="line-147"></a><span class="hs-identifier">testLorentzDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">DocTest</span><span class="hs-special">]</span><span>
</span><a name="line-148"></a><a name="testLorentzDoc"><a href="Lorentz.Test.Doc.html#testLorentzDoc"><span class="hs-identifier">testLorentzDoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mconcat</span><span>
</span><a name="line-149"></a><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">testDocBasic</span><span>
</span><a name="line-150"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><a href="Lorentz.Test.Doc.html#testDeclaresParameter"><span class="hs-identifier hs-var">testDeclaresParameter</span></a><span>
</span><a name="line-151"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Test.Doc.html#testNoAdjacentEpDescriptions"><span class="hs-identifier hs-var">testNoAdjacentEpDescriptions</span></a><span>
</span><a name="line-152"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Test.Doc.html#testEachEntrypointIsDescribed"><span class="hs-identifier hs-var">testEachEntrypointIsDescribed</span></a><span>
</span><a name="line-153"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Test.Doc.html#testParamBuildingStepsAreFinalized"><span class="hs-identifier hs-var">testParamBuildingStepsAreFinalized</span></a><span>
</span><a name="line-154"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Test.Doc.html#testAllEntrypointsAreCallable"><span class="hs-identifier hs-var">testAllEntrypointsAreCallable</span></a><span>
</span><a name="line-155"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-156"></a><span>  </span><span class="hs-special">]</span><span>
</span><a name="line-157"></a></pre></body></html>