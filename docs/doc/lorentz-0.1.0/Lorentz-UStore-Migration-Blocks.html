<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Lorentz.UStore.Migration.Blocks</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Lorentz.UStore.Migration.Blocks.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">lorentz-0.1.0: EDSL for the Michelson Language</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Lorentz.UStore.Migration.Blocks</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">General</a></li><li><a href="#g:2">Elemental steps</a></li><li><a href="#g:3">Migration batches</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Elemental building blocks for migrations.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:mustoreToOld">mustoreToOld</a> :: RequireBeInitial touched =&gt; (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTemplate newTemplate remDiff touched ': s) <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> (<a href="Lorentz-UStore-Types.html#t:UStore" title="Lorentz.UStore.Types">UStore</a> oldTemplate ': s)</li><li class="src short"><span class="keyword">class</span> <a href="#t:MigrationFinishCheckPosition">MigrationFinishCheckPosition</a> a <span class="keyword">where</span><ul class="subs"><li><a href="#v:migrationFinish">migrationFinish</a> :: a</li></ul></li><li class="src short"><a href="#v:migrateCoerceUnsafe">migrateCoerceUnsafe</a> :: <span class="keyword">forall</span> field oldTempl newTempl diff touched newDiff newDiff0 _1 _2 s. ('(_1, newDiff0) ~ <a href="Lorentz-UStore-Migration-Diff.html#t:CoverDiff" title="Lorentz.UStore.Migration.Diff">CoverDiff</a> <a href="Lorentz-UStore-Migration-Diff.html#v:DcRemove" title="Lorentz.UStore.Migration.Diff">DcRemove</a> field diff, '(_2, newDiff) ~ <a href="Lorentz-UStore-Migration-Diff.html#t:CoverDiff" title="Lorentz.UStore.Migration.Diff">CoverDiff</a> <a href="Lorentz-UStore-Migration-Diff.html#v:DcAdd" title="Lorentz.UStore.Migration.Diff">DcAdd</a> field newDiff0) =&gt; <a href="Lorentz-Value.html#t:Label" title="Lorentz.Value">Label</a> field -&gt; (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s) <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl newDiff touched ': s)</li><li class="src short"><a href="#v:migrateGetField">migrateGetField</a> :: <span class="keyword">forall</span> field oldTempl newTempl diff touched fieldTy s. (<a href="Lorentz-UStore-Instr.html#t:HasUField" title="Lorentz.UStore.Instr">HasUField</a> field fieldTy oldTempl, RequireUntouched field (field <a href="../morley-1.0.0/Util-Type.html#t:IsElem" title="Util.Type">`IsElem`</a> touched)) =&gt; <a href="Lorentz-Value.html#t:Label" title="Lorentz.Value">Label</a> field -&gt; (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s) <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> (fieldTy ': (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s))</li><li class="src short"><a href="#v:migrateAddField">migrateAddField</a> :: <span class="keyword">forall</span> field oldTempl newTempl diff touched fieldTy newDiff marker s. ('(<a href="Lorentz-UStore-Types.html#t:UStoreFieldExt" title="Lorentz.UStore.Types">UStoreFieldExt</a> marker fieldTy, newDiff) ~ <a href="Lorentz-UStore-Migration-Diff.html#t:CoverDiff" title="Lorentz.UStore.Migration.Diff">CoverDiff</a> <a href="Lorentz-UStore-Migration-Diff.html#v:DcAdd" title="Lorentz.UStore.Migration.Diff">DcAdd</a> field diff, <a href="Lorentz-UStore-Instr.html#t:HasUField" title="Lorentz.UStore.Instr">HasUField</a> field fieldTy newTempl) =&gt; <a href="Lorentz-Value.html#t:Label" title="Lorentz.Value">Label</a> field -&gt; (fieldTy ': (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s)) <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl newDiff (field ': touched) ': s)</li><li class="src short"><a href="#v:migrateRemoveField">migrateRemoveField</a> :: <span class="keyword">forall</span> field oldTempl newTempl diff touched fieldTy newDiff marker s. ('(<a href="Lorentz-UStore-Types.html#t:UStoreFieldExt" title="Lorentz.UStore.Types">UStoreFieldExt</a> marker fieldTy, newDiff) ~ <a href="Lorentz-UStore-Migration-Diff.html#t:CoverDiff" title="Lorentz.UStore.Migration.Diff">CoverDiff</a> <a href="Lorentz-UStore-Migration-Diff.html#v:DcRemove" title="Lorentz.UStore.Migration.Diff">DcRemove</a> field diff, <a href="Lorentz-UStore-Instr.html#t:HasUField" title="Lorentz.UStore.Instr">HasUField</a> field fieldTy oldTempl) =&gt; <a href="Lorentz-Value.html#t:Label" title="Lorentz.Value">Label</a> field -&gt; (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s) <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl newDiff (field ': touched) ': s)</li><li class="src short"><a href="#v:migrateExtractField">migrateExtractField</a> :: <span class="keyword">forall</span> field oldTempl newTempl diff touched fieldTy newDiff marker s. ('(<a href="Lorentz-UStore-Types.html#t:UStoreFieldExt" title="Lorentz.UStore.Types">UStoreFieldExt</a> marker fieldTy, newDiff) ~ <a href="Lorentz-UStore-Migration-Diff.html#t:CoverDiff" title="Lorentz.UStore.Migration.Diff">CoverDiff</a> <a href="Lorentz-UStore-Migration-Diff.html#v:DcRemove" title="Lorentz.UStore.Migration.Diff">DcRemove</a> field diff, <a href="Lorentz-UStore-Instr.html#t:HasUField" title="Lorentz.UStore.Instr">HasUField</a> field fieldTy oldTempl, RequireUntouched field (field <a href="../morley-1.0.0/Util-Type.html#t:IsElem" title="Util.Type">`IsElem`</a> touched)) =&gt; <a href="Lorentz-Value.html#t:Label" title="Lorentz.Value">Label</a> field -&gt; (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s) <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> (fieldTy ': (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl newDiff (field ': touched) ': s))</li><li class="src short"><a href="#v:migrateOverwriteField">migrateOverwriteField</a> :: <span class="keyword">forall</span> field oldTempl newTempl diff touched fieldTy oldFieldTy marker oldMarker newDiff newDiff0 s. ('(<a href="Lorentz-UStore-Types.html#t:UStoreFieldExt" title="Lorentz.UStore.Types">UStoreFieldExt</a> oldMarker oldFieldTy, newDiff0) ~ <a href="Lorentz-UStore-Migration-Diff.html#t:CoverDiff" title="Lorentz.UStore.Migration.Diff">CoverDiff</a> <a href="Lorentz-UStore-Migration-Diff.html#v:DcRemove" title="Lorentz.UStore.Migration.Diff">DcRemove</a> field diff, '(<a href="Lorentz-UStore-Types.html#t:UStoreFieldExt" title="Lorentz.UStore.Types">UStoreFieldExt</a> marker fieldTy, newDiff) ~ <a href="Lorentz-UStore-Migration-Diff.html#t:CoverDiff" title="Lorentz.UStore.Migration.Diff">CoverDiff</a> <a href="Lorentz-UStore-Migration-Diff.html#v:DcAdd" title="Lorentz.UStore.Migration.Diff">DcAdd</a> field newDiff0, <a href="Lorentz-UStore-Instr.html#t:HasUField" title="Lorentz.UStore.Instr">HasUField</a> field fieldTy newTempl) =&gt; <a href="Lorentz-Value.html#t:Label" title="Lorentz.Value">Label</a> field -&gt; (fieldTy ': (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s)) <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl newDiff (field ': touched) ': s)</li><li class="src short"><a href="#v:migrateModifyField">migrateModifyField</a> :: <span class="keyword">forall</span> field oldTempl newTempl diff touched fieldTy s. (<a href="Lorentz-UStore-Instr.html#t:HasUField" title="Lorentz.UStore.Instr">HasUField</a> field fieldTy oldTempl, <a href="Lorentz-UStore-Instr.html#t:HasUField" title="Lorentz.UStore.Instr">HasUField</a> field fieldTy newTempl) =&gt; <a href="Lorentz-Value.html#t:Label" title="Lorentz.Value">Label</a> field -&gt; (fieldTy ': (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s)) <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s)</li><li class="src short"><a href="#v:muBlock">muBlock</a> :: ('[<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> o n d1 t1] <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> '[<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> o n d2 t2]) -&gt; <a href="Lorentz-UStore-Migration-Base.html#t:MigrationBlocks" title="Lorentz.UStore.Migration.Base">MigrationBlocks</a> o n d1 t1 d2 t2</li><li class="src short"><a href="#v:muBlockNamed">muBlockNamed</a> :: <a href="Lorentz-Prelude.html#t:Text" title="Lorentz.Prelude">Text</a> -&gt; ('[<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> o n d1 t1] <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> '[<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> o n d2 t2]) -&gt; <a href="Lorentz-UStore-Migration-Base.html#t:MigrationBlocks" title="Lorentz.UStore.Migration.Base">MigrationBlocks</a> o n d1 t1 d2 t2</li><li class="src short"><a href="#v:-60--45--45--62-">(&lt;--&gt;)</a> :: <a href="Lorentz-UStore-Migration-Base.html#t:MigrationBlocks" title="Lorentz.UStore.Migration.Base">MigrationBlocks</a> o n d1 t1 d2 t2 -&gt; <a href="Lorentz-UStore-Migration-Base.html#t:MigrationBlocks" title="Lorentz.UStore.Migration.Base">MigrationBlocks</a> o n d2 t2 d3 t3 -&gt; <a href="Lorentz-UStore-Migration-Base.html#t:MigrationBlocks" title="Lorentz.UStore.Migration.Base">MigrationBlocks</a> o n d1 t1 d3 t3</li><li class="src short"><a href="#v:-36-:">($:)</a> :: (a -&gt; b) -&gt; a -&gt; b</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>General</h1></a><div class="top"><p class="src"><a id="v:mustoreToOld" class="def">mustoreToOld</a> :: RequireBeInitial touched =&gt; (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTemplate newTemplate remDiff touched ': s) <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> (<a href="Lorentz-UStore-Types.html#t:UStore" title="Lorentz.UStore.Types">UStore</a> oldTemplate ': s) <a href="src/Lorentz.UStore.Migration.Blocks.html#mustoreToOld" class="link">Source</a> <a href="#v:mustoreToOld" class="selflink">#</a></p><div class="doc"><p>Get the old version of storage.</p><p>This can be applied only in the beginning of migration.</p><p>In fact this function is not very useful, all required operations should
 be available for <code><a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a></code>, but leaving it here just in case.</p></div></div><div class="top"><p class="src"><span class="keyword">class</span> <a id="t:MigrationFinishCheckPosition" class="def">MigrationFinishCheckPosition</a> a <span class="keyword">where</span> <a href="src/Lorentz.UStore.Migration.Blocks.html#MigrationFinishCheckPosition" class="link">Source</a> <a href="#t:MigrationFinishCheckPosition" class="selflink">#</a></p><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:migrationFinish" class="def">migrationFinish</a> :: a <a href="src/Lorentz.UStore.Migration.Blocks.html#migrationFinish" class="link">Source</a> <a href="#v:migrationFinish" class="selflink">#</a></p><div class="doc"><p>Put this in the end of migration script to get a human-readable message
 about remaining diff which yet should be covered.
 Use of this function in migration is fully optional.</p><p>This function is not part of <code><a href="Lorentz-UStore-Migration-Base.html#v:mkUStoreMigration" title="Lorentz.UStore.Migration.Base">mkUStoreMigration</a></code> for the sake of
 proper error messages ordering, during development
 you probably want errors in migration script to be located earlier
 in code than errors about not fully covered diff (if you used
 to fix errors in the same order in which they appear).</p></div></div><div class="subs instances"><details id="i:MigrationFinishCheckPosition" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:MigrationFinishCheckPosition:MigrationFinishCheckPosition:1"></span> (i ~ (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s), o ~ (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl ([] :: [<a href="Lorentz-UStore-Migration-Diff.html#t:DiffItem" title="Lorentz.UStore.Migration.Diff">DiffItem</a>]) touched ': s), <a href="Lorentz-UStore-Migration-Diff.html#t:RequireEmptyDiff" title="Lorentz.UStore.Migration.Diff">RequireEmptyDiff</a> diff) =&gt; <a href="Lorentz-UStore-Migration-Blocks.html#t:MigrationFinishCheckPosition" title="Lorentz.UStore.Migration.Blocks">MigrationFinishCheckPosition</a> (i <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> o)</span> <a href="src/Lorentz.UStore.Migration.Blocks.html#line-275" class="link">Source</a> <a href="#t:MigrationFinishCheckPosition" class="selflink">#</a></td><td class="doc"><p>This version can be used in <code><a href="Lorentz-UStore-Migration-Base.html#v:mkUStoreMigration" title="Lorentz.UStore.Migration.Base">mkUStoreMigration</a></code>.</p></td></tr><tr><td colspan="2"><details id="i:ic:MigrationFinishCheckPosition:MigrationFinishCheckPosition:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Lorentz-UStore-Migration-Blocks.html">Lorentz.UStore.Migration.Blocks</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:migrationFinish">migrationFinish</a> :: i <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> o <a href="src/Lorentz.UStore.Migration.Blocks.html#migrationFinish" class="link">Source</a> <a href="#v:migrationFinish" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:MigrationFinishCheckPosition:MigrationFinishCheckPosition:2"></span> (<a href="Lorentz-UStore-Migration-Diff.html#t:RequireEmptyDiff" title="Lorentz.UStore.Migration.Diff">RequireEmptyDiff</a> d1, t1 ~ t2) =&gt; <a href="Lorentz-UStore-Migration-Blocks.html#t:MigrationFinishCheckPosition" title="Lorentz.UStore.Migration.Blocks">MigrationFinishCheckPosition</a> (<a href="Lorentz-UStore-Migration-Base.html#t:MigrationBlocks" title="Lorentz.UStore.Migration.Base">MigrationBlocks</a> o n d1 t1 ([] :: [<a href="Lorentz-UStore-Migration-Diff.html#t:DiffItem" title="Lorentz.UStore.Migration.Diff">DiffItem</a>]) t2)</span> <a href="src/Lorentz.UStore.Migration.Blocks.html#line-284" class="link">Source</a> <a href="#t:MigrationFinishCheckPosition" class="selflink">#</a></td><td class="doc"><p>This version can be used in <code>mkUStoreMultiMigration</code> as the last migration
 block.</p></td></tr><tr><td colspan="2"><details id="i:ic:MigrationFinishCheckPosition:MigrationFinishCheckPosition:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Lorentz-UStore-Migration-Blocks.html">Lorentz.UStore.Migration.Blocks</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:migrationFinish">migrationFinish</a> :: <a href="Lorentz-UStore-Migration-Base.html#t:MigrationBlocks" title="Lorentz.UStore.Migration.Base">MigrationBlocks</a> o n d1 t1 [] t2 <a href="src/Lorentz.UStore.Migration.Blocks.html#migrationFinish" class="link">Source</a> <a href="#v:migrationFinish" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><a href="#g:2" id="g:2"><h1>Elemental steps</h1></a><div class="top"><p class="src"><a id="v:migrateCoerceUnsafe" class="def">migrateCoerceUnsafe</a> :: <span class="keyword">forall</span> field oldTempl newTempl diff touched newDiff newDiff0 _1 _2 s. ('(_1, newDiff0) ~ <a href="Lorentz-UStore-Migration-Diff.html#t:CoverDiff" title="Lorentz.UStore.Migration.Diff">CoverDiff</a> <a href="Lorentz-UStore-Migration-Diff.html#v:DcRemove" title="Lorentz.UStore.Migration.Diff">DcRemove</a> field diff, '(_2, newDiff) ~ <a href="Lorentz-UStore-Migration-Diff.html#t:CoverDiff" title="Lorentz.UStore.Migration.Diff">CoverDiff</a> <a href="Lorentz-UStore-Migration-Diff.html#v:DcAdd" title="Lorentz.UStore.Migration.Diff">DcAdd</a> field newDiff0) =&gt; <a href="Lorentz-Value.html#t:Label" title="Lorentz.Value">Label</a> field -&gt; (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s) <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl newDiff touched ': s) <a href="src/Lorentz.UStore.Migration.Blocks.html#migrateCoerceUnsafe" class="link">Source</a> <a href="#v:migrateCoerceUnsafe" class="selflink">#</a></p><div class="doc"><p>Cast field or submap pretending that its value fits to the new type.</p><p>Useful when type of field, e.g. lambda or set of lambdas, is polymorphic
 over storage type.</p></div></div><div class="top"><p class="src"><a id="v:migrateGetField" class="def">migrateGetField</a> :: <span class="keyword">forall</span> field oldTempl newTempl diff touched fieldTy s. (<a href="Lorentz-UStore-Instr.html#t:HasUField" title="Lorentz.UStore.Instr">HasUField</a> field fieldTy oldTempl, RequireUntouched field (field <a href="../morley-1.0.0/Util-Type.html#t:IsElem" title="Util.Type">`IsElem`</a> touched)) =&gt; <a href="Lorentz-Value.html#t:Label" title="Lorentz.Value">Label</a> field -&gt; (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s) <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> (fieldTy ': (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s)) <a href="src/Lorentz.UStore.Migration.Blocks.html#migrateGetField" class="link">Source</a> <a href="#v:migrateGetField" class="selflink">#</a></p><div class="doc"><p>Get a field present in old version of <code><a href="Lorentz-UStore-Types.html#t:UStore" title="Lorentz.UStore.Types">UStore</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:migrateAddField" class="def">migrateAddField</a> :: <span class="keyword">forall</span> field oldTempl newTempl diff touched fieldTy newDiff marker s. ('(<a href="Lorentz-UStore-Types.html#t:UStoreFieldExt" title="Lorentz.UStore.Types">UStoreFieldExt</a> marker fieldTy, newDiff) ~ <a href="Lorentz-UStore-Migration-Diff.html#t:CoverDiff" title="Lorentz.UStore.Migration.Diff">CoverDiff</a> <a href="Lorentz-UStore-Migration-Diff.html#v:DcAdd" title="Lorentz.UStore.Migration.Diff">DcAdd</a> field diff, <a href="Lorentz-UStore-Instr.html#t:HasUField" title="Lorentz.UStore.Instr">HasUField</a> field fieldTy newTempl) =&gt; <a href="Lorentz-Value.html#t:Label" title="Lorentz.Value">Label</a> field -&gt; (fieldTy ': (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s)) <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl newDiff (field ': touched) ': s) <a href="src/Lorentz.UStore.Migration.Blocks.html#migrateAddField" class="link">Source</a> <a href="#v:migrateAddField" class="selflink">#</a></p><div class="doc"><p>Add a field which was not present before.
 This covers one addition from the diff and any removals of field with given
 name.</p><p>This function cannot overwrite existing field with the same name, if this
 is necessary use <code><a href="Lorentz-UStore-Migration-Blocks.html#v:migrateOverwriteField" title="Lorentz.UStore.Migration.Blocks">migrateOverwriteField</a></code> which would declare removal
 explicitly.</p></div></div><div class="top"><p class="src"><a id="v:migrateRemoveField" class="def">migrateRemoveField</a> :: <span class="keyword">forall</span> field oldTempl newTempl diff touched fieldTy newDiff marker s. ('(<a href="Lorentz-UStore-Types.html#t:UStoreFieldExt" title="Lorentz.UStore.Types">UStoreFieldExt</a> marker fieldTy, newDiff) ~ <a href="Lorentz-UStore-Migration-Diff.html#t:CoverDiff" title="Lorentz.UStore.Migration.Diff">CoverDiff</a> <a href="Lorentz-UStore-Migration-Diff.html#v:DcRemove" title="Lorentz.UStore.Migration.Diff">DcRemove</a> field diff, <a href="Lorentz-UStore-Instr.html#t:HasUField" title="Lorentz.UStore.Instr">HasUField</a> field fieldTy oldTempl) =&gt; <a href="Lorentz-Value.html#t:Label" title="Lorentz.Value">Label</a> field -&gt; (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s) <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl newDiff (field ': touched) ': s) <a href="src/Lorentz.UStore.Migration.Blocks.html#migrateRemoveField" class="link">Source</a> <a href="#v:migrateRemoveField" class="selflink">#</a></p><div class="doc"><p>Remove a field which should not be present in new version of storage.
 This covers one removal from the diff.</p><p>In fact, this action could be performed automatically, but since
 removal is a destructive operation, being explicit about it seems
 like a good thing.</p></div></div><div class="top"><p class="src"><a id="v:migrateExtractField" class="def">migrateExtractField</a> :: <span class="keyword">forall</span> field oldTempl newTempl diff touched fieldTy newDiff marker s. ('(<a href="Lorentz-UStore-Types.html#t:UStoreFieldExt" title="Lorentz.UStore.Types">UStoreFieldExt</a> marker fieldTy, newDiff) ~ <a href="Lorentz-UStore-Migration-Diff.html#t:CoverDiff" title="Lorentz.UStore.Migration.Diff">CoverDiff</a> <a href="Lorentz-UStore-Migration-Diff.html#v:DcRemove" title="Lorentz.UStore.Migration.Diff">DcRemove</a> field diff, <a href="Lorentz-UStore-Instr.html#t:HasUField" title="Lorentz.UStore.Instr">HasUField</a> field fieldTy oldTempl, RequireUntouched field (field <a href="../morley-1.0.0/Util-Type.html#t:IsElem" title="Util.Type">`IsElem`</a> touched)) =&gt; <a href="Lorentz-Value.html#t:Label" title="Lorentz.Value">Label</a> field -&gt; (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s) <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> (fieldTy ': (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl newDiff (field ': touched) ': s)) <a href="src/Lorentz.UStore.Migration.Blocks.html#migrateExtractField" class="link">Source</a> <a href="#v:migrateExtractField" class="selflink">#</a></p><div class="doc"><p>Get and remove a field from old version of <code><a href="Lorentz-UStore-Types.html#t:UStore" title="Lorentz.UStore.Types">UStore</a></code>.</p><p>You probably want to use this more often than plain <code><a href="Lorentz-UStore-Migration-Blocks.html#v:migrateRemoveField" title="Lorentz.UStore.Migration.Blocks">migrateRemoveField</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:migrateOverwriteField" class="def">migrateOverwriteField</a> :: <span class="keyword">forall</span> field oldTempl newTempl diff touched fieldTy oldFieldTy marker oldMarker newDiff newDiff0 s. ('(<a href="Lorentz-UStore-Types.html#t:UStoreFieldExt" title="Lorentz.UStore.Types">UStoreFieldExt</a> oldMarker oldFieldTy, newDiff0) ~ <a href="Lorentz-UStore-Migration-Diff.html#t:CoverDiff" title="Lorentz.UStore.Migration.Diff">CoverDiff</a> <a href="Lorentz-UStore-Migration-Diff.html#v:DcRemove" title="Lorentz.UStore.Migration.Diff">DcRemove</a> field diff, '(<a href="Lorentz-UStore-Types.html#t:UStoreFieldExt" title="Lorentz.UStore.Types">UStoreFieldExt</a> marker fieldTy, newDiff) ~ <a href="Lorentz-UStore-Migration-Diff.html#t:CoverDiff" title="Lorentz.UStore.Migration.Diff">CoverDiff</a> <a href="Lorentz-UStore-Migration-Diff.html#v:DcAdd" title="Lorentz.UStore.Migration.Diff">DcAdd</a> field newDiff0, <a href="Lorentz-UStore-Instr.html#t:HasUField" title="Lorentz.UStore.Instr">HasUField</a> field fieldTy newTempl) =&gt; <a href="Lorentz-Value.html#t:Label" title="Lorentz.Value">Label</a> field -&gt; (fieldTy ': (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s)) <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl newDiff (field ': touched) ': s) <a href="src/Lorentz.UStore.Migration.Blocks.html#migrateOverwriteField" class="link">Source</a> <a href="#v:migrateOverwriteField" class="selflink">#</a></p><div class="doc"><p>Remove field and write new one in place of it.</p><p>This is semantically equivalent to
 <code>dip (migrateRemoveField label) &gt;&gt; migrateAddField label</code>,
 but is cheaper.</p></div></div><div class="top"><p class="src"><a id="v:migrateModifyField" class="def">migrateModifyField</a> :: <span class="keyword">forall</span> field oldTempl newTempl diff touched fieldTy s. (<a href="Lorentz-UStore-Instr.html#t:HasUField" title="Lorentz.UStore.Instr">HasUField</a> field fieldTy oldTempl, <a href="Lorentz-UStore-Instr.html#t:HasUField" title="Lorentz.UStore.Instr">HasUField</a> field fieldTy newTempl) =&gt; <a href="Lorentz-Value.html#t:Label" title="Lorentz.Value">Label</a> field -&gt; (fieldTy ': (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s)) <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> (<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> oldTempl newTempl diff touched ': s) <a href="src/Lorentz.UStore.Migration.Blocks.html#migrateModifyField" class="link">Source</a> <a href="#v:migrateModifyField" class="selflink">#</a></p><div class="doc"><p>Modify field which should stay in new version of storage.
 This does not affect remaining diff.</p></div></div><a href="#g:3" id="g:3"><h1>Migration batches</h1></a><div class="top"><p class="src"><a id="v:muBlock" class="def">muBlock</a> :: ('[<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> o n d1 t1] <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> '[<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> o n d2 t2]) -&gt; <a href="Lorentz-UStore-Migration-Base.html#t:MigrationBlocks" title="Lorentz.UStore.Migration.Base">MigrationBlocks</a> o n d1 t1 d2 t2 <a href="src/Lorentz.UStore.Migration.Blocks.html#muBlock" class="link">Source</a> <a href="#v:muBlock" class="selflink">#</a></p><div class="doc"><p>Define a migration atom.</p><p>It will be named automatically according to the set of actions it performs
 (via <code><a href="Lorentz-UStore-Migration-Base.html#t:DMigrationActionDesc" title="Lorentz.UStore.Migration.Base">DMigrationActionDesc</a></code>s).
 This may be want you want for small sequences of actions, but for complex ones
 consider using <code><a href="Lorentz-UStore-Migration-Blocks.html#v:muBlockNamed" title="Lorentz.UStore.Migration.Blocks">muBlockNamed</a></code>.
 Names are used in rendering migration plan.</p></div></div><div class="top"><p class="src"><a id="v:muBlockNamed" class="def">muBlockNamed</a> :: <a href="Lorentz-Prelude.html#t:Text" title="Lorentz.Prelude">Text</a> -&gt; ('[<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> o n d1 t1] <a href="Lorentz-Base.html#t::-45--62-" title="Lorentz.Base">:-&gt;</a> '[<a href="Lorentz-UStore-Migration-Base.html#t:MUStore" title="Lorentz.UStore.Migration.Base">MUStore</a> o n d2 t2]) -&gt; <a href="Lorentz-UStore-Migration-Base.html#t:MigrationBlocks" title="Lorentz.UStore.Migration.Base">MigrationBlocks</a> o n d1 t1 d2 t2 <a href="src/Lorentz.UStore.Migration.Blocks.html#muBlockNamed" class="link">Source</a> <a href="#v:muBlockNamed" class="selflink">#</a></p><div class="doc"><p>Define a migration atom with given name.</p><p>Name will be used when rendering migration plan.</p></div></div><div class="top"><p class="src"><a id="v:-60--45--45--62-" class="def">(&lt;--&gt;)</a> :: <a href="Lorentz-UStore-Migration-Base.html#t:MigrationBlocks" title="Lorentz.UStore.Migration.Base">MigrationBlocks</a> o n d1 t1 d2 t2 -&gt; <a href="Lorentz-UStore-Migration-Base.html#t:MigrationBlocks" title="Lorentz.UStore.Migration.Base">MigrationBlocks</a> o n d2 t2 d3 t3 -&gt; <a href="Lorentz-UStore-Migration-Base.html#t:MigrationBlocks" title="Lorentz.UStore.Migration.Base">MigrationBlocks</a> o n d1 t1 d3 t3 <span class="fixity">infixl 2</span><span class="rightedge"></span> <a href="src/Lorentz.UStore.Migration.Blocks.html#%3C--%3E" class="link">Source</a> <a href="#v:-60--45--45--62-" class="selflink">#</a></p><div class="doc"><p>Composition of migration blocks.</p></div></div><div class="top"><p class="src"><a id="v:-36-:" class="def">($:)</a> :: (a -&gt; b) -&gt; a -&gt; b <span class="fixity">infixr 7</span><span class="rightedge"></span> <a href="src/Lorentz.UStore.Migration.Blocks.html#%24%3A" class="link">Source</a> <a href="#v:-36-:" class="selflink">#</a></p><div class="doc"><p>This is <code><a href="Lorentz-Prelude.html#t:-36-" title="Lorentz.Prelude">$</a></code> operator with priority higher than <code><a href="Lorentz-UStore-Migration-Blocks.html#v:-60--45--45--62-" title="Lorentz.UStore.Migration.Blocks">&lt;--&gt;</a></code>.</p><p>It allows you writing</p><pre>mkUStoreBatchedMigration =
  muBlock $: do
    migrateAddField ...
  <a href="--">--</a>
  muBlock $: do
    migrateRemoveField ...
</pre><p>Alternatively, <code>BlockArguments</code> extension can be used.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>