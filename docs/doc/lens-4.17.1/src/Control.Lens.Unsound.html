<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-warnings-deprecations #-}</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-cpp">#ifndef MIN_VERSION_mtl
#define MIN_VERSION_mtl(x,y,z) 1
#endif
</span><span>
</span><a name="line-12"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &lt; 708
</span><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span>
</span><a name="line-14"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-16"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- Module      :  Control.Lens.Unsound</span><span>
</span><a name="line-21"></a><span class="hs-comment">-- Copyright   :  (C) 2012-16 Edward Kmett</span><span>
</span><a name="line-22"></a><span class="hs-comment">-- License     :  BSD-style (see the file LICENSE)</span><span>
</span><a name="line-23"></a><span class="hs-comment">-- Maintainer  :  Edward Kmett &lt;ekmett@gmail.com&gt;</span><span>
</span><a name="line-24"></a><span class="hs-comment">-- Stability   :  provisional</span><span>
</span><a name="line-25"></a><span class="hs-comment">-- Portability :  Rank2Types</span><span>
</span><a name="line-26"></a><span class="hs-comment">--</span><span>
</span><a name="line-27"></a><span class="hs-comment">-- One commonly asked question is: can we combine two lenses,</span><span>
</span><a name="line-28"></a><span class="hs-comment">-- @`Lens'` a b@ and @`Lens'` a c@ into @`Lens'` a (b, c)@.</span><span>
</span><a name="line-29"></a><span class="hs-comment">-- This is fair thing to ask, but such operation is unsound in general. </span><span>
</span><a name="line-30"></a><span class="hs-comment">-- See `lensProduct`.</span><span>
</span><a name="line-31"></a><span class="hs-comment">--</span><span>
</span><a name="line-32"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-33"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control.Lens.Unsound</span><span>
</span><a name="line-34"></a><span>  </span><span class="hs-special">(</span><span>
</span><a name="line-35"></a><span>    </span><a href="Control.Lens.Unsound.html#lensProduct"><span class="hs-identifier hs-var">lensProduct</span></a><span>
</span><a name="line-36"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Lens.Unsound.html#prismSum"><span class="hs-identifier hs-var">prismSum</span></a><span>
</span><a name="line-37"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Applicative</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="Control.Lens.html"><span class="hs-identifier">Control.Lens</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-comment">-- | A lens product. There is no law-abiding way to do this in general.</span><span>
</span><a name="line-44"></a><span class="hs-comment">-- Result is only a valid 'Lens' if the input lenses project disjoint parts of </span><span>
</span><a name="line-45"></a><span class="hs-comment">-- the structure @s@. Otherwise &quot;you get what you put in&quot; law</span><span>
</span><a name="line-46"></a><span class="hs-comment">--</span><span>
</span><a name="line-47"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-48"></a><span class="hs-comment">-- 'Control.Lens.Getter.view' l ('Control.Lens.Setter.set' l v s) &#8801; v</span><span>
</span><a name="line-49"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-50"></a><span class="hs-comment">--</span><span>
</span><a name="line-51"></a><span class="hs-comment">-- is violated by</span><span>
</span><a name="line-52"></a><span class="hs-comment">--</span><span>
</span><a name="line-53"></a><span class="hs-comment">-- &gt;&gt;&gt; let badLens :: Lens' (Int, Char) (Int, Int); badLens = lensProduct _1 _1</span><span>
</span><a name="line-54"></a><span class="hs-comment">-- &gt;&gt;&gt; view badLens (set badLens (1,2) (3,'x'))</span><span>
</span><a name="line-55"></a><span class="hs-comment">-- (2,2)</span><span>
</span><a name="line-56"></a><span class="hs-comment">--</span><span>
</span><a name="line-57"></a><span class="hs-comment">-- but we should get @(1,2)@.</span><span>
</span><a name="line-58"></a><span class="hs-comment">--</span><span>
</span><a name="line-59"></a><span class="hs-comment">-- Are you looking for 'Control.Lens.Lens.alongside'?</span><span>
</span><a name="line-60"></a><span class="hs-comment">--</span><span>
</span><a name="line-61"></a><span class="hs-identifier">lensProduct</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Control.Lens.Lens.html#ALens%27"><span class="hs-identifier hs-type">ALens'</span></a><span> </span><a href="#local-6989586621679405379"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679405380"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Lens.Lens.html#ALens%27"><span class="hs-identifier hs-type">ALens'</span></a><span> </span><a href="#local-6989586621679405379"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679405381"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Lens.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a><span> </span><a href="#local-6989586621679405379"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679405380"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679405381"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-62"></a><a name="lensProduct"><a href="Control.Lens.Unsound.html#lensProduct"><span class="hs-identifier">lensProduct</span></a></a><span> </span><a name="local-6989586621679405382"><a href="#local-6989586621679405382"><span class="hs-identifier">l1</span></a></a><span> </span><a name="local-6989586621679405383"><a href="#local-6989586621679405383"><span class="hs-identifier">l2</span></a></a><span> </span><a name="local-6989586621679405384"><a href="#local-6989586621679405384"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679405385"><a href="#local-6989586621679405385"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-63"></a><span>    </span><a href="#local-6989586621679405384"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679405385"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="Control.Lens.Lens.html#%5E%23"><span class="hs-operator hs-var">^#</span></a><span> </span><a href="#local-6989586621679405382"><span class="hs-identifier hs-var">l1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679405385"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="Control.Lens.Lens.html#%5E%23"><span class="hs-operator hs-var">^#</span></a><span> </span><a href="#local-6989586621679405383"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&amp;&gt;</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679405386"><a href="#local-6989586621679405386"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679405387"><a href="#local-6989586621679405387"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679405385"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&amp;</span><span> </span><a href="#local-6989586621679405382"><span class="hs-identifier hs-var">l1</span></a><span> </span><a href="Control.Lens.Lens.html#%23~"><span class="hs-operator hs-var">#~</span></a><span> </span><a href="#local-6989586621679405386"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&amp;</span><span> </span><a href="#local-6989586621679405383"><span class="hs-identifier hs-var">l2</span></a><span> </span><a href="Control.Lens.Lens.html#%23~"><span class="hs-operator hs-var">#~</span></a><span> </span><a href="#local-6989586621679405387"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-comment">-- | A dual of `lensProduct`: a prism sum.</span><span>
</span><a name="line-66"></a><span class="hs-comment">--</span><span>
</span><a name="line-67"></a><span class="hs-comment">-- The law</span><span>
</span><a name="line-68"></a><span class="hs-comment">--</span><span>
</span><a name="line-69"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-70"></a><span class="hs-comment">-- 'Control.Lens.Fold.preview' l ('Control.Lens.Review.review' l b) &#8801; 'Just' b</span><span>
</span><a name="line-71"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-72"></a><span class="hs-comment">--</span><span>
</span><a name="line-73"></a><span class="hs-comment">-- breaks with</span><span>
</span><a name="line-74"></a><span class="hs-comment">--</span><span>
</span><a name="line-75"></a><span class="hs-comment">-- &gt;&gt;&gt; let badPrism :: Prism' (Maybe Char) (Either Char Char); badPrism = prismSum _Just _Just</span><span>
</span><a name="line-76"></a><span class="hs-comment">-- &gt;&gt;&gt; preview badPrism (review badPrism (Right 'x'))</span><span>
</span><a name="line-77"></a><span class="hs-comment">-- Just (Left 'x')</span><span>
</span><a name="line-78"></a><span class="hs-comment">--</span><span>
</span><a name="line-79"></a><span class="hs-comment">-- We put in 'Right' value, but get back 'Left'.</span><span>
</span><a name="line-80"></a><span class="hs-comment">-- </span><span>
</span><a name="line-81"></a><span class="hs-comment">-- Are you looking for 'Control.Lens.Prism.without'?</span><span>
</span><a name="line-82"></a><span class="hs-comment">--</span><span>
</span><a name="line-83"></a><span class="hs-identifier">prismSum</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Control.Lens.Prism.html#APrism"><span class="hs-identifier hs-type">APrism</span></a><span> </span><a href="#local-6989586621679405373"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679405374"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679405375"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679405376"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-84"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Lens.Prism.html#APrism"><span class="hs-identifier hs-type">APrism</span></a><span> </span><a href="#local-6989586621679405373"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679405374"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679405377"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-6989586621679405378"><span class="hs-identifier hs-type">d</span></a><span>
</span><a name="line-85"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Lens.Type.html#Prism"><span class="hs-identifier hs-type">Prism</span></a><span> </span><a href="#local-6989586621679405373"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679405374"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621679405375"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679405377"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621679405376"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621679405378"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-86"></a><a name="prismSum"><a href="Control.Lens.Unsound.html#prismSum"><span class="hs-identifier">prismSum</span></a></a><span> </span><a name="local-6989586621679405388"><a href="#local-6989586621679405388"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-87"></a><span>    </span><a href="Control.Lens.Prism.html#withPrism"><span class="hs-identifier hs-var">withPrism</span></a><span> </span><a href="#local-6989586621679405388"><span class="hs-identifier hs-var">k</span></a><span>                  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679405392"><a href="#local-6989586621679405392"><span class="hs-identifier">bt</span></a></a><span> </span><a name="local-6989586621679405393"><a href="#local-6989586621679405393"><span class="hs-identifier">seta</span></a></a><span> </span><a name="local-6989586621679405394"><a href="#local-6989586621679405394"><span class="hs-identifier">k'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-88"></a><span>    </span><a href="Control.Lens.Prism.html#withPrism"><span class="hs-identifier hs-var">withPrism</span></a><span> </span><a href="#local-6989586621679405394"><span class="hs-identifier hs-var">k'</span></a><span>                 </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679405395"><a href="#local-6989586621679405395"><span class="hs-identifier">dt</span></a></a><span> </span><a name="local-6989586621679405396"><a href="#local-6989586621679405396"><span class="hs-identifier">setb</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-89"></a><span>    </span><a href="Control.Lens.Prism.html#prism"><span class="hs-identifier hs-var">prism</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">either</span><span> </span><a href="#local-6989586621679405392"><span class="hs-identifier hs-var">bt</span></a><span> </span><a href="#local-6989586621679405395"><span class="hs-identifier hs-var">dt</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679405397"><a href="#local-6989586621679405397"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-90"></a><span>    </span><a href="#local-6989586621679405389"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679405393"><span class="hs-identifier hs-var">seta</span></a><span> </span><a href="#local-6989586621679405397"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679405396"><span class="hs-identifier hs-var">setb</span></a><span> </span><a href="#local-6989586621679405397"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-92"></a><span>    </span><a name="local-6989586621679405389"><a href="#local-6989586621679405389"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679405390"><a href="#local-6989586621679405390"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679405390"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-93"></a><span>    </span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><a name="local-6989586621679405391"><a href="#local-6989586621679405391"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679405391"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-94"></a></pre></body></html>