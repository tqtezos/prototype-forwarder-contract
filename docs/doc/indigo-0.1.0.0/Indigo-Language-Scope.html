<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Indigo.Language.Scope</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Indigo.Language.Scope.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">indigo-0.1.0.0: Convenient imperative eDSL over Lorentz.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Indigo.Language.Scope</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Machinery to provide ability to return values from Indigo statements.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">type</span> <a href="#t:ScopeCodeGen">ScopeCodeGen</a> ret = <a href="Indigo-Language-Scope.html#t:ScopeCodeGen-39-" title="Indigo.Language.Scope">ScopeCodeGen'</a> (<a href="Indigo-Language-Scope.html#t:ClassifyBranchReturn" title="Indigo.Language.Scope">ClassifyBranchReturn</a> ret) ret</li><li class="src short"><span class="keyword">class</span> <a href="#t:ScopeCodeGen-39-">ScopeCodeGen'</a> (retKind :: BranchRetKind) (ret :: <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a>) <span class="keyword">where</span><ul class="subs"><li><span class="keyword">type</span> <a href="#t:ScopeOutStack-39-">ScopeOutStack'</a> retKind ret (inp :: [<a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a>]) :: [<a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a>]</li><li><span class="keyword">type</span> <a href="#t:ScopeRetVars-39-">ScopeRetVars'</a> retKind ret :: <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a></li><li><span class="keyword">type</span> <a href="#t:ScopeRetExprs-39-">ScopeRetExprs'</a> retKind ret :: <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a></li><li><a href="#v:compileScopeReturn-39-">compileScopeReturn'</a> :: ret -&gt; <a href="Indigo-State.html#t:IndigoM" title="Indigo.State">IndigoM</a> xs (<a href="Indigo-Language-Scope.html#t:ScopeOutStack-39-" title="Indigo.Language.Scope">ScopeOutStack'</a> retKind ret xs) ()</li><li><a href="#v:liftClear-39-">liftClear'</a> :: (xs <a href="Indigo-Lorentz.html#t::-45--62-" title="Indigo.Lorentz">:-&gt;</a> inp) -&gt; <a href="Indigo-Language-Scope.html#t:ScopeOutStack-39-" title="Indigo.Language.Scope">ScopeOutStack'</a> retKind ret xs <a href="Indigo-Lorentz.html#t::-45--62-" title="Indigo.Lorentz">:-&gt;</a> <a href="Indigo-Language-Scope.html#t:ScopeOutStack-39-" title="Indigo.Language.Scope">ScopeOutStack'</a> retKind ret inp</li><li><a href="#v:finalizeStatement-39-">finalizeStatement'</a> :: <a href="Indigo-State.html#t:MetaData" title="Indigo.State">MetaData</a> inp -&gt; (inp <a href="Indigo-Lorentz.html#t::-45--62-" title="Indigo.Lorentz">:-&gt;</a> <a href="Indigo-Language-Scope.html#t:ScopeOutStack-39-" title="Indigo.Language.Scope">ScopeOutStack'</a> retKind ret inp) -&gt; <a href="Indigo-State.html#t:GenCode" title="Indigo.State">GenCode</a> inp (<a href="Indigo-Language-Scope.html#t:ScopeOutStack-39-" title="Indigo.Language.Scope">ScopeOutStack'</a> retKind ret inp) (<a href="Indigo-Language-Scope.html#t:ScopeRetVars-39-" title="Indigo.Language.Scope">ScopeRetVars'</a> retKind ret)</li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:ScopeOutStack">ScopeOutStack</a> ret inp = <a href="Indigo-Language-Scope.html#t:ScopeOutStack-39-" title="Indigo.Language.Scope">ScopeOutStack'</a> (<a href="Indigo-Language-Scope.html#t:ClassifyBranchReturn" title="Indigo.Language.Scope">ClassifyBranchReturn</a> ret) ret inp</li><li class="src short"><span class="keyword">type</span> <a href="#t:ScopeRetVars">ScopeRetVars</a> ret = <a href="Indigo-Language-Scope.html#t:ScopeRetVars-39-" title="Indigo.Language.Scope">ScopeRetVars'</a> (<a href="Indigo-Language-Scope.html#t:ClassifyBranchReturn" title="Indigo.Language.Scope">ClassifyBranchReturn</a> ret) ret</li><li class="src short"><span class="keyword">type</span> <a href="#t:ScopeRetExprs">ScopeRetExprs</a> ret = <a href="Indigo-Language-Scope.html#t:ScopeRetExprs-39-" title="Indigo.Language.Scope">ScopeRetExprs'</a> (<a href="Indigo-Language-Scope.html#t:ClassifyBranchReturn" title="Indigo.Language.Scope">ClassifyBranchReturn</a> ret) ret</li><li class="src short"><span class="keyword">type family</span> <a href="#t:ClassifyBranchReturn">ClassifyBranchReturn</a> (ret :: <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a>) <span class="keyword">where ...</span></li><li class="src short"><a href="#v:compileScope">compileScope</a> :: <span class="keyword">forall</span> ret inp xs. <a href="Indigo-Language-Scope.html#t:ScopeCodeGen" title="Indigo.Language.Scope">ScopeCodeGen</a> ret =&gt; <a href="Indigo-State.html#t:GenCode" title="Indigo.State">GenCode</a> inp xs ret -&gt; inp <a href="Indigo-Lorentz.html#t::-45--62-" title="Indigo.Lorentz">:-&gt;</a> <a href="Indigo-Language-Scope.html#t:ScopeOutStack" title="Indigo.Language.Scope">ScopeOutStack</a> ret inp</li><li class="src short"><a href="#v:finalizeStatement">finalizeStatement</a> :: <span class="keyword">forall</span> ret inp. <a href="Indigo-Language-Scope.html#t:ScopeCodeGen" title="Indigo.Language.Scope">ScopeCodeGen</a> ret =&gt; <a href="Indigo-State.html#t:MetaData" title="Indigo.State">MetaData</a> inp -&gt; (inp <a href="Indigo-Lorentz.html#t::-45--62-" title="Indigo.Lorentz">:-&gt;</a> <a href="Indigo-Language-Scope.html#t:ScopeOutStack" title="Indigo.Language.Scope">ScopeOutStack</a> ret inp) -&gt; <a href="Indigo-State.html#t:GenCode" title="Indigo.State">GenCode</a> inp (<a href="Indigo-Language-Scope.html#t:ScopeOutStack" title="Indigo.Language.Scope">ScopeOutStack</a> ret inp) (<a href="Indigo-Language-Scope.html#t:ScopeRetVars" title="Indigo.Language.Scope">ScopeRetVars</a> ret)</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:ScopeCodeGen" class="def">ScopeCodeGen</a> ret = <a href="Indigo-Language-Scope.html#t:ScopeCodeGen-39-" title="Indigo.Language.Scope">ScopeCodeGen'</a> (<a href="Indigo-Language-Scope.html#t:ClassifyBranchReturn" title="Indigo.Language.Scope">ClassifyBranchReturn</a> ret) ret <a href="src/Indigo.Language.Scope.html#ScopeCodeGen" class="link">Source</a> <a href="#t:ScopeCodeGen" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">class</span> <a id="t:ScopeCodeGen-39-" class="def">ScopeCodeGen'</a> (retKind :: BranchRetKind) (ret :: <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a>) <span class="keyword">where</span> <a href="src/Indigo.Language.Scope.html#ScopeCodeGen%27" class="link">Source</a> <a href="#t:ScopeCodeGen-39-" class="selflink">#</a></p><div class="doc"><p>Type class which unions all related management of computations in a scope,
 like in 'if' branch, in 'case' body, etc.
 Particularly, it takes care of the  computation of expressions
 returning from a scope to leave the scope safely.
 Basically, this type class encapsulates generation of Lorentz code which looks like:
   branch_code #
     we get some arbitrary type of a stack here, lets call it <code>xs</code>
   compute_returning_expressions #
     we get type of stack [e1, e2, ... ek] ++ xs
   cleanup_xs_to_inp
     we get [e1, e2, e3, ..., ek] ++ inp</p></div><div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a id="t:ScopeOutStack-39-" class="def">ScopeOutStack'</a> retKind ret (inp :: [<a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a>]) :: [<a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a>] <a href="src/Indigo.Language.Scope.html#ScopeOutStack%27" class="link">Source</a> <a href="#t:ScopeOutStack-39-" class="selflink">#</a></p><div class="doc"><p>Type family reflecting the output stack of the resulting statement.</p></div><p class="src"><span class="keyword">type</span> <a id="t:ScopeRetVars-39-" class="def">ScopeRetVars'</a> retKind ret :: <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <a href="src/Indigo.Language.Scope.html#ScopeRetVars%27" class="link">Source</a> <a href="#t:ScopeRetVars-39-" class="selflink">#</a></p><div class="doc"><p>Type family reflecting the output value of the resulting statement.</p></div><p class="src"><span class="keyword">type</span> <a id="t:ScopeRetExprs-39-" class="def">ScopeRetExprs'</a> retKind ret :: <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <a href="src/Indigo.Language.Scope.html#ScopeRetExprs%27" class="link">Source</a> <a href="#t:ScopeRetExprs-39-" class="selflink">#</a></p><div class="doc"><p>Tuple looking like `(Expr x, Expr y, ..)`, which corresponds
 to expressions returning from the scope.
 <code><a href="Indigo-Language-Scope.html#t:ScopeRetVars-39-" title="Indigo.Language.Scope">ScopeRetVars'</a></code> and <code><a href="Indigo-Language-Scope.html#t:ScopeRetExprs-39-" title="Indigo.Language.Scope">ScopeRetExprs'</a></code> are twin types because
 the former just adds <code><a href="Indigo-State.html#t:Var" title="Indigo.State">Var</a></code> over each expression from the later one.</p></div></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:compileScopeReturn-39-" class="def">compileScopeReturn'</a> :: ret -&gt; <a href="Indigo-State.html#t:IndigoM" title="Indigo.State">IndigoM</a> xs (<a href="Indigo-Language-Scope.html#t:ScopeOutStack-39-" title="Indigo.Language.Scope">ScopeOutStack'</a> retKind ret xs) () <a href="src/Indigo.Language.Scope.html#compileScopeReturn%27" class="link">Source</a> <a href="#v:compileScopeReturn-39-" class="selflink">#</a></p><div class="doc"><p>Produces an Indigo computation, which puts on a stack
 evaluated returnen expressions from the leaving scope.</p></div><p class="src"><a id="v:liftClear-39-" class="def">liftClear'</a> :: (xs <a href="Indigo-Lorentz.html#t::-45--62-" title="Indigo.Lorentz">:-&gt;</a> inp) -&gt; <a href="Indigo-Language-Scope.html#t:ScopeOutStack-39-" title="Indigo.Language.Scope">ScopeOutStack'</a> retKind ret xs <a href="Indigo-Lorentz.html#t::-45--62-" title="Indigo.Lorentz">:-&gt;</a> <a href="Indigo-Language-Scope.html#t:ScopeOutStack-39-" title="Indigo.Language.Scope">ScopeOutStack'</a> retKind ret inp <a href="src/Indigo.Language.Scope.html#liftClear%27" class="link">Source</a> <a href="#v:liftClear-39-" class="selflink">#</a></p><div class="doc"><p>Drop unused cells of a stack from the leaving scope,
 which are after evaluated expressions.</p></div><p class="src"><a id="v:finalizeStatement-39-" class="def">finalizeStatement'</a> :: <a href="Indigo-State.html#t:MetaData" title="Indigo.State">MetaData</a> inp -&gt; (inp <a href="Indigo-Lorentz.html#t::-45--62-" title="Indigo.Lorentz">:-&gt;</a> <a href="Indigo-Language-Scope.html#t:ScopeOutStack-39-" title="Indigo.Language.Scope">ScopeOutStack'</a> retKind ret inp) -&gt; <a href="Indigo-State.html#t:GenCode" title="Indigo.State">GenCode</a> inp (<a href="Indigo-Language-Scope.html#t:ScopeOutStack-39-" title="Indigo.Language.Scope">ScopeOutStack'</a> retKind ret inp) (<a href="Indigo-Language-Scope.html#t:ScopeRetVars-39-" title="Indigo.Language.Scope">ScopeRetVars'</a> retKind ret) <a href="src/Indigo.Language.Scope.html#finalizeStatement%27" class="link">Source</a> <a href="#v:finalizeStatement-39-" class="selflink">#</a></p><div class="doc"><p>Push a variables in MetaData, which refer to generated expressions,
 and generate <code><a href="Indigo-State.html#v:gcClear" title="Indigo.State">gcClear</a></code> for the whole statement</p></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:ScopeOutStack" class="def">ScopeOutStack</a> ret inp = <a href="Indigo-Language-Scope.html#t:ScopeOutStack-39-" title="Indigo.Language.Scope">ScopeOutStack'</a> (<a href="Indigo-Language-Scope.html#t:ClassifyBranchReturn" title="Indigo.Language.Scope">ClassifyBranchReturn</a> ret) ret inp <a href="src/Indigo.Language.Scope.html#ScopeOutStack" class="link">Source</a> <a href="#t:ScopeOutStack" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:ScopeRetVars" class="def">ScopeRetVars</a> ret = <a href="Indigo-Language-Scope.html#t:ScopeRetVars-39-" title="Indigo.Language.Scope">ScopeRetVars'</a> (<a href="Indigo-Language-Scope.html#t:ClassifyBranchReturn" title="Indigo.Language.Scope">ClassifyBranchReturn</a> ret) ret <a href="src/Indigo.Language.Scope.html#ScopeRetVars" class="link">Source</a> <a href="#t:ScopeRetVars" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:ScopeRetExprs" class="def">ScopeRetExprs</a> ret = <a href="Indigo-Language-Scope.html#t:ScopeRetExprs-39-" title="Indigo.Language.Scope">ScopeRetExprs'</a> (<a href="Indigo-Language-Scope.html#t:ClassifyBranchReturn" title="Indigo.Language.Scope">ClassifyBranchReturn</a> ret) ret <a href="src/Indigo.Language.Scope.html#ScopeRetExprs" class="link">Source</a> <a href="#t:ScopeRetExprs" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">type family</span> <a id="t:ClassifyBranchReturn" class="def">ClassifyBranchReturn</a> (ret :: <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a>) <span class="keyword">where ...</span> <a href="src/Indigo.Language.Scope.html#ClassifyBranchReturn" class="link">Source</a> <a href="#t:ClassifyBranchReturn" class="selflink">#</a></p><div class="doc"><p>This type family returns promoted value of type BranchRetKind
 or cause a compilation errors, if tuple with too many elements is used.</p></div><div class="subs equations"><p class="caption">Equations</p><table><tr><td class="src"><a href="Indigo-Language-Scope.html#t:ClassifyBranchReturn" title="Indigo.Language.Scope">ClassifyBranchReturn</a> () = Unit</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Indigo-Language-Scope.html#t:ClassifyBranchReturn" title="Indigo.Language.Scope">ClassifyBranchReturn</a> (_, _) = Tuple</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Indigo-Language-Scope.html#t:ClassifyBranchReturn" title="Indigo.Language.Scope">ClassifyBranchReturn</a> (_, _, _) = Tuple</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Indigo-Language-Scope.html#t:ClassifyBranchReturn" title="Indigo.Language.Scope">ClassifyBranchReturn</a> (_, _, _, _) = <a href="../base-4.12.0.0/GHC-TypeLits.html#t:TypeError" title="GHC.TypeLits">TypeError</a> (<a href="../base-4.12.0.0/GHC-TypeLits.html#v:Text" title="GHC.TypeLits">Text</a> &quot;Tuple with 4 elements is not supported yet as returning value&quot;)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Indigo-Language-Scope.html#t:ClassifyBranchReturn" title="Indigo.Language.Scope">ClassifyBranchReturn</a> (_, _, _, _, _) = <a href="../base-4.12.0.0/GHC-TypeLits.html#t:TypeError" title="GHC.TypeLits">TypeError</a> (<a href="../base-4.12.0.0/GHC-TypeLits.html#v:Text" title="GHC.TypeLits">Text</a> &quot;Tuple with 5 elements is not supported yet as returning value&quot;)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Indigo-Language-Scope.html#t:ClassifyBranchReturn" title="Indigo.Language.Scope">ClassifyBranchReturn</a> (_, _, _, _, _, _) = <a href="../base-4.12.0.0/GHC-TypeLits.html#t:TypeError" title="GHC.TypeLits">TypeError</a> (<a href="../base-4.12.0.0/GHC-TypeLits.html#v:Text" title="GHC.TypeLits">Text</a> &quot;Tuple with 6 elements is not supported yet as returning value&quot;)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Indigo-Language-Scope.html#t:ClassifyBranchReturn" title="Indigo.Language.Scope">ClassifyBranchReturn</a> _ = SingleVal</td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><a id="v:compileScope" class="def">compileScope</a> :: <span class="keyword">forall</span> ret inp xs. <a href="Indigo-Language-Scope.html#t:ScopeCodeGen" title="Indigo.Language.Scope">ScopeCodeGen</a> ret =&gt; <a href="Indigo-State.html#t:GenCode" title="Indigo.State">GenCode</a> inp xs ret -&gt; inp <a href="Indigo-Lorentz.html#t::-45--62-" title="Indigo.Lorentz">:-&gt;</a> <a href="Indigo-Language-Scope.html#t:ScopeOutStack" title="Indigo.Language.Scope">ScopeOutStack</a> ret inp <a href="src/Indigo.Language.Scope.html#compileScope" class="link">Source</a> <a href="#v:compileScope" class="selflink">#</a></p><div class="doc"><p>Concatenate a scope code, generation of returning expressions,
 and clean up of redundant cells from a stack</p></div></div><div class="top"><p class="src"><a id="v:finalizeStatement" class="def">finalizeStatement</a> :: <span class="keyword">forall</span> ret inp. <a href="Indigo-Language-Scope.html#t:ScopeCodeGen" title="Indigo.Language.Scope">ScopeCodeGen</a> ret =&gt; <a href="Indigo-State.html#t:MetaData" title="Indigo.State">MetaData</a> inp -&gt; (inp <a href="Indigo-Lorentz.html#t::-45--62-" title="Indigo.Lorentz">:-&gt;</a> <a href="Indigo-Language-Scope.html#t:ScopeOutStack" title="Indigo.Language.Scope">ScopeOutStack</a> ret inp) -&gt; <a href="Indigo-State.html#t:GenCode" title="Indigo.State">GenCode</a> inp (<a href="Indigo-Language-Scope.html#t:ScopeOutStack" title="Indigo.Language.Scope">ScopeOutStack</a> ret inp) (<a href="Indigo-Language-Scope.html#t:ScopeRetVars" title="Indigo.Language.Scope">ScopeRetVars</a> ret) <a href="src/Indigo.Language.Scope.html#finalizeStatement" class="link">Source</a> <a href="#v:finalizeStatement" class="selflink">#</a></p><div class="doc"><p>Specify type of <code>finalizeStatement'</code></p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>