<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- Language/Haskell/TH/Desugar/Core.hs

(c) Richard Eisenberg 2013
rae@cs.brynmawr.edu

Desugars full Template Haskell syntax into a smaller core syntax for further
processing. The desugared types and constructors are prefixed with a D.
-}</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell, LambdaCase, CPP, ScopedTypeVariables, TupleSections #-}</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.Haskell.TH.Desugar.Core</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapM</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">foldl</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">foldr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">all</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">elem</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">exp</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">and</span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language.Haskell.TH</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">match</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">clause</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">cxt</span><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language.Haskell.TH.Syntax</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lift</span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language.Haskell.TH.ExpandSyns</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">expandSyns</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &lt; 709
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Applicative</span><span>
</span><a name="line-22"></a><span class="hs-cpp">#endif
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">forM_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mapM</span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Zip</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Writer</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">forM_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mapM</span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Foldable</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Graph</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Set</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Traversable</span><span>
</span><a name="line-32"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isJust</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-36"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 800
</span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Fail</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">MonadFail</span><span>
</span><a name="line-38"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-40"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 803
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.OverloadedLabels</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">fromLabel</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Set</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">S</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Exts</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html"><span class="hs-identifier">Language.Haskell.TH.Desugar.AST</span></a><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html"><span class="hs-identifier">Language.Haskell.TH.Desugar.Util</span></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html"><span class="hs-identifier">Language.Haskell.TH.Desugar.Reify</span></a><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-comment">-- | Desugar an expression</span><span>
</span><a name="line-52"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226691"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Exp</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226691"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-53"></a><a name="dsExp"><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier">dsExp</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarE</span><span> </span><a name="local-6989586621679226692"><a href="#local-6989586621679226692"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679226692"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-54"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConE</span><span> </span><a name="local-6989586621679226693"><a href="#local-6989586621679226693"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConE"><span class="hs-identifier hs-var">DConE</span></a><span> </span><a href="#local-6989586621679226693"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-55"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitE</span><span> </span><a name="local-6989586621679226694"><a href="#local-6989586621679226694"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLitE"><span class="hs-identifier hs-var">DLitE</span></a><span> </span><a href="#local-6989586621679226694"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-56"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppE</span><span> </span><a name="local-6989586621679226695"><a href="#local-6989586621679226695"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621679226696"><a href="#local-6989586621679226696"><span class="hs-identifier">e2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226695"><span class="hs-identifier hs-var">e1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226696"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-57"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixE</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a name="local-6989586621679226711"><a href="#local-6989586621679226711"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226711"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-58"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679226712"><a href="#local-6989586621679226712"><span class="hs-identifier">lhs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679226713"><a href="#local-6989586621679226713"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226713"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226712"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixE</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a name="local-6989586621679226714"><a href="#local-6989586621679226714"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679226715"><a href="#local-6989586621679226715"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-60"></a><span>  </span><a name="local-6989586621679226716"><a href="#local-6989586621679226716"><span class="hs-identifier">lhsName</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#newUniqueName"><span class="hs-identifier hs-var">newUniqueName</span></a><span> </span><span class="hs-string">&quot;lhs&quot;</span><span>
</span><a name="line-61"></a><span>  </span><a name="local-6989586621679226717"><a href="#local-6989586621679226717"><span class="hs-identifier">op'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226714"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-62"></a><span>  </span><a name="local-6989586621679226718"><a href="#local-6989586621679226718"><span class="hs-identifier">rhs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226715"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-63"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLamE"><span class="hs-identifier hs-var">DLamE</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679226716"><span class="hs-identifier hs-var">lhsName</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><a href="#local-6989586621679226717"><span class="hs-identifier hs-var">op'</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679226716"><span class="hs-identifier hs-var">lhsName</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679226718"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679226719"><a href="#local-6989586621679226719"><span class="hs-identifier">lhs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679226720"><a href="#local-6989586621679226720"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679226721"><a href="#local-6989586621679226721"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-65"></a><span>  </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226720"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226719"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226721"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-66"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">UInfixE</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-67"></a><span>  </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-string">&quot;Cannot desugar unresolved infix operators.&quot;</span><span>
</span><a name="line-68"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParensE</span><span> </span><a name="local-6989586621679226722"><a href="#local-6989586621679226722"><span class="hs-identifier">exp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226722"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-69"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LamE</span><span> </span><a name="local-6989586621679226723"><a href="#local-6989586621679226723"><span class="hs-identifier">pats</span></a></a><span> </span><a name="local-6989586621679226724"><a href="#local-6989586621679226724"><span class="hs-identifier">exp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsLam"><span class="hs-identifier hs-var">dsLam</span></a><span> </span><a href="#local-6989586621679226723"><span class="hs-identifier hs-var">pats</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226724"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-70"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LamCaseE</span><span> </span><a name="local-6989586621679226725"><a href="#local-6989586621679226725"><span class="hs-identifier">matches</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-71"></a><span>  </span><a name="local-6989586621679226726"><a href="#local-6989586621679226726"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#newUniqueName"><span class="hs-identifier hs-var">newUniqueName</span></a><span> </span><span class="hs-string">&quot;x&quot;</span><span>
</span><a name="line-72"></a><span>  </span><a name="local-6989586621679226727"><a href="#local-6989586621679226727"><span class="hs-identifier">matches'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsMatches"><span class="hs-identifier hs-var">dsMatches</span></a><span> </span><a href="#local-6989586621679226726"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679226725"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-73"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLamE"><span class="hs-identifier hs-var">DLamE</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679226726"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DCaseE"><span class="hs-identifier hs-var">DCaseE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679226726"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226727"><span class="hs-identifier hs-var">matches'</span></a><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TupE</span><span> </span><a name="local-6989586621679226728"><a href="#local-6989586621679226728"><span class="hs-identifier">exps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-75"></a><span>  </span><a name="local-6989586621679226729"><a href="#local-6989586621679226729"><span class="hs-identifier">exps'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226728"><span class="hs-identifier hs-var">exps</span></a><span>
</span><a name="line-76"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConE"><span class="hs-identifier hs-var">DConE</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">tupleDataName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679226728"><span class="hs-identifier hs-var">exps</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226729"><span class="hs-identifier hs-var">exps'</span></a><span>
</span><a name="line-77"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">UnboxedTupE</span><span> </span><a name="local-6989586621679226730"><a href="#local-6989586621679226730"><span class="hs-identifier">exps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-78"></a><span>  </span><span class="hs-identifier hs-var">foldl</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConE"><span class="hs-identifier hs-var">DConE</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unboxedTupleDataName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679226730"><span class="hs-identifier hs-var">exps</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226730"><span class="hs-identifier hs-var">exps</span></a><span>
</span><a name="line-79"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CondE</span><span> </span><a name="local-6989586621679226731"><a href="#local-6989586621679226731"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621679226732"><a href="#local-6989586621679226732"><span class="hs-identifier">e2</span></a></a><span> </span><a name="local-6989586621679226733"><a href="#local-6989586621679226733"><span class="hs-identifier">e3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-80"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CaseE</span><span> </span><a href="#local-6989586621679226731"><span class="hs-identifier hs-var">e1</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">Match</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConP</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">True</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NormalB</span><span> </span><a href="#local-6989586621679226732"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-81"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Match</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConP</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">False</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NormalB</span><span> </span><a href="#local-6989586621679226733"><span class="hs-identifier hs-var">e3</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">MultiIfE</span><span> </span><a name="local-6989586621679226734"><a href="#local-6989586621679226734"><span class="hs-identifier">guarded_exps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-83"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679226735"><a href="#local-6989586621679226735"><span class="hs-identifier">failure</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">error</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitE"><span class="hs-identifier hs-var">DLitE</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">StringL</span><span> </span><span class="hs-string">&quot;Non-exhaustive guards in multi-way if&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-84"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Core.html#dsGuards"><span class="hs-identifier hs-var">dsGuards</span></a><span> </span><a href="#local-6989586621679226734"><span class="hs-identifier hs-var">guarded_exps</span></a><span> </span><a href="#local-6989586621679226735"><span class="hs-identifier hs-var">failure</span></a><span>
</span><a name="line-85"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LetE</span><span> </span><a name="local-6989586621679226736"><a href="#local-6989586621679226736"><span class="hs-identifier">decs</span></a></a><span> </span><a name="local-6989586621679226737"><a href="#local-6989586621679226737"><span class="hs-identifier">exp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLetE"><span class="hs-identifier hs-var">DLetE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsLetDecs"><span class="hs-identifier hs-var">dsLetDecs</span></a><span> </span><a href="#local-6989586621679226736"><span class="hs-identifier hs-var">decs</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226737"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-86"></a><span>    </span><span class="hs-comment">-- the following special case avoids creating a new &quot;let&quot; when it's not</span><span>
</span><a name="line-87"></a><span>    </span><span class="hs-comment">-- necessary. See #34.</span><span>
</span><a name="line-88"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CaseE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarE</span><span> </span><a name="local-6989586621679226738"><a href="#local-6989586621679226738"><span class="hs-identifier">scrutinee</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679226739"><a href="#local-6989586621679226739"><span class="hs-identifier">matches</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-89"></a><span>  </span><a name="local-6989586621679226740"><a href="#local-6989586621679226740"><span class="hs-identifier">matches'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsMatches"><span class="hs-identifier hs-var">dsMatches</span></a><span> </span><a href="#local-6989586621679226738"><span class="hs-identifier hs-var">scrutinee</span></a><span> </span><a href="#local-6989586621679226739"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-90"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DCaseE"><span class="hs-identifier hs-var">DCaseE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679226738"><span class="hs-identifier hs-var">scrutinee</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226740"><span class="hs-identifier hs-var">matches'</span></a><span>
</span><a name="line-91"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CaseE</span><span> </span><a name="local-6989586621679226741"><a href="#local-6989586621679226741"><span class="hs-identifier">exp</span></a></a><span> </span><a name="local-6989586621679226742"><a href="#local-6989586621679226742"><span class="hs-identifier">matches</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-92"></a><span>  </span><a name="local-6989586621679226743"><a href="#local-6989586621679226743"><span class="hs-identifier">scrutinee</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#newUniqueName"><span class="hs-identifier hs-var">newUniqueName</span></a><span> </span><span class="hs-string">&quot;scrutinee&quot;</span><span>
</span><a name="line-93"></a><span>  </span><a name="local-6989586621679226744"><a href="#local-6989586621679226744"><span class="hs-identifier">exp'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226741"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-94"></a><span>  </span><a name="local-6989586621679226745"><a href="#local-6989586621679226745"><span class="hs-identifier">matches'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsMatches"><span class="hs-identifier hs-var">dsMatches</span></a><span> </span><a href="#local-6989586621679226743"><span class="hs-identifier hs-var">scrutinee</span></a><span> </span><a href="#local-6989586621679226742"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-95"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLetE"><span class="hs-identifier hs-var">DLetE</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DValD"><span class="hs-identifier hs-var">DValD</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a href="#local-6989586621679226743"><span class="hs-identifier hs-var">scrutinee</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226744"><span class="hs-identifier hs-var">exp'</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-96"></a><span>           </span><a href="Language.Haskell.TH.Desugar.AST.html#DCaseE"><span class="hs-identifier hs-var">DCaseE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679226743"><span class="hs-identifier hs-var">scrutinee</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226745"><span class="hs-identifier hs-var">matches'</span></a><span>
</span><a name="line-97"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DoE</span><span> </span><a name="local-6989586621679226746"><a href="#local-6989586621679226746"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDoStmts"><span class="hs-identifier hs-var">dsDoStmts</span></a><span> </span><a href="#local-6989586621679226746"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-98"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CompE</span><span> </span><a name="local-6989586621679226747"><a href="#local-6989586621679226747"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsComp"><span class="hs-identifier hs-var">dsComp</span></a><span> </span><a href="#local-6989586621679226747"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-99"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ArithSeqE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FromR</span><span> </span><a name="local-6989586621679226748"><a href="#local-6989586621679226748"><span class="hs-identifier">exp</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">enumFrom</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226748"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-100"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ArithSeqE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FromThenR</span><span> </span><a name="local-6989586621679226749"><a href="#local-6989586621679226749"><span class="hs-identifier">exp1</span></a></a><span> </span><a name="local-6989586621679226750"><a href="#local-6989586621679226750"><span class="hs-identifier">exp2</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-101"></a><span>  </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">enumFromThen</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226749"><span class="hs-identifier hs-var">exp1</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226750"><span class="hs-identifier hs-var">exp2</span></a><span>
</span><a name="line-102"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ArithSeqE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FromToR</span><span> </span><a name="local-6989586621679226751"><a href="#local-6989586621679226751"><span class="hs-identifier">exp1</span></a></a><span> </span><a name="local-6989586621679226752"><a href="#local-6989586621679226752"><span class="hs-identifier">exp2</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-103"></a><span>  </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">enumFromTo</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226751"><span class="hs-identifier hs-var">exp1</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226752"><span class="hs-identifier hs-var">exp2</span></a><span>
</span><a name="line-104"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ArithSeqE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FromThenToR</span><span> </span><a name="local-6989586621679226753"><a href="#local-6989586621679226753"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621679226754"><a href="#local-6989586621679226754"><span class="hs-identifier">e2</span></a></a><span> </span><a name="local-6989586621679226755"><a href="#local-6989586621679226755"><span class="hs-identifier">e3</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-105"></a><span>  </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">enumFromThenTo</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226753"><span class="hs-identifier hs-var">e1</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span>
</span><a name="line-106"></a><span>                               </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226754"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span>
</span><a name="line-107"></a><span>            </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226755"><span class="hs-identifier hs-var">e3</span></a><span>
</span><a name="line-108"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListE</span><span> </span><a name="local-6989586621679226756"><a href="#local-6989586621679226756"><span class="hs-identifier">exps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226757"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679226756"><span class="hs-identifier hs-var">exps</span></a><span>
</span><a name="line-109"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679226757"><a href="#local-6989586621679226757"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConE"><span class="hs-identifier hs-var">DConE</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-110"></a><span>        </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679226758"><a href="#local-6989586621679226758"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679226759"><a href="#local-6989586621679226759"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConE"><span class="hs-identifier hs-var">DConE</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226758"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679226757"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679226759"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-111"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigE</span><span> </span><a name="local-6989586621679226760"><a href="#local-6989586621679226760"><span class="hs-identifier">exp</span></a></a><span> </span><a name="local-6989586621679226761"><a href="#local-6989586621679226761"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DSigE"><span class="hs-identifier hs-var">DSigE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226760"><span class="hs-identifier hs-var">exp</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679226761"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-112"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecConE</span><span> </span><a name="local-6989586621679226762"><a href="#local-6989586621679226762"><span class="hs-identifier">con_name</span></a></a><span> </span><a name="local-6989586621679226763"><a href="#local-6989586621679226763"><span class="hs-identifier">field_exps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-113"></a><span>  </span><a name="local-6989586621679226784"><a href="#local-6989586621679226784"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#dataConNameToCon"><span class="hs-identifier hs-var">dataConNameToCon</span></a><span> </span><a href="#local-6989586621679226762"><span class="hs-identifier hs-var">con_name</span></a><span>
</span><a name="line-114"></a><span>  </span><a name="local-6989586621679226785"><a href="#local-6989586621679226785"><span class="hs-identifier">reordered</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679226764"><span class="hs-identifier hs-var">reorder</span></a><span> </span><a href="#local-6989586621679226784"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-115"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConE"><span class="hs-identifier hs-var">DConE</span></a><span> </span><a href="#local-6989586621679226762"><span class="hs-identifier hs-var">con_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226785"><span class="hs-identifier hs-var">reordered</span></a><span>
</span><a name="line-116"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-117"></a><span>    </span><a name="local-6989586621679226764"><a href="#local-6989586621679226764"><span class="hs-identifier">reorder</span></a></a><span> </span><a name="local-6989586621679226767"><a href="#local-6989586621679226767"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679226767"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-118"></a><span>                    </span><span class="hs-identifier hs-var">NormalC</span><span> </span><a name="local-6989586621679226768"><a href="#local-6989586621679226768"><span class="hs-identifier">_name</span></a></a><span> </span><a name="local-6989586621679226769"><a href="#local-6989586621679226769"><span class="hs-identifier">fields</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226766"><span class="hs-identifier hs-var">non_record</span></a><span> </span><a href="#local-6989586621679226769"><span class="hs-identifier hs-var">fields</span></a><span>
</span><a name="line-119"></a><span>                    </span><span class="hs-identifier hs-var">InfixC</span><span> </span><a name="local-6989586621679226770"><a href="#local-6989586621679226770"><span class="hs-identifier">field1</span></a></a><span> </span><a name="local-6989586621679226771"><a href="#local-6989586621679226771"><span class="hs-identifier">_name</span></a></a><span> </span><a name="local-6989586621679226772"><a href="#local-6989586621679226772"><span class="hs-identifier">field2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226766"><span class="hs-identifier hs-var">non_record</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679226770"><span class="hs-identifier hs-var">field1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679226772"><span class="hs-identifier hs-var">field2</span></a><span class="hs-special">]</span><span>
</span><a name="line-120"></a><span>                    </span><span class="hs-identifier hs-var">RecC</span><span> </span><a name="local-6989586621679226773"><a href="#local-6989586621679226773"><span class="hs-identifier">_name</span></a></a><span> </span><a name="local-6989586621679226774"><a href="#local-6989586621679226774"><span class="hs-identifier">fields</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226765"><span class="hs-identifier hs-var">reorder_fields</span></a><span> </span><a href="#local-6989586621679226774"><span class="hs-identifier hs-var">fields</span></a><span>
</span><a name="line-121"></a><span>                    </span><span class="hs-identifier hs-var">ForallC</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679226775"><a href="#local-6989586621679226775"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226764"><span class="hs-identifier hs-var">reorder</span></a><span> </span><a href="#local-6989586621679226775"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-122"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 800
</span><span>                    </span><span class="hs-identifier hs-var">GadtC</span><span> </span><a name="local-6989586621679226776"><a href="#local-6989586621679226776"><span class="hs-identifier">_names</span></a></a><span> </span><a name="local-6989586621679226777"><a href="#local-6989586621679226777"><span class="hs-identifier">fields</span></a></a><span> </span><a name="local-6989586621679226778"><a href="#local-6989586621679226778"><span class="hs-identifier">_ret_ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226766"><span class="hs-identifier hs-var">non_record</span></a><span> </span><a href="#local-6989586621679226777"><span class="hs-identifier hs-var">fields</span></a><span>
</span><a name="line-124"></a><span>                    </span><span class="hs-identifier hs-var">RecGadtC</span><span> </span><a name="local-6989586621679226779"><a href="#local-6989586621679226779"><span class="hs-identifier">_names</span></a></a><span> </span><a name="local-6989586621679226780"><a href="#local-6989586621679226780"><span class="hs-identifier">fields</span></a></a><span> </span><a name="local-6989586621679226781"><a href="#local-6989586621679226781"><span class="hs-identifier">_ret_ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226765"><span class="hs-identifier hs-var">reorder_fields</span></a><span> </span><a href="#local-6989586621679226780"><span class="hs-identifier hs-var">fields</span></a><span>
</span><a name="line-125"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-127"></a><span>    </span><a name="local-6989586621679226765"><a href="#local-6989586621679226765"><span class="hs-identifier">reorder_fields</span></a></a><span> </span><a name="local-6989586621679226782"><a href="#local-6989586621679226782"><span class="hs-identifier">fields</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#reorderFields"><span class="hs-identifier hs-var">reorderFields</span></a><span> </span><a href="#local-6989586621679226762"><span class="hs-identifier hs-var">con_name</span></a><span> </span><a href="#local-6989586621679226782"><span class="hs-identifier hs-var">fields</span></a><span> </span><a href="#local-6989586621679226763"><span class="hs-identifier hs-var">field_exps</span></a><span>
</span><a name="line-128"></a><span>                                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">repeat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">undefined</span><span class="hs-special">)</span><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span>    </span><a name="local-6989586621679226766"><a href="#local-6989586621679226766"><span class="hs-identifier">non_record</span></a></a><span> </span><a name="local-6989586621679226783"><a href="#local-6989586621679226783"><span class="hs-identifier">fields</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679226763"><span class="hs-identifier hs-var">field_exps</span></a><span>
</span><a name="line-131"></a><span>                        </span><span class="hs-comment">-- Special case: record construction is allowed for any</span><span>
</span><a name="line-132"></a><span>                        </span><span class="hs-comment">-- constructor, regardless of whether the constructor</span><span>
</span><a name="line-133"></a><span>                        </span><span class="hs-comment">-- actually was declared with records, provided that no</span><span>
</span><a name="line-134"></a><span>                        </span><span class="hs-comment">-- records are given in the expression itself. (See #59).</span><span>
</span><a name="line-135"></a><span>                        </span><span class="hs-comment">--</span><span>
</span><a name="line-136"></a><span>                        </span><span class="hs-comment">-- Con{} desugars down to Con undefined ... undefined.</span><span>
</span><a name="line-137"></a><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679226783"><span class="hs-identifier hs-var">fields</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">undefined</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-140"></a><span>                          </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Record syntax used with non-record constructor &quot;</span><span>
</span><a name="line-141"></a><span>                                       </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679226762"><span class="hs-identifier hs-var">con_name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.&quot;</span><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecUpdE</span><span> </span><a name="local-6989586621679226786"><a href="#local-6989586621679226786"><span class="hs-identifier">exp</span></a></a><span> </span><a name="local-6989586621679226787"><a href="#local-6989586621679226787"><span class="hs-identifier">field_exps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-144"></a><span>  </span><span class="hs-comment">-- here, we need to use one of the field names to find the tycon, somewhat dodgily</span><span>
</span><a name="line-145"></a><span>  </span><a name="local-6989586621679226828"><a href="#local-6989586621679226828"><span class="hs-identifier">first_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679226787"><span class="hs-identifier hs-var">field_exps</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-146"></a><span>                  </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679226827"><a href="#local-6989586621679226827"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679226827"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-147"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;Record update with no fields listed.&quot;</span><span>
</span><a name="line-148"></a><span>  </span><a name="local-6989586621679226829"><a href="#local-6989586621679226829"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyWithLocals"><span class="hs-identifier hs-var">reifyWithLocals</span></a><span> </span><a href="#local-6989586621679226828"><span class="hs-identifier hs-var">first_name</span></a><span>
</span><a name="line-149"></a><span>  </span><a name="local-6989586621679226833"><a href="#local-6989586621679226833"><span class="hs-identifier">applied_type</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679226829"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-150"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710
</span><span>                    </span><span class="hs-identifier hs-var">VarI</span><span> </span><a name="local-6989586621679226830"><a href="#local-6989586621679226830"><span class="hs-identifier">_name</span></a></a><span> </span><a name="local-6989586621679226831"><a href="#local-6989586621679226831"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679226832"><a href="#local-6989586621679226832"><span class="hs-identifier">_m_dec</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226788"><span class="hs-identifier hs-var">extract_first_arg</span></a><span> </span><a href="#local-6989586621679226831"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-152"></a><span class="hs-cpp">#else
</span><span>                    </span><span class="hs-identifier">VarI</span><span> </span><span class="hs-identifier">_name</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-identifier">_m_dec</span><span> </span><span class="hs-identifier">_fixity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">extract_first_arg</span><span> </span><span class="hs-identifier">ty</span><span>
</span><a name="line-154"></a><span class="hs-cpp">#endif
</span><span>                    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;Record update with an invalid field name.&quot;</span><span>
</span><a name="line-156"></a><span>  </span><a name="local-6989586621679226834"><a href="#local-6989586621679226834"><span class="hs-identifier">type_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679226789"><span class="hs-identifier hs-var">extract_type_name</span></a><span> </span><a href="#local-6989586621679226833"><span class="hs-identifier hs-var">applied_type</span></a><span>
</span><a name="line-157"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679226835"><a href="#local-6989586621679226835"><span class="hs-identifier">cons</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#getDataD"><span class="hs-identifier hs-var">getDataD</span></a><span> </span><span class="hs-string">&quot;This seems to be an error in GHC.&quot;</span><span> </span><a href="#local-6989586621679226834"><span class="hs-identifier hs-var">type_name</span></a><span>
</span><a name="line-158"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679226836"><a href="#local-6989586621679226836"><span class="hs-identifier">filtered_cons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226790"><span class="hs-identifier hs-var">filter_cons_with_names</span></a><span> </span><a href="#local-6989586621679226835"><span class="hs-identifier hs-var">cons</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679226787"><span class="hs-identifier hs-var">field_exps</span></a><span class="hs-special">)</span><span>
</span><a name="line-159"></a><span>  </span><a name="local-6989586621679226837"><a href="#local-6989586621679226837"><span class="hs-identifier">exp'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226786"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-160"></a><span>  </span><a name="local-6989586621679226838"><a href="#local-6989586621679226838"><span class="hs-identifier">matches</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621679226792"><span class="hs-identifier hs-var">con_to_dmatch</span></a><span> </span><a href="#local-6989586621679226836"><span class="hs-identifier hs-var">filtered_cons</span></a><span>
</span><a name="line-161"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679226839"><a href="#local-6989586621679226839"><span class="hs-identifier">all_matches</span></a></a><span>
</span><a name="line-162"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679226836"><span class="hs-identifier hs-var">filtered_cons</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679226835"><span class="hs-identifier hs-var">cons</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226838"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-163"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226838"><span class="hs-identifier hs-var">matches</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679226793"><span class="hs-identifier hs-var">error_match</span></a><span class="hs-special">]</span><span>
</span><a name="line-164"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DCaseE"><span class="hs-identifier hs-var">DCaseE</span></a><span> </span><a href="#local-6989586621679226837"><span class="hs-identifier hs-var">exp'</span></a><span> </span><a href="#local-6989586621679226839"><span class="hs-identifier hs-var">all_matches</span></a><span>
</span><a name="line-165"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-166"></a><span>    </span><span class="hs-identifier">extract_first_arg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226795"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226795"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-167"></a><span>    </span><a name="local-6989586621679226788"><a href="#local-6989586621679226788"><span class="hs-identifier">extract_first_arg</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppT</span><span> </span><span class="hs-identifier hs-var">ArrowT</span><span> </span><a name="local-6989586621679226798"><a href="#local-6989586621679226798"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679226798"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-168"></a><span>    </span><span class="hs-identifier">extract_first_arg</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForallT</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679226799"><a href="#local-6989586621679226799"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226788"><span class="hs-identifier hs-var">extract_first_arg</span></a><span> </span><a href="#local-6989586621679226799"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-169"></a><span>    </span><span class="hs-identifier">extract_first_arg</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigT</span><span> </span><a name="local-6989586621679226800"><a href="#local-6989586621679226800"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226788"><span class="hs-identifier hs-var">extract_first_arg</span></a><span> </span><a href="#local-6989586621679226800"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-170"></a><span>    </span><span class="hs-identifier">extract_first_arg</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;Record selector not a function.&quot;</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span>    </span><span class="hs-identifier">extract_type_name</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226796"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226796"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-173"></a><span>    </span><a name="local-6989586621679226789"><a href="#local-6989586621679226789"><span class="hs-identifier">extract_type_name</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppT</span><span> </span><a name="local-6989586621679226801"><a href="#local-6989586621679226801"><span class="hs-identifier">t1</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226789"><span class="hs-identifier hs-var">extract_type_name</span></a><span> </span><a href="#local-6989586621679226801"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-174"></a><span>    </span><span class="hs-identifier">extract_type_name</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigT</span><span> </span><a name="local-6989586621679226802"><a href="#local-6989586621679226802"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226789"><span class="hs-identifier hs-var">extract_type_name</span></a><span> </span><a href="#local-6989586621679226802"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-175"></a><span>    </span><span class="hs-identifier">extract_type_name</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConT</span><span> </span><a name="local-6989586621679226803"><a href="#local-6989586621679226803"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679226803"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-176"></a><span>    </span><span class="hs-identifier">extract_type_name</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;Record selector domain not a datatype.&quot;</span><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span>    </span><a name="local-6989586621679226790"><a href="#local-6989586621679226790"><span class="hs-identifier">filter_cons_with_names</span></a></a><span> </span><a name="local-6989586621679226804"><a href="#local-6989586621679226804"><span class="hs-identifier">cons</span></a></a><span> </span><a name="local-6989586621679226805"><a href="#local-6989586621679226805"><span class="hs-identifier">field_names</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-179"></a><span>      </span><span class="hs-identifier hs-var">filter</span><span> </span><a href="#local-6989586621679226807"><span class="hs-identifier hs-var">has_names</span></a><span> </span><a href="#local-6989586621679226804"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-180"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-181"></a><span>        </span><a name="local-6989586621679226806"><a href="#local-6989586621679226806"><span class="hs-identifier">args_contain_names</span></a></a><span> </span><a name="local-6989586621679226808"><a href="#local-6989586621679226808"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-182"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679226809"><a href="#local-6989586621679226809"><span class="hs-identifier">con_field_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679226794"><span class="hs-identifier hs-var">fst_of_3</span></a><span> </span><a href="#local-6989586621679226808"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-183"></a><span>          </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679226809"><span class="hs-identifier hs-var">con_field_names</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226805"><span class="hs-identifier hs-var">field_names</span></a><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span>        </span><a name="local-6989586621679226807"><a href="#local-6989586621679226807"><span class="hs-identifier">has_names</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecC</span><span> </span><a name="local-6989586621679226810"><a href="#local-6989586621679226810"><span class="hs-identifier">_con_name</span></a></a><span> </span><a name="local-6989586621679226811"><a href="#local-6989586621679226811"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-186"></a><span>          </span><a href="#local-6989586621679226806"><span class="hs-identifier hs-var">args_contain_names</span></a><span> </span><a href="#local-6989586621679226811"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-187"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 800
</span><span>        </span><span class="hs-identifier">has_names</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecGadtC</span><span> </span><a name="local-6989586621679226812"><a href="#local-6989586621679226812"><span class="hs-identifier">_con_name</span></a></a><span> </span><a name="local-6989586621679226813"><a href="#local-6989586621679226813"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679226814"><a href="#local-6989586621679226814"><span class="hs-identifier">_ret_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-189"></a><span>          </span><a href="#local-6989586621679226806"><span class="hs-identifier hs-var">args_contain_names</span></a><span> </span><a href="#local-6989586621679226813"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-190"></a><span class="hs-cpp">#endif
</span><span>        </span><span class="hs-identifier">has_names</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForallC</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679226815"><a href="#local-6989586621679226815"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226807"><span class="hs-identifier hs-var">has_names</span></a><span> </span><a href="#local-6989586621679226815"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-192"></a><span>        </span><span class="hs-identifier">has_names</span><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span>    </span><a name="local-6989586621679226791"><a href="#local-6989586621679226791"><span class="hs-identifier">rec_con_to_dmatch</span></a></a><span> </span><a name="local-6989586621679226816"><a href="#local-6989586621679226816"><span class="hs-identifier">con_name</span></a></a><span> </span><a name="local-6989586621679226817"><a href="#local-6989586621679226817"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-195"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679226818"><a href="#local-6989586621679226818"><span class="hs-identifier">con_field_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679226794"><span class="hs-identifier hs-var">fst_of_3</span></a><span> </span><a href="#local-6989586621679226817"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-196"></a><span>      </span><a name="local-6989586621679226819"><a href="#local-6989586621679226819"><span class="hs-identifier">field_var_names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Util.html#newUniqueName"><span class="hs-identifier hs-var">newUniqueName</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nameBase</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226818"><span class="hs-identifier hs-var">con_field_names</span></a><span>
</span><a name="line-197"></a><span>      </span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><a href="#local-6989586621679226816"><span class="hs-identifier hs-var">con_name</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a href="#local-6989586621679226819"><span class="hs-identifier hs-var">field_var_names</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-198"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConE"><span class="hs-identifier hs-var">DConE</span></a><span> </span><a href="#local-6989586621679226816"><span class="hs-identifier hs-var">con_name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-199"></a><span>                    </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#reorderFields"><span class="hs-identifier hs-var">reorderFields</span></a><span> </span><a href="#local-6989586621679226816"><span class="hs-identifier hs-var">con_name</span></a><span> </span><a href="#local-6989586621679226817"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621679226787"><span class="hs-identifier hs-var">field_exps</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679226819"><span class="hs-identifier hs-var">field_var_names</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span>    </span><span class="hs-identifier">con_to_dmatch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226797"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Con</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226797"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-type">DMatch</span></a><span>
</span><a name="line-202"></a><span>    </span><a name="local-6989586621679226792"><a href="#local-6989586621679226792"><span class="hs-identifier">con_to_dmatch</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecC</span><span> </span><a name="local-6989586621679226820"><a href="#local-6989586621679226820"><span class="hs-identifier">con_name</span></a></a><span> </span><a name="local-6989586621679226821"><a href="#local-6989586621679226821"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226791"><span class="hs-identifier hs-var">rec_con_to_dmatch</span></a><span> </span><a href="#local-6989586621679226820"><span class="hs-identifier hs-var">con_name</span></a><span> </span><a href="#local-6989586621679226821"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-203"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 800
</span><span>    </span><span class="hs-comment">-- We're assuming the GADT constructor has only one Name here, but since</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-comment">-- this constructor was reified, this assumption should always hold true.</span><span>
</span><a name="line-206"></a><span>    </span><span class="hs-identifier">con_to_dmatch</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecGadtC</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679226822"><a href="#local-6989586621679226822"><span class="hs-identifier">con_name</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621679226823"><a href="#local-6989586621679226823"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679226824"><a href="#local-6989586621679226824"><span class="hs-identifier">_ret_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226791"><span class="hs-identifier hs-var">rec_con_to_dmatch</span></a><span> </span><a href="#local-6989586621679226822"><span class="hs-identifier hs-var">con_name</span></a><span> </span><a href="#local-6989586621679226823"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-207"></a><span class="hs-cpp">#endif
</span><span>    </span><span class="hs-identifier">con_to_dmatch</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForallC</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679226825"><a href="#local-6989586621679226825"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226792"><span class="hs-identifier hs-var">con_to_dmatch</span></a><span> </span><a href="#local-6989586621679226825"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-209"></a><span>    </span><span class="hs-identifier">con_to_dmatch</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;Internal error within th-desugar.&quot;</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span>    </span><a name="local-6989586621679226793"><a href="#local-6989586621679226793"><span class="hs-identifier">error_match</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">error</span><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>                   </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitE"><span class="hs-identifier hs-var">DLitE</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">StringL</span><span> </span><span class="hs-string">&quot;Non-exhaustive patterns in record update&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span>
</span><a name="line-214"></a><span>    </span><a name="local-6989586621679226794"><a href="#local-6989586621679226794"><span class="hs-identifier">fst_of_3</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679226826"><a href="#local-6989586621679226826"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226826"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-215"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 709
</span><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">StaticE</span><span> </span><a name="local-6989586621679226840"><a href="#local-6989586621679226840"><span class="hs-identifier">exp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DStaticE"><span class="hs-identifier hs-var">DStaticE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226840"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-217"></a><span class="hs-cpp">#endif
#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">UnboundVarE</span><span> </span><a name="local-6989586621679226841"><a href="#local-6989586621679226841"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679226841"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-220"></a><span class="hs-cpp">#endif
#if __GLASGOW_HASKELL__ &gt;= 801
</span><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppTypeE</span><span> </span><a name="local-6989586621679226842"><a href="#local-6989586621679226842"><span class="hs-identifier">exp</span></a></a><span> </span><a name="local-6989586621679226843"><a href="#local-6989586621679226843"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppTypeE"><span class="hs-identifier hs-var">DAppTypeE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226842"><span class="hs-identifier hs-var">exp</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679226843"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-223"></a><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">UnboxedSumE</span><span> </span><a name="local-6989586621679226844"><a href="#local-6989586621679226844"><span class="hs-identifier">exp</span></a></a><span> </span><a name="local-6989586621679226845"><a href="#local-6989586621679226845"><span class="hs-identifier">alt</span></a></a><span> </span><a name="local-6989586621679226846"><a href="#local-6989586621679226846"><span class="hs-identifier">arity</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-224"></a><span>  </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConE"><span class="hs-identifier hs-var">DConE</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unboxedSumDataName</span><span> </span><a href="#local-6989586621679226845"><span class="hs-identifier hs-var">alt</span></a><span> </span><a href="#local-6989586621679226846"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226844"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-225"></a><span class="hs-cpp">#endif
#if __GLASGOW_HASKELL__ &gt;= 803
</span><span class="hs-identifier">dsExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LabelE</span><span> </span><a name="local-6989586621679226847"><a href="#local-6989586621679226847"><span class="hs-identifier">str</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">fromLabel</span><span> </span><span class="hs-special">`</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppTypeE"><span class="hs-identifier hs-var">DAppTypeE</span></a><span class="hs-special">`</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLitT"><span class="hs-identifier hs-var">DLitT</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">StrTyLit</span><span> </span><a href="#local-6989586621679226847"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-230"></a><span class="hs-comment">-- | Desugar a lambda expression, where the body has already been desugared</span><span>
</span><a name="line-231"></a><span class="hs-identifier">dsLam</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226690"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Pat</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226690"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-232"></a><a name="dsLam"><a href="Language.Haskell.TH.Desugar.Core.html#dsLam"><span class="hs-identifier">dsLam</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#mkLam"><span class="hs-identifier hs-var">mkLam</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#stripVarP_maybe"><span class="hs-identifier hs-var">stripVarP_maybe</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPatsOverExp"><span class="hs-identifier hs-var">dsPatsOverExp</span></a><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-comment">-- | Convert a list of 'DPat' arguments and a 'DExp' body into a 'DLamE'. This</span><span>
</span><a name="line-235"></a><span class="hs-comment">-- is needed since 'DLamE' takes a list of 'Name's for its bound variables</span><span>
</span><a name="line-236"></a><span class="hs-comment">-- instead of 'DPat's, so some reorganization is needed.</span><span>
</span><a name="line-237"></a><span class="hs-identifier">mkDLamEFromDPats</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226689"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226689"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-238"></a><a name="mkDLamEFromDPats"><a href="Language.Haskell.TH.Desugar.Core.html#mkDLamEFromDPats"><span class="hs-identifier">mkDLamEFromDPats</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#mkLam"><span class="hs-identifier hs-var">mkLam</span></a><span> </span><a href="#local-6989586621679226848"><span class="hs-identifier hs-var">stripDVarPa_maybe</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679226850"><a href="#local-6989586621679226850"><span class="hs-identifier">pats</span></a></a><span> </span><a name="local-6989586621679226851"><a href="#local-6989586621679226851"><span class="hs-identifier">exp</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679226850"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679226851"><span class="hs-identifier hs-var">exp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-240"></a><span>    </span><span class="hs-identifier">stripDVarPa_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-241"></a><span>    </span><a name="local-6989586621679226848"><a href="#local-6989586621679226848"><span class="hs-identifier">stripDVarPa_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a name="local-6989586621679226849"><a href="#local-6989586621679226849"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679226849"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-242"></a><span>    </span><span class="hs-identifier">stripDVarPa_maybe</span><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-243"></a><span>
</span><a name="line-244"></a><span class="hs-comment">-- | Generalizes 'dsLam' and 'mkDLamEFromDPats' to work over an arbitrary</span><span>
</span><a name="line-245"></a><span class="hs-comment">-- pattern type.</span><span>
</span><a name="line-246"></a><span class="hs-identifier">mkLam</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226687"><span class="hs-identifier hs-type">q</span></a><span>
</span><a name="line-247"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679226688"><span class="hs-identifier hs-type">pat</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Should return @'Just' n@ if the argument is a</span><span>
</span><a name="line-248"></a><span>                             </span><span class="hs-comment">--   variable pattern, and 'Nothing' otherwise.</span><span>
</span><a name="line-249"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621679226688"><span class="hs-identifier hs-type">pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226687"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-250"></a><span>                             </span><span class="hs-comment">-- ^ Should process a list of @pat@ arguments and</span><span>
</span><a name="line-251"></a><span>                             </span><span class="hs-comment">--   a 'DExp' body. (This might do some internal</span><span>
</span><a name="line-252"></a><span>                             </span><span class="hs-comment">--   reorganization if there are as-patterns, as</span><span>
</span><a name="line-253"></a><span>                             </span><span class="hs-comment">--   in the case of 'dsPatsOverExp'.)</span><span>
</span><a name="line-254"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679226688"><span class="hs-identifier hs-type">pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226687"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-255"></a><a name="mkLam"><a href="Language.Haskell.TH.Desugar.Core.html#mkLam"><span class="hs-identifier">mkLam</span></a></a><span> </span><a name="local-6989586621679226852"><a href="#local-6989586621679226852"><span class="hs-identifier">mb_strip_var_pat</span></a></a><span> </span><a name="local-6989586621679226853"><a href="#local-6989586621679226853"><span class="hs-identifier">process_pats_over_exp</span></a></a><span> </span><a name="local-6989586621679226854"><a href="#local-6989586621679226854"><span class="hs-identifier">pats</span></a></a><span> </span><a name="local-6989586621679226855"><a href="#local-6989586621679226855"><span class="hs-identifier">exp</span></a></a><span>
</span><a name="line-256"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679226856"><a href="#local-6989586621679226856"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621679226852"><span class="hs-identifier hs-var">mb_strip_var_pat</span></a><span> </span><a href="#local-6989586621679226854"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-257"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLamE"><span class="hs-identifier hs-var">DLamE</span></a><span> </span><a href="#local-6989586621679226856"><span class="hs-identifier hs-var">names</span></a><span> </span><a href="#local-6989586621679226855"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-258"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-259"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679226857"><a href="#local-6989586621679226857"><span class="hs-identifier">arg_names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">replicateM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679226854"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Util.html#newUniqueName"><span class="hs-identifier hs-var">newUniqueName</span></a><span> </span><span class="hs-string">&quot;arg&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679226858"><a href="#local-6989586621679226858"><span class="hs-identifier">scrutinee</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#mkTupleDExp"><span class="hs-identifier hs-var">mkTupleDExp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679226857"><span class="hs-identifier hs-var">arg_names</span></a><span class="hs-special">)</span><span>
</span><a name="line-261"></a><span>       </span><span class="hs-special">(</span><a name="local-6989586621679226859"><a href="#local-6989586621679226859"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679226860"><a href="#local-6989586621679226860"><span class="hs-identifier">exp'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679226853"><span class="hs-identifier hs-var">process_pats_over_exp</span></a><span> </span><a href="#local-6989586621679226854"><span class="hs-identifier hs-var">pats</span></a><span> </span><a href="#local-6989586621679226855"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-262"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679226861"><a href="#local-6989586621679226861"><span class="hs-identifier">match</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#mkTupleDPat"><span class="hs-identifier hs-var">mkTupleDPat</span></a><span> </span><a href="#local-6989586621679226859"><span class="hs-identifier hs-var">pats'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226860"><span class="hs-identifier hs-var">exp'</span></a><span>
</span><a name="line-263"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLamE"><span class="hs-identifier hs-var">DLamE</span></a><span> </span><a href="#local-6989586621679226857"><span class="hs-identifier hs-var">arg_names</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DCaseE"><span class="hs-identifier hs-var">DCaseE</span></a><span> </span><a href="#local-6989586621679226858"><span class="hs-identifier hs-var">scrutinee</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679226861"><span class="hs-identifier hs-var">match</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-264"></a><span>
</span><a name="line-265"></a><span class="hs-comment">-- | Desugar a list of matches for a @case@ statement</span><span>
</span><a name="line-266"></a><span class="hs-identifier">dsMatches</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226686"><span class="hs-identifier hs-type">q</span></a><span>
</span><a name="line-267"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>     </span><span class="hs-comment">-- ^ Name of the scrutinee, which must be a bare var</span><span>
</span><a name="line-268"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Match</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ Matches of the @case@ statement</span><span>
</span><a name="line-269"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226686"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-type">DMatch</span></a><span class="hs-special">]</span><span>
</span><a name="line-270"></a><a name="dsMatches"><a href="Language.Haskell.TH.Desugar.Core.html#dsMatches"><span class="hs-identifier">dsMatches</span></a></a><span> </span><a name="local-6989586621679226862"><a href="#local-6989586621679226862"><span class="hs-identifier">scr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226863"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-271"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-272"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226864"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Match</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226864"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-type">DMatch</span></a><span class="hs-special">]</span><span>
</span><a name="line-273"></a><span>    </span><a name="local-6989586621679226863"><a href="#local-6989586621679226863"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-274"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Match</span><span> </span><a name="local-6989586621679226865"><a href="#local-6989586621679226865"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679226866"><a href="#local-6989586621679226866"><span class="hs-identifier">body</span></a></a><span> </span><a name="local-6989586621679226867"><a href="#local-6989586621679226867"><span class="hs-identifier">where_decs</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679226868"><a href="#local-6989586621679226868"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-275"></a><span>      </span><a name="local-6989586621679226869"><a href="#local-6989586621679226869"><span class="hs-identifier">rest'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679226863"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679226868"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-276"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679226870"><a href="#local-6989586621679226870"><span class="hs-identifier">failure</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DCaseE"><span class="hs-identifier hs-var">DCaseE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679226862"><span class="hs-identifier hs-var">scr</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226869"><span class="hs-identifier hs-var">rest'</span></a><span>  </span><span class="hs-comment">-- this might be an empty case.</span><span>
</span><a name="line-277"></a><span>      </span><a name="local-6989586621679226871"><a href="#local-6989586621679226871"><span class="hs-identifier">exp'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsBody"><span class="hs-identifier hs-var">dsBody</span></a><span> </span><a href="#local-6989586621679226866"><span class="hs-identifier hs-var">body</span></a><span> </span><a href="#local-6989586621679226867"><span class="hs-identifier hs-var">where_decs</span></a><span> </span><a href="#local-6989586621679226870"><span class="hs-identifier hs-var">failure</span></a><span>
</span><a name="line-278"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679226872"><a href="#local-6989586621679226872"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679226873"><a href="#local-6989586621679226873"><span class="hs-identifier">exp''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPatOverExp"><span class="hs-identifier hs-var">dsPatOverExp</span></a><span> </span><a href="#local-6989586621679226865"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621679226871"><span class="hs-identifier hs-var">exp'</span></a><span>
</span><a name="line-279"></a><span>      </span><a name="local-6989586621679226874"><a href="#local-6989586621679226874"><span class="hs-identifier">uni_pattern</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#isUniversalPattern"><span class="hs-identifier hs-var">isUniversalPattern</span></a><span> </span><a href="#local-6989586621679226872"><span class="hs-identifier hs-var">pat'</span></a><span> </span><span class="hs-comment">-- incomplete attempt at #6</span><span>
</span><a name="line-280"></a><span>      </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679226874"><span class="hs-identifier hs-var">uni_pattern</span></a><span>
</span><a name="line-281"></a><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><a href="#local-6989586621679226872"><span class="hs-identifier hs-var">pat'</span></a><span> </span><a href="#local-6989586621679226873"><span class="hs-identifier hs-var">exp''</span></a><span class="hs-special">]</span><span>
</span><a name="line-282"></a><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><a href="#local-6989586621679226872"><span class="hs-identifier hs-var">pat'</span></a><span> </span><a href="#local-6989586621679226873"><span class="hs-identifier hs-var">exp''</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679226869"><span class="hs-identifier hs-var">rest'</span></a><span class="hs-special">)</span><span>
</span><a name="line-283"></a><span>
</span><a name="line-284"></a><span class="hs-comment">-- | Desugar a @Body@</span><span>
</span><a name="line-285"></a><span class="hs-identifier">dsBody</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226685"><span class="hs-identifier hs-type">q</span></a><span>
</span><a name="line-286"></a><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Body</span><span>      </span><span class="hs-comment">-- ^ body to desugar</span><span>
</span><a name="line-287"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- ^ &quot;where&quot; declarations</span><span>
</span><a name="line-288"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>      </span><span class="hs-comment">-- ^ what to do if the guards don't match</span><span>
</span><a name="line-289"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226685"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-290"></a><a name="dsBody"><a href="Language.Haskell.TH.Desugar.Core.html#dsBody"><span class="hs-identifier">dsBody</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NormalB</span><span> </span><a name="local-6989586621679226875"><a href="#local-6989586621679226875"><span class="hs-identifier">exp</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679226876"><a href="#local-6989586621679226876"><span class="hs-identifier">decs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-291"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Core.html#maybeDLetE"><span class="hs-identifier hs-var">maybeDLetE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsLetDecs"><span class="hs-identifier hs-var">dsLetDecs</span></a><span> </span><a href="#local-6989586621679226876"><span class="hs-identifier hs-var">decs</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226875"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-292"></a><span class="hs-identifier">dsBody</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GuardedB</span><span> </span><a name="local-6989586621679226877"><a href="#local-6989586621679226877"><span class="hs-identifier">guarded_exps</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679226878"><a href="#local-6989586621679226878"><span class="hs-identifier">decs</span></a></a><span> </span><a name="local-6989586621679226879"><a href="#local-6989586621679226879"><span class="hs-identifier">failure</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-293"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Core.html#maybeDLetE"><span class="hs-identifier hs-var">maybeDLetE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsLetDecs"><span class="hs-identifier hs-var">dsLetDecs</span></a><span> </span><a href="#local-6989586621679226878"><span class="hs-identifier hs-var">decs</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsGuards"><span class="hs-identifier hs-var">dsGuards</span></a><span> </span><a href="#local-6989586621679226877"><span class="hs-identifier hs-var">guarded_exps</span></a><span> </span><a href="#local-6989586621679226879"><span class="hs-identifier hs-var">failure</span></a><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span class="hs-comment">-- | If decs is non-empty, delcare them in a let:</span><span>
</span><a name="line-296"></a><span class="hs-identifier">maybeDLetE</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DLetDec"><span class="hs-identifier hs-type">DLetDec</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-297"></a><a name="maybeDLetE"><a href="Language.Haskell.TH.Desugar.Core.html#maybeDLetE"><span class="hs-identifier">maybeDLetE</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679226880"><a href="#local-6989586621679226880"><span class="hs-identifier">exp</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226880"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-298"></a><span class="hs-identifier">maybeDLetE</span><span> </span><a name="local-6989586621679226881"><a href="#local-6989586621679226881"><span class="hs-identifier">decs</span></a></a><span> </span><a name="local-6989586621679226882"><a href="#local-6989586621679226882"><span class="hs-identifier">exp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLetE"><span class="hs-identifier hs-var">DLetE</span></a><span> </span><a href="#local-6989586621679226881"><span class="hs-identifier hs-var">decs</span></a><span> </span><a href="#local-6989586621679226882"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-299"></a><span>
</span><a name="line-300"></a><span class="hs-comment">-- | If matches is non-empty, make a case statement; otherwise make an error statement</span><span>
</span><a name="line-301"></a><span class="hs-identifier">maybeDCaseE</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-type">DMatch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-302"></a><a name="maybeDCaseE"><a href="Language.Haskell.TH.Desugar.Core.html#maybeDCaseE"><span class="hs-identifier">maybeDCaseE</span></a></a><span> </span><a name="local-6989586621679226883"><a href="#local-6989586621679226883"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">error</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitE"><span class="hs-identifier hs-var">DLitE</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">StringL</span><span> </span><a href="#local-6989586621679226883"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-303"></a><span class="hs-identifier">maybeDCaseE</span><span> </span><span class="hs-identifier">_</span><span>   </span><a name="local-6989586621679226884"><a href="#local-6989586621679226884"><span class="hs-identifier">scrut</span></a></a><span> </span><a name="local-6989586621679226885"><a href="#local-6989586621679226885"><span class="hs-identifier">matches</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DCaseE"><span class="hs-identifier hs-var">DCaseE</span></a><span> </span><a href="#local-6989586621679226884"><span class="hs-identifier hs-var">scrut</span></a><span> </span><a href="#local-6989586621679226885"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span class="hs-comment">-- | Desugar guarded expressions</span><span>
</span><a name="line-306"></a><span class="hs-identifier">dsGuards</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226684"><span class="hs-identifier hs-type">q</span></a><span>
</span><a name="line-307"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Guard</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Exp</span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ Guarded expressions</span><span>
</span><a name="line-308"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>            </span><span class="hs-comment">-- ^ What to do if none of the guards match</span><span>
</span><a name="line-309"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226684"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-310"></a><a name="dsGuards"><a href="Language.Haskell.TH.Desugar.Core.html#dsGuards"><span class="hs-identifier">dsGuards</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679226886"><a href="#local-6989586621679226886"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679226886"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-311"></a><span class="hs-identifier">dsGuards</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">NormalG</span><span> </span><a name="local-6989586621679226887"><a href="#local-6989586621679226887"><span class="hs-identifier">gd</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679226888"><a href="#local-6989586621679226888"><span class="hs-identifier">exp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679226889"><a href="#local-6989586621679226889"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679226890"><a href="#local-6989586621679226890"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-312"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Core.html#dsGuards"><span class="hs-identifier hs-var">dsGuards</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatG</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">NoBindS</span><span> </span><a href="#local-6989586621679226887"><span class="hs-identifier hs-var">gd</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679226888"><span class="hs-identifier hs-var">exp</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679226889"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226890"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-313"></a><span class="hs-identifier">dsGuards</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatG</span><span> </span><a name="local-6989586621679226891"><a href="#local-6989586621679226891"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679226892"><a href="#local-6989586621679226892"><span class="hs-identifier">exp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679226893"><a href="#local-6989586621679226893"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679226894"><a href="#local-6989586621679226894"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-314"></a><span>  </span><a name="local-6989586621679226895"><a href="#local-6989586621679226895"><span class="hs-identifier">success</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226892"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-315"></a><span>  </span><a name="local-6989586621679226896"><a href="#local-6989586621679226896"><span class="hs-identifier">failure</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsGuards"><span class="hs-identifier hs-var">dsGuards</span></a><span> </span><a href="#local-6989586621679226893"><span class="hs-identifier hs-var">rest</span></a><span> </span><a href="#local-6989586621679226894"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-316"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Core.html#dsGuardStmts"><span class="hs-identifier hs-var">dsGuardStmts</span></a><span> </span><a href="#local-6989586621679226891"><span class="hs-identifier hs-var">stmts</span></a><span> </span><a href="#local-6989586621679226895"><span class="hs-identifier hs-var">success</span></a><span> </span><a href="#local-6989586621679226896"><span class="hs-identifier hs-var">failure</span></a><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span class="hs-comment">-- | Desugar the @Stmt@s in a guard</span><span>
</span><a name="line-319"></a><span class="hs-identifier">dsGuardStmts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226683"><span class="hs-identifier hs-type">q</span></a><span>
</span><a name="line-320"></a><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Stmt</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ The @Stmt@s to desugar</span><span>
</span><a name="line-321"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>    </span><span class="hs-comment">-- ^ What to do if the @Stmt@s yield success</span><span>
</span><a name="line-322"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>    </span><span class="hs-comment">-- ^ What to do if the @Stmt@s yield failure</span><span>
</span><a name="line-323"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226683"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-324"></a><a name="dsGuardStmts"><a href="Language.Haskell.TH.Desugar.Core.html#dsGuardStmts"><span class="hs-identifier">dsGuardStmts</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679226897"><a href="#local-6989586621679226897"><span class="hs-identifier">success</span></a></a><span> </span><a name="local-6989586621679226898"><a href="#local-6989586621679226898"><span class="hs-identifier">_failure</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679226897"><span class="hs-identifier hs-var">success</span></a><span>
</span><a name="line-325"></a><span class="hs-identifier">dsGuardStmts</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BindS</span><span> </span><a name="local-6989586621679226899"><a href="#local-6989586621679226899"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679226900"><a href="#local-6989586621679226900"><span class="hs-identifier">exp</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679226901"><a href="#local-6989586621679226901"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679226902"><a href="#local-6989586621679226902"><span class="hs-identifier">success</span></a></a><span> </span><a name="local-6989586621679226903"><a href="#local-6989586621679226903"><span class="hs-identifier">failure</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-326"></a><span>  </span><a name="local-6989586621679226904"><a href="#local-6989586621679226904"><span class="hs-identifier">success'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsGuardStmts"><span class="hs-identifier hs-var">dsGuardStmts</span></a><span> </span><a href="#local-6989586621679226901"><span class="hs-identifier hs-var">rest</span></a><span> </span><a href="#local-6989586621679226902"><span class="hs-identifier hs-var">success</span></a><span> </span><a href="#local-6989586621679226903"><span class="hs-identifier hs-var">failure</span></a><span>
</span><a name="line-327"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679226905"><a href="#local-6989586621679226905"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679226906"><a href="#local-6989586621679226906"><span class="hs-identifier">success''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPatOverExp"><span class="hs-identifier hs-var">dsPatOverExp</span></a><span> </span><a href="#local-6989586621679226899"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621679226904"><span class="hs-identifier hs-var">success'</span></a><span>
</span><a name="line-328"></a><span>  </span><a name="local-6989586621679226907"><a href="#local-6989586621679226907"><span class="hs-identifier">exp'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226900"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-329"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DCaseE"><span class="hs-identifier hs-var">DCaseE</span></a><span> </span><a href="#local-6989586621679226907"><span class="hs-identifier hs-var">exp'</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><a href="#local-6989586621679226905"><span class="hs-identifier hs-var">pat'</span></a><span> </span><a href="#local-6989586621679226906"><span class="hs-identifier hs-var">success''</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span> </span><a href="#local-6989586621679226903"><span class="hs-identifier hs-var">failure</span></a><span class="hs-special">]</span><span>
</span><a name="line-330"></a><span class="hs-identifier">dsGuardStmts</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LetS</span><span> </span><a name="local-6989586621679226908"><a href="#local-6989586621679226908"><span class="hs-identifier">decs</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679226909"><a href="#local-6989586621679226909"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679226910"><a href="#local-6989586621679226910"><span class="hs-identifier">success</span></a></a><span> </span><a name="local-6989586621679226911"><a href="#local-6989586621679226911"><span class="hs-identifier">failure</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-331"></a><span>  </span><a name="local-6989586621679226912"><a href="#local-6989586621679226912"><span class="hs-identifier">decs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsLetDecs"><span class="hs-identifier hs-var">dsLetDecs</span></a><span> </span><a href="#local-6989586621679226908"><span class="hs-identifier hs-var">decs</span></a><span>
</span><a name="line-332"></a><span>  </span><a name="local-6989586621679226913"><a href="#local-6989586621679226913"><span class="hs-identifier">success'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsGuardStmts"><span class="hs-identifier hs-var">dsGuardStmts</span></a><span> </span><a href="#local-6989586621679226909"><span class="hs-identifier hs-var">rest</span></a><span> </span><a href="#local-6989586621679226910"><span class="hs-identifier hs-var">success</span></a><span> </span><a href="#local-6989586621679226911"><span class="hs-identifier hs-var">failure</span></a><span>
</span><a name="line-333"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLetE"><span class="hs-identifier hs-var">DLetE</span></a><span> </span><a href="#local-6989586621679226912"><span class="hs-identifier hs-var">decs'</span></a><span> </span><a href="#local-6989586621679226913"><span class="hs-identifier hs-var">success'</span></a><span>
</span><a name="line-334"></a><span>  </span><span class="hs-comment">-- special-case a final pattern containing &quot;otherwise&quot; or &quot;True&quot;</span><span>
</span><a name="line-335"></a><span>  </span><span class="hs-comment">-- note that GHC does this special-casing, too, in DsGRHSs.isTrueLHsExpr</span><span>
</span><a name="line-336"></a><span class="hs-identifier">dsGuardStmts</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">NoBindS</span><span> </span><a name="local-6989586621679226914"><a href="#local-6989586621679226914"><span class="hs-identifier">exp</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621679226915"><a href="#local-6989586621679226915"><span class="hs-identifier">success</span></a></a><span> </span><a name="local-6989586621679226916"><a href="#local-6989586621679226916"><span class="hs-identifier">_failure</span></a></a><span>
</span><a name="line-337"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">VarE</span><span> </span><a name="local-6989586621679226917"><a href="#local-6989586621679226917"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679226914"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-338"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679226917"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">otherwise</span><span>
</span><a name="line-339"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679226915"><span class="hs-identifier hs-var">success</span></a><span>
</span><a name="line-340"></a><span>
</span><a name="line-341"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">ConE</span><span> </span><a name="local-6989586621679226918"><a href="#local-6989586621679226918"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679226914"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-342"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679226918"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">True</span><span>
</span><a name="line-343"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679226915"><span class="hs-identifier hs-var">success</span></a><span>
</span><a name="line-344"></a><span class="hs-identifier">dsGuardStmts</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NoBindS</span><span> </span><a name="local-6989586621679226919"><a href="#local-6989586621679226919"><span class="hs-identifier">exp</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679226920"><a href="#local-6989586621679226920"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679226921"><a href="#local-6989586621679226921"><span class="hs-identifier">success</span></a></a><span> </span><a name="local-6989586621679226922"><a href="#local-6989586621679226922"><span class="hs-identifier">failure</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-345"></a><span>  </span><a name="local-6989586621679226923"><a href="#local-6989586621679226923"><span class="hs-identifier">exp'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226919"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-346"></a><span>  </span><a name="local-6989586621679226924"><a href="#local-6989586621679226924"><span class="hs-identifier">success'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsGuardStmts"><span class="hs-identifier hs-var">dsGuardStmts</span></a><span> </span><a href="#local-6989586621679226920"><span class="hs-identifier hs-var">rest</span></a><span> </span><a href="#local-6989586621679226921"><span class="hs-identifier hs-var">success</span></a><span> </span><a href="#local-6989586621679226922"><span class="hs-identifier hs-var">failure</span></a><span>
</span><a name="line-347"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DCaseE"><span class="hs-identifier hs-var">DCaseE</span></a><span> </span><a href="#local-6989586621679226923"><span class="hs-identifier hs-var">exp'</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">True</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226924"><span class="hs-identifier hs-var">success'</span></a><span>
</span><a name="line-348"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">False</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226922"><span class="hs-identifier hs-var">failure</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-349"></a><span class="hs-identifier">dsGuardStmts</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParS</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;Parallel comprehension in a pattern guard.&quot;</span><span>
</span><a name="line-350"></a><span>
</span><a name="line-351"></a><span class="hs-comment">-- | Desugar the @Stmt@s in a @do@ expression</span><span>
</span><a name="line-352"></a><span class="hs-identifier">dsDoStmts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226682"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Stmt</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226682"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-353"></a><a name="dsDoStmts"><a href="Language.Haskell.TH.Desugar.Core.html#dsDoStmts"><span class="hs-identifier">dsDoStmts</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;do-expression ended with something other than bare statement.&quot;</span><span>
</span><a name="line-354"></a><span class="hs-identifier">dsDoStmts</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">NoBindS</span><span> </span><a name="local-6989586621679226925"><a href="#local-6989586621679226925"><span class="hs-identifier">exp</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226925"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-355"></a><span class="hs-identifier">dsDoStmts</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BindS</span><span> </span><a name="local-6989586621679226926"><a href="#local-6989586621679226926"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679226927"><a href="#local-6989586621679226927"><span class="hs-identifier">exp</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679226928"><a href="#local-6989586621679226928"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-356"></a><span>  </span><a name="local-6989586621679226929"><a href="#local-6989586621679226929"><span class="hs-identifier">rest'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDoStmts"><span class="hs-identifier hs-var">dsDoStmts</span></a><span> </span><a href="#local-6989586621679226928"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-357"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Core.html#dsBindS"><span class="hs-identifier hs-var">dsBindS</span></a><span> </span><a href="#local-6989586621679226927"><span class="hs-identifier hs-var">exp</span></a><span> </span><a href="#local-6989586621679226926"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621679226929"><span class="hs-identifier hs-var">rest'</span></a><span> </span><span class="hs-string">&quot;do expression&quot;</span><span>
</span><a name="line-358"></a><span class="hs-identifier">dsDoStmts</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LetS</span><span> </span><a name="local-6989586621679226930"><a href="#local-6989586621679226930"><span class="hs-identifier">decs</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679226931"><a href="#local-6989586621679226931"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLetE"><span class="hs-identifier hs-var">DLetE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsLetDecs"><span class="hs-identifier hs-var">dsLetDecs</span></a><span> </span><a href="#local-6989586621679226930"><span class="hs-identifier hs-var">decs</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDoStmts"><span class="hs-identifier hs-var">dsDoStmts</span></a><span> </span><a href="#local-6989586621679226931"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-359"></a><span class="hs-identifier">dsDoStmts</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NoBindS</span><span> </span><a name="local-6989586621679226932"><a href="#local-6989586621679226932"><span class="hs-identifier">exp</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679226933"><a href="#local-6989586621679226933"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-360"></a><span>  </span><a name="local-6989586621679226934"><a href="#local-6989586621679226934"><span class="hs-identifier">exp'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226932"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-361"></a><span>  </span><a name="local-6989586621679226935"><a href="#local-6989586621679226935"><span class="hs-identifier">rest'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDoStmts"><span class="hs-identifier hs-var">dsDoStmts</span></a><span> </span><a href="#local-6989586621679226933"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-362"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">&gt;&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226934"><span class="hs-identifier hs-var">exp'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226935"><span class="hs-identifier hs-var">rest'</span></a><span>
</span><a name="line-363"></a><span class="hs-identifier">dsDoStmts</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParS</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;Parallel comprehension in a do-statement.&quot;</span><span>
</span><a name="line-364"></a><span>
</span><a name="line-365"></a><span class="hs-comment">-- | Desugar the @Stmt@s in a list or monad comprehension</span><span>
</span><a name="line-366"></a><span class="hs-identifier">dsComp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226681"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Stmt</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226681"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-367"></a><a name="dsComp"><a href="Language.Haskell.TH.Desugar.Core.html#dsComp"><span class="hs-identifier">dsComp</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;List/monad comprehension ended with something other than a bare statement.&quot;</span><span>
</span><a name="line-368"></a><span class="hs-identifier">dsComp</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">NoBindS</span><span> </span><a name="local-6989586621679226936"><a href="#local-6989586621679226936"><span class="hs-identifier">exp</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">return</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226936"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-369"></a><span class="hs-identifier">dsComp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BindS</span><span> </span><a name="local-6989586621679226937"><a href="#local-6989586621679226937"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679226938"><a href="#local-6989586621679226938"><span class="hs-identifier">exp</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679226939"><a href="#local-6989586621679226939"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-370"></a><span>  </span><a name="local-6989586621679226940"><a href="#local-6989586621679226940"><span class="hs-identifier">rest'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsComp"><span class="hs-identifier hs-var">dsComp</span></a><span> </span><a href="#local-6989586621679226939"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-371"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Core.html#dsBindS"><span class="hs-identifier hs-var">dsBindS</span></a><span> </span><a href="#local-6989586621679226938"><span class="hs-identifier hs-var">exp</span></a><span> </span><a href="#local-6989586621679226937"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621679226940"><span class="hs-identifier hs-var">rest'</span></a><span> </span><span class="hs-string">&quot;monad comprehension&quot;</span><span>
</span><a name="line-372"></a><span class="hs-identifier">dsComp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LetS</span><span> </span><a name="local-6989586621679226941"><a href="#local-6989586621679226941"><span class="hs-identifier">decs</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679226942"><a href="#local-6989586621679226942"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLetE"><span class="hs-identifier hs-var">DLetE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsLetDecs"><span class="hs-identifier hs-var">dsLetDecs</span></a><span> </span><a href="#local-6989586621679226941"><span class="hs-identifier hs-var">decs</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsComp"><span class="hs-identifier hs-var">dsComp</span></a><span> </span><a href="#local-6989586621679226942"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-373"></a><span class="hs-identifier">dsComp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NoBindS</span><span> </span><a name="local-6989586621679226943"><a href="#local-6989586621679226943"><span class="hs-identifier">exp</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679226944"><a href="#local-6989586621679226944"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-374"></a><span>  </span><a name="local-6989586621679226945"><a href="#local-6989586621679226945"><span class="hs-identifier">exp'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226943"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-375"></a><span>  </span><a name="local-6989586621679226946"><a href="#local-6989586621679226946"><span class="hs-identifier">rest'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsComp"><span class="hs-identifier hs-var">dsComp</span></a><span> </span><a href="#local-6989586621679226944"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-376"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">&gt;&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">guard</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226945"><span class="hs-identifier hs-var">exp'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226946"><span class="hs-identifier hs-var">rest'</span></a><span>
</span><a name="line-377"></a><span class="hs-identifier">dsComp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParS</span><span> </span><a name="local-6989586621679226947"><a href="#local-6989586621679226947"><span class="hs-identifier">stmtss</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679226948"><a href="#local-6989586621679226948"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-378"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679226949"><a href="#local-6989586621679226949"><span class="hs-identifier">pat</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679226950"><a href="#local-6989586621679226950"><span class="hs-identifier">exp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsParComp"><span class="hs-identifier hs-var">dsParComp</span></a><span> </span><a href="#local-6989586621679226947"><span class="hs-identifier hs-var">stmtss</span></a><span>
</span><a name="line-379"></a><span>  </span><a name="local-6989586621679226951"><a href="#local-6989586621679226951"><span class="hs-identifier">rest'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsComp"><span class="hs-identifier hs-var">dsComp</span></a><span> </span><a href="#local-6989586621679226948"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-380"></a><span>  </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">&gt;&gt;=</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226950"><span class="hs-identifier hs-var">exp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsLam"><span class="hs-identifier hs-var">dsLam</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679226949"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679226951"><span class="hs-identifier hs-var">rest'</span></a><span>
</span><a name="line-381"></a><span>
</span><a name="line-382"></a><span class="hs-comment">-- Desugar a binding statement in a do- or list comprehension.</span><span>
</span><a name="line-383"></a><span class="hs-comment">--</span><span>
</span><a name="line-384"></a><span class="hs-comment">-- In the event that the pattern in the statement is partial, the desugared</span><span>
</span><a name="line-385"></a><span class="hs-comment">-- case expression will contain a catch-all case that calls 'fail' from either</span><span>
</span><a name="line-386"></a><span class="hs-comment">-- 'MonadFail' or 'Monad', depending on whether the @MonadFailDesugaring@</span><span>
</span><a name="line-387"></a><span class="hs-comment">-- language extension is enabled or not. (On GHCs older than 8.0, 'fail' from</span><span>
</span><a name="line-388"></a><span class="hs-comment">-- 'Monad' is always used.)</span><span>
</span><a name="line-389"></a><span class="hs-identifier">dsBindS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679226680"><a href="#local-6989586621679226680"><span class="hs-identifier">q</span></a></a><span class="hs-operator">.</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226680"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Exp</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226680"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-390"></a><a name="dsBindS"><a href="Language.Haskell.TH.Desugar.Core.html#dsBindS"><span class="hs-identifier">dsBindS</span></a></a><span> </span><a name="local-6989586621679226952"><a href="#local-6989586621679226952"><span class="hs-identifier">bind_arg_exp</span></a></a><span> </span><a name="local-6989586621679226953"><a href="#local-6989586621679226953"><span class="hs-identifier">success_pat</span></a></a><span> </span><a name="local-6989586621679226954"><a href="#local-6989586621679226954"><span class="hs-identifier">success_exp</span></a></a><span> </span><a name="local-6989586621679226955"><a href="#local-6989586621679226955"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-391"></a><span>  </span><a name="local-6989586621679226958"><a href="#local-6989586621679226958"><span class="hs-identifier">bind_arg_exp'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679226952"><span class="hs-identifier hs-var">bind_arg_exp</span></a><span>
</span><a name="line-392"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679226959"><a href="#local-6989586621679226959"><span class="hs-identifier">success_pat'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679226960"><a href="#local-6989586621679226960"><span class="hs-identifier">success_exp'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPatOverExp"><span class="hs-identifier hs-var">dsPatOverExp</span></a><span> </span><a href="#local-6989586621679226953"><span class="hs-identifier hs-var">success_pat</span></a><span> </span><a href="#local-6989586621679226954"><span class="hs-identifier hs-var">success_exp</span></a><span>
</span><a name="line-393"></a><span>  </span><a name="local-6989586621679226961"><a href="#local-6989586621679226961"><span class="hs-identifier">is_univ_pat</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#isUniversalPattern"><span class="hs-identifier hs-var">isUniversalPattern</span></a><span> </span><a href="#local-6989586621679226959"><span class="hs-identifier hs-var">success_pat'</span></a><span>
</span><a name="line-394"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679226962"><a href="#local-6989586621679226962"><span class="hs-identifier">bind_into</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">&gt;&gt;=</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226958"><span class="hs-identifier hs-var">bind_arg_exp'</span></a><span class="hs-special">)</span><span>
</span><a name="line-395"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679226961"><span class="hs-identifier hs-var">is_univ_pat</span></a><span>
</span><a name="line-396"></a><span>     </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679226962"><span class="hs-identifier hs-var">bind_into</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#mkDLamEFromDPats"><span class="hs-identifier hs-var">mkDLamEFromDPats</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679226959"><span class="hs-identifier hs-var">success_pat'</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679226960"><span class="hs-identifier hs-var">success_exp'</span></a><span>
</span><a name="line-397"></a><span>     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679226963"><a href="#local-6989586621679226963"><span class="hs-identifier">arg_name</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#newUniqueName"><span class="hs-identifier hs-var">newUniqueName</span></a><span> </span><span class="hs-string">&quot;arg&quot;</span><span>
</span><a name="line-398"></a><span>             </span><a name="local-6989586621679226964"><a href="#local-6989586621679226964"><span class="hs-identifier">fail_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679226956"><span class="hs-identifier hs-var">mk_fail_name</span></a><span>
</span><a name="line-399"></a><span>             </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679226962"><span class="hs-identifier hs-var">bind_into</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLamE"><span class="hs-identifier hs-var">DLamE</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679226963"><span class="hs-identifier hs-var">arg_name</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DCaseE"><span class="hs-identifier hs-var">DCaseE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679226963"><span class="hs-identifier hs-var">arg_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-400"></a><span>               </span><span class="hs-special">[</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><a href="#local-6989586621679226959"><span class="hs-identifier hs-var">success_pat'</span></a><span> </span><a href="#local-6989586621679226960"><span class="hs-identifier hs-var">success_exp'</span></a><span>
</span><a name="line-401"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-402"></a><span>                 </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679226964"><span class="hs-identifier hs-var">fail_name</span></a><span> </span><span class="hs-special">`</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span class="hs-special">`</span><span>
</span><a name="line-403"></a><span>                   </span><a href="Language.Haskell.TH.Desugar.AST.html#DLitE"><span class="hs-identifier hs-var">DLitE</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">StringL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Pattern match failure in &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679226955"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-404"></a><span>               </span><span class="hs-special">]</span><span>
</span><a name="line-405"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-406"></a><span>    </span><span class="hs-identifier">mk_fail_name</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679226680"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-407"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 800
</span><span>    </span><a name="local-6989586621679226956"><a href="#local-6989586621679226956"><span class="hs-identifier">mk_fail_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-409"></a><span>      </span><a name="local-6989586621679226957"><a href="#local-6989586621679226957"><span class="hs-identifier">mfd</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">qIsExtEnabled</span><span> </span><span class="hs-identifier hs-var">MonadFailDesugaring</span><span>
</span><a name="line-410"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679226957"><span class="hs-identifier hs-var">mfd</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">MonadFail.fail</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Prelude.fail</span><span>
</span><a name="line-411"></a><span class="hs-cpp">#else
</span><span>    </span><span class="hs-identifier">mk_fail_name</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Prelude.fail</span><span>
</span><a name="line-413"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-415"></a><span class="hs-comment">-- | Desugar the contents of a parallel comprehension.</span><span>
</span><a name="line-416"></a><span class="hs-comment">--   Returns a @Pat@ containing a tuple of all bound variables and an expression</span><span>
</span><a name="line-417"></a><span class="hs-comment">--   to produce the values for those variables</span><span>
</span><a name="line-418"></a><span class="hs-identifier">dsParComp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226679"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Stmt</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226679"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Pat</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span class="hs-special">)</span><span>
</span><a name="line-419"></a><a name="dsParComp"><a href="Language.Haskell.TH.Desugar.Core.html#dsParComp"><span class="hs-identifier">dsParComp</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;Empty list of parallel comprehension statements.&quot;</span><span>
</span><a name="line-420"></a><span class="hs-identifier">dsParComp</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679226965"><a href="#local-6989586621679226965"><span class="hs-identifier">r</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-421"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679226966"><a href="#local-6989586621679226966"><span class="hs-identifier">rv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#extractBoundNamesStmt"><span class="hs-identifier hs-var">extractBoundNamesStmt</span></a><span> </span><a href="#local-6989586621679226965"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-422"></a><span>  </span><a name="local-6989586621679226967"><a href="#local-6989586621679226967"><span class="hs-identifier">dsR</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsComp"><span class="hs-identifier hs-var">dsComp</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679226965"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Core.html#mk_tuple_stmt"><span class="hs-identifier hs-var">mk_tuple_stmt</span></a><span> </span><a href="#local-6989586621679226966"><span class="hs-identifier hs-var">rv</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-423"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#mk_tuple_pat"><span class="hs-identifier hs-var">mk_tuple_pat</span></a><span> </span><a href="#local-6989586621679226966"><span class="hs-identifier hs-var">rv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679226967"><span class="hs-identifier hs-var">dsR</span></a><span class="hs-special">)</span><span>
</span><a name="line-424"></a><span class="hs-identifier">dsParComp</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679226968"><a href="#local-6989586621679226968"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679226969"><a href="#local-6989586621679226969"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-425"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679226970"><a href="#local-6989586621679226970"><span class="hs-identifier">qv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#extractBoundNamesStmt"><span class="hs-identifier hs-var">extractBoundNamesStmt</span></a><span> </span><a href="#local-6989586621679226968"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-426"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679226971"><a href="#local-6989586621679226971"><span class="hs-identifier">rest_pat</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679226972"><a href="#local-6989586621679226972"><span class="hs-identifier">rest_exp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsParComp"><span class="hs-identifier hs-var">dsParComp</span></a><span> </span><a href="#local-6989586621679226969"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-427"></a><span>  </span><a name="local-6989586621679226973"><a href="#local-6989586621679226973"><span class="hs-identifier">dsQ</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsComp"><span class="hs-identifier hs-var">dsComp</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679226968"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Core.html#mk_tuple_stmt"><span class="hs-identifier hs-var">mk_tuple_stmt</span></a><span> </span><a href="#local-6989586621679226970"><span class="hs-identifier hs-var">qv</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-428"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679226974"><a href="#local-6989586621679226974"><span class="hs-identifier">zipped</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">mzip</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226973"><span class="hs-identifier hs-var">dsQ</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679226972"><span class="hs-identifier hs-var">rest_exp</span></a><span>
</span><a name="line-429"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConP</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tupleDataName</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Core.html#mk_tuple_pat"><span class="hs-identifier hs-var">mk_tuple_pat</span></a><span> </span><a href="#local-6989586621679226970"><span class="hs-identifier hs-var">qv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679226971"><span class="hs-identifier hs-var">rest_pat</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679226974"><span class="hs-identifier hs-var">zipped</span></a><span class="hs-special">)</span><span>
</span><a name="line-430"></a><span>
</span><a name="line-431"></a><span class="hs-comment">-- helper function for dsParComp</span><span>
</span><a name="line-432"></a><span class="hs-identifier">mk_tuple_stmt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">S.Set</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Stmt</span><span>
</span><a name="line-433"></a><a name="mk_tuple_stmt"><a href="Language.Haskell.TH.Desugar.Core.html#mk_tuple_stmt"><span class="hs-identifier">mk_tuple_stmt</span></a></a><span> </span><a name="local-6989586621679226975"><a href="#local-6989586621679226975"><span class="hs-identifier">name_set</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-434"></a><span>  </span><span class="hs-identifier hs-var">NoBindS</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#mkTupleExp"><span class="hs-identifier hs-var">mkTupleExp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">S.foldr</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">VarE</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679226975"><span class="hs-identifier hs-var">name_set</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-435"></a><span>
</span><a name="line-436"></a><span class="hs-comment">-- helper function for dsParComp</span><span>
</span><a name="line-437"></a><span class="hs-identifier">mk_tuple_pat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">S.Set</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Pat</span><span>
</span><a name="line-438"></a><a name="mk_tuple_pat"><a href="Language.Haskell.TH.Desugar.Core.html#mk_tuple_pat"><span class="hs-identifier">mk_tuple_pat</span></a></a><span> </span><a name="local-6989586621679226976"><a href="#local-6989586621679226976"><span class="hs-identifier">name_set</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-439"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Core.html#mkTuplePat"><span class="hs-identifier hs-var">mkTuplePat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">S.foldr</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">VarP</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679226976"><span class="hs-identifier hs-var">name_set</span></a><span class="hs-special">)</span><span>
</span><a name="line-440"></a><span>
</span><a name="line-441"></a><span class="hs-comment">-- | Desugar a pattern, along with processing a (desugared) expression that</span><span>
</span><a name="line-442"></a><span class="hs-comment">-- is the entire scope of the variables bound in the pattern.</span><span>
</span><a name="line-443"></a><span class="hs-identifier">dsPatOverExp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226678"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226678"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span class="hs-special">)</span><span>
</span><a name="line-444"></a><a name="dsPatOverExp"><a href="Language.Haskell.TH.Desugar.Core.html#dsPatOverExp"><span class="hs-identifier">dsPatOverExp</span></a></a><span> </span><a name="local-6989586621679226977"><a href="#local-6989586621679226977"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679226978"><a href="#local-6989586621679226978"><span class="hs-identifier">exp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-445"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679226979"><a href="#local-6989586621679226979"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679226980"><a href="#local-6989586621679226980"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">runWriterT</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPat"><span class="hs-identifier hs-var">dsPat</span></a><span> </span><a href="#local-6989586621679226977"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-446"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679226981"><a href="#local-6989586621679226981"><span class="hs-identifier">name_decs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DValD"><span class="hs-identifier hs-var">DValD</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><a href="#local-6989586621679226980"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-447"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679226979"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#maybeDLetE"><span class="hs-identifier hs-var">maybeDLetE</span></a><span> </span><a href="#local-6989586621679226981"><span class="hs-identifier hs-var">name_decs</span></a><span> </span><a href="#local-6989586621679226978"><span class="hs-identifier hs-var">exp</span></a><span class="hs-special">)</span><span>
</span><a name="line-448"></a><span>
</span><a name="line-449"></a><span class="hs-comment">-- | Desugar multiple patterns. Like 'dsPatOverExp'.</span><span>
</span><a name="line-450"></a><span class="hs-identifier">dsPatsOverExp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226677"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Pat</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226677"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span class="hs-special">)</span><span>
</span><a name="line-451"></a><a name="dsPatsOverExp"><a href="Language.Haskell.TH.Desugar.Core.html#dsPatsOverExp"><span class="hs-identifier">dsPatsOverExp</span></a></a><span> </span><a name="local-6989586621679226982"><a href="#local-6989586621679226982"><span class="hs-identifier">pats</span></a></a><span> </span><a name="local-6989586621679226983"><a href="#local-6989586621679226983"><span class="hs-identifier">exp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-452"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679226984"><a href="#local-6989586621679226984"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679226985"><a href="#local-6989586621679226985"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">runWriterT</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPat"><span class="hs-identifier hs-var">dsPat</span></a><span> </span><a href="#local-6989586621679226982"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-453"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679226986"><a href="#local-6989586621679226986"><span class="hs-identifier">name_decs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DValD"><span class="hs-identifier hs-var">DValD</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><a href="#local-6989586621679226985"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-454"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679226984"><span class="hs-identifier hs-var">pats'</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#maybeDLetE"><span class="hs-identifier hs-var">maybeDLetE</span></a><span> </span><a href="#local-6989586621679226986"><span class="hs-identifier hs-var">name_decs</span></a><span> </span><a href="#local-6989586621679226983"><span class="hs-identifier hs-var">exp</span></a><span class="hs-special">)</span><span>
</span><a name="line-455"></a><span>
</span><a name="line-456"></a><span class="hs-comment">-- | Desugar a pattern, returning a list of (Name, DExp) pairs of extra</span><span>
</span><a name="line-457"></a><span class="hs-comment">-- variables that must be bound within the scope of the pattern</span><span>
</span><a name="line-458"></a><span class="hs-identifier">dsPatX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226676"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226676"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-459"></a><a name="dsPatX"><a href="Language.Haskell.TH.Desugar.Core.html#dsPatX"><span class="hs-identifier">dsPatX</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runWriterT</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPat"><span class="hs-identifier hs-var">dsPat</span></a><span>
</span><a name="line-460"></a><span>
</span><a name="line-461"></a><span class="hs-comment">-- | Desugaring a pattern also returns the list of variables bound in as-patterns</span><span>
</span><a name="line-462"></a><span class="hs-comment">-- and the values they should be bound to. This variables must be brought into</span><span>
</span><a name="line-463"></a><span class="hs-comment">-- scope in the &quot;body&quot; of the pattern.</span><span>
</span><a name="line-464"></a><span class="hs-keyword">type</span><span> </span><a name="PatM"><a href="Language.Haskell.TH.Desugar.Core.html#PatM"><span class="hs-identifier">PatM</span></a></a><span> </span><a name="local-6989586621679226637"><a href="#local-6989586621679226637"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">WriterT</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679226637"><span class="hs-identifier hs-type">q</span></a><span>
</span><a name="line-465"></a><span>
</span><a name="line-466"></a><span class="hs-comment">-- | Desugar a pattern.</span><span>
</span><a name="line-467"></a><span class="hs-identifier">dsPat</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226675"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#PatM"><span class="hs-identifier hs-type">PatM</span></a><span> </span><a href="#local-6989586621679226675"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span>
</span><a name="line-468"></a><a name="dsPat"><a href="Language.Haskell.TH.Desugar.Core.html#dsPat"><span class="hs-identifier">dsPat</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitP</span><span> </span><a name="local-6989586621679226987"><a href="#local-6989586621679226987"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLitPa"><span class="hs-identifier hs-var">DLitPa</span></a><span> </span><a href="#local-6989586621679226987"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-469"></a><span class="hs-identifier">dsPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarP</span><span> </span><a name="local-6989586621679226988"><a href="#local-6989586621679226988"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a href="#local-6989586621679226988"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-470"></a><span class="hs-identifier">dsPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TupP</span><span> </span><a name="local-6989586621679226989"><a href="#local-6989586621679226989"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tupleDataName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679226989"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPat"><span class="hs-identifier hs-var">dsPat</span></a><span> </span><a href="#local-6989586621679226989"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-471"></a><span class="hs-identifier">dsPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">UnboxedTupP</span><span> </span><a name="local-6989586621679226990"><a href="#local-6989586621679226990"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unboxedTupleDataName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679226990"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-472"></a><span>                           </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPat"><span class="hs-identifier hs-var">dsPat</span></a><span> </span><a href="#local-6989586621679226990"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-473"></a><span class="hs-identifier">dsPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConP</span><span> </span><a name="local-6989586621679226991"><a href="#local-6989586621679226991"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679226992"><a href="#local-6989586621679226992"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><a href="#local-6989586621679226991"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPat"><span class="hs-identifier hs-var">dsPat</span></a><span> </span><a href="#local-6989586621679226992"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-474"></a><span class="hs-identifier">dsPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixP</span><span> </span><a name="local-6989586621679226993"><a href="#local-6989586621679226993"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679226994"><a href="#local-6989586621679226994"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679226995"><a href="#local-6989586621679226995"><span class="hs-identifier">p2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><a href="#local-6989586621679226994"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPat"><span class="hs-identifier hs-var">dsPat</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679226993"><span class="hs-identifier hs-var">p1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679226995"><span class="hs-identifier hs-var">p2</span></a><span class="hs-special">]</span><span>
</span><a name="line-475"></a><span class="hs-identifier">dsPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">UInfixP</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-476"></a><span>  </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-string">&quot;Cannot desugar unresolved infix operators.&quot;</span><span>
</span><a name="line-477"></a><span class="hs-identifier">dsPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParensP</span><span> </span><a name="local-6989586621679226996"><a href="#local-6989586621679226996"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPat"><span class="hs-identifier hs-var">dsPat</span></a><span> </span><a href="#local-6989586621679226996"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-478"></a><span class="hs-identifier">dsPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TildeP</span><span> </span><a name="local-6989586621679226997"><a href="#local-6989586621679226997"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTildePa"><span class="hs-identifier hs-var">DTildePa</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPat"><span class="hs-identifier hs-var">dsPat</span></a><span> </span><a href="#local-6989586621679226997"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-479"></a><span class="hs-identifier">dsPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BangP</span><span> </span><a name="local-6989586621679226998"><a href="#local-6989586621679226998"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DBangPa"><span class="hs-identifier hs-var">DBangPa</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPat"><span class="hs-identifier hs-var">dsPat</span></a><span> </span><a href="#local-6989586621679226998"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-480"></a><span class="hs-identifier">dsPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AsP</span><span> </span><a name="local-6989586621679226999"><a href="#local-6989586621679226999"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679227000"><a href="#local-6989586621679227000"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-481"></a><span>  </span><a name="local-6989586621679227001"><a href="#local-6989586621679227001"><span class="hs-identifier">pat'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPat"><span class="hs-identifier hs-var">dsPat</span></a><span> </span><a href="#local-6989586621679227000"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-482"></a><span>  </span><a name="local-6989586621679227002"><a href="#local-6989586621679227002"><span class="hs-identifier">pat''</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#removeWilds"><span class="hs-identifier hs-var">removeWilds</span></a><span> </span><a href="#local-6989586621679227001"><span class="hs-identifier hs-var">pat'</span></a><span>
</span><a name="line-483"></a><span>  </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679226999"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dPatToDExp"><span class="hs-identifier hs-var">dPatToDExp</span></a><span> </span><a href="#local-6989586621679227002"><span class="hs-identifier hs-var">pat''</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-484"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679227002"><span class="hs-identifier hs-var">pat''</span></a><span>
</span><a name="line-485"></a><span class="hs-identifier">dsPat</span><span> </span><span class="hs-identifier hs-var">WildP</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span>
</span><a name="line-486"></a><span class="hs-identifier">dsPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecP</span><span> </span><a name="local-6989586621679227156"><a href="#local-6989586621679227156"><span class="hs-identifier">con_name</span></a></a><span> </span><a name="local-6989586621679227157"><a href="#local-6989586621679227157"><span class="hs-identifier">field_pats</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-487"></a><span>  </span><a name="local-6989586621679227178"><a href="#local-6989586621679227178"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#dataConNameToCon"><span class="hs-identifier hs-var">dataConNameToCon</span></a><span> </span><a href="#local-6989586621679227156"><span class="hs-identifier hs-var">con_name</span></a><span>
</span><a name="line-488"></a><span>  </span><a name="local-6989586621679227179"><a href="#local-6989586621679227179"><span class="hs-identifier">reordered</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679227158"><span class="hs-identifier hs-var">reorder</span></a><span> </span><a href="#local-6989586621679227178"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-489"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><a href="#local-6989586621679227156"><span class="hs-identifier hs-var">con_name</span></a><span> </span><a href="#local-6989586621679227179"><span class="hs-identifier hs-var">reordered</span></a><span>
</span><a name="line-490"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-491"></a><span>    </span><a name="local-6989586621679227158"><a href="#local-6989586621679227158"><span class="hs-identifier">reorder</span></a></a><span> </span><a name="local-6989586621679227161"><a href="#local-6989586621679227161"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679227161"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-492"></a><span>                     </span><span class="hs-identifier hs-var">NormalC</span><span> </span><a name="local-6989586621679227162"><a href="#local-6989586621679227162"><span class="hs-identifier">_name</span></a></a><span> </span><a name="local-6989586621679227163"><a href="#local-6989586621679227163"><span class="hs-identifier">fields</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679227160"><span class="hs-identifier hs-var">non_record</span></a><span> </span><a href="#local-6989586621679227163"><span class="hs-identifier hs-var">fields</span></a><span>
</span><a name="line-493"></a><span>                     </span><span class="hs-identifier hs-var">InfixC</span><span> </span><a name="local-6989586621679227164"><a href="#local-6989586621679227164"><span class="hs-identifier">field1</span></a></a><span> </span><a name="local-6989586621679227165"><a href="#local-6989586621679227165"><span class="hs-identifier">_name</span></a></a><span> </span><a name="local-6989586621679227166"><a href="#local-6989586621679227166"><span class="hs-identifier">field2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679227160"><span class="hs-identifier hs-var">non_record</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679227164"><span class="hs-identifier hs-var">field1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679227166"><span class="hs-identifier hs-var">field2</span></a><span class="hs-special">]</span><span>
</span><a name="line-494"></a><span>                     </span><span class="hs-identifier hs-var">RecC</span><span> </span><a name="local-6989586621679227167"><a href="#local-6989586621679227167"><span class="hs-identifier">_name</span></a></a><span> </span><a name="local-6989586621679227168"><a href="#local-6989586621679227168"><span class="hs-identifier">fields</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679227159"><span class="hs-identifier hs-var">reorder_fields_pat</span></a><span> </span><a href="#local-6989586621679227168"><span class="hs-identifier hs-var">fields</span></a><span>
</span><a name="line-495"></a><span>                     </span><span class="hs-identifier hs-var">ForallC</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679227169"><a href="#local-6989586621679227169"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679227158"><span class="hs-identifier hs-var">reorder</span></a><span> </span><a href="#local-6989586621679227169"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-496"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 800
</span><span>                     </span><span class="hs-identifier hs-var">GadtC</span><span> </span><a name="local-6989586621679227170"><a href="#local-6989586621679227170"><span class="hs-identifier">_names</span></a></a><span> </span><a name="local-6989586621679227171"><a href="#local-6989586621679227171"><span class="hs-identifier">fields</span></a></a><span> </span><a name="local-6989586621679227172"><a href="#local-6989586621679227172"><span class="hs-identifier">_ret_ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679227160"><span class="hs-identifier hs-var">non_record</span></a><span> </span><a href="#local-6989586621679227171"><span class="hs-identifier hs-var">fields</span></a><span>
</span><a name="line-498"></a><span>                     </span><span class="hs-identifier hs-var">RecGadtC</span><span> </span><a name="local-6989586621679227173"><a href="#local-6989586621679227173"><span class="hs-identifier">_names</span></a></a><span> </span><a name="local-6989586621679227174"><a href="#local-6989586621679227174"><span class="hs-identifier">fields</span></a></a><span> </span><a name="local-6989586621679227175"><a href="#local-6989586621679227175"><span class="hs-identifier">_ret_ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679227159"><span class="hs-identifier hs-var">reorder_fields_pat</span></a><span> </span><a href="#local-6989586621679227174"><span class="hs-identifier hs-var">fields</span></a><span>
</span><a name="line-499"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-501"></a><span>    </span><a name="local-6989586621679227159"><a href="#local-6989586621679227159"><span class="hs-identifier">reorder_fields_pat</span></a></a><span> </span><a name="local-6989586621679227176"><a href="#local-6989586621679227176"><span class="hs-identifier">fields</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#reorderFieldsPat"><span class="hs-identifier hs-var">reorderFieldsPat</span></a><span> </span><a href="#local-6989586621679227156"><span class="hs-identifier hs-var">con_name</span></a><span> </span><a href="#local-6989586621679227176"><span class="hs-identifier hs-var">fields</span></a><span> </span><a href="#local-6989586621679227157"><span class="hs-identifier hs-var">field_pats</span></a><span>
</span><a name="line-502"></a><span>
</span><a name="line-503"></a><span>    </span><a name="local-6989586621679227160"><a href="#local-6989586621679227160"><span class="hs-identifier">non_record</span></a></a><span> </span><a name="local-6989586621679227177"><a href="#local-6989586621679227177"><span class="hs-identifier">fields</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679227157"><span class="hs-identifier hs-var">field_pats</span></a><span>
</span><a name="line-504"></a><span>                        </span><span class="hs-comment">-- Special case: record patterns are allowed for any</span><span>
</span><a name="line-505"></a><span>                        </span><span class="hs-comment">-- constructor, regardless of whether the constructor</span><span>
</span><a name="line-506"></a><span>                        </span><span class="hs-comment">-- actually was declared with records, provided that</span><span>
</span><a name="line-507"></a><span>                        </span><span class="hs-comment">-- no records are given in the pattern itself. (See #59).</span><span>
</span><a name="line-508"></a><span>                        </span><span class="hs-comment">--</span><span>
</span><a name="line-509"></a><span>                        </span><span class="hs-comment">-- Con{} desugars down to Con _ ... _.</span><span>
</span><a name="line-510"></a><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679227177"><span class="hs-identifier hs-var">fields</span></a><span class="hs-special">)</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span>
</span><a name="line-511"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span>
</span><a name="line-512"></a><span>                                         </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Record syntax used with non-record constructor &quot;</span><span>
</span><a name="line-513"></a><span>                                           </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679227156"><span class="hs-identifier hs-var">con_name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.&quot;</span><span>
</span><a name="line-514"></a><span>
</span><a name="line-515"></a><span class="hs-identifier">dsPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListP</span><span> </span><a name="local-6989586621679227180"><a href="#local-6989586621679227180"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679227181"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679227180"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-516"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679227181"><a href="#local-6989586621679227181"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-517"></a><span>        </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679227182"><a href="#local-6989586621679227182"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679227183"><a href="#local-6989586621679227183"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-518"></a><span>          </span><a name="local-6989586621679227184"><a href="#local-6989586621679227184"><span class="hs-identifier">h'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPat"><span class="hs-identifier hs-var">dsPat</span></a><span> </span><a href="#local-6989586621679227182"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-519"></a><span>          </span><a name="local-6989586621679227185"><a href="#local-6989586621679227185"><span class="hs-identifier">t'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679227181"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679227183"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-520"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679227184"><span class="hs-identifier hs-var">h'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679227185"><span class="hs-identifier hs-var">t'</span></a><span class="hs-special">]</span><span>
</span><a name="line-521"></a><span class="hs-identifier">dsPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigP</span><span> </span><a name="local-6989586621679227186"><a href="#local-6989586621679227186"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679227187"><a href="#local-6989586621679227187"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DSigPa"><span class="hs-identifier hs-var">DSigPa</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPat"><span class="hs-identifier hs-var">dsPat</span></a><span> </span><a href="#local-6989586621679227186"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227187"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-522"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 801
</span><span class="hs-identifier">dsPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">UnboxedSumP</span><span> </span><a name="local-6989586621679227188"><a href="#local-6989586621679227188"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679227189"><a href="#local-6989586621679227189"><span class="hs-identifier">alt</span></a></a><span> </span><a name="local-6989586621679227190"><a href="#local-6989586621679227190"><span class="hs-identifier">arity</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-524"></a><span>  </span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unboxedSumDataName</span><span> </span><a href="#local-6989586621679227189"><span class="hs-identifier hs-var">alt</span></a><span> </span><a href="#local-6989586621679227190"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPat"><span class="hs-identifier hs-var">dsPat</span></a><span> </span><a href="#local-6989586621679227188"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">)</span><span>
</span><a name="line-525"></a><span class="hs-cpp">#endif
</span><span class="hs-identifier">dsPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ViewP</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-527"></a><span>  </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-string">&quot;View patterns are not supported in th-desugar. Use pattern guards instead.&quot;</span><span>
</span><a name="line-528"></a><span>
</span><a name="line-529"></a><span class="hs-comment">-- | Convert a 'DPat' to a 'DExp'. Fails on 'DWildP'.</span><span>
</span><a name="line-530"></a><span class="hs-identifier">dPatToDExp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-531"></a><a name="dPatToDExp"><a href="Language.Haskell.TH.Desugar.Core.html#dPatToDExp"><span class="hs-identifier">dPatToDExp</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitPa"><span class="hs-identifier hs-var">DLitPa</span></a><span> </span><a name="local-6989586621679227191"><a href="#local-6989586621679227191"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLitE"><span class="hs-identifier hs-var">DLitE</span></a><span> </span><a href="#local-6989586621679227191"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-532"></a><span class="hs-identifier">dPatToDExp</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a name="local-6989586621679227192"><a href="#local-6989586621679227192"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679227192"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-533"></a><span class="hs-identifier">dPatToDExp</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><a name="local-6989586621679227193"><a href="#local-6989586621679227193"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679227194"><a href="#local-6989586621679227194"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConE"><span class="hs-identifier hs-var">DConE</span></a><span> </span><a href="#local-6989586621679227193"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dPatToDExp"><span class="hs-identifier hs-var">dPatToDExp</span></a><span> </span><a href="#local-6989586621679227194"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">)</span><span>
</span><a name="line-534"></a><span class="hs-identifier">dPatToDExp</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DTildePa"><span class="hs-identifier hs-var">DTildePa</span></a><span> </span><a name="local-6989586621679227195"><a href="#local-6989586621679227195"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dPatToDExp"><span class="hs-identifier hs-var">dPatToDExp</span></a><span> </span><a href="#local-6989586621679227195"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-535"></a><span class="hs-identifier">dPatToDExp</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DBangPa"><span class="hs-identifier hs-var">DBangPa</span></a><span> </span><a name="local-6989586621679227196"><a href="#local-6989586621679227196"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dPatToDExp"><span class="hs-identifier hs-var">dPatToDExp</span></a><span> </span><a href="#local-6989586621679227196"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-536"></a><span class="hs-identifier">dPatToDExp</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DSigPa"><span class="hs-identifier hs-var">DSigPa</span></a><span> </span><a name="local-6989586621679227197"><a href="#local-6989586621679227197"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679227198"><a href="#local-6989586621679227198"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DSigE"><span class="hs-identifier hs-var">DSigE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#dPatToDExp"><span class="hs-identifier hs-var">dPatToDExp</span></a><span> </span><a href="#local-6989586621679227197"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679227198"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-537"></a><span class="hs-identifier">dPatToDExp</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar: wildcard in rhs of as-pattern&quot;</span><span>
</span><a name="line-538"></a><span>
</span><a name="line-539"></a><span class="hs-comment">-- | Remove all wildcards from a pattern, replacing any wildcard with a fresh</span><span>
</span><a name="line-540"></a><span class="hs-comment">--   variable</span><span>
</span><a name="line-541"></a><span class="hs-identifier">removeWilds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226674"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226674"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span>
</span><a name="line-542"></a><a name="removeWilds"><a href="Language.Haskell.TH.Desugar.Core.html#removeWilds"><span class="hs-identifier">removeWilds</span></a></a><span> </span><a name="local-6989586621679227199"><a href="#local-6989586621679227199"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitPa"><span class="hs-identifier hs-var">DLitPa</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679227199"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-543"></a><span class="hs-identifier">removeWilds</span><span> </span><a name="local-6989586621679227200"><a href="#local-6989586621679227200"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679227200"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-544"></a><span class="hs-identifier">removeWilds</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><a name="local-6989586621679227201"><a href="#local-6989586621679227201"><span class="hs-identifier">con_name</span></a></a><span> </span><a name="local-6989586621679227202"><a href="#local-6989586621679227202"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><a href="#local-6989586621679227201"><span class="hs-identifier hs-var">con_name</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#removeWilds"><span class="hs-identifier hs-var">removeWilds</span></a><span> </span><a href="#local-6989586621679227202"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-545"></a><span class="hs-identifier">removeWilds</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DTildePa"><span class="hs-identifier hs-var">DTildePa</span></a><span> </span><a name="local-6989586621679227203"><a href="#local-6989586621679227203"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTildePa"><span class="hs-identifier hs-var">DTildePa</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#removeWilds"><span class="hs-identifier hs-var">removeWilds</span></a><span> </span><a href="#local-6989586621679227203"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-546"></a><span class="hs-identifier">removeWilds</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DBangPa"><span class="hs-identifier hs-var">DBangPa</span></a><span> </span><a name="local-6989586621679227204"><a href="#local-6989586621679227204"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DBangPa"><span class="hs-identifier hs-var">DBangPa</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#removeWilds"><span class="hs-identifier hs-var">removeWilds</span></a><span> </span><a href="#local-6989586621679227204"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-547"></a><span class="hs-identifier">removeWilds</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DSigPa"><span class="hs-identifier hs-var">DSigPa</span></a><span> </span><a name="local-6989586621679227205"><a href="#local-6989586621679227205"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679227206"><a href="#local-6989586621679227206"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DSigPa"><span class="hs-identifier hs-var">DSigPa</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#removeWilds"><span class="hs-identifier hs-var">removeWilds</span></a><span> </span><a href="#local-6989586621679227205"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679227206"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-548"></a><span class="hs-identifier">removeWilds</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#newUniqueName"><span class="hs-identifier hs-var">newUniqueName</span></a><span> </span><span class="hs-string">&quot;wild&quot;</span><span>
</span><a name="line-549"></a><span>
</span><a name="line-550"></a><span class="hs-identifier">extractBoundNamesDPat</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">S.Set</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-551"></a><a name="extractBoundNamesDPat"><a href="Language.Haskell.TH.Desugar.Core.html#extractBoundNamesDPat"><span class="hs-identifier">extractBoundNamesDPat</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitPa"><span class="hs-identifier hs-var">DLitPa</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.empty</span><span>
</span><a name="line-552"></a><span class="hs-identifier">extractBoundNamesDPat</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a name="local-6989586621679227207"><a href="#local-6989586621679227207"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.singleton</span><span> </span><a href="#local-6989586621679227207"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-553"></a><span class="hs-identifier">extractBoundNamesDPat</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679227208"><a href="#local-6989586621679227208"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.unions</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#extractBoundNamesDPat"><span class="hs-identifier hs-var">extractBoundNamesDPat</span></a><span> </span><a href="#local-6989586621679227208"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">)</span><span>
</span><a name="line-554"></a><span class="hs-identifier">extractBoundNamesDPat</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DTildePa"><span class="hs-identifier hs-var">DTildePa</span></a><span> </span><a name="local-6989586621679227209"><a href="#local-6989586621679227209"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#extractBoundNamesDPat"><span class="hs-identifier hs-var">extractBoundNamesDPat</span></a><span> </span><a href="#local-6989586621679227209"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-555"></a><span class="hs-identifier">extractBoundNamesDPat</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DBangPa"><span class="hs-identifier hs-var">DBangPa</span></a><span> </span><a name="local-6989586621679227210"><a href="#local-6989586621679227210"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#extractBoundNamesDPat"><span class="hs-identifier hs-var">extractBoundNamesDPat</span></a><span> </span><a href="#local-6989586621679227210"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-556"></a><span class="hs-identifier">extractBoundNamesDPat</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DSigPa"><span class="hs-identifier hs-var">DSigPa</span></a><span> </span><a name="local-6989586621679227211"><a href="#local-6989586621679227211"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#extractBoundNamesDPat"><span class="hs-identifier hs-var">extractBoundNamesDPat</span></a><span> </span><a href="#local-6989586621679227211"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-557"></a><span class="hs-identifier">extractBoundNamesDPat</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.empty</span><span>
</span><a name="line-558"></a><span>
</span><a name="line-559"></a><span class="hs-comment">-- | Desugar @Info@</span><span>
</span><a name="line-560"></a><span class="hs-identifier">dsInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226673"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Info</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226673"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DInfo"><span class="hs-identifier hs-type">DInfo</span></a><span>
</span><a name="line-561"></a><a name="dsInfo"><a href="Language.Haskell.TH.Desugar.Core.html#dsInfo"><span class="hs-identifier">dsInfo</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClassI</span><span> </span><a name="local-6989586621679227212"><a href="#local-6989586621679227212"><span class="hs-identifier">dec</span></a></a><span> </span><a name="local-6989586621679227213"><a href="#local-6989586621679227213"><span class="hs-identifier">instances</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-562"></a><span>  </span><span class="hs-special">[</span><a name="local-6989586621679227214"><a href="#local-6989586621679227214"><span class="hs-identifier">ddec</span></a></a><span class="hs-special">]</span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDec"><span class="hs-identifier hs-var">dsDec</span></a><span> </span><a href="#local-6989586621679227212"><span class="hs-identifier hs-var">dec</span></a><span>
</span><a name="line-563"></a><span>  </span><a name="local-6989586621679227215"><a href="#local-6989586621679227215"><span class="hs-identifier">dinstances</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDecs"><span class="hs-identifier hs-var">dsDecs</span></a><span> </span><a href="#local-6989586621679227213"><span class="hs-identifier hs-var">instances</span></a><span>
</span><a name="line-564"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTyConI"><span class="hs-identifier hs-var">DTyConI</span></a><span> </span><a href="#local-6989586621679227214"><span class="hs-identifier hs-var">ddec</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679227215"><span class="hs-identifier hs-var">dinstances</span></a><span class="hs-special">)</span><span>
</span><a name="line-565"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="hs-identifier">dsInfo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClassOpI</span><span> </span><a name="local-6989586621679227216"><a href="#local-6989586621679227216"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679227217"><a href="#local-6989586621679227217"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679227218"><a href="#local-6989586621679227218"><span class="hs-identifier">parent</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-567"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">dsInfo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ClassOpI</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-identifier">parent</span><span> </span><span class="hs-identifier">_fixity</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-569"></a><span class="hs-cpp">#endif
</span><span>  </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarI"><span class="hs-identifier hs-var">DVarI</span></a><span> </span><a href="#local-6989586621679227216"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227217"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679227218"><span class="hs-identifier hs-var">parent</span></a><span class="hs-special">)</span><span>
</span><a name="line-571"></a><span class="hs-identifier">dsInfo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TyConI</span><span> </span><a name="local-6989586621679227219"><a href="#local-6989586621679227219"><span class="hs-identifier">dec</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-572"></a><span>  </span><span class="hs-special">[</span><a name="local-6989586621679227220"><a href="#local-6989586621679227220"><span class="hs-identifier">ddec</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDec"><span class="hs-identifier hs-var">dsDec</span></a><span> </span><a href="#local-6989586621679227219"><span class="hs-identifier hs-var">dec</span></a><span>
</span><a name="line-573"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTyConI"><span class="hs-identifier hs-var">DTyConI</span></a><span> </span><a href="#local-6989586621679227220"><span class="hs-identifier hs-var">ddec</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-574"></a><span class="hs-identifier">dsInfo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FamilyI</span><span> </span><a name="local-6989586621679227221"><a href="#local-6989586621679227221"><span class="hs-identifier">dec</span></a></a><span> </span><a name="local-6989586621679227222"><a href="#local-6989586621679227222"><span class="hs-identifier">instances</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-575"></a><span>  </span><span class="hs-special">[</span><a name="local-6989586621679227223"><a href="#local-6989586621679227223"><span class="hs-identifier">ddec</span></a></a><span class="hs-special">]</span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDec"><span class="hs-identifier hs-var">dsDec</span></a><span> </span><a href="#local-6989586621679227221"><span class="hs-identifier hs-var">dec</span></a><span>
</span><a name="line-576"></a><span>  </span><a name="local-6989586621679227224"><a href="#local-6989586621679227224"><span class="hs-identifier">dinstances</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDecs"><span class="hs-identifier hs-var">dsDecs</span></a><span> </span><a href="#local-6989586621679227222"><span class="hs-identifier hs-var">instances</span></a><span>
</span><a name="line-577"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679227225"><a href="#local-6989586621679227225"><span class="hs-identifier">ddec'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679227226"><a href="#local-6989586621679227226"><span class="hs-identifier">num_args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#fixBug8884ForFamilies"><span class="hs-identifier hs-var">fixBug8884ForFamilies</span></a><span> </span><a href="#local-6989586621679227223"><span class="hs-identifier hs-var">ddec</span></a><span>
</span><a name="line-578"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679227227"><a href="#local-6989586621679227227"><span class="hs-identifier">dinstances'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#fixBug8884ForInstances"><span class="hs-identifier hs-var">fixBug8884ForInstances</span></a><span> </span><a href="#local-6989586621679227226"><span class="hs-identifier hs-var">num_args</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679227224"><span class="hs-identifier hs-var">dinstances</span></a><span>
</span><a name="line-579"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTyConI"><span class="hs-identifier hs-var">DTyConI</span></a><span> </span><a href="#local-6989586621679227225"><span class="hs-identifier hs-var">ddec'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679227227"><span class="hs-identifier hs-var">dinstances'</span></a><span class="hs-special">)</span><span>
</span><a name="line-580"></a><span class="hs-identifier">dsInfo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PrimTyConI</span><span> </span><a name="local-6989586621679227228"><a href="#local-6989586621679227228"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679227229"><a href="#local-6989586621679227229"><span class="hs-identifier">arity</span></a></a><span> </span><a name="local-6989586621679227230"><a href="#local-6989586621679227230"><span class="hs-identifier">unlifted</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-581"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPrimTyConI"><span class="hs-identifier hs-var">DPrimTyConI</span></a><span> </span><a href="#local-6989586621679227228"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679227229"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="#local-6989586621679227230"><span class="hs-identifier hs-var">unlifted</span></a><span>
</span><a name="line-582"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="hs-identifier">dsInfo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DataConI</span><span> </span><a name="local-6989586621679227231"><a href="#local-6989586621679227231"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679227232"><a href="#local-6989586621679227232"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679227233"><a href="#local-6989586621679227233"><span class="hs-identifier">parent</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-584"></a><span>  </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarI"><span class="hs-identifier hs-var">DVarI</span></a><span> </span><a href="#local-6989586621679227231"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227232"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679227233"><span class="hs-identifier hs-var">parent</span></a><span class="hs-special">)</span><span>
</span><a name="line-585"></a><span class="hs-identifier">dsInfo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarI</span><span> </span><a name="local-6989586621679227234"><a href="#local-6989586621679227234"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679227235"><a href="#local-6989586621679227235"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-586"></a><span>  </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarI"><span class="hs-identifier hs-var">DVarI</span></a><span> </span><a href="#local-6989586621679227234"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227235"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-587"></a><span class="hs-identifier">dsInfo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarI</span><span> </span><a name="local-6989586621679227236"><a href="#local-6989586621679227236"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-588"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Declaration supplied with variable: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679227236"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-589"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">dsInfo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DataConI</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-identifier">parent</span><span> </span><span class="hs-identifier">_fixity</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-591"></a><span>  </span><span class="hs-identifier">DVarI</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">parent</span><span class="hs-special">)</span><span>
</span><a name="line-592"></a><span class="hs-identifier">dsInfo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">VarI</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-identifier">_fixity</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-593"></a><span>  </span><span class="hs-identifier">DVarI</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-594"></a><span class="hs-identifier">dsInfo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">VarI</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-595"></a><span>  </span><span class="hs-identifier">impossible</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-string">&quot;Declaration supplied with variable: &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-identifier">name</span><span>
</span><a name="line-596"></a><span class="hs-cpp">#endif
</span><span class="hs-identifier">dsInfo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TyVarI</span><span> </span><a name="local-6989586621679227237"><a href="#local-6989586621679227237"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679227238"><a href="#local-6989586621679227238"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTyVarI"><span class="hs-identifier hs-var">DTyVarI</span></a><span> </span><a href="#local-6989586621679227237"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227238"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-598"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 801
</span><span class="hs-identifier">dsInfo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynI</span><span> </span><a name="local-6989586621679227239"><a href="#local-6989586621679227239"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679227240"><a href="#local-6989586621679227240"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPatSynI"><span class="hs-identifier hs-var">DPatSynI</span></a><span> </span><a href="#local-6989586621679227239"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227240"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-600"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-602"></a><span class="hs-identifier">fixBug8884ForFamilies</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226672"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DDec"><span class="hs-identifier hs-type">DDec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226672"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DDec"><span class="hs-identifier hs-type">DDec</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-603"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &lt; 708
</span><span class="hs-identifier">fixBug8884ForFamilies</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DOpenTypeFamilyD</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DTypeFamilyHead</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">frs</span><span> </span><span class="hs-identifier">ann</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-605"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">num_args</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">tvbs</span><span>
</span><a name="line-606"></a><span>  </span><span class="hs-identifier">frs'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">remove_arrows</span><span> </span><span class="hs-identifier">num_args</span><span> </span><span class="hs-identifier">frs</span><span>
</span><a name="line-607"></a><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DOpenTypeFamilyD</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DTypeFamilyHead</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">frs'</span><span> </span><span class="hs-identifier">ann</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier">num_args</span><span class="hs-special">)</span><span>
</span><a name="line-608"></a><span class="hs-identifier">fixBug8884ForFamilies</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DClosedTypeFamilyD</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DTypeFamilyHead</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">frs</span><span> </span><span class="hs-identifier">ann</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">eqns</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-609"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">num_args</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">tvbs</span><span>
</span><a name="line-610"></a><span>      </span><span class="hs-identifier">eqns'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fixBug8884ForEqn</span><span> </span><span class="hs-identifier">num_args</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">eqns</span><span>
</span><a name="line-611"></a><span>  </span><span class="hs-identifier">frs'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">remove_arrows</span><span> </span><span class="hs-identifier">num_args</span><span> </span><span class="hs-identifier">frs</span><span>
</span><a name="line-612"></a><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DClosedTypeFamilyD</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DTypeFamilyHead</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">frs'</span><span> </span><span class="hs-identifier">ann</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">eqns'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">num_args</span><span class="hs-special">)</span><span>
</span><a name="line-613"></a><span class="hs-identifier">fixBug8884ForFamilies</span><span> </span><span class="hs-identifier">dec</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">DDataFamilyD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-614"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">dec</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- the num_args is ignored for data families</span><span>
</span><a name="line-615"></a><span class="hs-identifier">fixBug8884ForFamilies</span><span> </span><span class="hs-identifier">dec</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-616"></a><span>  </span><span class="hs-identifier">impossible</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-string">&quot;Reifying yielded a FamilyI with a non-family Dec: &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-identifier">dec</span><span>
</span><a name="line-617"></a><span>
</span><a name="line-618"></a><span class="hs-identifier">remove_arrows</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">DsMonad</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">DFamilyResultSig</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-identifier">DFamilyResultSig</span><span>
</span><a name="line-619"></a><span class="hs-identifier">remove_arrows</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DKindSig</span><span> </span><span class="hs-identifier">k</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DKindSig</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">remove_arrows_kind</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">k</span><span>
</span><a name="line-620"></a><span class="hs-identifier">remove_arrows</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DTyVarSig</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DKindedTV</span><span> </span><span class="hs-identifier">nm</span><span> </span><span class="hs-identifier">k</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-621"></a><span>  </span><span class="hs-identifier">DTyVarSig</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DKindedTV</span><span> </span><span class="hs-identifier">nm</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">remove_arrows_kind</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">k</span><span class="hs-special">)</span><span>
</span><a name="line-622"></a><span class="hs-identifier">remove_arrows</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">frs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">frs</span><span>
</span><a name="line-623"></a><span>
</span><a name="line-624"></a><span class="hs-identifier">remove_arrows_kind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">DsMonad</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">DKind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-identifier">DKind</span><span>
</span><a name="line-625"></a><span class="hs-identifier">remove_arrows_kind</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">k</span><span>
</span><a name="line-626"></a><span class="hs-identifier">remove_arrows_kind</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DAppT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DAppT</span><span> </span><span class="hs-identifier">DArrowT</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">k</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">remove_arrows_kind</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">k</span><span>
</span><a name="line-627"></a><span class="hs-identifier">remove_arrows_kind</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-628"></a><span>  </span><span class="hs-identifier">impossible</span><span> </span><span class="hs-string">&quot;Internal error: Fix for bug 8884 ran out of arrows.&quot;</span><span>
</span><a name="line-629"></a><span>
</span><a name="line-630"></a><span class="hs-cpp">#else
</span><a name="fixBug8884ForFamilies"><a href="Language.Haskell.TH.Desugar.Core.html#fixBug8884ForFamilies"><span class="hs-identifier">fixBug8884ForFamilies</span></a></a><span> </span><a name="local-6989586621679227241"><a href="#local-6989586621679227241"><span class="hs-identifier">dec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679227241"><span class="hs-identifier hs-var">dec</span></a><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- return value ignored</span><span>
</span><a name="line-632"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-634"></a><span class="hs-identifier">fixBug8884ForInstances</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DDec"><span class="hs-identifier hs-type">DDec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DDec"><span class="hs-identifier hs-type">DDec</span></a><span>
</span><a name="line-635"></a><a name="fixBug8884ForInstances"><a href="Language.Haskell.TH.Desugar.Core.html#fixBug8884ForInstances"><span class="hs-identifier">fixBug8884ForInstances</span></a></a><span> </span><a name="local-6989586621679227242"><a href="#local-6989586621679227242"><span class="hs-identifier">num_args</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DTySynInstD"><span class="hs-identifier hs-var">DTySynInstD</span></a><span> </span><a name="local-6989586621679227243"><a href="#local-6989586621679227243"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679227244"><a href="#local-6989586621679227244"><span class="hs-identifier">eqn</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-636"></a><span>  </span><a href="Language.Haskell.TH.Desugar.AST.html#DTySynInstD"><span class="hs-identifier hs-var">DTySynInstD</span></a><span> </span><a href="#local-6989586621679227243"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#fixBug8884ForEqn"><span class="hs-identifier hs-var">fixBug8884ForEqn</span></a><span> </span><a href="#local-6989586621679227242"><span class="hs-identifier hs-var">num_args</span></a><span> </span><a href="#local-6989586621679227244"><span class="hs-identifier hs-var">eqn</span></a><span class="hs-special">)</span><span>
</span><a name="line-637"></a><span class="hs-identifier">fixBug8884ForInstances</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679227245"><a href="#local-6989586621679227245"><span class="hs-identifier">dec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679227245"><span class="hs-identifier hs-var">dec</span></a><span>
</span><a name="line-638"></a><span>
</span><a name="line-639"></a><span class="hs-identifier">fixBug8884ForEqn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTySynEqn"><span class="hs-identifier hs-type">DTySynEqn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTySynEqn"><span class="hs-identifier hs-type">DTySynEqn</span></a><span>
</span><a name="line-640"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &lt; 708
</span><span class="hs-identifier">fixBug8884ForEqn</span><span> </span><span class="hs-identifier">num_args</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DTySynEqn</span><span> </span><span class="hs-identifier">lhs</span><span> </span><span class="hs-identifier">rhs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-642"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">lhs'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">drop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">lhs</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">num_args</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">lhs</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-643"></a><span>  </span><span class="hs-identifier">DTySynEqn</span><span> </span><span class="hs-identifier">lhs'</span><span> </span><span class="hs-identifier">rhs</span><span>
</span><a name="line-644"></a><span class="hs-cpp">#else
</span><a name="fixBug8884ForEqn"><a href="Language.Haskell.TH.Desugar.Core.html#fixBug8884ForEqn"><span class="hs-identifier">fixBug8884ForEqn</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-646"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-648"></a><span class="hs-comment">-- | Desugar arbitrary @Dec@s</span><span>
</span><a name="line-649"></a><span class="hs-identifier">dsDecs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226671"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226671"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DDec"><span class="hs-identifier hs-type">DDec</span></a><span class="hs-special">]</span><span>
</span><a name="line-650"></a><a name="dsDecs"><a href="Language.Haskell.TH.Desugar.Core.html#dsDecs"><span class="hs-identifier">dsDecs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDec"><span class="hs-identifier hs-var">dsDec</span></a><span>
</span><a name="line-651"></a><span>
</span><a name="line-652"></a><span class="hs-comment">-- | Desugar a single @Dec@, perhaps producing multiple 'DDec's</span><span>
</span><a name="line-653"></a><span class="hs-identifier">dsDec</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226670"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Dec</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226670"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DDec"><span class="hs-identifier hs-type">DDec</span></a><span class="hs-special">]</span><span>
</span><a name="line-654"></a><a name="dsDec"><a href="Language.Haskell.TH.Desugar.Core.html#dsDec"><span class="hs-identifier">dsDec</span></a></a><span> </span><a name="local-6989586621679227246"><a href="#local-6989586621679227246"><span class="hs-identifier">d</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">FunD</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span class="hs-special">)</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLetDec"><span class="hs-identifier hs-var">DLetDec</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsLetDec"><span class="hs-identifier hs-var">dsLetDec</span></a><span> </span><a href="#local-6989586621679227246"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-655"></a><span class="hs-identifier">dsDec</span><span> </span><a name="local-6989586621679227247"><a href="#local-6989586621679227247"><span class="hs-identifier">d</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">ValD</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span class="hs-special">)</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLetDec"><span class="hs-identifier hs-var">DLetDec</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsLetDec"><span class="hs-identifier hs-var">dsLetDec</span></a><span> </span><a href="#local-6989586621679227247"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-656"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DataD</span><span> </span><a name="local-6989586621679227248"><a href="#local-6989586621679227248"><span class="hs-identifier">cxt</span></a></a><span> </span><a name="local-6989586621679227249"><a href="#local-6989586621679227249"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679227250"><a href="#local-6989586621679227250"><span class="hs-identifier">tvbs</span></a></a><span> </span><a name="local-6989586621679227251"><a href="#local-6989586621679227251"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621679227252"><a href="#local-6989586621679227252"><span class="hs-identifier">cons</span></a></a><span> </span><a name="local-6989586621679227253"><a href="#local-6989586621679227253"><span class="hs-identifier">derivings</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-658"></a><span>  </span><a name="local-6989586621679227254"><a href="#local-6989586621679227254"><span class="hs-identifier">tvbs'</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsTvb"><span class="hs-identifier hs-var">dsTvb</span></a><span> </span><a href="#local-6989586621679227250"><span class="hs-identifier hs-var">tvbs</span></a><span>
</span><a name="line-659"></a><span>  </span><a name="local-6989586621679227255"><a href="#local-6989586621679227255"><span class="hs-identifier">all_tvbs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#nonFamilyDataTvbs"><span class="hs-identifier hs-var">nonFamilyDataTvbs</span></a><span> </span><a href="#local-6989586621679227254"><span class="hs-identifier hs-var">tvbs'</span></a><span> </span><a href="#local-6989586621679227251"><span class="hs-identifier hs-var">mk</span></a><span>
</span><a name="line-660"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679227256"><a href="#local-6989586621679227256"><span class="hs-identifier">data_type</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#nonFamilyDataReturnType"><span class="hs-identifier hs-var">nonFamilyDataReturnType</span></a><span> </span><a href="#local-6989586621679227249"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679227255"><span class="hs-identifier hs-var">all_tvbs</span></a><span>
</span><a name="line-661"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DDataD"><span class="hs-identifier hs-var">DDataD</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#Data"><span class="hs-identifier hs-var">Data</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsCxt"><span class="hs-identifier hs-var">dsCxt</span></a><span> </span><a href="#local-6989586621679227248"><span class="hs-identifier hs-var">cxt</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679227249"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-662"></a><span>                         </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679227254"><span class="hs-identifier hs-var">tvbs'</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227251"><span class="hs-identifier hs-var">mk</span></a><span>
</span><a name="line-663"></a><span>                         </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#dsCon"><span class="hs-identifier hs-var">dsCon</span></a><span> </span><a href="#local-6989586621679227254"><span class="hs-identifier hs-var">tvbs'</span></a><span> </span><a href="#local-6989586621679227256"><span class="hs-identifier hs-var">data_type</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679227252"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-664"></a><span>                         </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDerivClause"><span class="hs-identifier hs-var">dsDerivClause</span></a><span> </span><a href="#local-6989586621679227253"><span class="hs-identifier hs-var">derivings</span></a><span class="hs-special">)</span><span>
</span><a name="line-665"></a><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NewtypeD</span><span> </span><a name="local-6989586621679227257"><a href="#local-6989586621679227257"><span class="hs-identifier">cxt</span></a></a><span> </span><a name="local-6989586621679227258"><a href="#local-6989586621679227258"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679227259"><a href="#local-6989586621679227259"><span class="hs-identifier">tvbs</span></a></a><span> </span><a name="local-6989586621679227260"><a href="#local-6989586621679227260"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621679227261"><a href="#local-6989586621679227261"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621679227262"><a href="#local-6989586621679227262"><span class="hs-identifier">derivings</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-666"></a><span>  </span><a name="local-6989586621679227263"><a href="#local-6989586621679227263"><span class="hs-identifier">tvbs'</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsTvb"><span class="hs-identifier hs-var">dsTvb</span></a><span> </span><a href="#local-6989586621679227259"><span class="hs-identifier hs-var">tvbs</span></a><span>
</span><a name="line-667"></a><span>  </span><a name="local-6989586621679227264"><a href="#local-6989586621679227264"><span class="hs-identifier">all_tvbs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#nonFamilyDataTvbs"><span class="hs-identifier hs-var">nonFamilyDataTvbs</span></a><span> </span><a href="#local-6989586621679227263"><span class="hs-identifier hs-var">tvbs'</span></a><span> </span><a href="#local-6989586621679227260"><span class="hs-identifier hs-var">mk</span></a><span>
</span><a name="line-668"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679227265"><a href="#local-6989586621679227265"><span class="hs-identifier">data_type</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#nonFamilyDataReturnType"><span class="hs-identifier hs-var">nonFamilyDataReturnType</span></a><span> </span><a href="#local-6989586621679227258"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679227264"><span class="hs-identifier hs-var">all_tvbs</span></a><span>
</span><a name="line-669"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DDataD"><span class="hs-identifier hs-var">DDataD</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#Newtype"><span class="hs-identifier hs-var">Newtype</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsCxt"><span class="hs-identifier hs-var">dsCxt</span></a><span> </span><a href="#local-6989586621679227257"><span class="hs-identifier hs-var">cxt</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679227258"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-670"></a><span>                            </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679227263"><span class="hs-identifier hs-var">tvbs'</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227260"><span class="hs-identifier hs-var">mk</span></a><span>
</span><a name="line-671"></a><span>                            </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsCon"><span class="hs-identifier hs-var">dsCon</span></a><span> </span><a href="#local-6989586621679227263"><span class="hs-identifier hs-var">tvbs'</span></a><span> </span><a href="#local-6989586621679227265"><span class="hs-identifier hs-var">data_type</span></a><span> </span><a href="#local-6989586621679227261"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-672"></a><span>                            </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDerivClause"><span class="hs-identifier hs-var">dsDerivClause</span></a><span> </span><a href="#local-6989586621679227262"><span class="hs-identifier hs-var">derivings</span></a><span class="hs-special">)</span><span>
</span><a name="line-673"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DataD</span><span> </span><span class="hs-identifier">cxt</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">cons</span><span> </span><span class="hs-identifier">derivings</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-675"></a><span>  </span><span class="hs-identifier">tvbs'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">dsTvb</span><span> </span><span class="hs-identifier">tvbs</span><span>
</span><a name="line-676"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">data_type</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nonFamilyDataReturnType</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">tvbs'</span><span>
</span><a name="line-677"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DDataD</span><span> </span><span class="hs-identifier">Data</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">dsCxt</span><span> </span><span class="hs-identifier">cxt</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-678"></a><span>                         </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">tvbs'</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-679"></a><span>                         </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">concatMapM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">dsCon</span><span> </span><span class="hs-identifier">tvbs'</span><span> </span><span class="hs-identifier">data_type</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">cons</span><span>
</span><a name="line-680"></a><span>                         </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">dsDerivClause</span><span> </span><span class="hs-identifier">derivings</span><span class="hs-special">)</span><span>
</span><a name="line-681"></a><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NewtypeD</span><span> </span><span class="hs-identifier">cxt</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">con</span><span> </span><span class="hs-identifier">derivings</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-682"></a><span>  </span><span class="hs-identifier">tvbs'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">dsTvb</span><span> </span><span class="hs-identifier">tvbs</span><span>
</span><a name="line-683"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">data_type</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nonFamilyDataReturnType</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">tvbs'</span><span>
</span><a name="line-684"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DDataD</span><span> </span><span class="hs-identifier">Newtype</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">dsCxt</span><span> </span><span class="hs-identifier">cxt</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-685"></a><span>                            </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">tvbs'</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-686"></a><span>                            </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">dsCon</span><span> </span><span class="hs-identifier">tvbs'</span><span> </span><span class="hs-identifier">data_type</span><span> </span><span class="hs-identifier">con</span><span>
</span><a name="line-687"></a><span>                            </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">dsDerivClause</span><span> </span><span class="hs-identifier">derivings</span><span class="hs-special">)</span><span>
</span><a name="line-688"></a><span class="hs-cpp">#endif
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TySynD</span><span> </span><a name="local-6989586621679227266"><a href="#local-6989586621679227266"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679227267"><a href="#local-6989586621679227267"><span class="hs-identifier">tvbs</span></a></a><span> </span><a name="local-6989586621679227268"><a href="#local-6989586621679227268"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-690"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DTySynD"><span class="hs-identifier hs-var">DTySynD</span></a><span> </span><a href="#local-6989586621679227266"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsTvb"><span class="hs-identifier hs-var">dsTvb</span></a><span> </span><a href="#local-6989586621679227267"><span class="hs-identifier hs-var">tvbs</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227268"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-691"></a><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClassD</span><span> </span><a name="local-6989586621679227269"><a href="#local-6989586621679227269"><span class="hs-identifier">cxt</span></a></a><span> </span><a name="local-6989586621679227270"><a href="#local-6989586621679227270"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679227271"><a href="#local-6989586621679227271"><span class="hs-identifier">tvbs</span></a></a><span> </span><a name="local-6989586621679227272"><a href="#local-6989586621679227272"><span class="hs-identifier">fds</span></a></a><span> </span><a name="local-6989586621679227273"><a href="#local-6989586621679227273"><span class="hs-identifier">decs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-692"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DClassD"><span class="hs-identifier hs-var">DClassD</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsCxt"><span class="hs-identifier hs-var">dsCxt</span></a><span> </span><a href="#local-6989586621679227269"><span class="hs-identifier hs-var">cxt</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679227270"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsTvb"><span class="hs-identifier hs-var">dsTvb</span></a><span> </span><a href="#local-6989586621679227271"><span class="hs-identifier hs-var">tvbs</span></a><span>
</span><a name="line-693"></a><span>                     </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679227272"><span class="hs-identifier hs-var">fds</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDecs"><span class="hs-identifier hs-var">dsDecs</span></a><span> </span><a href="#local-6989586621679227273"><span class="hs-identifier hs-var">decs</span></a><span class="hs-special">)</span><span>
</span><a name="line-694"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 711
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InstanceD</span><span> </span><a name="local-6989586621679227274"><a href="#local-6989586621679227274"><span class="hs-identifier">over</span></a></a><span> </span><a name="local-6989586621679227275"><a href="#local-6989586621679227275"><span class="hs-identifier">cxt</span></a></a><span> </span><a name="local-6989586621679227276"><a href="#local-6989586621679227276"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679227277"><a href="#local-6989586621679227277"><span class="hs-identifier">decs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-696"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DInstanceD"><span class="hs-identifier hs-var">DInstanceD</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679227274"><span class="hs-identifier hs-var">over</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsCxt"><span class="hs-identifier hs-var">dsCxt</span></a><span> </span><a href="#local-6989586621679227275"><span class="hs-identifier hs-var">cxt</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227276"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDecs"><span class="hs-identifier hs-var">dsDecs</span></a><span> </span><a href="#local-6989586621679227277"><span class="hs-identifier hs-var">decs</span></a><span class="hs-special">)</span><span>
</span><a name="line-697"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">InstanceD</span><span> </span><span class="hs-identifier">cxt</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-identifier">decs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-699"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DInstanceD</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">dsCxt</span><span> </span><span class="hs-identifier">cxt</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">dsDecs</span><span> </span><span class="hs-identifier">decs</span><span class="hs-special">)</span><span>
</span><a name="line-700"></a><span class="hs-cpp">#endif
</span><span class="hs-identifier">dsDec</span><span> </span><a name="local-6989586621679227278"><a href="#local-6989586621679227278"><span class="hs-identifier">d</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigD</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span class="hs-special">)</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLetDec"><span class="hs-identifier hs-var">DLetDec</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsLetDec"><span class="hs-identifier hs-var">dsLetDec</span></a><span> </span><a href="#local-6989586621679227278"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-702"></a><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForeignD</span><span> </span><a name="local-6989586621679227279"><a href="#local-6989586621679227279"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DForeignD"><span class="hs-identifier hs-var">DForeignD</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsForeign"><span class="hs-identifier hs-var">dsForeign</span></a><span> </span><a href="#local-6989586621679227279"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-703"></a><span class="hs-identifier">dsDec</span><span> </span><a name="local-6989586621679227280"><a href="#local-6989586621679227280"><span class="hs-identifier">d</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixD</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span class="hs-special">)</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLetDec"><span class="hs-identifier hs-var">DLetDec</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsLetDec"><span class="hs-identifier hs-var">dsLetDec</span></a><span> </span><a href="#local-6989586621679227280"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-704"></a><span class="hs-identifier">dsDec</span><span> </span><a name="local-6989586621679227281"><a href="#local-6989586621679227281"><span class="hs-identifier">d</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">PragmaD</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span class="hs-special">)</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLetDec"><span class="hs-identifier hs-var">DLetDec</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsLetDec"><span class="hs-identifier hs-var">dsLetDec</span></a><span> </span><a href="#local-6989586621679227281"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-705"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OpenTypeFamilyD</span><span> </span><a name="local-6989586621679227282"><a href="#local-6989586621679227282"><span class="hs-identifier">tfHead</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-707"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DOpenTypeFamilyD"><span class="hs-identifier hs-var">DOpenTypeFamilyD</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsTypeFamilyHead"><span class="hs-identifier hs-var">dsTypeFamilyHead</span></a><span> </span><a href="#local-6989586621679227282"><span class="hs-identifier hs-var">tfHead</span></a><span class="hs-special">)</span><span>
</span><a name="line-708"></a><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DataFamilyD</span><span> </span><a name="local-6989586621679227283"><a href="#local-6989586621679227283"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679227284"><a href="#local-6989586621679227284"><span class="hs-identifier">tvbs</span></a></a><span> </span><a name="local-6989586621679227285"><a href="#local-6989586621679227285"><span class="hs-identifier">m_k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-709"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DDataFamilyD"><span class="hs-identifier hs-var">DDataFamilyD</span></a><span> </span><a href="#local-6989586621679227283"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsTvb"><span class="hs-identifier hs-var">dsTvb</span></a><span> </span><a href="#local-6989586621679227284"><span class="hs-identifier hs-var">tvbs</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227285"><span class="hs-identifier hs-var">m_k</span></a><span class="hs-special">)</span><span>
</span><a name="line-710"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">FamilyD</span><span> </span><span class="hs-identifier">TypeFam</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">m_k</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-712"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DOpenTypeFamilyD</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">dsTypeFamilyHead</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">m_k</span><span class="hs-special">)</span><span>
</span><a name="line-713"></a><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">FamilyD</span><span> </span><span class="hs-identifier">DataFam</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">m_k</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-714"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DDataFamilyD</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">dsTvb</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier">m_k</span><span class="hs-special">)</span><span>
</span><a name="line-715"></a><span class="hs-cpp">#endif
#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DataInstD</span><span> </span><a name="local-6989586621679227286"><a href="#local-6989586621679227286"><span class="hs-identifier">cxt</span></a></a><span> </span><a name="local-6989586621679227287"><a href="#local-6989586621679227287"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679227288"><a href="#local-6989586621679227288"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-6989586621679227289"><a href="#local-6989586621679227289"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621679227290"><a href="#local-6989586621679227290"><span class="hs-identifier">cons</span></a></a><span> </span><a name="local-6989586621679227291"><a href="#local-6989586621679227291"><span class="hs-identifier">derivings</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-718"></a><span>  </span><a name="local-6989586621679227292"><a href="#local-6989586621679227292"><span class="hs-identifier">tys'</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227288"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-719"></a><span>  </span><a name="local-6989586621679227293"><a href="#local-6989586621679227293"><span class="hs-identifier">all_tys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dataFamInstTypes"><span class="hs-identifier hs-var">dataFamInstTypes</span></a><span> </span><a href="#local-6989586621679227292"><span class="hs-identifier hs-var">tys'</span></a><span> </span><a href="#local-6989586621679227289"><span class="hs-identifier hs-var">mk</span></a><span>
</span><a name="line-720"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679227294"><a href="#local-6989586621679227294"><span class="hs-identifier">tvbs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dataFamInstTvbs"><span class="hs-identifier hs-var">dataFamInstTvbs</span></a><span> </span><a href="#local-6989586621679227293"><span class="hs-identifier hs-var">all_tys</span></a><span>
</span><a name="line-721"></a><span>      </span><a name="local-6989586621679227295"><a href="#local-6989586621679227295"><span class="hs-identifier">fam_inst_type</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dataFamInstReturnType"><span class="hs-identifier hs-var">dataFamInstReturnType</span></a><span> </span><a href="#local-6989586621679227287"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679227293"><span class="hs-identifier hs-var">all_tys</span></a><span>
</span><a name="line-722"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DDataInstD"><span class="hs-identifier hs-var">DDataInstD</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#Data"><span class="hs-identifier hs-var">Data</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsCxt"><span class="hs-identifier hs-var">dsCxt</span></a><span> </span><a href="#local-6989586621679227286"><span class="hs-identifier hs-var">cxt</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679227287"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-723"></a><span>                             </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679227292"><span class="hs-identifier hs-var">tys'</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227289"><span class="hs-identifier hs-var">mk</span></a><span>
</span><a name="line-724"></a><span>                             </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#dsCon"><span class="hs-identifier hs-var">dsCon</span></a><span> </span><a href="#local-6989586621679227294"><span class="hs-identifier hs-var">tvbs</span></a><span> </span><a href="#local-6989586621679227295"><span class="hs-identifier hs-var">fam_inst_type</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679227290"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-725"></a><span>                             </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDerivClause"><span class="hs-identifier hs-var">dsDerivClause</span></a><span> </span><a href="#local-6989586621679227291"><span class="hs-identifier hs-var">derivings</span></a><span class="hs-special">)</span><span>
</span><a name="line-726"></a><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NewtypeInstD</span><span> </span><a name="local-6989586621679227296"><a href="#local-6989586621679227296"><span class="hs-identifier">cxt</span></a></a><span> </span><a name="local-6989586621679227297"><a href="#local-6989586621679227297"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679227298"><a href="#local-6989586621679227298"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-6989586621679227299"><a href="#local-6989586621679227299"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621679227300"><a href="#local-6989586621679227300"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621679227301"><a href="#local-6989586621679227301"><span class="hs-identifier">derivings</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-727"></a><span>  </span><a name="local-6989586621679227302"><a href="#local-6989586621679227302"><span class="hs-identifier">tys'</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227298"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-728"></a><span>  </span><a name="local-6989586621679227303"><a href="#local-6989586621679227303"><span class="hs-identifier">all_tys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dataFamInstTypes"><span class="hs-identifier hs-var">dataFamInstTypes</span></a><span> </span><a href="#local-6989586621679227302"><span class="hs-identifier hs-var">tys'</span></a><span> </span><a href="#local-6989586621679227299"><span class="hs-identifier hs-var">mk</span></a><span>
</span><a name="line-729"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679227304"><a href="#local-6989586621679227304"><span class="hs-identifier">tvbs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dataFamInstTvbs"><span class="hs-identifier hs-var">dataFamInstTvbs</span></a><span> </span><a href="#local-6989586621679227303"><span class="hs-identifier hs-var">all_tys</span></a><span>
</span><a name="line-730"></a><span>      </span><a name="local-6989586621679227305"><a href="#local-6989586621679227305"><span class="hs-identifier">fam_inst_type</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dataFamInstReturnType"><span class="hs-identifier hs-var">dataFamInstReturnType</span></a><span> </span><a href="#local-6989586621679227297"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679227303"><span class="hs-identifier hs-var">all_tys</span></a><span>
</span><a name="line-731"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DDataInstD"><span class="hs-identifier hs-var">DDataInstD</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#Newtype"><span class="hs-identifier hs-var">Newtype</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsCxt"><span class="hs-identifier hs-var">dsCxt</span></a><span> </span><a href="#local-6989586621679227296"><span class="hs-identifier hs-var">cxt</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679227297"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-732"></a><span>                                </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679227302"><span class="hs-identifier hs-var">tys'</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227299"><span class="hs-identifier hs-var">mk</span></a><span>
</span><a name="line-733"></a><span>                                </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsCon"><span class="hs-identifier hs-var">dsCon</span></a><span> </span><a href="#local-6989586621679227304"><span class="hs-identifier hs-var">tvbs</span></a><span> </span><a href="#local-6989586621679227305"><span class="hs-identifier hs-var">fam_inst_type</span></a><span> </span><a href="#local-6989586621679227300"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-734"></a><span>                                </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDerivClause"><span class="hs-identifier hs-var">dsDerivClause</span></a><span> </span><a href="#local-6989586621679227301"><span class="hs-identifier hs-var">derivings</span></a><span class="hs-special">)</span><span>
</span><a name="line-735"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DataInstD</span><span> </span><span class="hs-identifier">cxt</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-identifier">cons</span><span> </span><span class="hs-identifier">derivings</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-737"></a><span>  </span><span class="hs-identifier">tys'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier">tys</span><span>
</span><a name="line-738"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dataFamInstTvbs</span><span> </span><span class="hs-identifier">tys'</span><span>
</span><a name="line-739"></a><span>      </span><span class="hs-identifier">fam_inst_type</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dataFamInstReturnType</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">tys'</span><span>
</span><a name="line-740"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DDataInstD</span><span> </span><span class="hs-identifier">Data</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">dsCxt</span><span> </span><span class="hs-identifier">cxt</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-741"></a><span>                             </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">tys'</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-742"></a><span>                             </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">concatMapM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">dsCon</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">fam_inst_type</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">cons</span><span>
</span><a name="line-743"></a><span>                             </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">dsDerivClause</span><span> </span><span class="hs-identifier">derivings</span><span class="hs-special">)</span><span>
</span><a name="line-744"></a><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NewtypeInstD</span><span> </span><span class="hs-identifier">cxt</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-identifier">con</span><span> </span><span class="hs-identifier">derivings</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-745"></a><span>  </span><span class="hs-identifier">tys'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier">tys</span><span>
</span><a name="line-746"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dataFamInstTvbs</span><span> </span><span class="hs-identifier">tys'</span><span>
</span><a name="line-747"></a><span>      </span><span class="hs-identifier">fam_inst_type</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dataFamInstReturnType</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">tys'</span><span>
</span><a name="line-748"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DDataInstD</span><span> </span><span class="hs-identifier">Newtype</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">dsCxt</span><span> </span><span class="hs-identifier">cxt</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-749"></a><span>                                </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">tys'</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-750"></a><span>                                </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">dsCon</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">fam_inst_type</span><span> </span><span class="hs-identifier">con</span><span>
</span><a name="line-751"></a><span>                                </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">dsDerivClause</span><span> </span><span class="hs-identifier">derivings</span><span class="hs-special">)</span><span>
</span><a name="line-752"></a><span class="hs-cpp">#endif
#if __GLASGOW_HASKELL__ &lt; 707
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TySynInstD</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">lhs</span><span> </span><span class="hs-identifier">rhs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DTySynInstD</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span>
</span><a name="line-755"></a><span>                                          </span><span class="hs-special">(</span><span class="hs-identifier">DTySynEqn</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier">lhs</span><span>
</span><a name="line-756"></a><span>                                                     </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier">rhs</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-757"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TySynInstD</span><span> </span><a name="local-6989586621679227306"><a href="#local-6989586621679227306"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679227307"><a href="#local-6989586621679227307"><span class="hs-identifier">eqn</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DTySynInstD"><span class="hs-identifier hs-var">DTySynInstD</span></a><span> </span><a href="#local-6989586621679227306"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsTySynEqn"><span class="hs-identifier hs-var">dsTySynEqn</span></a><span> </span><a href="#local-6989586621679227307"><span class="hs-identifier hs-var">eqn</span></a><span class="hs-special">)</span><span>
</span><a name="line-759"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClosedTypeFamilyD</span><span> </span><a name="local-6989586621679227308"><a href="#local-6989586621679227308"><span class="hs-identifier">tfHead</span></a></a><span> </span><a name="local-6989586621679227309"><a href="#local-6989586621679227309"><span class="hs-identifier">eqns</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-761"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DClosedTypeFamilyD"><span class="hs-identifier hs-var">DClosedTypeFamilyD</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsTypeFamilyHead"><span class="hs-identifier hs-var">dsTypeFamilyHead</span></a><span> </span><a href="#local-6989586621679227308"><span class="hs-identifier hs-var">tfHead</span></a><span>
</span><a name="line-762"></a><span>                                </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsTySynEqn"><span class="hs-identifier hs-var">dsTySynEqn</span></a><span> </span><a href="#local-6989586621679227309"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">)</span><span>
</span><a name="line-763"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ClosedTypeFamilyD</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">m_k</span><span> </span><span class="hs-identifier">eqns</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-765"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DClosedTypeFamilyD</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">dsTypeFamilyHead</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">m_k</span><span>
</span><a name="line-766"></a><span>                                </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">dsTySynEqn</span><span> </span><span class="hs-identifier">eqns</span><span class="hs-special">)</span><span>
</span><a name="line-767"></a><span class="hs-cpp">#endif
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RoleAnnotD</span><span> </span><a name="local-6989586621679227310"><a href="#local-6989586621679227310"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679227311"><a href="#local-6989586621679227311"><span class="hs-identifier">roles</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DRoleAnnotD"><span class="hs-identifier hs-var">DRoleAnnotD</span></a><span> </span><a href="#local-6989586621679227310"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679227311"><span class="hs-identifier hs-var">roles</span></a><span class="hs-special">]</span><span>
</span><a name="line-769"></a><span class="hs-cpp">#endif
#if __GLASGOW_HASKELL__ &gt;= 709
#if __GLASGOW_HASKELL__ &gt;= 801
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynD</span><span> </span><a name="local-6989586621679227312"><a href="#local-6989586621679227312"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679227313"><a href="#local-6989586621679227313"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679227314"><a href="#local-6989586621679227314"><span class="hs-identifier">dir</span></a></a><span> </span><a name="local-6989586621679227315"><a href="#local-6989586621679227315"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-773"></a><span>  </span><a name="local-6989586621679227316"><a href="#local-6989586621679227316"><span class="hs-identifier">dir'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPatSynDir"><span class="hs-identifier hs-var">dsPatSynDir</span></a><span> </span><a href="#local-6989586621679227312"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679227314"><span class="hs-identifier hs-var">dir</span></a><span>
</span><a name="line-774"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679227317"><a href="#local-6989586621679227317"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679227318"><a href="#local-6989586621679227318"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPatX"><span class="hs-identifier hs-var">dsPatX</span></a><span> </span><a href="#local-6989586621679227315"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-775"></a><span>  </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679227318"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-776"></a><span>    </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Pattern synonym definition cannot contain as-patterns (@).&quot;</span><span>
</span><a name="line-777"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DPatSynD"><span class="hs-identifier hs-var">DPatSynD</span></a><span> </span><a href="#local-6989586621679227312"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679227313"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621679227316"><span class="hs-identifier hs-var">dir'</span></a><span> </span><a href="#local-6989586621679227317"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">]</span><span>
</span><a name="line-778"></a><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynSigD</span><span> </span><a name="local-6989586621679227319"><a href="#local-6989586621679227319"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679227320"><a href="#local-6989586621679227320"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DPatSynSigD"><span class="hs-identifier hs-var">DPatSynSigD</span></a><span> </span><a href="#local-6989586621679227319"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227320"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-779"></a><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">StandaloneDerivD</span><span> </span><a name="local-6989586621679227321"><a href="#local-6989586621679227321"><span class="hs-identifier">mds</span></a></a><span> </span><a name="local-6989586621679227322"><a href="#local-6989586621679227322"><span class="hs-identifier">cxt</span></a></a><span> </span><a name="local-6989586621679227323"><a href="#local-6989586621679227323"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-780"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DStandaloneDerivD"><span class="hs-identifier hs-var">DStandaloneDerivD</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDerivStrategy"><span class="hs-identifier hs-var">dsDerivStrategy</span></a><span> </span><a href="#local-6989586621679227321"><span class="hs-identifier hs-var">mds</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsCxt"><span class="hs-identifier hs-var">dsCxt</span></a><span> </span><a href="#local-6989586621679227322"><span class="hs-identifier hs-var">cxt</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227323"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-781"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">StandaloneDerivD</span><span> </span><span class="hs-identifier">cxt</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-783"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DStandaloneDerivD</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">dsCxt</span><span> </span><span class="hs-identifier">cxt</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span>
</span><a name="line-784"></a><span class="hs-cpp">#endif
</span><span class="hs-identifier">dsDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DefaultSigD</span><span> </span><a name="local-6989586621679227324"><a href="#local-6989586621679227324"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679227325"><a href="#local-6989586621679227325"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DDefaultSigD"><span class="hs-identifier hs-var">DDefaultSigD</span></a><span> </span><a href="#local-6989586621679227324"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227325"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-786"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-788"></a><span class="hs-comment">-- Like mkExtraDKindBinders, but accepts a Maybe Kind</span><span>
</span><a name="line-789"></a><span class="hs-comment">-- argument instead of DKind.</span><span>
</span><a name="line-790"></a><span class="hs-identifier">mkExtraKindBinders</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226669"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Kind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226669"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DTyVarBndr"><span class="hs-identifier hs-type">DTyVarBndr</span></a><span class="hs-special">]</span><span>
</span><a name="line-791"></a><a name="mkExtraKindBinders"><a href="Language.Haskell.TH.Desugar.Core.html#mkExtraKindBinders"><span class="hs-identifier">mkExtraKindBinders</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-792"></a><span>  </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#typeKindName"><span class="hs-identifier hs-var">typeKindName</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">runQ</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">expandSyns</span><span> </span><span class="hs-operator hs-var">&gt;=&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;=&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#mkExtraDKindBinders%27"><span class="hs-identifier hs-var">mkExtraDKindBinders'</span></a><span>
</span><a name="line-793"></a><span>
</span><a name="line-794"></a><span class="hs-comment">-- | Like mkExtraDKindBinders, but assumes kind synonyms have been expanded.</span><span>
</span><a name="line-795"></a><span class="hs-identifier">mkExtraDKindBinders'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Quasi</span><span> </span><a href="#local-6989586621679226668"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DKind"><span class="hs-identifier hs-type">DKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226668"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DTyVarBndr"><span class="hs-identifier hs-type">DTyVarBndr</span></a><span class="hs-special">]</span><span>
</span><a name="line-796"></a><a name="mkExtraDKindBinders%27"><a href="Language.Haskell.TH.Desugar.Core.html#mkExtraDKindBinders%27"><span class="hs-identifier">mkExtraDKindBinders'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#mkExtraKindBindersGeneric"><span class="hs-identifier hs-var">mkExtraKindBindersGeneric</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#unravel"><span class="hs-identifier hs-var">unravel</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DKindedTV"><span class="hs-identifier hs-var">DKindedTV</span></a><span>
</span><a name="line-797"></a><span>
</span><a name="line-798"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="hs-comment">-- | Desugar a @FamilyResultSig@</span><span>
</span><a name="line-800"></a><span class="hs-identifier">dsFamilyResultSig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226667"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">FamilyResultSig</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226667"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DFamilyResultSig"><span class="hs-identifier hs-type">DFamilyResultSig</span></a><span>
</span><a name="line-801"></a><a name="dsFamilyResultSig"><a href="Language.Haskell.TH.Desugar.Core.html#dsFamilyResultSig"><span class="hs-identifier">dsFamilyResultSig</span></a></a><span> </span><span class="hs-identifier hs-var">NoSig</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DNoSig"><span class="hs-identifier hs-var">DNoSig</span></a><span>
</span><a name="line-802"></a><span class="hs-identifier">dsFamilyResultSig</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">KindSig</span><span> </span><a name="local-6989586621679227326"><a href="#local-6989586621679227326"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DKindSig"><span class="hs-identifier hs-var">DKindSig</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679227326"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-803"></a><span class="hs-identifier">dsFamilyResultSig</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TyVarSig</span><span> </span><a name="local-6989586621679227327"><a href="#local-6989586621679227327"><span class="hs-identifier">tvb</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTyVarSig"><span class="hs-identifier hs-var">DTyVarSig</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsTvb"><span class="hs-identifier hs-var">dsTvb</span></a><span> </span><a href="#local-6989586621679227327"><span class="hs-identifier hs-var">tvb</span></a><span>
</span><a name="line-804"></a><span>
</span><a name="line-805"></a><span class="hs-comment">-- | Desugar a @TypeFamilyHead@</span><span>
</span><a name="line-806"></a><span class="hs-identifier">dsTypeFamilyHead</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226666"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">TypeFamilyHead</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226666"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTypeFamilyHead"><span class="hs-identifier hs-type">DTypeFamilyHead</span></a><span>
</span><a name="line-807"></a><a name="dsTypeFamilyHead"><a href="Language.Haskell.TH.Desugar.Core.html#dsTypeFamilyHead"><span class="hs-identifier">dsTypeFamilyHead</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeFamilyHead</span><span> </span><a name="local-6989586621679227328"><a href="#local-6989586621679227328"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679227329"><a href="#local-6989586621679227329"><span class="hs-identifier">tvbs</span></a></a><span> </span><a name="local-6989586621679227330"><a href="#local-6989586621679227330"><span class="hs-identifier">result</span></a></a><span> </span><a name="local-6989586621679227331"><a href="#local-6989586621679227331"><span class="hs-identifier">inj</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-808"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTypeFamilyHead"><span class="hs-identifier hs-var">DTypeFamilyHead</span></a><span> </span><a href="#local-6989586621679227328"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsTvb"><span class="hs-identifier hs-var">dsTvb</span></a><span> </span><a href="#local-6989586621679227329"><span class="hs-identifier hs-var">tvbs</span></a><span>
</span><a name="line-809"></a><span>                      </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsFamilyResultSig"><span class="hs-identifier hs-var">dsFamilyResultSig</span></a><span> </span><a href="#local-6989586621679227330"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-810"></a><span>                      </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679227331"><span class="hs-identifier hs-var">inj</span></a><span>
</span><a name="line-811"></a><span class="hs-cpp">#else
</span><span class="hs-comment">-- | Desugar bits and pieces into a 'DTypeFamilyHead'</span><span>
</span><a name="line-813"></a><span class="hs-identifier">dsTypeFamilyHead</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">DsMonad</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-814"></a><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">TyVarBndr</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Kind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-identifier">DTypeFamilyHead</span><span>
</span><a name="line-815"></a><span class="hs-identifier">dsTypeFamilyHead</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">m_kind</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-816"></a><span>  </span><span class="hs-identifier">result_sig</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">m_kind</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-817"></a><span>    </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">DNoSig</span><span>
</span><a name="line-818"></a><span>    </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">k</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">DKindSig</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier">k</span><span>
</span><a name="line-819"></a><span>  </span><span class="hs-identifier">DTypeFamilyHead</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">dsTvb</span><span> </span><span class="hs-identifier">tvbs</span><span>
</span><a name="line-820"></a><span>                    </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">result_sig</span><span>
</span><a name="line-821"></a><span>                    </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-822"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-824"></a><span class="hs-comment">-- | Desugar @Dec@s that can appear in a let expression</span><span>
</span><a name="line-825"></a><span class="hs-identifier">dsLetDecs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226665"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226665"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DLetDec"><span class="hs-identifier hs-type">DLetDec</span></a><span class="hs-special">]</span><span>
</span><a name="line-826"></a><a name="dsLetDecs"><a href="Language.Haskell.TH.Desugar.Core.html#dsLetDecs"><span class="hs-identifier">dsLetDecs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsLetDec"><span class="hs-identifier hs-var">dsLetDec</span></a><span>
</span><a name="line-827"></a><span>
</span><a name="line-828"></a><span class="hs-comment">-- | Desugar a single @Dec@, perhaps producing multiple 'DLetDec's</span><span>
</span><a name="line-829"></a><span class="hs-identifier">dsLetDec</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226664"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Dec</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226664"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DLetDec"><span class="hs-identifier hs-type">DLetDec</span></a><span class="hs-special">]</span><span>
</span><a name="line-830"></a><a name="dsLetDec"><a href="Language.Haskell.TH.Desugar.Core.html#dsLetDec"><span class="hs-identifier">dsLetDec</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FunD</span><span> </span><a name="local-6989586621679227332"><a href="#local-6989586621679227332"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679227333"><a href="#local-6989586621679227333"><span class="hs-identifier">clauses</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-831"></a><span>  </span><a name="local-6989586621679227334"><a href="#local-6989586621679227334"><span class="hs-identifier">clauses'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsClauses"><span class="hs-identifier hs-var">dsClauses</span></a><span> </span><a href="#local-6989586621679227332"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679227333"><span class="hs-identifier hs-var">clauses</span></a><span>
</span><a name="line-832"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DFunD"><span class="hs-identifier hs-var">DFunD</span></a><span> </span><a href="#local-6989586621679227332"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679227334"><span class="hs-identifier hs-var">clauses'</span></a><span class="hs-special">]</span><span>
</span><a name="line-833"></a><span class="hs-identifier">dsLetDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ValD</span><span> </span><a name="local-6989586621679227335"><a href="#local-6989586621679227335"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679227336"><a href="#local-6989586621679227336"><span class="hs-identifier">body</span></a></a><span> </span><a name="local-6989586621679227337"><a href="#local-6989586621679227337"><span class="hs-identifier">where_decs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-834"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679228295"><a href="#local-6989586621679228295"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228296"><a href="#local-6989586621679228296"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPatX"><span class="hs-identifier hs-var">dsPatX</span></a><span> </span><a href="#local-6989586621679227335"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-835"></a><span>  </span><a name="local-6989586621679228297"><a href="#local-6989586621679228297"><span class="hs-identifier">body'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsBody"><span class="hs-identifier hs-var">dsBody</span></a><span> </span><a href="#local-6989586621679227336"><span class="hs-identifier hs-var">body</span></a><span> </span><a href="#local-6989586621679227337"><span class="hs-identifier hs-var">where_decs</span></a><span> </span><a href="#local-6989586621679227338"><span class="hs-identifier hs-var">error_exp</span></a><span>
</span><a name="line-836"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679228298"><a href="#local-6989586621679228298"><span class="hs-identifier">extras</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DValD"><span class="hs-identifier hs-var">DValD</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><a href="#local-6989586621679228296"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-837"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DValD"><span class="hs-identifier hs-var">DValD</span></a><span> </span><a href="#local-6989586621679228295"><span class="hs-identifier hs-var">pat'</span></a><span> </span><a href="#local-6989586621679228297"><span class="hs-identifier hs-var">body'</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679228298"><span class="hs-identifier hs-var">extras</span></a><span>
</span><a name="line-838"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-839"></a><span>    </span><a name="local-6989586621679227338"><a href="#local-6989586621679227338"><span class="hs-identifier">error_exp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">error</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitE"><span class="hs-identifier hs-var">DLitE</span></a><span>
</span><a name="line-840"></a><span>                       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">StringL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Non-exhaustive patterns for &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">pprint</span><span> </span><a href="#local-6989586621679227335"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-841"></a><span class="hs-identifier">dsLetDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigD</span><span> </span><a name="local-6989586621679228299"><a href="#local-6989586621679228299"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679228300"><a href="#local-6989586621679228300"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-842"></a><span>  </span><a name="local-6989586621679228301"><a href="#local-6989586621679228301"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228300"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-843"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DSigD"><span class="hs-identifier hs-var">DSigD</span></a><span> </span><a href="#local-6989586621679228299"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679228301"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">]</span><span>
</span><a name="line-844"></a><span class="hs-identifier">dsLetDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixD</span><span> </span><a name="local-6989586621679228302"><a href="#local-6989586621679228302"><span class="hs-identifier">fixity</span></a></a><span> </span><a name="local-6989586621679228303"><a href="#local-6989586621679228303"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DInfixD"><span class="hs-identifier hs-var">DInfixD</span></a><span> </span><a href="#local-6989586621679228302"><span class="hs-identifier hs-var">fixity</span></a><span> </span><a href="#local-6989586621679228303"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span>
</span><a name="line-845"></a><span class="hs-identifier">dsLetDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PragmaD</span><span> </span><a name="local-6989586621679228304"><a href="#local-6989586621679228304"><span class="hs-identifier">prag</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DPragmaD"><span class="hs-identifier hs-var">DPragmaD</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPragma"><span class="hs-identifier hs-var">dsPragma</span></a><span> </span><a href="#local-6989586621679228304"><span class="hs-identifier hs-var">prag</span></a><span class="hs-special">)</span><span>
</span><a name="line-846"></a><span class="hs-identifier">dsLetDec</span><span> </span><a name="local-6989586621679228305"><a href="#local-6989586621679228305"><span class="hs-identifier">_dec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;Illegal declaration in let expression.&quot;</span><span>
</span><a name="line-847"></a><span>
</span><a name="line-848"></a><span class="hs-comment">-- | Desugar a single @Con@.</span><span>
</span><a name="line-849"></a><span class="hs-comment">--</span><span>
</span><a name="line-850"></a><span class="hs-comment">-- Because we always desugar @Con@s to GADT syntax (see the documentation for</span><span>
</span><a name="line-851"></a><span class="hs-comment">-- 'DCon'), it is not always possible to desugar with just a 'Con' alone.</span><span>
</span><a name="line-852"></a><span class="hs-comment">-- For instance, we must desugar:</span><span>
</span><a name="line-853"></a><span class="hs-comment">--</span><span>
</span><a name="line-854"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-855"></a><span class="hs-comment">-- data Foo a = forall b. MkFoo b</span><span>
</span><a name="line-856"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-857"></a><span class="hs-comment">--</span><span>
</span><a name="line-858"></a><span class="hs-comment">-- To this:</span><span>
</span><a name="line-859"></a><span class="hs-comment">--</span><span>
</span><a name="line-860"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-861"></a><span class="hs-comment">-- data Foo a :: Type where</span><span>
</span><a name="line-862"></a><span class="hs-comment">--   MkFoo :: forall a b. b -&gt; Foo a</span><span>
</span><a name="line-863"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-864"></a><span class="hs-comment">--</span><span>
</span><a name="line-865"></a><span class="hs-comment">-- If our only argument was @forall b. MkFoo b@, it would be somewhat awkward</span><span>
</span><a name="line-866"></a><span class="hs-comment">-- to figure out (1) what the set of universally quantified type variables</span><span>
</span><a name="line-867"></a><span class="hs-comment">-- (@[a]@) was, and (2) what the return type (@Foo a@) was. For this reason,</span><span>
</span><a name="line-868"></a><span class="hs-comment">-- we require passing these as arguments. (If we desugar an actual GADT</span><span>
</span><a name="line-869"></a><span class="hs-comment">-- constructor, these arguments are ignored.)</span><span>
</span><a name="line-870"></a><span class="hs-identifier">dsCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226663"><span class="hs-identifier hs-type">q</span></a><span>
</span><a name="line-871"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DTyVarBndr"><span class="hs-identifier hs-type">DTyVarBndr</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ The universally quantified type variables</span><span>
</span><a name="line-872"></a><span>                      </span><span class="hs-comment">--   (used if desugaring a non-GADT constructor).</span><span>
</span><a name="line-873"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span>        </span><span class="hs-comment">-- ^ The original data declaration's type</span><span>
</span><a name="line-874"></a><span>                      </span><span class="hs-comment">--   (used if desugaring a non-GADT constructor).</span><span>
</span><a name="line-875"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Con</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226663"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DCon"><span class="hs-identifier hs-type">DCon</span></a><span class="hs-special">]</span><span>
</span><a name="line-876"></a><a name="dsCon"><a href="Language.Haskell.TH.Desugar.Core.html#dsCon"><span class="hs-identifier">dsCon</span></a></a><span> </span><a name="local-6989586621679228306"><a href="#local-6989586621679228306"><span class="hs-identifier">univ_dtvbs</span></a></a><span> </span><a name="local-6989586621679228307"><a href="#local-6989586621679228307"><span class="hs-identifier">data_type</span></a></a><span> </span><a name="local-6989586621679228308"><a href="#local-6989586621679228308"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-877"></a><span>  </span><a name="local-6989586621679228309"><a href="#local-6989586621679228309"><span class="hs-identifier">dcons'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsCon%27"><span class="hs-identifier hs-var">dsCon'</span></a><span> </span><a href="#local-6989586621679228308"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-878"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679228309"><span class="hs-identifier hs-var">dcons'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679228310"><a href="#local-6989586621679228310"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228311"><a href="#local-6989586621679228311"><span class="hs-identifier">dtvbs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228312"><a href="#local-6989586621679228312"><span class="hs-identifier">dcxt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228313"><a href="#local-6989586621679228313"><span class="hs-identifier">fields</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228314"><a href="#local-6989586621679228314"><span class="hs-identifier">m_gadt_type</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-879"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679228314"><span class="hs-identifier hs-var">m_gadt_type</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-880"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-881"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679228315"><a href="#local-6989586621679228315"><span class="hs-identifier">ex_dtvbs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679228311"><span class="hs-identifier hs-var">dtvbs</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-882"></a><span>        </span><a href="Language.Haskell.TH.Desugar.AST.html#DCon"><span class="hs-identifier hs-var">DCon</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679228306"><span class="hs-identifier hs-var">univ_dtvbs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679228315"><span class="hs-identifier hs-var">ex_dtvbs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679228312"><span class="hs-identifier hs-var">dcxt</span></a><span> </span><a href="#local-6989586621679228310"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679228313"><span class="hs-identifier hs-var">fields</span></a><span> </span><a href="#local-6989586621679228307"><span class="hs-identifier hs-var">data_type</span></a><span>
</span><a name="line-883"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679228316"><a href="#local-6989586621679228316"><span class="hs-identifier">gadt_type</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-884"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679228317"><a href="#local-6989586621679228317"><span class="hs-identifier">univ_ex_dtvbs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679228311"><span class="hs-identifier hs-var">dtvbs</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-885"></a><span>        </span><a href="Language.Haskell.TH.Desugar.AST.html#DCon"><span class="hs-identifier hs-var">DCon</span></a><span> </span><a href="#local-6989586621679228317"><span class="hs-identifier hs-var">univ_ex_dtvbs</span></a><span> </span><a href="#local-6989586621679228312"><span class="hs-identifier hs-var">dcxt</span></a><span> </span><a href="#local-6989586621679228310"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679228313"><span class="hs-identifier hs-var">fields</span></a><span> </span><a href="#local-6989586621679228316"><span class="hs-identifier hs-var">gadt_type</span></a><span>
</span><a name="line-886"></a><span>
</span><a name="line-887"></a><span class="hs-comment">-- Desugar a Con in isolation. The meaning of the returned DTyVarBndrs changes</span><span>
</span><a name="line-888"></a><span class="hs-comment">-- depending on what the returned Maybe DType value is:</span><span>
</span><a name="line-889"></a><span class="hs-comment">--</span><span>
</span><a name="line-890"></a><span class="hs-comment">-- * If returning Just gadt_ty, then we've encountered a GadtC or RecGadtC,</span><span>
</span><a name="line-891"></a><span class="hs-comment">--   so the returned DTyVarBndrs are both the universally and existentially</span><span>
</span><a name="line-892"></a><span class="hs-comment">--   quantified tyvars.</span><span>
</span><a name="line-893"></a><span class="hs-comment">-- * If returning Nothing, we're dealing with a non-GADT constructor, so</span><span>
</span><a name="line-894"></a><span class="hs-comment">--   the returned DTyVarBndrs are the existentials only.</span><span>
</span><a name="line-895"></a><span class="hs-identifier">dsCon'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226662"><span class="hs-identifier hs-type">q</span></a><span>
</span><a name="line-896"></a><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Con</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226662"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DTyVarBndr"><span class="hs-identifier hs-type">DTyVarBndr</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DCxt"><span class="hs-identifier hs-type">DCxt</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConFields"><span class="hs-identifier hs-type">DConFields</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-897"></a><a name="dsCon%27"><a href="Language.Haskell.TH.Desugar.Core.html#dsCon%27"><span class="hs-identifier">dsCon'</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NormalC</span><span> </span><a name="local-6989586621679228318"><a href="#local-6989586621679228318"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679228319"><a href="#local-6989586621679228319"><span class="hs-identifier">stys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-898"></a><span>  </span><a name="local-6989586621679228320"><a href="#local-6989586621679228320"><span class="hs-identifier">dtys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsBangType"><span class="hs-identifier hs-var">dsBangType</span></a><span> </span><a href="#local-6989586621679228319"><span class="hs-identifier hs-var">stys</span></a><span>
</span><a name="line-899"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679228318"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DNormalC"><span class="hs-identifier hs-var">DNormalC</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621679228320"><span class="hs-identifier hs-var">dtys</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-900"></a><span class="hs-identifier">dsCon'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecC</span><span> </span><a name="local-6989586621679228321"><a href="#local-6989586621679228321"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679228322"><a href="#local-6989586621679228322"><span class="hs-identifier">vstys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-901"></a><span>  </span><a name="local-6989586621679228323"><a href="#local-6989586621679228323"><span class="hs-identifier">vdtys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsVarBangType"><span class="hs-identifier hs-var">dsVarBangType</span></a><span> </span><a href="#local-6989586621679228322"><span class="hs-identifier hs-var">vstys</span></a><span>
</span><a name="line-902"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679228321"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DRecC"><span class="hs-identifier hs-var">DRecC</span></a><span> </span><a href="#local-6989586621679228323"><span class="hs-identifier hs-var">vdtys</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-903"></a><span class="hs-identifier">dsCon'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixC</span><span> </span><a name="local-6989586621679228324"><a href="#local-6989586621679228324"><span class="hs-identifier">sty1</span></a></a><span> </span><a name="local-6989586621679228325"><a href="#local-6989586621679228325"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679228326"><a href="#local-6989586621679228326"><span class="hs-identifier">sty2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-904"></a><span>  </span><a name="local-6989586621679228327"><a href="#local-6989586621679228327"><span class="hs-identifier">dty1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsBangType"><span class="hs-identifier hs-var">dsBangType</span></a><span> </span><a href="#local-6989586621679228324"><span class="hs-identifier hs-var">sty1</span></a><span>
</span><a name="line-905"></a><span>  </span><a name="local-6989586621679228328"><a href="#local-6989586621679228328"><span class="hs-identifier">dty2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsBangType"><span class="hs-identifier hs-var">dsBangType</span></a><span> </span><a href="#local-6989586621679228326"><span class="hs-identifier hs-var">sty2</span></a><span>
</span><a name="line-906"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679228325"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DNormalC"><span class="hs-identifier hs-var">DNormalC</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679228327"><span class="hs-identifier hs-var">dty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679228328"><span class="hs-identifier hs-var">dty2</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-907"></a><span class="hs-identifier">dsCon'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForallC</span><span> </span><a name="local-6989586621679228329"><a href="#local-6989586621679228329"><span class="hs-identifier">tvbs</span></a></a><span> </span><a name="local-6989586621679228330"><a href="#local-6989586621679228330"><span class="hs-identifier">cxt</span></a></a><span> </span><a name="local-6989586621679228331"><a href="#local-6989586621679228331"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-908"></a><span>  </span><a name="local-6989586621679228332"><a href="#local-6989586621679228332"><span class="hs-identifier">dtvbs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsTvb"><span class="hs-identifier hs-var">dsTvb</span></a><span> </span><a href="#local-6989586621679228329"><span class="hs-identifier hs-var">tvbs</span></a><span>
</span><a name="line-909"></a><span>  </span><a name="local-6989586621679228333"><a href="#local-6989586621679228333"><span class="hs-identifier">dcxt</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsCxt"><span class="hs-identifier hs-var">dsCxt</span></a><span> </span><a href="#local-6989586621679228330"><span class="hs-identifier hs-var">cxt</span></a><span>
</span><a name="line-910"></a><span>  </span><a name="local-6989586621679228334"><a href="#local-6989586621679228334"><span class="hs-identifier">dcons'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsCon%27"><span class="hs-identifier hs-var">dsCon'</span></a><span> </span><a href="#local-6989586621679228331"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-911"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679228334"><span class="hs-identifier hs-var">dcons'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679228335"><a href="#local-6989586621679228335"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228336"><a href="#local-6989586621679228336"><span class="hs-identifier">dtvbs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228337"><a href="#local-6989586621679228337"><span class="hs-identifier">dcxt'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228338"><a href="#local-6989586621679228338"><span class="hs-identifier">fields</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228339"><a href="#local-6989586621679228339"><span class="hs-identifier">m_gadt_type</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-912"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621679228335"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679228332"><span class="hs-identifier hs-var">dtvbs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679228336"><span class="hs-identifier hs-var">dtvbs'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679228333"><span class="hs-identifier hs-var">dcxt</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679228337"><span class="hs-identifier hs-var">dcxt'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679228338"><span class="hs-identifier hs-var">fields</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679228339"><span class="hs-identifier hs-var">m_gadt_type</span></a><span class="hs-special">)</span><span>
</span><a name="line-913"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="hs-identifier">dsCon'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GadtC</span><span> </span><a name="local-6989586621679228340"><a href="#local-6989586621679228340"><span class="hs-identifier">nms</span></a></a><span> </span><a name="local-6989586621679228341"><a href="#local-6989586621679228341"><span class="hs-identifier">btys</span></a></a><span> </span><a name="local-6989586621679228342"><a href="#local-6989586621679228342"><span class="hs-identifier">rty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-915"></a><span>  </span><a name="local-6989586621679228343"><a href="#local-6989586621679228343"><span class="hs-identifier">dbtys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsBangType"><span class="hs-identifier hs-var">dsBangType</span></a><span> </span><a href="#local-6989586621679228341"><span class="hs-identifier hs-var">btys</span></a><span>
</span><a name="line-916"></a><span>  </span><a name="local-6989586621679228344"><a href="#local-6989586621679228344"><span class="hs-identifier">drty</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228342"><span class="hs-identifier hs-var">rty</span></a><span>
</span><a name="line-917"></a><span>  </span><span class="hs-identifier hs-var">sequence</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679228340"><span class="hs-identifier hs-var">nms</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679228345"><a href="#local-6989586621679228345"><span class="hs-identifier">nm</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-918"></a><span>    </span><a name="local-6989586621679228346"><a href="#local-6989586621679228346"><span class="hs-identifier">mbFi</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyFixityWithLocals"><span class="hs-identifier hs-var">reifyFixityWithLocals</span></a><span> </span><a href="#local-6989586621679228345"><span class="hs-identifier hs-var">nm</span></a><span>
</span><a name="line-919"></a><span>    </span><span class="hs-comment">-- A GADT data constructor is declared infix when these three</span><span>
</span><a name="line-920"></a><span>    </span><span class="hs-comment">-- properties hold:</span><span>
</span><a name="line-921"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679228347"><a href="#local-6989586621679228347"><span class="hs-identifier">decInfix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#isInfixDataCon"><span class="hs-identifier hs-var">isInfixDataCon</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nameBase</span><span> </span><a href="#local-6989586621679228345"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- 1. Its name uses operator syntax</span><span>
</span><a name="line-922"></a><span>                                                </span><span class="hs-comment">--    (e.g., (:*:))</span><span>
</span><a name="line-923"></a><span>                </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679228343"><span class="hs-identifier hs-var">dbtys</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">2</span><span>            </span><span class="hs-comment">-- 2. It has exactly two fields</span><span>
</span><a name="line-924"></a><span>                </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">isJust</span><span> </span><a href="#local-6989586621679228346"><span class="hs-identifier hs-var">mbFi</span></a><span>                  </span><span class="hs-comment">-- 3. It has a programmer-specified</span><span>
</span><a name="line-925"></a><span>                                                </span><span class="hs-comment">--    fixity declaration</span><span>
</span><a name="line-926"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679228345"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DNormalC"><span class="hs-identifier hs-var">DNormalC</span></a><span> </span><a href="#local-6989586621679228347"><span class="hs-identifier hs-var">decInfix</span></a><span> </span><a href="#local-6989586621679228343"><span class="hs-identifier hs-var">dbtys</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679228344"><span class="hs-identifier hs-var">drty</span></a><span class="hs-special">)</span><span>
</span><a name="line-927"></a><span class="hs-identifier">dsCon'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecGadtC</span><span> </span><a name="local-6989586621679228348"><a href="#local-6989586621679228348"><span class="hs-identifier">nms</span></a></a><span> </span><a name="local-6989586621679228349"><a href="#local-6989586621679228349"><span class="hs-identifier">vbtys</span></a></a><span> </span><a name="local-6989586621679228350"><a href="#local-6989586621679228350"><span class="hs-identifier">rty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-928"></a><span>  </span><a name="local-6989586621679228351"><a href="#local-6989586621679228351"><span class="hs-identifier">dvbtys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsVarBangType"><span class="hs-identifier hs-var">dsVarBangType</span></a><span> </span><a href="#local-6989586621679228349"><span class="hs-identifier hs-var">vbtys</span></a><span>
</span><a name="line-929"></a><span>  </span><a name="local-6989586621679228352"><a href="#local-6989586621679228352"><span class="hs-identifier">drty</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228350"><span class="hs-identifier hs-var">rty</span></a><span>
</span><a name="line-930"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679228348"><span class="hs-identifier hs-var">nms</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679228353"><a href="#local-6989586621679228353"><span class="hs-identifier">nm</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-931"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621679228353"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DRecC"><span class="hs-identifier hs-var">DRecC</span></a><span> </span><a href="#local-6989586621679228351"><span class="hs-identifier hs-var">dvbtys</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679228352"><span class="hs-identifier hs-var">drty</span></a><span class="hs-special">)</span><span>
</span><a name="line-932"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-934"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="hs-comment">-- | Desugar a @BangType@ (or a @StrictType@, if you're old-fashioned)</span><span>
</span><a name="line-936"></a><span class="hs-identifier">dsBangType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226661"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">BangType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226661"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DBangType"><span class="hs-identifier hs-type">DBangType</span></a><span>
</span><a name="line-937"></a><a name="dsBangType"><a href="Language.Haskell.TH.Desugar.Core.html#dsBangType"><span class="hs-identifier">dsBangType</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679228354"><a href="#local-6989586621679228354"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228355"><a href="#local-6989586621679228355"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679228354"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228355"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-938"></a><span>
</span><a name="line-939"></a><span class="hs-comment">-- | Desugar a @VarBangType@ (or a @VarStrictType@, if you're old-fashioned)</span><span>
</span><a name="line-940"></a><span class="hs-identifier">dsVarBangType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226660"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">VarBangType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226660"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarBangType"><span class="hs-identifier hs-type">DVarBangType</span></a><span>
</span><a name="line-941"></a><a name="dsVarBangType"><a href="Language.Haskell.TH.Desugar.Core.html#dsVarBangType"><span class="hs-identifier">dsVarBangType</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679228356"><a href="#local-6989586621679228356"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228357"><a href="#local-6989586621679228357"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228358"><a href="#local-6989586621679228358"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679228356"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679228357"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228358"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-942"></a><span class="hs-cpp">#else
</span><span class="hs-comment">-- | Desugar a @BangType@ (or a @StrictType@, if you're old-fashioned)</span><span>
</span><a name="line-944"></a><span class="hs-identifier">dsBangType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">DsMonad</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">StrictType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-identifier">DBangType</span><span>
</span><a name="line-945"></a><span class="hs-identifier">dsBangType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">b</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">strictToBang</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier">ty</span><span>
</span><a name="line-946"></a><span>
</span><a name="line-947"></a><span class="hs-comment">-- | Desugar a @VarBangType@ (or a @VarStrictType@, if you're old-fashioned)</span><span>
</span><a name="line-948"></a><span class="hs-identifier">dsVarBangType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">DsMonad</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">VarStrictType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-identifier">DVarBangType</span><span>
</span><a name="line-949"></a><span class="hs-identifier">dsVarBangType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">strictToBang</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier">ty</span><span>
</span><a name="line-950"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-952"></a><span class="hs-comment">-- | Desugar a @Foreign@.</span><span>
</span><a name="line-953"></a><span class="hs-identifier">dsForeign</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226659"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Foreign</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226659"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DForeign"><span class="hs-identifier hs-type">DForeign</span></a><span>
</span><a name="line-954"></a><a name="dsForeign"><a href="Language.Haskell.TH.Desugar.Core.html#dsForeign"><span class="hs-identifier">dsForeign</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ImportF</span><span> </span><a name="local-6989586621679228359"><a href="#local-6989586621679228359"><span class="hs-identifier">cc</span></a></a><span> </span><a name="local-6989586621679228360"><a href="#local-6989586621679228360"><span class="hs-identifier">safety</span></a></a><span> </span><a name="local-6989586621679228361"><a href="#local-6989586621679228361"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621679228362"><a href="#local-6989586621679228362"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679228363"><a href="#local-6989586621679228363"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DImportF"><span class="hs-identifier hs-var">DImportF</span></a><span> </span><a href="#local-6989586621679228359"><span class="hs-identifier hs-var">cc</span></a><span> </span><a href="#local-6989586621679228360"><span class="hs-identifier hs-var">safety</span></a><span> </span><a href="#local-6989586621679228361"><span class="hs-identifier hs-var">str</span></a><span> </span><a href="#local-6989586621679228362"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228363"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-955"></a><span class="hs-identifier">dsForeign</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExportF</span><span> </span><a name="local-6989586621679228364"><a href="#local-6989586621679228364"><span class="hs-identifier">cc</span></a></a><span> </span><a name="local-6989586621679228365"><a href="#local-6989586621679228365"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621679228366"><a href="#local-6989586621679228366"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679228367"><a href="#local-6989586621679228367"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExportF"><span class="hs-identifier hs-var">DExportF</span></a><span> </span><a href="#local-6989586621679228364"><span class="hs-identifier hs-var">cc</span></a><span> </span><a href="#local-6989586621679228365"><span class="hs-identifier hs-var">str</span></a><span> </span><a href="#local-6989586621679228366"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228367"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-956"></a><span>
</span><a name="line-957"></a><span class="hs-comment">-- | Desugar a @Pragma@.</span><span>
</span><a name="line-958"></a><span class="hs-identifier">dsPragma</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226658"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Pragma</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226658"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPragma"><span class="hs-identifier hs-type">DPragma</span></a><span>
</span><a name="line-959"></a><a name="dsPragma"><a href="Language.Haskell.TH.Desugar.Core.html#dsPragma"><span class="hs-identifier">dsPragma</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InlineP</span><span> </span><a name="local-6989586621679228368"><a href="#local-6989586621679228368"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679228369"><a href="#local-6989586621679228369"><span class="hs-identifier">inl</span></a></a><span> </span><a name="local-6989586621679228370"><a href="#local-6989586621679228370"><span class="hs-identifier">rm</span></a></a><span> </span><a name="local-6989586621679228371"><a href="#local-6989586621679228371"><span class="hs-identifier">phases</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DInlineP"><span class="hs-identifier hs-var">DInlineP</span></a><span> </span><a href="#local-6989586621679228368"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679228369"><span class="hs-identifier hs-var">inl</span></a><span> </span><a href="#local-6989586621679228370"><span class="hs-identifier hs-var">rm</span></a><span> </span><a href="#local-6989586621679228371"><span class="hs-identifier hs-var">phases</span></a><span>
</span><a name="line-960"></a><span class="hs-identifier">dsPragma</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpecialiseP</span><span> </span><a name="local-6989586621679228372"><a href="#local-6989586621679228372"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679228373"><a href="#local-6989586621679228373"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679228374"><a href="#local-6989586621679228374"><span class="hs-identifier">m_inl</span></a></a><span> </span><a name="local-6989586621679228375"><a href="#local-6989586621679228375"><span class="hs-identifier">phases</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DSpecialiseP"><span class="hs-identifier hs-var">DSpecialiseP</span></a><span> </span><a href="#local-6989586621679228372"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228373"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-961"></a><span>                                                          </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679228374"><span class="hs-identifier hs-var">m_inl</span></a><span>
</span><a name="line-962"></a><span>                                                          </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679228375"><span class="hs-identifier hs-var">phases</span></a><span>
</span><a name="line-963"></a><span class="hs-identifier">dsPragma</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpecialiseInstP</span><span> </span><a name="local-6989586621679228376"><a href="#local-6989586621679228376"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DSpecialiseInstP"><span class="hs-identifier hs-var">DSpecialiseInstP</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228376"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-964"></a><span class="hs-identifier">dsPragma</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RuleP</span><span> </span><a name="local-6989586621679228377"><a href="#local-6989586621679228377"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621679228378"><a href="#local-6989586621679228378"><span class="hs-identifier">rbs</span></a></a><span> </span><a name="local-6989586621679228379"><a href="#local-6989586621679228379"><span class="hs-identifier">lhs</span></a></a><span> </span><a name="local-6989586621679228380"><a href="#local-6989586621679228380"><span class="hs-identifier">rhs</span></a></a><span> </span><a name="local-6989586621679228381"><a href="#local-6989586621679228381"><span class="hs-identifier">phases</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DRuleP"><span class="hs-identifier hs-var">DRuleP</span></a><span> </span><a href="#local-6989586621679228377"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsRuleBndr"><span class="hs-identifier hs-var">dsRuleBndr</span></a><span> </span><a href="#local-6989586621679228378"><span class="hs-identifier hs-var">rbs</span></a><span>
</span><a name="line-965"></a><span>                                                      </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679228379"><span class="hs-identifier hs-var">lhs</span></a><span>
</span><a name="line-966"></a><span>                                                      </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679228380"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-967"></a><span>                                                      </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679228381"><span class="hs-identifier hs-var">phases</span></a><span>
</span><a name="line-968"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 707
</span><span class="hs-identifier">dsPragma</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AnnP</span><span> </span><a name="local-6989586621679228382"><a href="#local-6989586621679228382"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-6989586621679228383"><a href="#local-6989586621679228383"><span class="hs-identifier">exp</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAnnP"><span class="hs-identifier hs-var">DAnnP</span></a><span> </span><a href="#local-6989586621679228382"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679228383"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-970"></a><span class="hs-cpp">#endif
#if __GLASGOW_HASKELL__ &gt;= 709
</span><span class="hs-identifier">dsPragma</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LineP</span><span> </span><a name="local-6989586621679228384"><a href="#local-6989586621679228384"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679228385"><a href="#local-6989586621679228385"><span class="hs-identifier">str</span></a></a><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLineP"><span class="hs-identifier hs-var">DLineP</span></a><span> </span><a href="#local-6989586621679228384"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679228385"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-973"></a><span class="hs-cpp">#endif
#if __GLASGOW_HASKELL__ &gt;= 801
</span><span class="hs-identifier">dsPragma</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CompleteP</span><span> </span><a name="local-6989586621679228386"><a href="#local-6989586621679228386"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621679228387"><a href="#local-6989586621679228387"><span class="hs-identifier">mty</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DCompleteP"><span class="hs-identifier hs-var">DCompleteP</span></a><span> </span><a href="#local-6989586621679228386"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-6989586621679228387"><span class="hs-identifier hs-var">mty</span></a><span>
</span><a name="line-976"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-978"></a><span class="hs-comment">-- | Desugar a @RuleBndr@.</span><span>
</span><a name="line-979"></a><span class="hs-identifier">dsRuleBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226657"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">RuleBndr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226657"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DRuleBndr"><span class="hs-identifier hs-type">DRuleBndr</span></a><span>
</span><a name="line-980"></a><a name="dsRuleBndr"><a href="Language.Haskell.TH.Desugar.Core.html#dsRuleBndr"><span class="hs-identifier">dsRuleBndr</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RuleVar</span><span> </span><a name="local-6989586621679228388"><a href="#local-6989586621679228388"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DRuleVar"><span class="hs-identifier hs-var">DRuleVar</span></a><span> </span><a href="#local-6989586621679228388"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-981"></a><span class="hs-identifier">dsRuleBndr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypedRuleVar</span><span> </span><a name="local-6989586621679228389"><a href="#local-6989586621679228389"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679228390"><a href="#local-6989586621679228390"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTypedRuleVar"><span class="hs-identifier hs-var">DTypedRuleVar</span></a><span> </span><a href="#local-6989586621679228389"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228390"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-982"></a><span>
</span><a name="line-983"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 707
</span><span class="hs-comment">-- | Desugar a @TySynEqn@. (Available only with GHC 7.8+)</span><span>
</span><a name="line-985"></a><span class="hs-identifier">dsTySynEqn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226656"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">TySynEqn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226656"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTySynEqn"><span class="hs-identifier hs-type">DTySynEqn</span></a><span>
</span><a name="line-986"></a><a name="dsTySynEqn"><a href="Language.Haskell.TH.Desugar.Core.html#dsTySynEqn"><span class="hs-identifier">dsTySynEqn</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TySynEqn</span><span> </span><a name="local-6989586621679228391"><a href="#local-6989586621679228391"><span class="hs-identifier">lhs</span></a></a><span> </span><a name="local-6989586621679228392"><a href="#local-6989586621679228392"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTySynEqn"><span class="hs-identifier hs-var">DTySynEqn</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228391"><span class="hs-identifier hs-var">lhs</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228392"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-987"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-989"></a><span class="hs-comment">-- | Desugar clauses to a function definition</span><span>
</span><a name="line-990"></a><span class="hs-identifier">dsClauses</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226655"><span class="hs-identifier hs-type">q</span></a><span>
</span><a name="line-991"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>         </span><span class="hs-comment">-- ^ Name of the function</span><span>
</span><a name="line-992"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Clause</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- ^ Clauses to desugar</span><span>
</span><a name="line-993"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226655"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DClause"><span class="hs-identifier hs-type">DClause</span></a><span class="hs-special">]</span><span>
</span><a name="line-994"></a><a name="dsClauses"><a href="Language.Haskell.TH.Desugar.Core.html#dsClauses"><span class="hs-identifier">dsClauses</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-995"></a><span class="hs-identifier">dsClauses</span><span> </span><a name="local-6989586621679228393"><a href="#local-6989586621679228393"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Clause</span><span> </span><a name="local-6989586621679228394"><a href="#local-6989586621679228394"><span class="hs-identifier">pats</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NormalB</span><span> </span><a name="local-6989586621679228395"><a href="#local-6989586621679228395"><span class="hs-identifier">exp</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679228396"><a href="#local-6989586621679228396"><span class="hs-identifier">where_decs</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679228397"><a href="#local-6989586621679228397"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-996"></a><span>  </span><span class="hs-comment">-- this case is necessary to maintain the roundtrip property.</span><span>
</span><a name="line-997"></a><span>  </span><a name="local-6989586621679228398"><a href="#local-6989586621679228398"><span class="hs-identifier">rest'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsClauses"><span class="hs-identifier hs-var">dsClauses</span></a><span> </span><a href="#local-6989586621679228393"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679228397"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-998"></a><span>  </span><a name="local-6989586621679228399"><a href="#local-6989586621679228399"><span class="hs-identifier">exp'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span> </span><a href="#local-6989586621679228395"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-999"></a><span>  </span><a name="local-6989586621679228400"><a href="#local-6989586621679228400"><span class="hs-identifier">where_decs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsLetDecs"><span class="hs-identifier hs-var">dsLetDecs</span></a><span> </span><a href="#local-6989586621679228396"><span class="hs-identifier hs-var">where_decs</span></a><span>
</span><a name="line-1000"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679228401"><a href="#local-6989586621679228401"><span class="hs-identifier">exp_with_wheres</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#maybeDLetE"><span class="hs-identifier hs-var">maybeDLetE</span></a><span> </span><a href="#local-6989586621679228400"><span class="hs-identifier hs-var">where_decs'</span></a><span> </span><a href="#local-6989586621679228399"><span class="hs-identifier hs-var">exp'</span></a><span>
</span><a name="line-1001"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679228402"><a href="#local-6989586621679228402"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228403"><a href="#local-6989586621679228403"><span class="hs-identifier">exp''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPatsOverExp"><span class="hs-identifier hs-var">dsPatsOverExp</span></a><span> </span><a href="#local-6989586621679228394"><span class="hs-identifier hs-var">pats</span></a><span> </span><a href="#local-6989586621679228401"><span class="hs-identifier hs-var">exp_with_wheres</span></a><span>
</span><a name="line-1002"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DClause"><span class="hs-identifier hs-var">DClause</span></a><span> </span><a href="#local-6989586621679228402"><span class="hs-identifier hs-var">pats'</span></a><span> </span><a href="#local-6989586621679228403"><span class="hs-identifier hs-var">exp''</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679228398"><span class="hs-identifier hs-var">rest'</span></a><span>
</span><a name="line-1003"></a><span class="hs-identifier">dsClauses</span><span> </span><a name="local-6989586621679228404"><a href="#local-6989586621679228404"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679228405"><a href="#local-6989586621679228405"><span class="hs-identifier">clauses</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Clause</span><span> </span><a name="local-6989586621679228406"><a href="#local-6989586621679228406"><span class="hs-identifier">outer_pats</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1004"></a><span>  </span><a name="local-6989586621679228420"><a href="#local-6989586621679228420"><span class="hs-identifier">arg_names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">replicateM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679228406"><span class="hs-identifier hs-var">outer_pats</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Util.html#newUniqueName"><span class="hs-identifier hs-var">newUniqueName</span></a><span> </span><span class="hs-string">&quot;arg&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1005"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679228421"><a href="#local-6989586621679228421"><span class="hs-identifier">scrutinee</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#mkTupleDExp"><span class="hs-identifier hs-var">mkTupleDExp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679228420"><span class="hs-identifier hs-var">arg_names</span></a><span class="hs-special">)</span><span>
</span><a name="line-1006"></a><span>  </span><a name="local-6989586621679228422"><a href="#local-6989586621679228422"><span class="hs-identifier">clause</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DClause"><span class="hs-identifier hs-var">DClause</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a href="#local-6989586621679228420"><span class="hs-identifier hs-var">arg_names</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-1007"></a><span>              </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DCaseE"><span class="hs-identifier hs-var">DCaseE</span></a><span> </span><a href="#local-6989586621679228421"><span class="hs-identifier hs-var">scrutinee</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">foldrM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679228407"><span class="hs-identifier hs-var">clause_to_dmatch</span></a><span> </span><a href="#local-6989586621679228421"><span class="hs-identifier hs-var">scrutinee</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679228405"><span class="hs-identifier hs-var">clauses</span></a><span class="hs-special">)</span><span>
</span><a name="line-1008"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679228422"><span class="hs-identifier hs-var">clause</span></a><span class="hs-special">]</span><span>
</span><a name="line-1009"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1010"></a><span>    </span><span class="hs-identifier">clause_to_dmatch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679228408"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Clause</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-type">DMatch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679228408"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-type">DMatch</span></a><span class="hs-special">]</span><span>
</span><a name="line-1011"></a><span>    </span><a name="local-6989586621679228407"><a href="#local-6989586621679228407"><span class="hs-identifier">clause_to_dmatch</span></a></a><span> </span><a name="local-6989586621679228409"><a href="#local-6989586621679228409"><span class="hs-identifier">scrutinee</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Clause</span><span> </span><a name="local-6989586621679228410"><a href="#local-6989586621679228410"><span class="hs-identifier">pats</span></a></a><span> </span><a name="local-6989586621679228411"><a href="#local-6989586621679228411"><span class="hs-identifier">body</span></a></a><span> </span><a name="local-6989586621679228412"><a href="#local-6989586621679228412"><span class="hs-identifier">where_decs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679228413"><a href="#local-6989586621679228413"><span class="hs-identifier">failure_matches</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1012"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679228414"><a href="#local-6989586621679228414"><span class="hs-identifier">failure_exp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#maybeDCaseE"><span class="hs-identifier hs-var">maybeDCaseE</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Non-exhaustive patterns in &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679228404"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1013"></a><span>                                    </span><a href="#local-6989586621679228409"><span class="hs-identifier hs-var">scrutinee</span></a><span> </span><a href="#local-6989586621679228413"><span class="hs-identifier hs-var">failure_matches</span></a><span>
</span><a name="line-1014"></a><span>      </span><a name="local-6989586621679228415"><a href="#local-6989586621679228415"><span class="hs-identifier">exp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsBody"><span class="hs-identifier hs-var">dsBody</span></a><span> </span><a href="#local-6989586621679228411"><span class="hs-identifier hs-var">body</span></a><span> </span><a href="#local-6989586621679228412"><span class="hs-identifier hs-var">where_decs</span></a><span> </span><a href="#local-6989586621679228414"><span class="hs-identifier hs-var">failure_exp</span></a><span>
</span><a name="line-1015"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679228416"><a href="#local-6989586621679228416"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228417"><a href="#local-6989586621679228417"><span class="hs-identifier">exp'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPatsOverExp"><span class="hs-identifier hs-var">dsPatsOverExp</span></a><span> </span><a href="#local-6989586621679228410"><span class="hs-identifier hs-var">pats</span></a><span> </span><a href="#local-6989586621679228415"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-1016"></a><span>      </span><a name="local-6989586621679228418"><a href="#local-6989586621679228418"><span class="hs-identifier">uni_pats</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">getAll</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">All</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#isUniversalPattern"><span class="hs-identifier hs-var">isUniversalPattern</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679228416"><span class="hs-identifier hs-var">pats'</span></a><span>
</span><a name="line-1017"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679228419"><a href="#local-6989586621679228419"><span class="hs-identifier">match</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#mkTupleDPat"><span class="hs-identifier hs-var">mkTupleDPat</span></a><span> </span><a href="#local-6989586621679228416"><span class="hs-identifier hs-var">pats'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679228417"><span class="hs-identifier hs-var">exp'</span></a><span>
</span><a name="line-1018"></a><span>      </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679228418"><span class="hs-identifier hs-var">uni_pats</span></a><span>
</span><a name="line-1019"></a><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679228419"><span class="hs-identifier hs-var">match</span></a><span class="hs-special">]</span><span>
</span><a name="line-1020"></a><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679228419"><span class="hs-identifier hs-var">match</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679228413"><span class="hs-identifier hs-var">failure_matches</span></a><span class="hs-special">)</span><span>
</span><a name="line-1021"></a><span>
</span><a name="line-1022"></a><span class="hs-comment">-- | Desugar a type</span><span>
</span><a name="line-1023"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226654"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226654"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span>
</span><a name="line-1024"></a><a name="dsType"><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier">dsType</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForallT</span><span> </span><a name="local-6989586621679228423"><a href="#local-6989586621679228423"><span class="hs-identifier">tvbs</span></a></a><span> </span><a name="local-6989586621679228424"><a href="#local-6989586621679228424"><span class="hs-identifier">preds</span></a></a><span> </span><a name="local-6989586621679228425"><a href="#local-6989586621679228425"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DForallT"><span class="hs-identifier hs-var">DForallT</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsTvb"><span class="hs-identifier hs-var">dsTvb</span></a><span> </span><a href="#local-6989586621679228423"><span class="hs-identifier hs-var">tvbs</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsCxt"><span class="hs-identifier hs-var">dsCxt</span></a><span> </span><a href="#local-6989586621679228424"><span class="hs-identifier hs-var">preds</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228425"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1025"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppT</span><span> </span><a name="local-6989586621679228426"><a href="#local-6989586621679228426"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679228427"><a href="#local-6989586621679228427"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppT"><span class="hs-identifier hs-var">DAppT</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228426"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228427"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1026"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigT</span><span> </span><a name="local-6989586621679228428"><a href="#local-6989586621679228428"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679228429"><a href="#local-6989586621679228429"><span class="hs-identifier">ki</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DSigT"><span class="hs-identifier hs-var">DSigT</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228428"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228429"><span class="hs-identifier hs-var">ki</span></a><span>
</span><a name="line-1027"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarT</span><span> </span><a name="local-6989586621679228430"><a href="#local-6989586621679228430"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarT"><span class="hs-identifier hs-var">DVarT</span></a><span> </span><a href="#local-6989586621679228430"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1028"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConT</span><span> </span><a name="local-6989586621679228431"><a href="#local-6989586621679228431"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><a href="#local-6989586621679228431"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1029"></a><span>  </span><span class="hs-comment">-- the only difference between ConT and PromotedT is the name lookup. Here, we assume</span><span>
</span><a name="line-1030"></a><span>  </span><span class="hs-comment">-- that the TH quote mechanism figured out the right name. Note that lookupDataName name</span><span>
</span><a name="line-1031"></a><span>  </span><span class="hs-comment">-- does not necessarily work, because `name` has its original module attached, which</span><span>
</span><a name="line-1032"></a><span>  </span><span class="hs-comment">-- may not be in scope.</span><span>
</span><a name="line-1033"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PromotedT</span><span> </span><a name="local-6989586621679228432"><a href="#local-6989586621679228432"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><a href="#local-6989586621679228432"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1034"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TupleT</span><span> </span><a name="local-6989586621679228433"><a href="#local-6989586621679228433"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tupleTypeName</span><span> </span><a href="#local-6989586621679228433"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1035"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">UnboxedTupleT</span><span> </span><a name="local-6989586621679228434"><a href="#local-6989586621679228434"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unboxedTupleTypeName</span><span> </span><a href="#local-6989586621679228434"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1036"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier hs-var">ArrowT</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DArrowT"><span class="hs-identifier hs-var">DArrowT</span></a><span>
</span><a name="line-1037"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier hs-var">ListT</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><span class="hs-special">''</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1038"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PromotedTupleT</span><span> </span><a name="local-6989586621679228435"><a href="#local-6989586621679228435"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tupleDataName</span><span> </span><a href="#local-6989586621679228435"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1039"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier hs-var">PromotedNilT</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1040"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier hs-var">PromotedConsT</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-1041"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier hs-var">StarT</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#typeKindName"><span class="hs-identifier hs-var">typeKindName</span></a><span>
</span><a name="line-1042"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier hs-var">ConstraintT</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">Constraint</span><span>
</span><a name="line-1043"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitT</span><span> </span><a name="local-6989586621679228436"><a href="#local-6989586621679228436"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLitT"><span class="hs-identifier hs-var">DLitT</span></a><span> </span><a href="#local-6989586621679228436"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1044"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 709
</span><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier hs-var">EqualityT</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><span class="hs-special">''</span><span class="hs-special">(</span><span class="hs-glyph">~</span><span class="hs-special">)</span><span>
</span><a name="line-1046"></a><span class="hs-cpp">#endif
#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="hs-identifier">dsType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixT</span><span> </span><a name="local-6989586621679228437"><a href="#local-6989586621679228437"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679228438"><a href="#local-6989586621679228438"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679228439"><a href="#local-6989586621679228439"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppT"><span class="hs-identifier hs-var">DAppT</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppT"><span class="hs-identifier hs-var">DAppT</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><a href="#local-6989586621679228438"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228437"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228439"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1049"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">UInfixT</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-string">&quot;Cannot desugar unresolved infix operators.&quot;</span><span>
</span><a name="line-1050"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParensT</span><span> </span><a name="local-6989586621679228440"><a href="#local-6989586621679228440"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228440"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-1051"></a><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier hs-var">WildCardT</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildCardT"><span class="hs-identifier hs-var">DWildCardT</span></a><span>
</span><a name="line-1052"></a><span class="hs-cpp">#endif
#if __GLASGOW_HASKELL__ &gt;= 801
</span><span class="hs-identifier">dsType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">UnboxedSumT</span><span> </span><a name="local-6989586621679228441"><a href="#local-6989586621679228441"><span class="hs-identifier">arity</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unboxedSumTypeName</span><span> </span><a href="#local-6989586621679228441"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span>
</span><a name="line-1055"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-1057"></a><span class="hs-comment">-- | Desugar a @TyVarBndr@</span><span>
</span><a name="line-1058"></a><span class="hs-identifier">dsTvb</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226653"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">TyVarBndr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226653"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTyVarBndr"><span class="hs-identifier hs-type">DTyVarBndr</span></a><span>
</span><a name="line-1059"></a><a name="dsTvb"><a href="Language.Haskell.TH.Desugar.Core.html#dsTvb"><span class="hs-identifier">dsTvb</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PlainTV</span><span> </span><a name="local-6989586621679228442"><a href="#local-6989586621679228442"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPlainTV"><span class="hs-identifier hs-var">DPlainTV</span></a><span> </span><a href="#local-6989586621679228442"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1060"></a><span class="hs-identifier">dsTvb</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">KindedTV</span><span> </span><a name="local-6989586621679228443"><a href="#local-6989586621679228443"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679228444"><a href="#local-6989586621679228444"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DKindedTV"><span class="hs-identifier hs-var">DKindedTV</span></a><span> </span><a href="#local-6989586621679228443"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228444"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-1061"></a><span>
</span><a name="line-1062"></a><span class="hs-comment">-- | Desugar a @Cxt@</span><span>
</span><a name="line-1063"></a><span class="hs-identifier">dsCxt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226652"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Cxt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226652"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DCxt"><span class="hs-identifier hs-type">DCxt</span></a><span>
</span><a name="line-1064"></a><a name="dsCxt"><a href="Language.Haskell.TH.Desugar.Core.html#dsCxt"><span class="hs-identifier">dsCxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPred"><span class="hs-identifier hs-var">dsPred</span></a><span>
</span><a name="line-1065"></a><span>
</span><a name="line-1066"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 801
</span><span class="hs-comment">-- | Desugar a @DerivClause@.</span><span>
</span><a name="line-1068"></a><span class="hs-identifier">dsDerivClause</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226651"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">DerivClause</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226651"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DDerivClause"><span class="hs-identifier hs-type">DDerivClause</span></a><span>
</span><a name="line-1069"></a><a name="dsDerivClause"><a href="Language.Haskell.TH.Desugar.Core.html#dsDerivClause"><span class="hs-identifier">dsDerivClause</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DerivClause</span><span> </span><a name="local-6989586621679228445"><a href="#local-6989586621679228445"><span class="hs-identifier">mds</span></a></a><span> </span><a name="local-6989586621679228446"><a href="#local-6989586621679228446"><span class="hs-identifier">cxt</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1070"></a><span>  </span><a href="Language.Haskell.TH.Desugar.AST.html#DDerivClause"><span class="hs-identifier hs-var">DDerivClause</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsDerivStrategy"><span class="hs-identifier hs-var">dsDerivStrategy</span></a><span> </span><a href="#local-6989586621679228445"><span class="hs-identifier hs-var">mds</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsCxt"><span class="hs-identifier hs-var">dsCxt</span></a><span> </span><a href="#local-6989586621679228446"><span class="hs-identifier hs-var">cxt</span></a><span>
</span><a name="line-1071"></a><span class="hs-cpp">#elif __GLASGOW_HASKELL__ &gt;= 711
</span><span class="hs-identifier">dsDerivClause</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">DsMonad</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Pred</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-identifier">DDerivClause</span><span>
</span><a name="line-1073"></a><span class="hs-identifier">dsDerivClause</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DDerivClause</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">dsPred</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-1074"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">dsDerivClause</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">DsMonad</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-identifier">DDerivClause</span><span>
</span><a name="line-1076"></a><span class="hs-identifier">dsDerivClause</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">DDerivClause</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">DConPr</span><span> </span><span class="hs-identifier">n</span><span class="hs-special">]</span><span>
</span><a name="line-1077"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-1079"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 801
</span><span class="hs-comment">-- | Desugar a @DerivStrategy@.</span><span>
</span><a name="line-1081"></a><span class="hs-identifier">dsDerivStrategy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226650"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">DerivStrategy</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226650"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DDerivStrategy"><span class="hs-identifier hs-type">DDerivStrategy</span></a><span>
</span><a name="line-1082"></a><a name="dsDerivStrategy"><a href="Language.Haskell.TH.Desugar.Core.html#dsDerivStrategy"><span class="hs-identifier">dsDerivStrategy</span></a></a><span> </span><span class="hs-identifier hs-var">StockStrategy</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DStockStrategy"><span class="hs-identifier hs-var">DStockStrategy</span></a><span>
</span><a name="line-1083"></a><span class="hs-identifier">dsDerivStrategy</span><span> </span><span class="hs-identifier hs-var">AnyclassStrategy</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAnyclassStrategy"><span class="hs-identifier hs-var">DAnyclassStrategy</span></a><span>
</span><a name="line-1084"></a><span class="hs-identifier">dsDerivStrategy</span><span> </span><span class="hs-identifier hs-var">NewtypeStrategy</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DNewtypeStrategy"><span class="hs-identifier hs-var">DNewtypeStrategy</span></a><span>
</span><a name="line-1085"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 805
</span><span class="hs-identifier">dsDerivStrategy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ViaStrategy</span><span> </span><a name="local-6989586621679228447"><a href="#local-6989586621679228447"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DViaStrategy"><span class="hs-identifier hs-var">DViaStrategy</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228447"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1087"></a><span class="hs-cpp">#endif
#endif
</span><span>
</span><a name="line-1090"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 801
</span><span class="hs-comment">-- | Desugar a @PatSynDir@. (Available only with GHC 8.2+)</span><span>
</span><a name="line-1092"></a><span class="hs-identifier">dsPatSynDir</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226649"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">PatSynDir</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226649"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPatSynDir"><span class="hs-identifier hs-type">DPatSynDir</span></a><span>
</span><a name="line-1093"></a><a name="dsPatSynDir"><a href="Language.Haskell.TH.Desugar.Core.html#dsPatSynDir"><span class="hs-identifier">dsPatSynDir</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">Unidir</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DUnidir"><span class="hs-identifier hs-var">DUnidir</span></a><span>
</span><a name="line-1094"></a><span class="hs-identifier">dsPatSynDir</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">ImplBidir</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DImplBidir"><span class="hs-identifier hs-var">DImplBidir</span></a><span>
</span><a name="line-1095"></a><span class="hs-identifier">dsPatSynDir</span><span> </span><a name="local-6989586621679228448"><a href="#local-6989586621679228448"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExplBidir</span><span> </span><a name="local-6989586621679228449"><a href="#local-6989586621679228449"><span class="hs-identifier">clauses</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExplBidir"><span class="hs-identifier hs-var">DExplBidir</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsClauses"><span class="hs-identifier hs-var">dsClauses</span></a><span> </span><a href="#local-6989586621679228448"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679228449"><span class="hs-identifier hs-var">clauses</span></a><span>
</span><a name="line-1096"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-1098"></a><span class="hs-comment">-- | Desugar a @Pred@, flattening any internal tuples</span><span>
</span><a name="line-1099"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226648"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Pred</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226648"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DCxt"><span class="hs-identifier hs-type">DCxt</span></a><span>
</span><a name="line-1100"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &lt; 709
</span><span class="hs-identifier">dsPred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ClassP</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">tys</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1102"></a><span>  </span><span class="hs-identifier">ts'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">dsType</span><span> </span><span class="hs-identifier">tys</span><span>
</span><a name="line-1103"></a><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">foldl</span><span> </span><span class="hs-identifier">DAppPr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DConPr</span><span> </span><span class="hs-identifier">n</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ts'</span><span class="hs-special">]</span><span>
</span><a name="line-1104"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">EqualP</span><span> </span><span class="hs-identifier">t1</span><span> </span><span class="hs-identifier">t2</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1105"></a><span>  </span><span class="hs-identifier">ts'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">dsType</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">t2</span><span class="hs-special">]</span><span>
</span><a name="line-1106"></a><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">foldl</span><span> </span><span class="hs-identifier">DAppPr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DConPr</span><span> </span><span class="hs-special">''</span><span class="hs-special">(</span><span class="hs-glyph">~</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ts'</span><span class="hs-special">]</span><span>
</span><a name="line-1107"></a><span class="hs-cpp">#else
</span><a name="dsPred"><a href="Language.Haskell.TH.Desugar.Core.html#dsPred"><span class="hs-identifier">dsPred</span></a></a><span> </span><a name="local-6989586621679228450"><a href="#local-6989586621679228450"><span class="hs-identifier">t</span></a></a><span>
</span><a name="line-1109"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679228451"><a href="#local-6989586621679228451"><span class="hs-identifier">ts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#splitTuple_maybe"><span class="hs-identifier hs-var">splitTuple_maybe</span></a><span> </span><a href="#local-6989586621679228450"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-1110"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPred"><span class="hs-identifier hs-var">dsPred</span></a><span> </span><a href="#local-6989586621679228451"><span class="hs-identifier hs-var">ts</span></a><span>
</span><a name="line-1111"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForallT</span><span> </span><a name="local-6989586621679228452"><a href="#local-6989586621679228452"><span class="hs-identifier">tvbs</span></a></a><span> </span><a name="local-6989586621679228453"><a href="#local-6989586621679228453"><span class="hs-identifier">cxt</span></a></a><span> </span><a name="local-6989586621679228454"><a href="#local-6989586621679228454"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1112"></a><span>  </span><a name="local-6989586621679228455"><a href="#local-6989586621679228455"><span class="hs-identifier">ps'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPred"><span class="hs-identifier hs-var">dsPred</span></a><span> </span><a href="#local-6989586621679228454"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1113"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679228455"><span class="hs-identifier hs-var">ps'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1114"></a><span>    </span><span class="hs-special">[</span><a name="local-6989586621679228456"><a href="#local-6989586621679228456"><span class="hs-identifier">p'</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DForallPr"><span class="hs-identifier hs-var">DForallPr</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsTvb"><span class="hs-identifier hs-var">dsTvb</span></a><span> </span><a href="#local-6989586621679228452"><span class="hs-identifier hs-var">tvbs</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsCxt"><span class="hs-identifier hs-var">dsCxt</span></a><span> </span><a href="#local-6989586621679228453"><span class="hs-identifier hs-var">cxt</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679228456"><span class="hs-identifier hs-var">p'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1115"></a><span>    </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-string">&quot;Cannot desugar constraint tuples in the body of a quantified constraint&quot;</span><span>
</span><a name="line-1116"></a><span>              </span><span class="hs-comment">-- See Trac #15334.</span><span>
</span><a name="line-1117"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppT</span><span> </span><a name="local-6989586621679228457"><a href="#local-6989586621679228457"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679228458"><a href="#local-6989586621679228458"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1118"></a><span>  </span><span class="hs-special">[</span><a name="local-6989586621679228459"><a href="#local-6989586621679228459"><span class="hs-identifier">p1</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPred"><span class="hs-identifier hs-var">dsPred</span></a><span> </span><a href="#local-6989586621679228457"><span class="hs-identifier hs-var">t1</span></a><span>   </span><span class="hs-comment">-- tuples can't be applied!</span><span>
</span><a name="line-1119"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppPr"><span class="hs-identifier hs-var">DAppPr</span></a><span> </span><a href="#local-6989586621679228459"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228458"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1120"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigT</span><span> </span><a name="local-6989586621679228460"><a href="#local-6989586621679228460"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679228461"><a href="#local-6989586621679228461"><span class="hs-identifier">ki</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1121"></a><span>  </span><a name="local-6989586621679228462"><a href="#local-6989586621679228462"><span class="hs-identifier">preds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPred"><span class="hs-identifier hs-var">dsPred</span></a><span> </span><a href="#local-6989586621679228460"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1122"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679228462"><span class="hs-identifier hs-var">preds</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1123"></a><span>    </span><span class="hs-special">[</span><a name="local-6989586621679228463"><a href="#local-6989586621679228463"><span class="hs-identifier">p</span></a></a><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DSigPr"><span class="hs-identifier hs-var">DSigPr</span></a><span> </span><a href="#local-6989586621679228463"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228461"><span class="hs-identifier hs-var">ki</span></a><span>
</span><a name="line-1124"></a><span>    </span><a name="local-6989586621679228464"><a href="#local-6989586621679228464"><span class="hs-identifier">other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679228464"><span class="hs-identifier hs-var">other</span></a><span>   </span><span class="hs-comment">-- just drop the kind signature on a tuple.</span><span>
</span><a name="line-1125"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarT</span><span> </span><a name="local-6989586621679228465"><a href="#local-6989586621679228465"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPr"><span class="hs-identifier hs-var">DVarPr</span></a><span> </span><a href="#local-6989586621679228465"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span>
</span><a name="line-1126"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConT</span><span> </span><a name="local-6989586621679228466"><a href="#local-6989586621679228466"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPr"><span class="hs-identifier hs-var">DConPr</span></a><span> </span><a href="#local-6989586621679228466"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span>
</span><a name="line-1127"></a><span class="hs-identifier">dsPred</span><span> </span><a name="local-6989586621679228467"><a href="#local-6989586621679228467"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">PromotedT</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1128"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Promoted type seen as head of constraint: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679228467"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-1129"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TupleT</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPr"><span class="hs-identifier hs-var">DConPr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tupleTypeName</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1130"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TupleT</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1131"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;Internal error in th-desugar in detecting tuple constraints.&quot;</span><span>
</span><a name="line-1132"></a><span class="hs-identifier">dsPred</span><span> </span><a name="local-6989586621679228468"><a href="#local-6989586621679228468"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">UnboxedTupleT</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1133"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Unboxed tuple seen as head of constraint: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679228468"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-1134"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-identifier hs-var">ArrowT</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;Arrow seen as head of constraint.&quot;</span><span>
</span><a name="line-1135"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-identifier hs-var">ListT</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;List seen as head of constraint.&quot;</span><span>
</span><a name="line-1136"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PromotedTupleT</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1137"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;Promoted tuple seen as head of constraint.&quot;</span><span>
</span><a name="line-1138"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-identifier hs-var">PromotedNilT</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;Promoted nil seen as head of constraint.&quot;</span><span>
</span><a name="line-1139"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-identifier hs-var">PromotedConsT</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;Promoted cons seen as head of constraint.&quot;</span><span>
</span><a name="line-1140"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-identifier hs-var">StarT</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;* seen as head of constraint.&quot;</span><span>
</span><a name="line-1141"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-identifier hs-var">ConstraintT</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1142"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;The kind `Constraint' seen as head of constraint.&quot;</span><span>
</span><a name="line-1143"></a><span class="hs-identifier">dsPred</span><span> </span><a name="local-6989586621679228469"><a href="#local-6989586621679228469"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitT</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1144"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Type literal seen as head of constraint: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679228469"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-1145"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-identifier hs-var">EqualityT</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPr"><span class="hs-identifier hs-var">DConPr</span></a><span> </span><span class="hs-special">''</span><span class="hs-special">(</span><span class="hs-glyph">~</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1146"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="hs-identifier">dsPred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixT</span><span> </span><a name="local-6989586621679228470"><a href="#local-6989586621679228470"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679228471"><a href="#local-6989586621679228471"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679228472"><a href="#local-6989586621679228472"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppPr"><span class="hs-identifier hs-var">DAppPr</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppPr"><span class="hs-identifier hs-var">DAppPr</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPr"><span class="hs-identifier hs-var">DConPr</span></a><span> </span><a href="#local-6989586621679228471"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228470"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsType"><span class="hs-identifier hs-var">dsType</span></a><span> </span><a href="#local-6989586621679228472"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1148"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">UInfixT</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-string">&quot;Cannot desugar unresolved infix operators.&quot;</span><span>
</span><a name="line-1149"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParensT</span><span> </span><a name="local-6989586621679228473"><a href="#local-6989586621679228473"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPred"><span class="hs-identifier hs-var">dsPred</span></a><span> </span><a href="#local-6989586621679228473"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-1150"></a><span class="hs-identifier">dsPred</span><span> </span><span class="hs-identifier hs-var">WildCardT</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DWildCardPr"><span class="hs-identifier hs-var">DWildCardPr</span></a><span class="hs-special">]</span><span>
</span><a name="line-1151"></a><span class="hs-cpp">#endif
#if __GLASGOW_HASKELL__ &gt;= 801
</span><span class="hs-identifier">dsPred</span><span> </span><a name="local-6989586621679228474"><a href="#local-6989586621679228474"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">UnboxedSumT</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1154"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Unboxed sum seen as head of constraint: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679228474"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-1155"></a><span class="hs-cpp">#endif
#endif
</span><span>
</span><a name="line-1158"></a><span class="hs-comment">-- | Like 'reify', but safer and desugared. Uses local declarations where</span><span>
</span><a name="line-1159"></a><span class="hs-comment">-- available.</span><span>
</span><a name="line-1160"></a><span class="hs-identifier">dsReify</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226647"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226647"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DInfo"><span class="hs-identifier hs-type">DInfo</span></a><span class="hs-special">)</span><span>
</span><a name="line-1161"></a><a name="dsReify"><a href="Language.Haskell.TH.Desugar.Core.html#dsReify"><span class="hs-identifier">dsReify</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsInfo"><span class="hs-identifier hs-var">dsInfo</span></a><span> </span><span class="hs-operator hs-var">&lt;=&lt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyWithLocals_maybe"><span class="hs-identifier hs-var">reifyWithLocals_maybe</span></a><span>
</span><a name="line-1162"></a><span>
</span><a name="line-1163"></a><span class="hs-comment">-- create a list of expressions in the same order as the fields in the first argument</span><span>
</span><a name="line-1164"></a><span class="hs-comment">-- but with the values as given in the second argument</span><span>
</span><a name="line-1165"></a><span class="hs-comment">-- if a field is missing from the second argument, use the corresponding expression</span><span>
</span><a name="line-1166"></a><span class="hs-comment">-- from the third argument</span><span>
</span><a name="line-1167"></a><span class="hs-identifier">reorderFields</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226646"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">VarStrictType</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FieldExp</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226646"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span class="hs-special">]</span><span>
</span><a name="line-1168"></a><a name="reorderFields"><a href="Language.Haskell.TH.Desugar.Core.html#reorderFields"><span class="hs-identifier">reorderFields</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#reorderFields%27"><span class="hs-identifier hs-var">reorderFields'</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsExp"><span class="hs-identifier hs-var">dsExp</span></a><span>
</span><a name="line-1169"></a><span>
</span><a name="line-1170"></a><span class="hs-identifier">reorderFieldsPat</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226645"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">VarStrictType</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FieldPat</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#PatM"><span class="hs-identifier hs-type">PatM</span></a><span> </span><a href="#local-6989586621679226645"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span class="hs-special">]</span><span>
</span><a name="line-1171"></a><a name="reorderFieldsPat"><a href="Language.Haskell.TH.Desugar.Core.html#reorderFieldsPat"><span class="hs-identifier">reorderFieldsPat</span></a></a><span> </span><a name="local-6989586621679228475"><a href="#local-6989586621679228475"><span class="hs-identifier">con_name</span></a></a><span> </span><a name="local-6989586621679228476"><a href="#local-6989586621679228476"><span class="hs-identifier">field_decs</span></a></a><span> </span><a name="local-6989586621679228477"><a href="#local-6989586621679228477"><span class="hs-identifier">field_pats</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1172"></a><span>  </span><a href="Language.Haskell.TH.Desugar.Core.html#reorderFields%27"><span class="hs-identifier hs-var">reorderFields'</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsPat"><span class="hs-identifier hs-var">dsPat</span></a><span> </span><a href="#local-6989586621679228475"><span class="hs-identifier hs-var">con_name</span></a><span> </span><a href="#local-6989586621679228476"><span class="hs-identifier hs-var">field_decs</span></a><span> </span><a href="#local-6989586621679228477"><span class="hs-identifier hs-var">field_pats</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">repeat</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span class="hs-special">)</span><span>
</span><a name="line-1173"></a><span>
</span><a name="line-1174"></a><span class="hs-identifier">reorderFields'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-6989586621679226642"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679226642"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-1175"></a><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679226643"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226642"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679226644"><span class="hs-identifier hs-type">da</span></a><span class="hs-special">)</span><span>
</span><a name="line-1176"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-comment">-- ^ The name of the constructor (used for error reporting)</span><span>
</span><a name="line-1177"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">VarStrictType</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679226643"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1178"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679226644"><span class="hs-identifier hs-type">da</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226642"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679226644"><span class="hs-identifier hs-type">da</span></a><span class="hs-special">]</span><span>
</span><a name="line-1179"></a><a name="reorderFields%27"><a href="Language.Haskell.TH.Desugar.Core.html#reorderFields%27"><span class="hs-identifier">reorderFields'</span></a></a><span> </span><a name="local-6989586621679228478"><a href="#local-6989586621679228478"><span class="hs-identifier">ds_thing</span></a></a><span> </span><a name="local-6989586621679228479"><a href="#local-6989586621679228479"><span class="hs-identifier">con_name</span></a></a><span> </span><a name="local-6989586621679228480"><a href="#local-6989586621679228480"><span class="hs-identifier">field_names_types</span></a></a><span> </span><a name="local-6989586621679228481"><a href="#local-6989586621679228481"><span class="hs-identifier">field_things</span></a></a><span> </span><a name="local-6989586621679228482"><a href="#local-6989586621679228482"><span class="hs-identifier">deflts</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1180"></a><span>  </span><a href="#local-6989586621679228484"><span class="hs-identifier hs-var">check_valid_fields</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="#local-6989586621679228485"><span class="hs-identifier hs-var">reorder</span></a><span> </span><a href="#local-6989586621679228483"><span class="hs-identifier hs-var">field_names</span></a><span> </span><a href="#local-6989586621679228482"><span class="hs-identifier hs-var">deflts</span></a><span>
</span><a name="line-1181"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1182"></a><span>    </span><a name="local-6989586621679228483"><a href="#local-6989586621679228483"><span class="hs-identifier">field_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679228486"><a href="#local-6989586621679228486"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679228486"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679228480"><span class="hs-identifier hs-var">field_names_types</span></a><span>
</span><a name="line-1183"></a><span>
</span><a name="line-1184"></a><span>    </span><a name="local-6989586621679228484"><a href="#local-6989586621679228484"><span class="hs-identifier">check_valid_fields</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1185"></a><span>      </span><span class="hs-identifier hs-var">forM_</span><span> </span><a href="#local-6989586621679228481"><span class="hs-identifier hs-var">field_things</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679228487"><a href="#local-6989586621679228487"><span class="hs-identifier">thing_name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1186"></a><span>        </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679228487"><span class="hs-identifier hs-var">thing_name</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679228483"><span class="hs-identifier hs-var">field_names</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1187"></a><span>          </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Constructor &#8216;&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">nameBase</span><span> </span><a href="#local-6989586621679228479"><span class="hs-identifier hs-var">con_name</span></a><span>   </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;&#8216; does not have field &#8216;&quot;</span><span>
</span><a name="line-1188"></a><span>                                 </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">nameBase</span><span> </span><a href="#local-6989586621679228487"><span class="hs-identifier hs-var">thing_name</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;&#8216;&quot;</span><span>
</span><a name="line-1189"></a><span>
</span><a name="line-1190"></a><span>    </span><a name="local-6989586621679228485"><a href="#local-6989586621679228485"><span class="hs-identifier">reorder</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1191"></a><span>    </span><span class="hs-identifier">reorder</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679228488"><a href="#local-6989586621679228488"><span class="hs-identifier">field_name</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679228489"><a href="#local-6989586621679228489"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679228490"><a href="#local-6989586621679228490"><span class="hs-identifier">deflt</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679228491"><a href="#local-6989586621679228491"><span class="hs-identifier">rest_deflt</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1192"></a><span>      </span><a name="local-6989586621679228492"><a href="#local-6989586621679228492"><span class="hs-identifier">rest'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679228485"><span class="hs-identifier hs-var">reorder</span></a><span> </span><a href="#local-6989586621679228489"><span class="hs-identifier hs-var">rest</span></a><span> </span><a href="#local-6989586621679228491"><span class="hs-identifier hs-var">rest_deflt</span></a><span>
</span><a name="line-1193"></a><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">find</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679228493"><a href="#local-6989586621679228493"><span class="hs-identifier">thing_name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679228493"><span class="hs-identifier hs-var">thing_name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679228488"><span class="hs-identifier hs-var">field_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679228481"><span class="hs-identifier hs-var">field_things</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1194"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679228494"><a href="#local-6989586621679228494"><span class="hs-identifier">thing</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679228492"><span class="hs-identifier hs-var">rest'</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679228478"><span class="hs-identifier hs-var">ds_thing</span></a><span> </span><a href="#local-6989586621679228494"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1195"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679228490"><span class="hs-identifier hs-var">deflt</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679228492"><span class="hs-identifier hs-var">rest'</span></a><span>
</span><a name="line-1196"></a><span>    </span><span class="hs-identifier">reorder</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar.&quot;</span><span>
</span><a name="line-1197"></a><span>
</span><a name="line-1198"></a><span class="hs-comment">-- | Make a tuple 'DExp' from a list of 'DExp's. Avoids using a 1-tuple.</span><span>
</span><a name="line-1199"></a><span class="hs-identifier">mkTupleDExp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-1200"></a><a name="mkTupleDExp"><a href="Language.Haskell.TH.Desugar.Core.html#mkTupleDExp"><span class="hs-identifier">mkTupleDExp</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621679228495"><a href="#local-6989586621679228495"><span class="hs-identifier">exp</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679228495"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-1201"></a><span class="hs-identifier">mkTupleDExp</span><span> </span><a name="local-6989586621679228496"><a href="#local-6989586621679228496"><span class="hs-identifier">exps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConE"><span class="hs-identifier hs-var">DConE</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">tupleDataName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679228496"><span class="hs-identifier hs-var">exps</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679228496"><span class="hs-identifier hs-var">exps</span></a><span>
</span><a name="line-1202"></a><span>
</span><a name="line-1203"></a><span class="hs-comment">-- | Make a tuple 'Exp' from a list of 'Exp's. Avoids using a 1-tuple.</span><span>
</span><a name="line-1204"></a><span class="hs-identifier">mkTupleExp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Exp</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Exp</span><span>
</span><a name="line-1205"></a><a name="mkTupleExp"><a href="Language.Haskell.TH.Desugar.Core.html#mkTupleExp"><span class="hs-identifier">mkTupleExp</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621679228497"><a href="#local-6989586621679228497"><span class="hs-identifier">exp</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679228497"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-1206"></a><span class="hs-identifier">mkTupleExp</span><span> </span><a name="local-6989586621679228498"><a href="#local-6989586621679228498"><span class="hs-identifier">exps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><span class="hs-identifier hs-var">AppE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConE</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">tupleDataName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679228498"><span class="hs-identifier hs-var">exps</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679228498"><span class="hs-identifier hs-var">exps</span></a><span>
</span><a name="line-1207"></a><span>
</span><a name="line-1208"></a><span class="hs-comment">-- | Make a tuple 'DPat' from a list of 'DPat's. Avoids using a 1-tuple.</span><span>
</span><a name="line-1209"></a><span class="hs-identifier">mkTupleDPat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span>
</span><a name="line-1210"></a><a name="mkTupleDPat"><a href="Language.Haskell.TH.Desugar.Core.html#mkTupleDPat"><span class="hs-identifier">mkTupleDPat</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621679228499"><a href="#local-6989586621679228499"><span class="hs-identifier">pat</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679228499"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-1211"></a><span class="hs-identifier">mkTupleDPat</span><span> </span><a name="local-6989586621679228500"><a href="#local-6989586621679228500"><span class="hs-identifier">pats</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tupleDataName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679228500"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679228500"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-1212"></a><span>
</span><a name="line-1213"></a><span class="hs-comment">-- | Make a tuple 'Pat' from a list of 'Pat's. Avoids using a 1-tuple.</span><span>
</span><a name="line-1214"></a><span class="hs-identifier">mkTuplePat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Pat</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Pat</span><span>
</span><a name="line-1215"></a><a name="mkTuplePat"><a href="Language.Haskell.TH.Desugar.Core.html#mkTuplePat"><span class="hs-identifier">mkTuplePat</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621679228501"><a href="#local-6989586621679228501"><span class="hs-identifier">pat</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679228501"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-1216"></a><span class="hs-identifier">mkTuplePat</span><span> </span><a name="local-6989586621679228502"><a href="#local-6989586621679228502"><span class="hs-identifier">pats</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ConP</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tupleDataName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679228502"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679228502"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-1217"></a><span>
</span><a name="line-1218"></a><span class="hs-comment">-- | Is this pattern guaranteed to match?</span><span>
</span><a name="line-1219"></a><span class="hs-identifier">isUniversalPattern</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226641"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226641"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1220"></a><a name="isUniversalPattern"><a href="Language.Haskell.TH.Desugar.Core.html#isUniversalPattern"><span class="hs-identifier">isUniversalPattern</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitPa"><span class="hs-identifier hs-var">DLitPa</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1221"></a><span class="hs-identifier">isUniversalPattern</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1222"></a><span class="hs-identifier">isUniversalPattern</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><a name="local-6989586621679228503"><a href="#local-6989586621679228503"><span class="hs-identifier">con_name</span></a></a><span> </span><a name="local-6989586621679228504"><a href="#local-6989586621679228504"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1223"></a><span>  </span><a name="local-6989586621679228505"><a href="#local-6989586621679228505"><span class="hs-identifier">data_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#dataConNameToDataName"><span class="hs-identifier hs-var">dataConNameToDataName</span></a><span> </span><a href="#local-6989586621679228503"><span class="hs-identifier hs-var">con_name</span></a><span>
</span><a name="line-1224"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679228506"><a href="#local-6989586621679228506"><span class="hs-identifier">_tvbs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228507"><a href="#local-6989586621679228507"><span class="hs-identifier">cons</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#getDataD"><span class="hs-identifier hs-var">getDataD</span></a><span> </span><span class="hs-string">&quot;Internal error.&quot;</span><span> </span><a href="#local-6989586621679228505"><span class="hs-identifier hs-var">data_name</span></a><span>
</span><a name="line-1225"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679228507"><span class="hs-identifier hs-var">cons</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-1226"></a><span>  </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">and</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#isUniversalPattern"><span class="hs-identifier hs-var">isUniversalPattern</span></a><span> </span><a href="#local-6989586621679228504"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-1227"></a><span>  </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1228"></a><span class="hs-identifier">isUniversalPattern</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DTildePa"><span class="hs-identifier hs-var">DTildePa</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1229"></a><span class="hs-identifier">isUniversalPattern</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DBangPa"><span class="hs-identifier hs-var">DBangPa</span></a><span> </span><a name="local-6989586621679228508"><a href="#local-6989586621679228508"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#isUniversalPattern"><span class="hs-identifier hs-var">isUniversalPattern</span></a><span> </span><a href="#local-6989586621679228508"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-1230"></a><span class="hs-identifier">isUniversalPattern</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DSigPa"><span class="hs-identifier hs-var">DSigPa</span></a><span> </span><a name="local-6989586621679228509"><a href="#local-6989586621679228509"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#isUniversalPattern"><span class="hs-identifier hs-var">isUniversalPattern</span></a><span> </span><a href="#local-6989586621679228509"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-1231"></a><span class="hs-identifier">isUniversalPattern</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1232"></a><span>
</span><a name="line-1233"></a><span class="hs-comment">-- | Apply one 'DExp' to a list of arguments</span><span>
</span><a name="line-1234"></a><span class="hs-identifier">applyDExp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-1235"></a><a name="applyDExp"><a href="Language.Haskell.TH.Desugar.Core.html#applyDExp"><span class="hs-identifier">applyDExp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span>
</span><a name="line-1236"></a><span>
</span><a name="line-1237"></a><span class="hs-comment">-- | Apply one 'DType' to a list of arguments</span><span>
</span><a name="line-1238"></a><span class="hs-identifier">applyDType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span>
</span><a name="line-1239"></a><a name="applyDType"><a href="Language.Haskell.TH.Desugar.Core.html#applyDType"><span class="hs-identifier">applyDType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppT"><span class="hs-identifier hs-var">DAppT</span></a><span>
</span><a name="line-1240"></a><span>
</span><a name="line-1241"></a><span class="hs-comment">-- | Convert a 'DTyVarBndr' into a 'DType'</span><span>
</span><a name="line-1242"></a><span class="hs-identifier">dTyVarBndrToDType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTyVarBndr"><span class="hs-identifier hs-type">DTyVarBndr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span>
</span><a name="line-1243"></a><a name="dTyVarBndrToDType"><a href="Language.Haskell.TH.Desugar.Core.html#dTyVarBndrToDType"><span class="hs-identifier">dTyVarBndrToDType</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DPlainTV"><span class="hs-identifier hs-var">DPlainTV</span></a><span> </span><a name="local-6989586621679228510"><a href="#local-6989586621679228510"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarT"><span class="hs-identifier hs-var">DVarT</span></a><span> </span><a href="#local-6989586621679228510"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-1244"></a><span class="hs-identifier">dTyVarBndrToDType</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DKindedTV"><span class="hs-identifier hs-var">DKindedTV</span></a><span> </span><a name="local-6989586621679228511"><a href="#local-6989586621679228511"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679228512"><a href="#local-6989586621679228512"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarT"><span class="hs-identifier hs-var">DVarT</span></a><span> </span><a href="#local-6989586621679228511"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><a href="Language.Haskell.TH.Desugar.AST.html#DSigT"><span class="hs-identifier hs-var">DSigT</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679228512"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-1245"></a><span>
</span><a name="line-1246"></a><span class="hs-comment">-- | Convert a 'Strict' to a 'Bang' in GHCs 7.x. This is just</span><span>
</span><a name="line-1247"></a><span class="hs-comment">-- the identity operation in GHC 8.x, which has no 'Strict'.</span><span>
</span><a name="line-1248"></a><span class="hs-comment">-- (This is included in GHC 8.x only for good Haddocking.)</span><span>
</span><a name="line-1249"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &lt;= 710
</span><span class="hs-identifier">strictToBang</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Strict</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bang</span><span>
</span><a name="line-1251"></a><span class="hs-identifier">strictToBang</span><span> </span><span class="hs-identifier">IsStrict</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Bang</span><span> </span><span class="hs-identifier">NoSourceUnpackedness</span><span> </span><span class="hs-identifier">SourceStrict</span><span>
</span><a name="line-1252"></a><span class="hs-identifier">strictToBang</span><span> </span><span class="hs-identifier">NotStrict</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Bang</span><span> </span><span class="hs-identifier">NoSourceUnpackedness</span><span> </span><span class="hs-identifier">NoSourceStrictness</span><span>
</span><a name="line-1253"></a><span class="hs-identifier">strictToBang</span><span> </span><span class="hs-identifier">Unpacked</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Bang</span><span> </span><span class="hs-identifier">SourceUnpack</span><span> </span><span class="hs-identifier">SourceStrict</span><span>
</span><a name="line-1254"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">strictToBang</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bang</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bang</span><span>
</span><a name="line-1256"></a><a name="strictToBang"><a href="Language.Haskell.TH.Desugar.Core.html#strictToBang"><span class="hs-identifier">strictToBang</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-1257"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-1259"></a><span class="hs-comment">-- | Convert a 'DType' to a 'DPred'.</span><span>
</span><a name="line-1260"></a><span class="hs-identifier">dTypeToDPred</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679226640"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226640"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPred"><span class="hs-identifier hs-type">DPred</span></a><span>
</span><a name="line-1261"></a><a name="dTypeToDPred"><a href="Language.Haskell.TH.Desugar.Core.html#dTypeToDPred"><span class="hs-identifier">dTypeToDPred</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DForallT"><span class="hs-identifier hs-var">DForallT</span></a><span> </span><a name="local-6989586621679228513"><a href="#local-6989586621679228513"><span class="hs-identifier">tvbs</span></a></a><span> </span><a name="local-6989586621679228514"><a href="#local-6989586621679228514"><span class="hs-identifier">cxt</span></a></a><span> </span><a name="local-6989586621679228515"><a href="#local-6989586621679228515"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1262"></a><span>                             </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DForallPr"><span class="hs-identifier hs-var">DForallPr</span></a><span> </span><a href="#local-6989586621679228513"><span class="hs-identifier hs-var">tvbs</span></a><span> </span><a href="#local-6989586621679228514"><span class="hs-identifier hs-var">cxt</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">liftM</span><span class="hs-special">`</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dTypeToDPred"><span class="hs-identifier hs-var">dTypeToDPred</span></a><span> </span><a href="#local-6989586621679228515"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1263"></a><span class="hs-identifier">dTypeToDPred</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppT"><span class="hs-identifier hs-var">DAppT</span></a><span> </span><a name="local-6989586621679228516"><a href="#local-6989586621679228516"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679228517"><a href="#local-6989586621679228517"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM2</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppPr"><span class="hs-identifier hs-var">DAppPr</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#dTypeToDPred"><span class="hs-identifier hs-var">dTypeToDPred</span></a><span> </span><a href="#local-6989586621679228516"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679228517"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1264"></a><span class="hs-identifier">dTypeToDPred</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DSigT"><span class="hs-identifier hs-var">DSigT</span></a><span> </span><a name="local-6989586621679228518"><a href="#local-6989586621679228518"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679228519"><a href="#local-6989586621679228519"><span class="hs-identifier">ki</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM2</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DSigPr"><span class="hs-identifier hs-var">DSigPr</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#dTypeToDPred"><span class="hs-identifier hs-var">dTypeToDPred</span></a><span> </span><a href="#local-6989586621679228518"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679228519"><span class="hs-identifier hs-var">ki</span></a><span class="hs-special">)</span><span>
</span><a name="line-1265"></a><span class="hs-identifier">dTypeToDPred</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarT"><span class="hs-identifier hs-var">DVarT</span></a><span> </span><a name="local-6989586621679228520"><a href="#local-6989586621679228520"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPr"><span class="hs-identifier hs-var">DVarPr</span></a><span> </span><a href="#local-6989586621679228520"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1266"></a><span class="hs-identifier">dTypeToDPred</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><a name="local-6989586621679228521"><a href="#local-6989586621679228521"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConPr"><span class="hs-identifier hs-var">DConPr</span></a><span> </span><a href="#local-6989586621679228521"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1267"></a><span class="hs-identifier">dTypeToDPred</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DArrowT"><span class="hs-identifier hs-var">DArrowT</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;Arrow used as head of constraint&quot;</span><span>
</span><a name="line-1268"></a><span class="hs-identifier">dTypeToDPred</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitT"><span class="hs-identifier hs-var">DLitT</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a><span> </span><span class="hs-string">&quot;Type literal used as head of constraint&quot;</span><span>
</span><a name="line-1269"></a><span class="hs-identifier">dTypeToDPred</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildCardT"><span class="hs-identifier hs-var">DWildCardT</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildCardPr"><span class="hs-identifier hs-var">DWildCardPr</span></a><span>
</span><a name="line-1270"></a><span>
</span><a name="line-1271"></a><span class="hs-comment">-- | Convert a 'DPred' to 'DType'.</span><span>
</span><a name="line-1272"></a><span class="hs-identifier">dPredToDType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPred"><span class="hs-identifier hs-type">DPred</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span>
</span><a name="line-1273"></a><a name="dPredToDType"><a href="Language.Haskell.TH.Desugar.Core.html#dPredToDType"><span class="hs-identifier">dPredToDType</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DForallPr"><span class="hs-identifier hs-var">DForallPr</span></a><span> </span><a name="local-6989586621679228522"><a href="#local-6989586621679228522"><span class="hs-identifier">tvbs</span></a></a><span> </span><a name="local-6989586621679228523"><a href="#local-6989586621679228523"><span class="hs-identifier">cxt</span></a></a><span> </span><a name="local-6989586621679228524"><a href="#local-6989586621679228524"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DForallT"><span class="hs-identifier hs-var">DForallT</span></a><span> </span><a href="#local-6989586621679228522"><span class="hs-identifier hs-var">tvbs</span></a><span> </span><a href="#local-6989586621679228523"><span class="hs-identifier hs-var">cxt</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#dPredToDType"><span class="hs-identifier hs-var">dPredToDType</span></a><span> </span><a href="#local-6989586621679228524"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-1274"></a><span class="hs-identifier">dPredToDType</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppPr"><span class="hs-identifier hs-var">DAppPr</span></a><span> </span><a name="local-6989586621679228525"><a href="#local-6989586621679228525"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679228526"><a href="#local-6989586621679228526"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppT"><span class="hs-identifier hs-var">DAppT</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#dPredToDType"><span class="hs-identifier hs-var">dPredToDType</span></a><span> </span><a href="#local-6989586621679228525"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679228526"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-1275"></a><span class="hs-identifier">dPredToDType</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DSigPr"><span class="hs-identifier hs-var">DSigPr</span></a><span> </span><a name="local-6989586621679228527"><a href="#local-6989586621679228527"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679228528"><a href="#local-6989586621679228528"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DSigT"><span class="hs-identifier hs-var">DSigT</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#dPredToDType"><span class="hs-identifier hs-var">dPredToDType</span></a><span> </span><a href="#local-6989586621679228527"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679228528"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-1276"></a><span class="hs-identifier">dPredToDType</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPr"><span class="hs-identifier hs-var">DVarPr</span></a><span> </span><a name="local-6989586621679228529"><a href="#local-6989586621679228529"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarT"><span class="hs-identifier hs-var">DVarT</span></a><span> </span><a href="#local-6989586621679228529"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1277"></a><span class="hs-identifier">dPredToDType</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPr"><span class="hs-identifier hs-var">DConPr</span></a><span> </span><a name="local-6989586621679228530"><a href="#local-6989586621679228530"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><a href="#local-6989586621679228530"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1278"></a><span class="hs-identifier">dPredToDType</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildCardPr"><span class="hs-identifier hs-var">DWildCardPr</span></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildCardT"><span class="hs-identifier hs-var">DWildCardT</span></a><span>
</span><a name="line-1279"></a><span>
</span><a name="line-1280"></a><span class="hs-comment">-- Take a data type name (which does not belong to a data family) and</span><span>
</span><a name="line-1281"></a><span class="hs-comment">-- apply it to its type variable binders to form a DType.</span><span>
</span><a name="line-1282"></a><span class="hs-identifier">nonFamilyDataReturnType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DTyVarBndr"><span class="hs-identifier hs-type">DTyVarBndr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span>
</span><a name="line-1283"></a><a name="nonFamilyDataReturnType"><a href="Language.Haskell.TH.Desugar.Core.html#nonFamilyDataReturnType"><span class="hs-identifier">nonFamilyDataReturnType</span></a></a><span> </span><a name="local-6989586621679228531"><a href="#local-6989586621679228531"><span class="hs-identifier">con_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#applyDType"><span class="hs-identifier hs-var">applyDType</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><a href="#local-6989586621679228531"><span class="hs-identifier hs-var">con_name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dTyVarBndrToDType"><span class="hs-identifier hs-var">dTyVarBndrToDType</span></a><span>
</span><a name="line-1284"></a><span>
</span><a name="line-1285"></a><span class="hs-comment">-- Take a data family name and apply it to its argument types to form a</span><span>
</span><a name="line-1286"></a><span class="hs-comment">-- data family instance DType.</span><span>
</span><a name="line-1287"></a><span class="hs-identifier">dataFamInstReturnType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span>
</span><a name="line-1288"></a><a name="dataFamInstReturnType"><a href="Language.Haskell.TH.Desugar.Core.html#dataFamInstReturnType"><span class="hs-identifier">dataFamInstReturnType</span></a></a><span> </span><a name="local-6989586621679228532"><a href="#local-6989586621679228532"><span class="hs-identifier">fam_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#applyDType"><span class="hs-identifier hs-var">applyDType</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><a href="#local-6989586621679228532"><span class="hs-identifier hs-var">fam_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1289"></a><span>
</span><a name="line-1290"></a><span class="hs-comment">-- Take a data type (which does not belong to a data family) of the form</span><span>
</span><a name="line-1291"></a><span class="hs-comment">-- @Foo a :: k -&gt; Type -&gt; Type@ and return @Foo a (b :: k) (c :: Type)@, where</span><span>
</span><a name="line-1292"></a><span class="hs-comment">-- @b@ and @c@ are fresh type variable names.</span><span>
</span><a name="line-1293"></a><span class="hs-identifier">nonFamilyDataTvbs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226639"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DTyVarBndr"><span class="hs-identifier hs-type">DTyVarBndr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Kind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226639"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DTyVarBndr"><span class="hs-identifier hs-type">DTyVarBndr</span></a><span class="hs-special">]</span><span>
</span><a name="line-1294"></a><a name="nonFamilyDataTvbs"><a href="Language.Haskell.TH.Desugar.Core.html#nonFamilyDataTvbs"><span class="hs-identifier">nonFamilyDataTvbs</span></a></a><span> </span><a name="local-6989586621679228533"><a href="#local-6989586621679228533"><span class="hs-identifier">tvbs</span></a></a><span> </span><a name="local-6989586621679228534"><a href="#local-6989586621679228534"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1295"></a><span>  </span><a name="local-6989586621679228535"><a href="#local-6989586621679228535"><span class="hs-identifier">extra_tvbs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#mkExtraKindBinders"><span class="hs-identifier hs-var">mkExtraKindBinders</span></a><span> </span><a href="#local-6989586621679228534"><span class="hs-identifier hs-var">mk</span></a><span>
</span><a name="line-1296"></a><span>  </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679228533"><span class="hs-identifier hs-var">tvbs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679228535"><span class="hs-identifier hs-var">extra_tvbs</span></a><span>
</span><a name="line-1297"></a><span>
</span><a name="line-1298"></a><span class="hs-comment">-- Take a data family instance of the form @Foo a :: k -&gt; Type -&gt; Type@ and</span><span>
</span><a name="line-1299"></a><span class="hs-comment">-- return @Foo a (b :: k) (c :: Type)@, where @b@ and @c@ are fresh type</span><span>
</span><a name="line-1300"></a><span class="hs-comment">-- variable names.</span><span>
</span><a name="line-1301"></a><span class="hs-identifier">dataFamInstTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679226638"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Kind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226638"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span class="hs-special">]</span><span>
</span><a name="line-1302"></a><a name="dataFamInstTypes"><a href="Language.Haskell.TH.Desugar.Core.html#dataFamInstTypes"><span class="hs-identifier">dataFamInstTypes</span></a></a><span> </span><a name="local-6989586621679228536"><a href="#local-6989586621679228536"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-6989586621679228537"><a href="#local-6989586621679228537"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1303"></a><span>  </span><a name="local-6989586621679228538"><a href="#local-6989586621679228538"><span class="hs-identifier">extra_tvbs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#mkExtraKindBinders"><span class="hs-identifier hs-var">mkExtraKindBinders</span></a><span> </span><a href="#local-6989586621679228537"><span class="hs-identifier hs-var">mk</span></a><span>
</span><a name="line-1304"></a><span>  </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679228536"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dTyVarBndrToDType"><span class="hs-identifier hs-var">dTyVarBndrToDType</span></a><span> </span><a href="#local-6989586621679228538"><span class="hs-identifier hs-var">extra_tvbs</span></a><span>
</span><a name="line-1305"></a><span>
</span><a name="line-1306"></a><span class="hs-comment">-- Unlike vanilla data types and data family declarations, data family</span><span>
</span><a name="line-1307"></a><span class="hs-comment">-- instance declarations do not come equipped with a list of bound type</span><span>
</span><a name="line-1308"></a><span class="hs-comment">-- variables (at least not yet&#8212;see Trac #14268). This means that we have</span><span>
</span><a name="line-1309"></a><span class="hs-comment">-- to reverse engineer this information ourselves from the list of type</span><span>
</span><a name="line-1310"></a><span class="hs-comment">-- patterns. We accomplish this by taking the free variables of the types</span><span>
</span><a name="line-1311"></a><span class="hs-comment">-- and performing a reverse topological sort on them to ensure that the</span><span>
</span><a name="line-1312"></a><span class="hs-comment">-- returned list is well scoped.</span><span>
</span><a name="line-1313"></a><span class="hs-identifier">dataFamInstTvbs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DTyVarBndr"><span class="hs-identifier hs-type">DTyVarBndr</span></a><span class="hs-special">]</span><span>
</span><a name="line-1314"></a><a name="dataFamInstTvbs"><a href="Language.Haskell.TH.Desugar.Core.html#dataFamInstTvbs"><span class="hs-identifier">dataFamInstTvbs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#toposortTyVarsOf"><span class="hs-identifier hs-var">toposortTyVarsOf</span></a><span>
</span><a name="line-1315"></a><span>
</span><a name="line-1316"></a><span class="hs-comment">-- | Take a list of 'DType's, find their free variables, and sort them in</span><span>
</span><a name="line-1317"></a><span class="hs-comment">-- reverse topological order to ensure that they are well scoped.</span><span>
</span><a name="line-1318"></a><span class="hs-comment">--</span><span>
</span><a name="line-1319"></a><span class="hs-comment">-- On older GHCs, this takes measures to avoid returning explicitly bound</span><span>
</span><a name="line-1320"></a><span class="hs-comment">-- kind variables, which was not possible before @TypeInType@.</span><span>
</span><a name="line-1321"></a><span class="hs-identifier">toposortTyVarsOf</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DTyVarBndr"><span class="hs-identifier hs-type">DTyVarBndr</span></a><span class="hs-special">]</span><span>
</span><a name="line-1322"></a><a name="toposortTyVarsOf"><a href="Language.Haskell.TH.Desugar.Core.html#toposortTyVarsOf"><span class="hs-identifier">toposortTyVarsOf</span></a></a><span> </span><a name="local-6989586621679228539"><a href="#local-6989586621679228539"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1323"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">fvs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>
</span><a name="line-1324"></a><span>      </span><a name="local-6989586621679228540"><a href="#local-6989586621679228540"><span class="hs-identifier">fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Set.toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#fvDType"><span class="hs-identifier hs-var">fvDType</span></a><span> </span><a href="#local-6989586621679228539"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1325"></a><span>
</span><a name="line-1326"></a><span>      </span><span class="hs-identifier">varKindSigs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DKind"><span class="hs-identifier hs-type">DKind</span></a><span>
</span><a name="line-1327"></a><span>      </span><a name="local-6989586621679228541"><a href="#local-6989586621679228541"><span class="hs-identifier">varKindSigs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><a href="#local-6989586621679228548"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679228539"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1328"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-1329"></a><span>          </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DKind"><span class="hs-identifier hs-type">DKind</span></a><span>
</span><a name="line-1330"></a><span>          </span><a name="local-6989586621679228548"><a href="#local-6989586621679228548"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DForallT"><span class="hs-identifier hs-var">DForallT</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;`forall` type used in type family pattern&quot;</span><span>
</span><a name="line-1331"></a><span>          </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppT"><span class="hs-identifier hs-var">DAppT</span></a><span> </span><a name="local-6989586621679228549"><a href="#local-6989586621679228549"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679228550"><a href="#local-6989586621679228550"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679228548"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679228549"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679228548"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679228550"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1332"></a><span>          </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DSigT"><span class="hs-identifier hs-var">DSigT</span></a><span> </span><a name="local-6989586621679228551"><a href="#local-6989586621679228551"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679228552"><a href="#local-6989586621679228552"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1333"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679228553"><a href="#local-6989586621679228553"><span class="hs-identifier">kSigs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679228548"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679228552"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-1334"></a><span>            </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679228551"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1335"></a><span>                 </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarT"><span class="hs-identifier hs-var">DVarT</span></a><span> </span><a name="local-6989586621679228554"><a href="#local-6989586621679228554"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Map.insert</span><span> </span><a href="#local-6989586621679228554"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679228552"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679228553"><span class="hs-identifier hs-var">kSigs</span></a><span>
</span><a name="line-1336"></a><span>                 </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679228548"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679228551"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679228553"><span class="hs-identifier hs-var">kSigs</span></a><span>
</span><a name="line-1337"></a><span>          </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarT"><span class="hs-identifier hs-var">DVarT</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-1338"></a><span>          </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-1339"></a><span>          </span><span class="hs-identifier">go</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DArrowT"><span class="hs-identifier hs-var">DArrowT</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-1340"></a><span>          </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitT"><span class="hs-identifier hs-var">DLitT</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-1341"></a><span>          </span><span class="hs-identifier">go</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildCardT"><span class="hs-identifier hs-var">DWildCardT</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-1342"></a><span>
</span><a name="line-1343"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679228542"><a href="#local-6989586621679228542"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228543"><a href="#local-6989586621679228543"><span class="hs-identifier">gLookup</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1344"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">graphFromEdges</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679228555"><span class="hs-identifier hs-var">fv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679228555"><span class="hs-identifier hs-var">fv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679228556"><span class="hs-identifier hs-var">kindVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1345"></a><span>                         </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679228555"><a href="#local-6989586621679228555"><span class="hs-identifier">fv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679228540"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-1346"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679228556"><a href="#local-6989586621679228556"><span class="hs-identifier">kindVars</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1347"></a><span>                                 </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><a href="#local-6989586621679228555"><span class="hs-identifier hs-var">fv</span></a><span> </span><a href="#local-6989586621679228541"><span class="hs-identifier hs-var">varKindSigs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1348"></a><span>                                   </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1349"></a><span>                                   </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679228557"><a href="#local-6989586621679228557"><span class="hs-identifier">ks</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Set.toList</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#fvDType"><span class="hs-identifier hs-var">fvDType</span></a><span> </span><a href="#local-6989586621679228557"><span class="hs-identifier hs-var">ks</span></a><span class="hs-special">)</span><span>
</span><a name="line-1350"></a><span>                         </span><span class="hs-special">]</span><span>
</span><a name="line-1351"></a><span>      </span><a name="local-6989586621679228544"><a href="#local-6989586621679228544"><span class="hs-identifier">tg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">topSort</span><span> </span><a href="#local-6989586621679228542"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-1352"></a><span>
</span><a name="line-1353"></a><span>      </span><a name="local-6989586621679228545"><a href="#local-6989586621679228545"><span class="hs-identifier">lookupVertex</span></a></a><span> </span><a name="local-6989586621679228558"><a href="#local-6989586621679228558"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1354"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679228543"><span class="hs-identifier hs-var">gLookup</span></a><span> </span><a href="#local-6989586621679228558"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1355"></a><span>          </span><span class="hs-special">(</span><a name="local-6989586621679228559"><a href="#local-6989586621679228559"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679228559"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1356"></a><span>
</span><a name="line-1357"></a><span>      </span><a name="local-6989586621679228546"><a href="#local-6989586621679228546"><span class="hs-identifier">ascribeWithKind</span></a></a><span> </span><a name="local-6989586621679228560"><a href="#local-6989586621679228560"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-1358"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679228561"><a href="#local-6989586621679228561"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><a href="#local-6989586621679228560"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679228541"><span class="hs-identifier hs-var">varKindSigs</span></a><span>
</span><a name="line-1359"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DKindedTV"><span class="hs-identifier hs-var">DKindedTV</span></a><span> </span><a href="#local-6989586621679228560"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679228561"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-1360"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1361"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPlainTV"><span class="hs-identifier hs-var">DPlainTV</span></a><span> </span><a href="#local-6989586621679228560"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1362"></a><span>
</span><a name="line-1363"></a><span>      </span><span class="hs-comment">-- An annoying wrinkle: GHCs before 8.0 don't support explicitly</span><span>
</span><a name="line-1364"></a><span>      </span><span class="hs-comment">-- quantifying kinds, so something like @forall k (a :: k)@ would be</span><span>
</span><a name="line-1365"></a><span>      </span><span class="hs-comment">-- rejected. To work around this, we filter out any binders whose names</span><span>
</span><a name="line-1366"></a><span>      </span><span class="hs-comment">-- also appear in a kind on old GHCs.</span><span>
</span><a name="line-1367"></a><span>      </span><a name="local-6989586621679228547"><a href="#local-6989586621679228547"><span class="hs-identifier">isKindBinderOnOldGHCs</span></a></a><span>
</span><a name="line-1368"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 800
</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1370"></a><span class="hs-cpp">#else
</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier">elem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">kindVars</span><span class="hs-special">)</span><span>
</span><a name="line-1372"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-1373"></a><span>            </span><span class="hs-identifier">kindVars</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">foldMap</span><span> </span><span class="hs-identifier">fvDType</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">Map.elems</span><span> </span><span class="hs-identifier">varKindSigs</span><span>
</span><a name="line-1374"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-1376"></a><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679228546"><span class="hs-identifier hs-var">ascribeWithKind</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1377"></a><span>     </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679228547"><span class="hs-identifier hs-var">isKindBinderOnOldGHCs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1378"></a><span>     </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679228545"><span class="hs-identifier hs-var">lookupVertex</span></a><span> </span><a href="#local-6989586621679228544"><span class="hs-identifier hs-var">tg</span></a><span>
</span><a name="line-1379"></a><span>
</span><a name="line-1380"></a><span class="hs-identifier">fvDType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">S.Set</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-1381"></a><a name="fvDType"><a href="Language.Haskell.TH.Desugar.Core.html#fvDType"><span class="hs-identifier">fvDType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679228562"><span class="hs-identifier hs-var">go_ty</span></a><span>
</span><a name="line-1382"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1383"></a><span>    </span><span class="hs-identifier">go_ty</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">S.Set</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-1384"></a><span>    </span><a name="local-6989586621679228562"><a href="#local-6989586621679228562"><span class="hs-identifier">go_ty</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DForallT"><span class="hs-identifier hs-var">DForallT</span></a><span> </span><a name="local-6989586621679228565"><a href="#local-6989586621679228565"><span class="hs-identifier">tvbs</span></a></a><span> </span><a name="local-6989586621679228566"><a href="#local-6989586621679228566"><span class="hs-identifier">cxt</span></a></a><span> </span><a name="local-6989586621679228567"><a href="#local-6989586621679228567"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="#local-6989586621679228564"><span class="hs-identifier hs-var">go_tvb</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldMap</span><span> </span><a href="#local-6989586621679228563"><span class="hs-identifier hs-var">go_pred</span></a><span> </span><a href="#local-6989586621679228566"><span class="hs-identifier hs-var">cxt</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679228562"><span class="hs-identifier hs-var">go_ty</span></a><span> </span><a href="#local-6989586621679228567"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679228565"><span class="hs-identifier hs-var">tvbs</span></a><span>
</span><a name="line-1385"></a><span>    </span><span class="hs-identifier">go_ty</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppT"><span class="hs-identifier hs-var">DAppT</span></a><span> </span><a name="local-6989586621679228568"><a href="#local-6989586621679228568"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679228569"><a href="#local-6989586621679228569"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679228562"><span class="hs-identifier hs-var">go_ty</span></a><span> </span><a href="#local-6989586621679228568"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679228562"><span class="hs-identifier hs-var">go_ty</span></a><span> </span><a href="#local-6989586621679228569"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1386"></a><span>    </span><span class="hs-identifier">go_ty</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DSigT"><span class="hs-identifier hs-var">DSigT</span></a><span> </span><a name="local-6989586621679228570"><a href="#local-6989586621679228570"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679228571"><a href="#local-6989586621679228571"><span class="hs-identifier">ki</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679228562"><span class="hs-identifier hs-var">go_ty</span></a><span> </span><a href="#local-6989586621679228570"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679228562"><span class="hs-identifier hs-var">go_ty</span></a><span> </span><a href="#local-6989586621679228571"><span class="hs-identifier hs-var">ki</span></a><span>
</span><a name="line-1387"></a><span>    </span><span class="hs-identifier">go_ty</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarT"><span class="hs-identifier hs-var">DVarT</span></a><span> </span><a name="local-6989586621679228572"><a href="#local-6989586621679228572"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.singleton</span><span> </span><a href="#local-6989586621679228572"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1388"></a><span>    </span><span class="hs-identifier">go_ty</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConT"><span class="hs-identifier hs-var">DConT</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.empty</span><span>
</span><a name="line-1389"></a><span>    </span><span class="hs-identifier">go_ty</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DArrowT"><span class="hs-identifier hs-var">DArrowT</span></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.empty</span><span>
</span><a name="line-1390"></a><span>    </span><span class="hs-identifier">go_ty</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitT"><span class="hs-identifier hs-var">DLitT</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.empty</span><span>
</span><a name="line-1391"></a><span>    </span><span class="hs-identifier">go_ty</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildCardT"><span class="hs-identifier hs-var">DWildCardT</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.empty</span><span>
</span><a name="line-1392"></a><span>
</span><a name="line-1393"></a><span>    </span><span class="hs-identifier">go_pred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPred"><span class="hs-identifier hs-type">DPred</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">S.Set</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-1394"></a><span>    </span><a name="local-6989586621679228563"><a href="#local-6989586621679228563"><span class="hs-identifier">go_pred</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppPr"><span class="hs-identifier hs-var">DAppPr</span></a><span> </span><a name="local-6989586621679228573"><a href="#local-6989586621679228573"><span class="hs-identifier">pr</span></a></a><span> </span><a name="local-6989586621679228574"><a href="#local-6989586621679228574"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679228563"><span class="hs-identifier hs-var">go_pred</span></a><span> </span><a href="#local-6989586621679228573"><span class="hs-identifier hs-var">pr</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679228562"><span class="hs-identifier hs-var">go_ty</span></a><span> </span><a href="#local-6989586621679228574"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1395"></a><span>    </span><span class="hs-identifier">go_pred</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DSigPr"><span class="hs-identifier hs-var">DSigPr</span></a><span> </span><a name="local-6989586621679228575"><a href="#local-6989586621679228575"><span class="hs-identifier">pr</span></a></a><span> </span><a name="local-6989586621679228576"><a href="#local-6989586621679228576"><span class="hs-identifier">ki</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679228563"><span class="hs-identifier hs-var">go_pred</span></a><span> </span><a href="#local-6989586621679228575"><span class="hs-identifier hs-var">pr</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679228562"><span class="hs-identifier hs-var">go_ty</span></a><span> </span><a href="#local-6989586621679228576"><span class="hs-identifier hs-var">ki</span></a><span>
</span><a name="line-1396"></a><span>    </span><span class="hs-identifier">go_pred</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPr"><span class="hs-identifier hs-var">DVarPr</span></a><span> </span><a name="local-6989586621679228577"><a href="#local-6989586621679228577"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.singleton</span><span> </span><a href="#local-6989586621679228577"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1397"></a><span>    </span><span class="hs-identifier">go_pred</span><span> </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.empty</span><span>
</span><a name="line-1398"></a><span>
</span><a name="line-1399"></a><span>    </span><span class="hs-identifier">go_tvb</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTyVarBndr"><span class="hs-identifier hs-type">DTyVarBndr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">S.Set</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">S.Set</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-1400"></a><span>    </span><a name="local-6989586621679228564"><a href="#local-6989586621679228564"><span class="hs-identifier">go_tvb</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DPlainTV"><span class="hs-identifier hs-var">DPlainTV</span></a><span> </span><a name="local-6989586621679228578"><a href="#local-6989586621679228578"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>    </span><a name="local-6989586621679228579"><a href="#local-6989586621679228579"><span class="hs-identifier">fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.delete</span><span> </span><a href="#local-6989586621679228578"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679228579"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-1401"></a><span>    </span><span class="hs-identifier">go_tvb</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DKindedTV"><span class="hs-identifier hs-var">DKindedTV</span></a><span> </span><a name="local-6989586621679228580"><a href="#local-6989586621679228580"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679228581"><a href="#local-6989586621679228581"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679228582"><a href="#local-6989586621679228582"><span class="hs-identifier">fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.delete</span><span> </span><a href="#local-6989586621679228580"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679228582"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679228562"><span class="hs-identifier hs-var">go_ty</span></a><span> </span><a href="#local-6989586621679228581"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-1402"></a><span>
</span><a name="line-1403"></a><span class="hs-identifier">dtvbName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DTyVarBndr"><span class="hs-identifier hs-type">DTyVarBndr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-1404"></a><a name="dtvbName"><a href="Language.Haskell.TH.Desugar.Core.html#dtvbName"><span class="hs-identifier">dtvbName</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DPlainTV"><span class="hs-identifier hs-var">DPlainTV</span></a><span> </span><a name="local-6989586621679228583"><a href="#local-6989586621679228583"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679228583"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1405"></a><span class="hs-identifier">dtvbName</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DKindedTV"><span class="hs-identifier hs-var">DKindedTV</span></a><span> </span><a name="local-6989586621679228584"><a href="#local-6989586621679228584"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679228584"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1406"></a><span>
</span><a name="line-1407"></a><span class="hs-comment">-- | Decompose a function type into its type variables, its context, its</span><span>
</span><a name="line-1408"></a><span class="hs-comment">-- argument types, and its result type.</span><span>
</span><a name="line-1409"></a><span class="hs-identifier">unravel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DTyVarBndr"><span class="hs-identifier hs-type">DTyVarBndr</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DPred"><span class="hs-identifier hs-type">DPred</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span class="hs-special">)</span><span>
</span><a name="line-1410"></a><a name="unravel"><a href="Language.Haskell.TH.Desugar.Core.html#unravel"><span class="hs-identifier">unravel</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DForallT"><span class="hs-identifier hs-var">DForallT</span></a><span> </span><a name="local-6989586621679228585"><a href="#local-6989586621679228585"><span class="hs-identifier">tvbs</span></a></a><span> </span><a name="local-6989586621679228586"><a href="#local-6989586621679228586"><span class="hs-identifier">cxt</span></a></a><span> </span><a name="local-6989586621679228587"><a href="#local-6989586621679228587"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1411"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679228588"><a href="#local-6989586621679228588"><span class="hs-identifier">tvbs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228589"><a href="#local-6989586621679228589"><span class="hs-identifier">cxt'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228590"><a href="#local-6989586621679228590"><span class="hs-identifier">tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228591"><a href="#local-6989586621679228591"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#unravel"><span class="hs-identifier hs-var">unravel</span></a><span> </span><a href="#local-6989586621679228587"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1412"></a><span>  </span><span class="hs-special">(</span><a href="#local-6989586621679228585"><span class="hs-identifier hs-var">tvbs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679228588"><span class="hs-identifier hs-var">tvbs'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679228586"><span class="hs-identifier hs-var">cxt</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679228589"><span class="hs-identifier hs-var">cxt'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679228590"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679228591"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-1413"></a><span class="hs-identifier">unravel</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppT"><span class="hs-identifier hs-var">DAppT</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppT"><span class="hs-identifier hs-var">DAppT</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DArrowT"><span class="hs-identifier hs-var">DArrowT</span></a><span> </span><a name="local-6989586621679228592"><a href="#local-6989586621679228592"><span class="hs-identifier">t1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679228593"><a href="#local-6989586621679228593"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1414"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679228594"><a href="#local-6989586621679228594"><span class="hs-identifier">tvbs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228595"><a href="#local-6989586621679228595"><span class="hs-identifier">cxt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228596"><a href="#local-6989586621679228596"><span class="hs-identifier">tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679228597"><a href="#local-6989586621679228597"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#unravel"><span class="hs-identifier hs-var">unravel</span></a><span> </span><a href="#local-6989586621679228593"><span class="hs-identifier hs-var">t2</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-1415"></a><span>  </span><span class="hs-special">(</span><a href="#local-6989586621679228594"><span class="hs-identifier hs-var">tvbs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679228595"><span class="hs-identifier hs-var">cxt</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679228592"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679228596"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679228597"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-1416"></a><span class="hs-identifier">unravel</span><span> </span><a name="local-6989586621679228598"><a href="#local-6989586621679228598"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679228598"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-1417"></a></pre></body></html>