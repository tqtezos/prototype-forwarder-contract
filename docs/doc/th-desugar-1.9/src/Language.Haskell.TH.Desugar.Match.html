<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- Language/Haskell/TH/Desugar/Match.hs

(c) Richard Eisenberg 2013
rae@cs.brynmawr.edu

Simplifies case statements in desugared TH. After this pass, there are no
more nested patterns.

This code is directly based on the analogous operation as written in GHC.
-}</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-pragma">{-# LANGUAGE CPP, TemplateHaskell #-}</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &lt;= 708
</span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><a name="line-16"></a><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>   </span><span class="hs-comment">-- we need Ord Lit. argh.</span><span>
</span><a name="line-17"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-19"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.Haskell.TH.Desugar.Match</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#scExp"><span class="hs-identifier hs-var">scExp</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#scLetDec"><span class="hs-identifier hs-var">scLetDec</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">fail</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">exp</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &lt; 709
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Applicative</span><span>
</span><a name="line-25"></a><span class="hs-cpp">#endif
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Monad</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Data</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Generics</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Set</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">S</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language.Haskell.TH.Instances</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language.Haskell.TH.Syntax</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html"><span class="hs-identifier">Language.Haskell.TH.Desugar.AST</span></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html"><span class="hs-identifier">Language.Haskell.TH.Desugar.Core</span></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html"><span class="hs-identifier">Language.Haskell.TH.Desugar.Util</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html"><span class="hs-identifier">Language.Haskell.TH.Desugar.Reify</span></a><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-comment">-- | Remove all nested pattern-matches within this expression. This also</span><span>
</span><a name="line-41"></a><span class="hs-comment">-- removes all 'DTildePa's and 'DBangPa's. After this is run, every pattern</span><span>
</span><a name="line-42"></a><span class="hs-comment">-- is guaranteed to be either a 'DConPa' with bare variables as arguments,</span><span>
</span><a name="line-43"></a><span class="hs-comment">-- a 'DLitPa', or a 'DWildPa'.</span><span>
</span><a name="line-44"></a><span class="hs-identifier">scExp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302264"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302264"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-45"></a><a name="scExp"><a href="Language.Haskell.TH.Desugar.Match.html#scExp"><span class="hs-identifier">scExp</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><a name="local-6989586621679302265"><a href="#local-6989586621679302265"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621679302266"><a href="#local-6989586621679302266"><span class="hs-identifier">e2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#scExp"><span class="hs-identifier hs-var">scExp</span></a><span> </span><a href="#local-6989586621679302265"><span class="hs-identifier hs-var">e1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#scExp"><span class="hs-identifier hs-var">scExp</span></a><span> </span><a href="#local-6989586621679302266"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-46"></a><span class="hs-identifier">scExp</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLamE"><span class="hs-identifier hs-var">DLamE</span></a><span> </span><a name="local-6989586621679302267"><a href="#local-6989586621679302267"><span class="hs-identifier">names</span></a></a><span> </span><a name="local-6989586621679302268"><a href="#local-6989586621679302268"><span class="hs-identifier">exp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLamE"><span class="hs-identifier hs-var">DLamE</span></a><span> </span><a href="#local-6989586621679302267"><span class="hs-identifier hs-var">names</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#scExp"><span class="hs-identifier hs-var">scExp</span></a><span> </span><a href="#local-6989586621679302268"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-47"></a><span class="hs-identifier">scExp</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DCaseE"><span class="hs-identifier hs-var">DCaseE</span></a><span> </span><a name="local-6989586621679302269"><a href="#local-6989586621679302269"><span class="hs-identifier">scrut</span></a></a><span> </span><a name="local-6989586621679302270"><a href="#local-6989586621679302270"><span class="hs-identifier">matches</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a name="local-6989586621679302275"><a href="#local-6989586621679302275"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679302269"><span class="hs-identifier hs-var">scrut</span></a><span>
</span><a name="line-49"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#simplCaseExp"><span class="hs-identifier hs-var">simplCaseExp</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679302275"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679302271"><span class="hs-identifier hs-var">clauses</span></a><span>
</span><a name="line-50"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-51"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679302276"><a href="#local-6989586621679302276"><span class="hs-identifier">scrut_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#newUniqueName"><span class="hs-identifier hs-var">newUniqueName</span></a><span> </span><span class="hs-string">&quot;scrut&quot;</span><span>
</span><a name="line-52"></a><span>       </span><a name="local-6989586621679302277"><a href="#local-6989586621679302277"><span class="hs-identifier">case_exp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#simplCaseExp"><span class="hs-identifier hs-var">simplCaseExp</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679302276"><span class="hs-identifier hs-var">scrut_name</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679302271"><span class="hs-identifier hs-var">clauses</span></a><span>
</span><a name="line-53"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLetE"><span class="hs-identifier hs-var">DLetE</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DValD"><span class="hs-identifier hs-var">DValD</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a href="#local-6989586621679302276"><span class="hs-identifier hs-var">scrut_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302269"><span class="hs-identifier hs-var">scrut</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679302277"><span class="hs-identifier hs-var">case_exp</span></a><span>
</span><a name="line-54"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-55"></a><span>    </span><a name="local-6989586621679302271"><a href="#local-6989586621679302271"><span class="hs-identifier">clauses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679302272"><span class="hs-identifier hs-var">match_to_clause</span></a><span> </span><a href="#local-6989586621679302270"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-56"></a><span>    </span><a name="local-6989586621679302272"><a href="#local-6989586621679302272"><span class="hs-identifier">match_to_clause</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><a name="local-6989586621679302273"><a href="#local-6989586621679302273"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679302274"><a href="#local-6989586621679302274"><span class="hs-identifier">exp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DClause"><span class="hs-identifier hs-var">DClause</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679302273"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679302274"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-identifier">scExp</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLetE"><span class="hs-identifier hs-var">DLetE</span></a><span> </span><a name="local-6989586621679302278"><a href="#local-6989586621679302278"><span class="hs-identifier">decs</span></a></a><span> </span><a name="local-6989586621679302279"><a href="#local-6989586621679302279"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLetE"><span class="hs-identifier hs-var">DLetE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#scLetDec"><span class="hs-identifier hs-var">scLetDec</span></a><span> </span><a href="#local-6989586621679302278"><span class="hs-identifier hs-var">decs</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#scExp"><span class="hs-identifier hs-var">scExp</span></a><span> </span><a href="#local-6989586621679302279"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-59"></a><span class="hs-identifier">scExp</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DSigE"><span class="hs-identifier hs-var">DSigE</span></a><span> </span><a name="local-6989586621679302280"><a href="#local-6989586621679302280"><span class="hs-identifier">exp</span></a></a><span> </span><a name="local-6989586621679302281"><a href="#local-6989586621679302281"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DSigE"><span class="hs-identifier hs-var">DSigE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#scExp"><span class="hs-identifier hs-var">scExp</span></a><span> </span><a href="#local-6989586621679302280"><span class="hs-identifier hs-var">exp</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679302281"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-60"></a><span class="hs-identifier">scExp</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppTypeE"><span class="hs-identifier hs-var">DAppTypeE</span></a><span> </span><a name="local-6989586621679302282"><a href="#local-6989586621679302282"><span class="hs-identifier">exp</span></a></a><span> </span><a name="local-6989586621679302283"><a href="#local-6989586621679302283"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppTypeE"><span class="hs-identifier hs-var">DAppTypeE</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#scExp"><span class="hs-identifier hs-var">scExp</span></a><span> </span><a href="#local-6989586621679302282"><span class="hs-identifier hs-var">exp</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679302283"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-61"></a><span class="hs-identifier">scExp</span><span> </span><a name="local-6989586621679302284"><a href="#local-6989586621679302284"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679302284"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-62"></a><span class="hs-identifier">scExp</span><span> </span><a name="local-6989586621679302285"><a href="#local-6989586621679302285"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConE"><span class="hs-identifier hs-var">DConE</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679302285"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-63"></a><span class="hs-identifier">scExp</span><span> </span><a name="local-6989586621679302286"><a href="#local-6989586621679302286"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitE"><span class="hs-identifier hs-var">DLitE</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679302286"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-64"></a><span class="hs-identifier">scExp</span><span> </span><a name="local-6989586621679302287"><a href="#local-6989586621679302287"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DStaticE"><span class="hs-identifier hs-var">DStaticE</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679302287"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-comment">-- | Like 'scExp', but for a 'DLetDec'.</span><span>
</span><a name="line-67"></a><span class="hs-identifier">scLetDec</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302263"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLetDec"><span class="hs-identifier hs-type">DLetDec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302263"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLetDec"><span class="hs-identifier hs-type">DLetDec</span></a><span>
</span><a name="line-68"></a><a name="scLetDec"><a href="Language.Haskell.TH.Desugar.Match.html#scLetDec"><span class="hs-identifier">scLetDec</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DFunD"><span class="hs-identifier hs-var">DFunD</span></a><span> </span><a name="local-6989586621679302288"><a href="#local-6989586621679302288"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679302289"><a href="#local-6989586621679302289"><span class="hs-identifier">clauses</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DClause"><span class="hs-identifier hs-var">DClause</span></a><span> </span><a name="local-6989586621679302290"><a href="#local-6989586621679302290"><span class="hs-identifier">pats1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-69"></a><span>  </span><a name="local-6989586621679302294"><a href="#local-6989586621679302294"><span class="hs-identifier">arg_names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Util.html#newUniqueName"><span class="hs-identifier hs-var">newUniqueName</span></a><span> </span><span class="hs-string">&quot;_arg&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302290"><span class="hs-identifier hs-var">pats1</span></a><span>
</span><a name="line-70"></a><span>  </span><a name="local-6989586621679302295"><a href="#local-6989586621679302295"><span class="hs-identifier">clauses'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621679302291"><span class="hs-identifier hs-var">sc_clause_rhs</span></a><span> </span><a href="#local-6989586621679302289"><span class="hs-identifier hs-var">clauses</span></a><span>
</span><a name="line-71"></a><span>  </span><a name="local-6989586621679302296"><a href="#local-6989586621679302296"><span class="hs-identifier">case_exp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#simplCaseExp"><span class="hs-identifier hs-var">simplCaseExp</span></a><span> </span><a href="#local-6989586621679302294"><span class="hs-identifier hs-var">arg_names</span></a><span> </span><a href="#local-6989586621679302295"><span class="hs-identifier hs-var">clauses'</span></a><span>
</span><a name="line-72"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DFunD"><span class="hs-identifier hs-var">DFunD</span></a><span> </span><a href="#local-6989586621679302288"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DClause"><span class="hs-identifier hs-var">DClause</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a href="#local-6989586621679302294"><span class="hs-identifier hs-var">arg_names</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302296"><span class="hs-identifier hs-var">case_exp</span></a><span class="hs-special">]</span><span>
</span><a name="line-73"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-74"></a><span>    </span><a name="local-6989586621679302291"><a href="#local-6989586621679302291"><span class="hs-identifier">sc_clause_rhs</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DClause"><span class="hs-identifier hs-var">DClause</span></a><span> </span><a name="local-6989586621679302292"><a href="#local-6989586621679302292"><span class="hs-identifier">pats</span></a></a><span> </span><a name="local-6989586621679302293"><a href="#local-6989586621679302293"><span class="hs-identifier">exp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DClause"><span class="hs-identifier hs-var">DClause</span></a><span> </span><a href="#local-6989586621679302292"><span class="hs-identifier hs-var">pats</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#scExp"><span class="hs-identifier hs-var">scExp</span></a><span> </span><a href="#local-6989586621679302293"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-75"></a><span class="hs-identifier">scLetDec</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DValD"><span class="hs-identifier hs-var">DValD</span></a><span> </span><a name="local-6989586621679302297"><a href="#local-6989586621679302297"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679302298"><a href="#local-6989586621679302298"><span class="hs-identifier">exp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DValD"><span class="hs-identifier hs-var">DValD</span></a><span> </span><a href="#local-6989586621679302297"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#scExp"><span class="hs-identifier hs-var">scExp</span></a><span> </span><a href="#local-6989586621679302298"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-76"></a><span class="hs-identifier">scLetDec</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DPragmaD"><span class="hs-identifier hs-var">DPragmaD</span></a><span> </span><a name="local-6989586621679302299"><a href="#local-6989586621679302299"><span class="hs-identifier">prag</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPragmaD"><span class="hs-identifier hs-var">DPragmaD</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#scLetPragma"><span class="hs-identifier hs-var">scLetPragma</span></a><span> </span><a href="#local-6989586621679302299"><span class="hs-identifier hs-var">prag</span></a><span>
</span><a name="line-77"></a><span class="hs-identifier">scLetDec</span><span> </span><a name="local-6989586621679302300"><a href="#local-6989586621679302300"><span class="hs-identifier">dec</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DSigD"><span class="hs-identifier hs-var">DSigD</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679302300"><span class="hs-identifier hs-var">dec</span></a><span>
</span><a name="line-78"></a><span class="hs-identifier">scLetDec</span><span> </span><a name="local-6989586621679302301"><a href="#local-6989586621679302301"><span class="hs-identifier">dec</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DInfixD"><span class="hs-identifier hs-var">DInfixD</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679302301"><span class="hs-identifier hs-var">dec</span></a><span>
</span><a name="line-79"></a><span class="hs-identifier">scLetDec</span><span> </span><a name="local-6989586621679302302"><a href="#local-6989586621679302302"><span class="hs-identifier">dec</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DFunD"><span class="hs-identifier hs-var">DFunD</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679302302"><span class="hs-identifier hs-var">dec</span></a><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-identifier">scLetPragma</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302262"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPragma"><span class="hs-identifier hs-type">DPragma</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302262"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPragma"><span class="hs-identifier hs-type">DPragma</span></a><span>
</span><a name="line-82"></a><a name="scLetPragma"><a href="Language.Haskell.TH.Desugar.Match.html#scLetPragma"><span class="hs-identifier">scLetPragma</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#topEverywhereM"><span class="hs-identifier hs-var">topEverywhereM</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#scExp"><span class="hs-identifier hs-var">scExp</span></a><span> </span><span class="hs-comment">-- Only topEverywhereM because scExp already recurses on its own</span><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-keyword">type</span><span> </span><a name="MatchResult"><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier">MatchResult</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-identifier">matchResultToDExp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-87"></a><a name="matchResultToDExp"><a href="Language.Haskell.TH.Desugar.Match.html#matchResultToDExp"><span class="hs-identifier">matchResultToDExp</span></a></a><span> </span><a name="local-6989586621679302303"><a href="#local-6989586621679302303"><span class="hs-identifier">mr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679302303"><span class="hs-identifier hs-var">mr</span></a><span> </span><a href="#local-6989586621679302304"><span class="hs-identifier hs-var">failed_pattern_match</span></a><span>
</span><a name="line-88"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-89"></a><span>    </span><a name="local-6989586621679302304"><a href="#local-6989586621679302304"><span class="hs-identifier">failed_pattern_match</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">error</span><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span>                                 </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitE"><span class="hs-identifier hs-var">DLitE</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">StringL</span><span> </span><span class="hs-string">&quot;Pattern-match failure&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-identifier">simplCaseExp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302261"><span class="hs-identifier hs-type">q</span></a><span>
</span><a name="line-93"></a><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>
</span><a name="line-94"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DClause"><span class="hs-identifier hs-type">DClause</span></a><span class="hs-special">]</span><span>
</span><a name="line-95"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302261"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-96"></a><a name="simplCaseExp"><a href="Language.Haskell.TH.Desugar.Match.html#simplCaseExp"><span class="hs-identifier">simplCaseExp</span></a></a><span> </span><a name="local-6989586621679302305"><a href="#local-6989586621679302305"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621679302306"><a href="#local-6989586621679302306"><span class="hs-identifier">clauses</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-97"></a><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679302307"><a href="#local-6989586621679302307"><span class="hs-identifier">eis</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-var">EquationInfo</span></a><span> </span><a href="#local-6989586621679302308"><span class="hs-identifier hs-var">pats</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302309"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span>
</span><a name="line-98"></a><span>                 </span><a href="Language.Haskell.TH.Desugar.AST.html#DClause"><span class="hs-identifier hs-var">DClause</span></a><span> </span><a name="local-6989586621679302308"><a href="#local-6989586621679302308"><span class="hs-identifier">pats</span></a></a><span> </span><a name="local-6989586621679302309"><a href="#local-6989586621679302309"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679302306"><span class="hs-identifier hs-var">clauses</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-99"></a><span>     </span><a href="Language.Haskell.TH.Desugar.Match.html#matchResultToDExp"><span class="hs-identifier hs-var">matchResultToDExp</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">liftM</span><span class="hs-special">`</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#simplCase"><span class="hs-identifier hs-var">simplCase</span></a><span> </span><a href="#local-6989586621679302305"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621679302307"><span class="hs-identifier hs-var">eis</span></a><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-keyword">data</span><span> </span><a name="EquationInfo"><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier">EquationInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="EquationInfo"><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier">EquationInfo</span></a></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span class="hs-special">]</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>  </span><span class="hs-comment">-- like DClause, but with a hole</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-comment">-- analogous to GHC's match (in deSugar/Match.lhs)</span><span>
</span><a name="line-104"></a><span class="hs-identifier">simplCase</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302260"><span class="hs-identifier hs-type">q</span></a><span>
</span><a name="line-105"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>         </span><span class="hs-comment">-- the names of the scrutinees</span><span>
</span><a name="line-106"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- the matches (where the # of pats == length (1st arg))</span><span>
</span><a name="line-107"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302260"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>
</span><a name="line-108"></a><a name="simplCase"><a href="Language.Haskell.TH.Desugar.Match.html#simplCase"><span class="hs-identifier">simplCase</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679302310"><a href="#local-6989586621679302310"><span class="hs-identifier">clauses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldr1</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302311"><span class="hs-identifier hs-var">match_results</span></a><span class="hs-special">)</span><span>
</span><a name="line-109"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-110"></a><span>    </span><a name="local-6989586621679302311"><a href="#local-6989586621679302311"><span class="hs-identifier">match_results</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679302312"><span class="hs-identifier hs-var">mr</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-var">EquationInfo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679302312"><a href="#local-6989586621679302312"><span class="hs-identifier">mr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679302310"><span class="hs-identifier hs-var">clauses</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-111"></a><span class="hs-identifier">simplCase</span><span> </span><a name="local-6989586621679302313"><a href="#local-6989586621679302313"><span class="hs-identifier">vars</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679302314"><a href="#local-6989586621679302314"><span class="hs-identifier">v</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679302315"><a href="#local-6989586621679302315"><span class="hs-identifier">clauses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-112"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679302328"><a href="#local-6989586621679302328"><span class="hs-identifier">aux_binds</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679302329"><a href="#local-6989586621679302329"><span class="hs-identifier">tidy_clauses</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapAndUnzipM</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#tidyClause"><span class="hs-identifier hs-var">tidyClause</span></a><span> </span><a href="#local-6989586621679302314"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302315"><span class="hs-identifier hs-var">clauses</span></a><span>
</span><a name="line-113"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679302330"><a href="#local-6989586621679302330"><span class="hs-identifier">grouped</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#groupClauses"><span class="hs-identifier hs-var">groupClauses</span></a><span> </span><a href="#local-6989586621679302329"><span class="hs-identifier hs-var">tidy_clauses</span></a><span>
</span><a name="line-114"></a><span>  </span><a name="local-6989586621679302331"><a href="#local-6989586621679302331"><span class="hs-identifier">match_results</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679302316"><span class="hs-identifier hs-var">match_groups</span></a><span> </span><a href="#local-6989586621679302330"><span class="hs-identifier hs-var">grouped</span></a><span>
</span><a name="line-115"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#adjustMatchResult"><span class="hs-identifier hs-var">adjustMatchResult</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><a href="#local-6989586621679302328"><span class="hs-identifier hs-var">aux_binds</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-116"></a><span>          </span><span class="hs-identifier hs-var">foldr1</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302331"><span class="hs-identifier hs-var">match_results</span></a><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-118"></a><span>    </span><span class="hs-identifier">match_groups</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302319"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#PatGroup"><span class="hs-identifier hs-type">PatGroup</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302319"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span class="hs-special">]</span><span>
</span><a name="line-119"></a><span>    </span><a name="local-6989586621679302316"><a href="#local-6989586621679302316"><span class="hs-identifier">match_groups</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#matchEmpty"><span class="hs-identifier hs-var">matchEmpty</span></a><span> </span><a href="#local-6989586621679302314"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-120"></a><span>    </span><span class="hs-identifier">match_groups</span><span> </span><a name="local-6989586621679302321"><a href="#local-6989586621679302321"><span class="hs-identifier">gs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621679302317"><span class="hs-identifier hs-var">match_group</span></a><span> </span><a href="#local-6989586621679302321"><span class="hs-identifier hs-var">gs</span></a><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span>    </span><span class="hs-identifier">match_group</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302320"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#PatGroup"><span class="hs-identifier hs-type">PatGroup</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302320"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>
</span><a name="line-123"></a><span>    </span><a name="local-6989586621679302317"><a href="#local-6989586621679302317"><span class="hs-identifier">match_group</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar (match_group)&quot;</span><span>
</span><a name="line-124"></a><span>    </span><span class="hs-identifier">match_group</span><span> </span><a name="local-6989586621679302322"><a href="#local-6989586621679302322"><span class="hs-identifier">eqns</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679302323"><a href="#local-6989586621679302323"><span class="hs-identifier">group</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-125"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679302323"><span class="hs-identifier hs-var">group</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-126"></a><span>        </span><a href="Language.Haskell.TH.Desugar.Match.html#PgCon"><span class="hs-identifier hs-var">PgCon</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#matchConFamily"><span class="hs-identifier hs-var">matchConFamily</span></a><span> </span><a href="#local-6989586621679302313"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#subGroup"><span class="hs-identifier hs-var">subGroup</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679302324"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">,</span><a href="#local-6989586621679302325"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#PgCon"><span class="hs-identifier hs-var">PgCon</span></a><span> </span><a name="local-6989586621679302324"><a href="#local-6989586621679302324"><span class="hs-identifier">c</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679302325"><a href="#local-6989586621679302325"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679302322"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-127"></a><span>        </span><a href="Language.Haskell.TH.Desugar.Match.html#PgLit"><span class="hs-identifier hs-var">PgLit</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#matchLiterals"><span class="hs-identifier hs-var">matchLiterals</span></a><span>  </span><a href="#local-6989586621679302313"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#subGroup"><span class="hs-identifier hs-var">subGroup</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679302326"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679302327"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#PgLit"><span class="hs-identifier hs-var">PgLit</span></a><span> </span><a name="local-6989586621679302326"><a href="#local-6989586621679302326"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679302327"><a href="#local-6989586621679302327"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679302322"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span>        </span><a href="Language.Haskell.TH.Desugar.Match.html#PgBang"><span class="hs-identifier hs-var">PgBang</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#matchBangs"><span class="hs-identifier hs-var">matchBangs</span></a><span>     </span><a href="#local-6989586621679302313"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302318"><span class="hs-identifier hs-var">drop_group</span></a><span> </span><a href="#local-6989586621679302322"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">)</span><span>
</span><a name="line-129"></a><span>        </span><a href="Language.Haskell.TH.Desugar.Match.html#PgAny"><span class="hs-identifier hs-var">PgAny</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#matchVariables"><span class="hs-identifier hs-var">matchVariables</span></a><span> </span><a href="#local-6989586621679302313"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302318"><span class="hs-identifier hs-var">drop_group</span></a><span> </span><a href="#local-6989586621679302322"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">)</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span>    </span><a name="local-6989586621679302318"><a href="#local-6989586621679302318"><span class="hs-identifier">drop_group</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-comment">-- analogous to GHC's tidyEqnInfo</span><span>
</span><a name="line-134"></a><span class="hs-identifier">tidyClause</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302259"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302259"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">)</span><span>
</span><a name="line-135"></a><a name="tidyClause"><a href="Language.Haskell.TH.Desugar.Match.html#tidyClause"><span class="hs-identifier">tidyClause</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-var">EquationInfo</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-136"></a><span>  </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar: no patterns in tidyClause.&quot;</span><span>
</span><a name="line-137"></a><span class="hs-identifier">tidyClause</span><span> </span><a name="local-6989586621679302332"><a href="#local-6989586621679302332"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-var">EquationInfo</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679302333"><a href="#local-6989586621679302333"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679302334"><a href="#local-6989586621679302334"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679302335"><a href="#local-6989586621679302335"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-138"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679302336"><a href="#local-6989586621679302336"><span class="hs-identifier">wrap</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679302337"><a href="#local-6989586621679302337"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#tidy1"><span class="hs-identifier hs-var">tidy1</span></a><span> </span><a href="#local-6989586621679302332"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679302333"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-139"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302336"><span class="hs-identifier hs-var">wrap</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-var">EquationInfo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302337"><span class="hs-identifier hs-var">pat'</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679302334"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302335"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-identifier">tidy1</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302258"><span class="hs-identifier hs-type">q</span></a><span>
</span><a name="line-142"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>   </span><span class="hs-comment">-- the name of the variable that ...</span><span>
</span><a name="line-143"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span>   </span><span class="hs-comment">-- ... this pattern is matching against</span><span>
</span><a name="line-144"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302258"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- a wrapper and tidied pattern</span><span>
</span><a name="line-145"></a><a name="tidy1"><a href="Language.Haskell.TH.Desugar.Match.html#tidy1"><span class="hs-identifier">tidy1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679302338"><a href="#local-6989586621679302338"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitPa"><span class="hs-identifier hs-var">DLitPa</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">id</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679302338"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-146"></a><span class="hs-identifier">tidy1</span><span> </span><a name="local-6989586621679302339"><a href="#local-6989586621679302339"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a name="local-6989586621679302340"><a href="#local-6989586621679302340"><span class="hs-identifier">var</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#wrapBind"><span class="hs-identifier hs-var">wrapBind</span></a><span> </span><a href="#local-6989586621679302340"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679302339"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span class="hs-identifier">tidy1</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679302341"><a href="#local-6989586621679302341"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">id</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679302341"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span class="hs-identifier">tidy1</span><span> </span><a name="local-6989586621679302342"><a href="#local-6989586621679302342"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DTildePa"><span class="hs-identifier hs-var">DTildePa</span></a><span> </span><a name="local-6989586621679302343"><a href="#local-6989586621679302343"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-149"></a><span>  </span><a name="local-6989586621679302344"><a href="#local-6989586621679302344"><span class="hs-identifier">sel_decs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#mkSelectorDecs"><span class="hs-identifier hs-var">mkSelectorDecs</span></a><span> </span><a href="#local-6989586621679302343"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621679302342"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-150"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Core.html#maybeDLetE"><span class="hs-identifier hs-var">maybeDLetE</span></a><span> </span><a href="#local-6989586621679302344"><span class="hs-identifier hs-var">sel_decs</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span class="hs-identifier">tidy1</span><span> </span><a name="local-6989586621679302345"><a href="#local-6989586621679302345"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DBangPa"><span class="hs-identifier hs-var">DBangPa</span></a><span> </span><a name="local-6989586621679302346"><a href="#local-6989586621679302346"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-152"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679302346"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-153"></a><span>    </span><a href="Language.Haskell.TH.Desugar.AST.html#DLitPa"><span class="hs-identifier hs-var">DLitPa</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#tidy1"><span class="hs-identifier hs-var">tidy1</span></a><span> </span><a href="#local-6989586621679302345"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679302346"><span class="hs-identifier hs-var">pat</span></a><span>   </span><span class="hs-comment">-- already strict</span><span>
</span><a name="line-154"></a><span>    </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">id</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DBangPa"><span class="hs-identifier hs-var">DBangPa</span></a><span> </span><a href="#local-6989586621679302346"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- no change</span><span>
</span><a name="line-155"></a><span>    </span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#tidy1"><span class="hs-identifier hs-var">tidy1</span></a><span> </span><a href="#local-6989586621679302345"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679302346"><span class="hs-identifier hs-var">pat</span></a><span>   </span><span class="hs-comment">-- already strict</span><span>
</span><a name="line-156"></a><span>    </span><a href="Language.Haskell.TH.Desugar.AST.html#DTildePa"><span class="hs-identifier hs-var">DTildePa</span></a><span> </span><a name="local-6989586621679302347"><a href="#local-6989586621679302347"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#tidy1"><span class="hs-identifier hs-var">tidy1</span></a><span> </span><a href="#local-6989586621679302345"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DBangPa"><span class="hs-identifier hs-var">DBangPa</span></a><span> </span><a href="#local-6989586621679302347"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- discard ~ under !</span><span>
</span><a name="line-157"></a><span>    </span><a href="Language.Haskell.TH.Desugar.AST.html#DBangPa"><span class="hs-identifier hs-var">DBangPa</span></a><span> </span><a name="local-6989586621679302348"><a href="#local-6989586621679302348"><span class="hs-identifier">p</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#tidy1"><span class="hs-identifier hs-var">tidy1</span></a><span> </span><a href="#local-6989586621679302345"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DBangPa"><span class="hs-identifier hs-var">DBangPa</span></a><span> </span><a href="#local-6989586621679302348"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- discard ! under !</span><span>
</span><a name="line-158"></a><span>    </span><a href="Language.Haskell.TH.Desugar.AST.html#DSigPa"><span class="hs-identifier hs-var">DSigPa</span></a><span> </span><a name="local-6989586621679302349"><a href="#local-6989586621679302349"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#tidy1"><span class="hs-identifier hs-var">tidy1</span></a><span> </span><a href="#local-6989586621679302345"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DBangPa"><span class="hs-identifier hs-var">DBangPa</span></a><span> </span><a href="#local-6989586621679302349"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- discard sig under !</span><span>
</span><a name="line-159"></a><span>    </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">id</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DBangPa"><span class="hs-identifier hs-var">DBangPa</span></a><span> </span><a href="#local-6989586621679302346"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- no change</span><span>
</span><a name="line-160"></a><span class="hs-identifier">tidy1</span><span> </span><a name="local-6989586621679302350"><a href="#local-6989586621679302350"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DSigPa"><span class="hs-identifier hs-var">DSigPa</span></a><span> </span><a name="local-6989586621679302351"><a href="#local-6989586621679302351"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679302352"><a href="#local-6989586621679302352"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-161"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679302353"><span class="hs-identifier hs-var">no_tyvars_ty</span></a><span> </span><a href="#local-6989586621679302352"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#tidy1"><span class="hs-identifier hs-var">tidy1</span></a><span> </span><a href="#local-6989586621679302350"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679302351"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-162"></a><span>  </span><span class="hs-comment">-- The match-flattener doesn't know how to deal with patterns that mention</span><span>
</span><a name="line-163"></a><span>  </span><span class="hs-comment">-- type variables properly, so we give up if we encounter one.</span><span>
</span><a name="line-164"></a><span>  </span><span class="hs-comment">-- See https://github.com/goldfirere/th-desugar/pull/48#issuecomment-266778976</span><span>
</span><a name="line-165"></a><span>  </span><span class="hs-comment">-- for further discussion.</span><span>
</span><a name="line-166"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Monad.fail</span><span>
</span><a name="line-167"></a><span>    </span><span class="hs-string">&quot;Match-flattening patterns that mention type variables is not supported.&quot;</span><span>
</span><a name="line-168"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-169"></a><span>    </span><span class="hs-identifier">no_tyvars_ty</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Data</span><span> </span><a href="#local-6989586621679302355"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679302355"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-170"></a><span>    </span><a name="local-6989586621679302353"><a href="#local-6989586621679302353"><span class="hs-identifier">no_tyvars_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">everything</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&amp;&amp;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkQ</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679302354"><span class="hs-identifier hs-var">no_tyvar_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span>    </span><span class="hs-identifier">no_tyvar_ty</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DType"><span class="hs-identifier hs-type">DType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-173"></a><span>    </span><a name="local-6989586621679302354"><a href="#local-6989586621679302354"><span class="hs-identifier">no_tyvar_ty</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarT"><span class="hs-identifier hs-var">DVarT</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-174"></a><span>    </span><span class="hs-identifier">no_tyvar_ty</span><span> </span><a name="local-6989586621679302356"><a href="#local-6989586621679302356"><span class="hs-identifier">t</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">gmapQl</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&amp;&amp;</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679302353"><span class="hs-identifier hs-var">no_tyvars_ty</span></a><span> </span><a href="#local-6989586621679302356"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-175"></a><span class="hs-identifier">tidy1</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">id</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-identifier">wrapBind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-178"></a><a name="wrapBind"><a href="Language.Haskell.TH.Desugar.Match.html#wrapBind"><span class="hs-identifier">wrapBind</span></a></a><span> </span><a name="local-6989586621679302357"><a href="#local-6989586621679302357"><span class="hs-identifier">new</span></a></a><span> </span><a name="local-6989586621679302358"><a href="#local-6989586621679302358"><span class="hs-identifier">old</span></a></a><span>
</span><a name="line-179"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679302357"><span class="hs-identifier hs-var">new</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679302358"><span class="hs-identifier hs-var">old</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-180"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLetE"><span class="hs-identifier hs-var">DLetE</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DValD"><span class="hs-identifier hs-var">DValD</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a href="#local-6989586621679302357"><span class="hs-identifier hs-var">new</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679302358"><span class="hs-identifier hs-var">old</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-181"></a><span>
</span><a name="line-182"></a><span class="hs-comment">-- like GHC's mkSelectorBinds</span><span>
</span><a name="line-183"></a><span class="hs-identifier">mkSelectorDecs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302257"><span class="hs-identifier hs-type">q</span></a><span>
</span><a name="line-184"></a><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span>      </span><span class="hs-comment">-- pattern to deconstruct</span><span>
</span><a name="line-185"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>      </span><span class="hs-comment">-- variable being matched against</span><span>
</span><a name="line-186"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302257"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DLetDec"><span class="hs-identifier hs-type">DLetDec</span></a><span class="hs-special">]</span><span>
</span><a name="line-187"></a><a name="mkSelectorDecs"><a href="Language.Haskell.TH.Desugar.Match.html#mkSelectorDecs"><span class="hs-identifier">mkSelectorDecs</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a name="local-6989586621679302359"><a href="#local-6989586621679302359"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679302360"><a href="#local-6989586621679302360"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DValD"><span class="hs-identifier hs-var">DValD</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a href="#local-6989586621679302359"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679302360"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-188"></a><span class="hs-identifier">mkSelectorDecs</span><span> </span><a name="local-6989586621679302361"><a href="#local-6989586621679302361"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679302362"><a href="#local-6989586621679302362"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-189"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">S.null</span><span> </span><a href="#local-6989586621679302363"><span class="hs-identifier hs-var">binders</span></a><span>
</span><a name="line-190"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">S.size</span><span> </span><a href="#local-6989586621679302363"><span class="hs-identifier hs-var">binders</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-193"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679302380"><a href="#local-6989586621679302380"><span class="hs-identifier">val_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#newUniqueName"><span class="hs-identifier hs-var">newUniqueName</span></a><span> </span><span class="hs-string">&quot;var&quot;</span><span>
</span><a name="line-194"></a><span>       </span><a name="local-6989586621679302381"><a href="#local-6989586621679302381"><span class="hs-identifier">err_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#newUniqueName"><span class="hs-identifier hs-var">newUniqueName</span></a><span> </span><span class="hs-string">&quot;err&quot;</span><span>
</span><a name="line-195"></a><span>       </span><a name="local-6989586621679302382"><a href="#local-6989586621679302382"><span class="hs-identifier">bind</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679302369"><span class="hs-identifier hs-var">mk_bind</span></a><span> </span><a href="#local-6989586621679302380"><span class="hs-identifier hs-var">val_var</span></a><span> </span><a href="#local-6989586621679302381"><span class="hs-identifier hs-var">err_var</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">S.elems</span><span> </span><a href="#local-6989586621679302363"><span class="hs-identifier hs-var">binders</span></a><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DValD"><span class="hs-identifier hs-var">DValD</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a href="#local-6989586621679302380"><span class="hs-identifier hs-var">val_var</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679302362"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-197"></a><span>               </span><a href="Language.Haskell.TH.Desugar.AST.html#DValD"><span class="hs-identifier hs-var">DValD</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a href="#local-6989586621679302381"><span class="hs-identifier hs-var">err_var</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">error</span><span> </span><span class="hs-special">`</span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span class="hs-special">`</span><span>
</span><a name="line-198"></a><span>                                       </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitE"><span class="hs-identifier hs-var">DLitE</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">StringL</span><span> </span><span class="hs-string">&quot;Irrefutable match failed&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-199"></a><span>               </span><a href="#local-6989586621679302382"><span class="hs-identifier hs-var">bind</span></a><span class="hs-special">]</span><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-202"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679302383"><a href="#local-6989586621679302383"><span class="hs-identifier">tuple_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#simplCaseExp"><span class="hs-identifier hs-var">simplCaseExp</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679302362"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DClause"><span class="hs-identifier hs-var">DClause</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679302361"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679302366"><span class="hs-identifier hs-var">local_tuple</span></a><span class="hs-special">]</span><span>
</span><a name="line-203"></a><span>       </span><a name="local-6989586621679302384"><a href="#local-6989586621679302384"><span class="hs-identifier">tuple_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#newUniqueName"><span class="hs-identifier hs-var">newUniqueName</span></a><span> </span><span class="hs-string">&quot;tuple&quot;</span><span>
</span><a name="line-204"></a><span>       </span><a name="local-6989586621679302385"><a href="#local-6989586621679302385"><span class="hs-identifier">projections</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302367"><span class="hs-identifier hs-var">mk_projection</span></a><span> </span><a href="#local-6989586621679302384"><span class="hs-identifier hs-var">tuple_var</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><a href="#local-6989586621679302365"><span class="hs-identifier hs-var">tuple_size</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">]</span><span>
</span><a name="line-205"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DValD"><span class="hs-identifier hs-var">DValD</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a href="#local-6989586621679302384"><span class="hs-identifier hs-var">tuple_var</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302383"><span class="hs-identifier hs-var">tuple_expr</span></a><span> </span><span class="hs-glyph">:</span><span>
</span><a name="line-206"></a><span>               </span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DValD"><span class="hs-identifier hs-var">DValD</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a href="#local-6989586621679302364"><span class="hs-identifier hs-var">binders_list</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302385"><span class="hs-identifier hs-var">projections</span></a><span class="hs-special">)</span><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-209"></a><span>    </span><a name="local-6989586621679302363"><a href="#local-6989586621679302363"><span class="hs-identifier">binders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#extractBoundNamesDPat"><span class="hs-identifier hs-var">extractBoundNamesDPat</span></a><span> </span><a href="#local-6989586621679302361"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-210"></a><span>    </span><a name="local-6989586621679302364"><a href="#local-6989586621679302364"><span class="hs-identifier">binders_list</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.toAscList</span><span> </span><a href="#local-6989586621679302363"><span class="hs-identifier hs-var">binders</span></a><span>
</span><a name="line-211"></a><span>    </span><a name="local-6989586621679302365"><a href="#local-6989586621679302365"><span class="hs-identifier">tuple_size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679302364"><span class="hs-identifier hs-var">binders_list</span></a><span>
</span><a name="line-212"></a><span>    </span><a name="local-6989586621679302366"><a href="#local-6989586621679302366"><span class="hs-identifier">local_tuple</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#mkTupleDExp"><span class="hs-identifier hs-var">mkTupleDExp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679302364"><span class="hs-identifier hs-var">binders_list</span></a><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span>
</span><a name="line-214"></a><span>    </span><span class="hs-identifier">mk_projection</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302370"><span class="hs-identifier hs-type">q</span></a><span>
</span><a name="line-215"></a><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>   </span><span class="hs-comment">-- of the tuple</span><span>
</span><a name="line-216"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>    </span><span class="hs-comment">-- which element to get (0-indexed)</span><span>
</span><a name="line-217"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302370"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span>
</span><a name="line-218"></a><span>    </span><a name="local-6989586621679302367"><a href="#local-6989586621679302367"><span class="hs-identifier">mk_projection</span></a></a><span> </span><a name="local-6989586621679302371"><a href="#local-6989586621679302371"><span class="hs-identifier">tup_name</span></a></a><span> </span><a name="local-6989586621679302372"><a href="#local-6989586621679302372"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-219"></a><span>      </span><a name="local-6989586621679302373"><a href="#local-6989586621679302373"><span class="hs-identifier">var_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#newUniqueName"><span class="hs-identifier hs-var">newUniqueName</span></a><span> </span><span class="hs-string">&quot;proj&quot;</span><span>
</span><a name="line-220"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DCaseE"><span class="hs-identifier hs-var">DCaseE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679302371"><span class="hs-identifier hs-var">tup_name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tupleDataName</span><span> </span><a href="#local-6989586621679302365"><span class="hs-identifier hs-var">tuple_size</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302368"><span class="hs-identifier hs-var">mk_tuple_pats</span></a><span> </span><a href="#local-6989586621679302373"><span class="hs-identifier hs-var">var_name</span></a><span> </span><a href="#local-6989586621679302372"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span>                                               </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679302373"><span class="hs-identifier hs-var">var_name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span>    </span><span class="hs-identifier">mk_tuple_pats</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span>   </span><span class="hs-comment">-- of the projected element</span><span>
</span><a name="line-224"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>    </span><span class="hs-comment">-- which element to get (0-indexed)</span><span>
</span><a name="line-225"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span class="hs-special">]</span><span>
</span><a name="line-226"></a><span>    </span><a name="local-6989586621679302368"><a href="#local-6989586621679302368"><span class="hs-identifier">mk_tuple_pats</span></a></a><span> </span><a name="local-6989586621679302374"><a href="#local-6989586621679302374"><span class="hs-identifier">elt_name</span></a></a><span> </span><a name="local-6989586621679302375"><a href="#local-6989586621679302375"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621679302375"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a href="#local-6989586621679302374"><span class="hs-identifier hs-var">elt_name</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302365"><span class="hs-identifier hs-var">tuple_size</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679302375"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span>    </span><a name="local-6989586621679302369"><a href="#local-6989586621679302369"><span class="hs-identifier">mk_bind</span></a></a><span> </span><a name="local-6989586621679302376"><a href="#local-6989586621679302376"><span class="hs-identifier">scrut_var</span></a></a><span> </span><a name="local-6989586621679302377"><a href="#local-6989586621679302377"><span class="hs-identifier">err_var</span></a></a><span> </span><a name="local-6989586621679302378"><a href="#local-6989586621679302378"><span class="hs-identifier">bndr_var</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-229"></a><span>      </span><a name="local-6989586621679302379"><a href="#local-6989586621679302379"><span class="hs-identifier">rhs_mr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#simplCase"><span class="hs-identifier hs-var">simplCase</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679302376"><span class="hs-identifier hs-var">scrut_var</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-var">EquationInfo</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679302361"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679302378"><span class="hs-identifier hs-var">bndr_var</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-230"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DValD"><span class="hs-identifier hs-var">DValD</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a href="#local-6989586621679302378"><span class="hs-identifier hs-var">bndr_var</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302379"><span class="hs-identifier hs-var">rhs_mr</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679302377"><span class="hs-identifier hs-var">err_var</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span class="hs-keyword">data</span><span> </span><a name="PatGroup"><a href="Language.Haskell.TH.Desugar.Match.html#PatGroup"><span class="hs-identifier">PatGroup</span></a></a><span>
</span><a name="line-233"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="PgAny"><a href="Language.Haskell.TH.Desugar.Match.html#PgAny"><span class="hs-identifier">PgAny</span></a></a><span>         </span><span class="hs-comment">-- immediate match (wilds, vars, lazies)</span><span>
</span><a name="line-234"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PgCon"><a href="Language.Haskell.TH.Desugar.Match.html#PgCon"><span class="hs-identifier">PgCon</span></a></a><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-235"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PgLit"><a href="Language.Haskell.TH.Desugar.Match.html#PgLit"><span class="hs-identifier">PgLit</span></a></a><span> </span><span class="hs-identifier hs-type">Lit</span><span>
</span><a name="line-236"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PgBang"><a href="Language.Haskell.TH.Desugar.Match.html#PgBang"><span class="hs-identifier">PgBang</span></a></a><span>
</span><a name="line-237"></a><span>
</span><a name="line-238"></a><span class="hs-comment">-- like GHC's groupEquations</span><span>
</span><a name="line-239"></a><span class="hs-identifier">groupClauses</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#PatGroup"><span class="hs-identifier hs-type">PatGroup</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-240"></a><a name="groupClauses"><a href="Language.Haskell.TH.Desugar.Match.html#groupClauses"><span class="hs-identifier">groupClauses</span></a></a><span> </span><a name="local-6989586621679302386"><a href="#local-6989586621679302386"><span class="hs-identifier">clauses</span></a></a><span>
</span><a name="line-241"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#runs"><span class="hs-identifier hs-var">runs</span></a><span> </span><a href="#local-6989586621679302387"><span class="hs-identifier hs-var">same_gp</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#patGroup"><span class="hs-identifier hs-var">patGroup</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#firstPat"><span class="hs-identifier hs-var">firstPat</span></a><span> </span><a href="#local-6989586621679302390"><span class="hs-identifier hs-var">clause</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679302390"><span class="hs-identifier hs-var">clause</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679302390"><a href="#local-6989586621679302390"><span class="hs-identifier">clause</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679302386"><span class="hs-identifier hs-var">clauses</span></a><span class="hs-special">]</span><span>
</span><a name="line-242"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-243"></a><span>    </span><span class="hs-identifier">same_gp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#PatGroup"><span class="hs-identifier hs-type">PatGroup</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#PatGroup"><span class="hs-identifier hs-type">PatGroup</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-244"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679302388"><a href="#local-6989586621679302388"><span class="hs-identifier">pg1</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a name="local-6989586621679302387"><a href="#local-6989586621679302387"><span class="hs-identifier">same_gp</span></a></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679302389"><a href="#local-6989586621679302389"><span class="hs-identifier">pg2</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679302388"><span class="hs-identifier hs-var">pg1</span></a><span> </span><span class="hs-special">`</span><a href="Language.Haskell.TH.Desugar.Match.html#sameGroup"><span class="hs-identifier hs-var">sameGroup</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679302389"><span class="hs-identifier hs-var">pg2</span></a><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span class="hs-identifier">patGroup</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#PatGroup"><span class="hs-identifier hs-type">PatGroup</span></a><span>
</span><a name="line-247"></a><a name="patGroup"><a href="Language.Haskell.TH.Desugar.Match.html#patGroup"><span class="hs-identifier">patGroup</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitPa"><span class="hs-identifier hs-var">DLitPa</span></a><span> </span><a name="local-6989586621679302391"><a href="#local-6989586621679302391"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#PgLit"><span class="hs-identifier hs-var">PgLit</span></a><span> </span><a href="#local-6989586621679302391"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-248"></a><span class="hs-identifier">patGroup</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar (patGroup DVarPa)&quot;</span><span>
</span><a name="line-249"></a><span class="hs-identifier">patGroup</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><a name="local-6989586621679302392"><a href="#local-6989586621679302392"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#PgCon"><span class="hs-identifier hs-var">PgCon</span></a><span> </span><a href="#local-6989586621679302392"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-250"></a><span class="hs-identifier">patGroup</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DTildePa"><span class="hs-identifier hs-var">DTildePa</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar (patGroup DTildePa)&quot;</span><span>
</span><a name="line-251"></a><span class="hs-identifier">patGroup</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DBangPa"><span class="hs-identifier hs-var">DBangPa</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#PgBang"><span class="hs-identifier hs-var">PgBang</span></a><span>
</span><a name="line-252"></a><span class="hs-identifier">patGroup</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DSigPa"><span class="hs-identifier hs-var">DSigPa</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar (patGroup DSigPa)&quot;</span><span>
</span><a name="line-253"></a><span class="hs-identifier">patGroup</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#PgAny"><span class="hs-identifier hs-var">PgAny</span></a><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span class="hs-identifier">sameGroup</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#PatGroup"><span class="hs-identifier hs-type">PatGroup</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#PatGroup"><span class="hs-identifier hs-type">PatGroup</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-256"></a><a name="sameGroup"><a href="Language.Haskell.TH.Desugar.Match.html#sameGroup"><span class="hs-identifier">sameGroup</span></a></a><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#PgAny"><span class="hs-identifier hs-var">PgAny</span></a><span>     </span><a href="Language.Haskell.TH.Desugar.Match.html#PgAny"><span class="hs-identifier hs-var">PgAny</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-257"></a><span class="hs-identifier">sameGroup</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#PgBang"><span class="hs-identifier hs-var">PgBang</span></a><span>    </span><a href="Language.Haskell.TH.Desugar.Match.html#PgBang"><span class="hs-identifier hs-var">PgBang</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-258"></a><span class="hs-identifier">sameGroup</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#PgCon"><span class="hs-identifier hs-var">PgCon</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#PgCon"><span class="hs-identifier hs-var">PgCon</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-259"></a><span class="hs-identifier">sameGroup</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#PgLit"><span class="hs-identifier hs-var">PgLit</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#PgLit"><span class="hs-identifier hs-var">PgLit</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-260"></a><span class="hs-identifier">sameGroup</span><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-261"></a><span>
</span><a name="line-262"></a><span class="hs-identifier">subGroup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679302256"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679302256"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-263"></a><a name="subGroup"><a href="Language.Haskell.TH.Desugar.Match.html#subGroup"><span class="hs-identifier">subGroup</span></a></a><span> </span><a name="local-6989586621679302393"><a href="#local-6989586621679302393"><span class="hs-identifier">group</span></a></a><span>
</span><a name="line-264"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Map.elems</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><a href="#local-6989586621679302394"><span class="hs-identifier hs-var">accumulate</span></a><span> </span><span class="hs-identifier hs-var">Map.empty</span><span> </span><a href="#local-6989586621679302393"><span class="hs-identifier hs-var">group</span></a><span>
</span><a name="line-265"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-266"></a><span>    </span><a name="local-6989586621679302394"><a href="#local-6989586621679302394"><span class="hs-identifier">accumulate</span></a></a><span> </span><a name="local-6989586621679302395"><a href="#local-6989586621679302395"><span class="hs-identifier">pg_map</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679302396"><a href="#local-6989586621679302396"><span class="hs-identifier">pg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679302397"><a href="#local-6989586621679302397"><span class="hs-identifier">eqn</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-267"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><a href="#local-6989586621679302396"><span class="hs-identifier hs-var">pg</span></a><span> </span><a href="#local-6989586621679302395"><span class="hs-identifier hs-var">pg_map</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-268"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679302398"><a href="#local-6989586621679302398"><span class="hs-identifier">eqns</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Map.insert</span><span> </span><a href="#local-6989586621679302396"><span class="hs-identifier hs-var">pg</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302397"><span class="hs-identifier hs-var">eqn</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679302398"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302395"><span class="hs-identifier hs-var">pg_map</span></a><span>
</span><a name="line-269"></a><span>          </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Map.insert</span><span> </span><a href="#local-6989586621679302396"><span class="hs-identifier hs-var">pg</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679302397"><span class="hs-identifier hs-var">eqn</span></a><span class="hs-special">]</span><span>      </span><a href="#local-6989586621679302395"><span class="hs-identifier hs-var">pg_map</span></a><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span class="hs-identifier">firstPat</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span>
</span><a name="line-272"></a><a name="firstPat"><a href="Language.Haskell.TH.Desugar.Match.html#firstPat"><span class="hs-identifier">firstPat</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-var">EquationInfo</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679302399"><a href="#local-6989586621679302399"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679302399"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-273"></a><span class="hs-identifier">firstPat</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Clause encountered with no patterns -- should never happen&quot;</span><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-keyword">data</span><span> </span><a name="CaseAlt"><a href="Language.Haskell.TH.Desugar.Match.html#CaseAlt"><span class="hs-identifier">CaseAlt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CaseAlt"><a href="Language.Haskell.TH.Desugar.Match.html#CaseAlt"><span class="hs-identifier">CaseAlt</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="alt_con"><a href="Language.Haskell.TH.Desugar.Match.html#alt_con"><span class="hs-identifier">alt_con</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span>         </span><span class="hs-comment">-- con name</span><span>
</span><a name="line-276"></a><span>                       </span><span class="hs-special">,</span><span> </span><a name="_alt_args"><a href="Language.Haskell.TH.Desugar.Match.html#_alt_args"><span class="hs-identifier">_alt_args</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- bound var names</span><span>
</span><a name="line-277"></a><span>                       </span><span class="hs-special">,</span><span> </span><a name="_alt_rhs"><a href="Language.Haskell.TH.Desugar.Match.html#_alt_rhs"><span class="hs-identifier">_alt_rhs</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>  </span><span class="hs-comment">-- RHS</span><span>
</span><a name="line-278"></a><span>                       </span><span class="hs-special">}</span><span>
</span><a name="line-279"></a><span>
</span><a name="line-280"></a><span class="hs-comment">-- from GHC's MatchCon.lhs</span><span>
</span><a name="line-281"></a><span class="hs-identifier">matchConFamily</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302255"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302255"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>
</span><a name="line-282"></a><a name="matchConFamily"><a href="Language.Haskell.TH.Desugar.Match.html#matchConFamily"><span class="hs-identifier">matchConFamily</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679302400"><a href="#local-6989586621679302400"><span class="hs-identifier">var</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679302401"><a href="#local-6989586621679302401"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679302402"><a href="#local-6989586621679302402"><span class="hs-identifier">groups</span></a></a><span>
</span><a name="line-283"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679302403"><a href="#local-6989586621679302403"><span class="hs-identifier">alts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#matchOneCon"><span class="hs-identifier hs-var">matchOneCon</span></a><span> </span><a href="#local-6989586621679302401"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302402"><span class="hs-identifier hs-var">groups</span></a><span>
</span><a name="line-284"></a><span>       </span><a href="Language.Haskell.TH.Desugar.Match.html#mkDataConCase"><span class="hs-identifier hs-var">mkDataConCase</span></a><span> </span><a href="#local-6989586621679302400"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679302403"><span class="hs-identifier hs-var">alts</span></a><span>
</span><a name="line-285"></a><span class="hs-identifier">matchConFamily</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar (matchConFamily)&quot;</span><span>
</span><a name="line-286"></a><span>
</span><a name="line-287"></a><span class="hs-comment">-- like matchOneConLike from MatchCon</span><span>
</span><a name="line-288"></a><span class="hs-identifier">matchOneCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302254"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302254"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#CaseAlt"><span class="hs-identifier hs-type">CaseAlt</span></a><span>
</span><a name="line-289"></a><a name="matchOneCon"><a href="Language.Haskell.TH.Desugar.Match.html#matchOneCon"><span class="hs-identifier">matchOneCon</span></a></a><span> </span><a name="local-6989586621679302404"><a href="#local-6989586621679302404"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621679302405"><a href="#local-6989586621679302405"><span class="hs-identifier">eqns</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679302406"><a href="#local-6989586621679302406"><span class="hs-identifier">eqn1</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-290"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679302419"><a href="#local-6989586621679302419"><span class="hs-identifier">arg_vars</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#selectMatchVars"><span class="hs-identifier hs-var">selectMatchVars</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302408"><span class="hs-identifier hs-var">pat_args</span></a><span> </span><a href="#local-6989586621679302407"><span class="hs-identifier hs-var">pat1</span></a><span class="hs-special">)</span><span>
</span><a name="line-291"></a><span>       </span><a name="local-6989586621679302420"><a href="#local-6989586621679302420"><span class="hs-identifier">match_result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679302410"><span class="hs-identifier hs-var">match_group</span></a><span> </span><a href="#local-6989586621679302419"><span class="hs-identifier hs-var">arg_vars</span></a><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#CaseAlt"><span class="hs-identifier hs-var">CaseAlt</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302409"><span class="hs-identifier hs-var">pat_con</span></a><span> </span><a href="#local-6989586621679302407"><span class="hs-identifier hs-var">pat1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302419"><span class="hs-identifier hs-var">arg_vars</span></a><span> </span><a href="#local-6989586621679302420"><span class="hs-identifier hs-var">match_result</span></a><span>
</span><a name="line-294"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-295"></a><span>    </span><a name="local-6989586621679302407"><a href="#local-6989586621679302407"><span class="hs-identifier">pat1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#firstPat"><span class="hs-identifier hs-var">firstPat</span></a><span> </span><a href="#local-6989586621679302406"><span class="hs-identifier hs-var">eqn1</span></a><span>
</span><a name="line-296"></a><span>
</span><a name="line-297"></a><span>    </span><a name="local-6989586621679302408"><a href="#local-6989586621679302408"><span class="hs-identifier">pat_args</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679302413"><a href="#local-6989586621679302413"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679302413"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-298"></a><span>    </span><span class="hs-identifier">pat_args</span><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar (pat_args)&quot;</span><span>
</span><a name="line-299"></a><span>
</span><a name="line-300"></a><span>    </span><a name="local-6989586621679302409"><a href="#local-6989586621679302409"><span class="hs-identifier">pat_con</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><a name="local-6989586621679302414"><a href="#local-6989586621679302414"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679302414"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-301"></a><span>    </span><span class="hs-identifier">pat_con</span><span> </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar (pat_con)&quot;</span><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span>    </span><span class="hs-identifier">match_group</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302412"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302412"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>
</span><a name="line-304"></a><span>    </span><a name="local-6989586621679302410"><a href="#local-6989586621679302410"><span class="hs-identifier">match_group</span></a></a><span> </span><a name="local-6989586621679302415"><a href="#local-6989586621679302415"><span class="hs-identifier">arg_vars</span></a></a><span>
</span><a name="line-305"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#simplCase"><span class="hs-identifier hs-var">simplCase</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302415"><span class="hs-identifier hs-var">arg_vars</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679302404"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679302411"><span class="hs-identifier hs-var">shift</span></a><span> </span><a href="#local-6989586621679302405"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">)</span><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span>    </span><a name="local-6989586621679302411"><a href="#local-6989586621679302411"><span class="hs-identifier">shift</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-var">EquationInfo</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679302416"><a href="#local-6989586621679302416"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679302417"><a href="#local-6989586621679302417"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679302418"><a href="#local-6989586621679302418"><span class="hs-identifier">exp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-var">EquationInfo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302416"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679302417"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302418"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-308"></a><span>    </span><span class="hs-identifier">shift</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar (shift)&quot;</span><span>
</span><a name="line-309"></a><span class="hs-identifier">matchOneCon</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar (matchOneCon)&quot;</span><span>
</span><a name="line-310"></a><span>
</span><a name="line-311"></a><span class="hs-identifier">mkDataConCase</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302253"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Match.html#CaseAlt"><span class="hs-identifier hs-type">CaseAlt</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302253"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>
</span><a name="line-312"></a><a name="mkDataConCase"><a href="Language.Haskell.TH.Desugar.Match.html#mkDataConCase"><span class="hs-identifier">mkDataConCase</span></a></a><span> </span><a name="local-6989586621679302421"><a href="#local-6989586621679302421"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679302422"><a href="#local-6989586621679302422"><span class="hs-identifier">case_alts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-313"></a><span>  </span><a name="local-6989586621679302445"><a href="#local-6989586621679302445"><span class="hs-identifier">all_ctors</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679302427"><span class="hs-identifier hs-var">get_all_ctors</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">alt_con</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679302422"><span class="hs-identifier hs-var">case_alts</span></a><span class="hs-special">)</span><span>
</span><a name="line-314"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679302446"><a href="#local-6989586621679302446"><span class="hs-identifier">fail</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-315"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679302447"><a href="#local-6989586621679302447"><span class="hs-identifier">matches</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302423"><span class="hs-identifier hs-var">mk_alt</span></a><span> </span><a href="#local-6989586621679302446"><span class="hs-identifier hs-var">fail</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302422"><span class="hs-identifier hs-var">case_alts</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-316"></a><span>    </span><a href="Language.Haskell.TH.Desugar.AST.html#DCaseE"><span class="hs-identifier hs-var">DCaseE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679302421"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302447"><span class="hs-identifier hs-var">matches</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679302424"><span class="hs-identifier hs-var">mk_default</span></a><span> </span><a href="#local-6989586621679302445"><span class="hs-identifier hs-var">all_ctors</span></a><span> </span><a href="#local-6989586621679302446"><span class="hs-identifier hs-var">fail</span></a><span class="hs-special">)</span><span>
</span><a name="line-317"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-318"></a><span>    </span><a name="local-6989586621679302423"><a href="#local-6989586621679302423"><span class="hs-identifier">mk_alt</span></a></a><span> </span><a name="local-6989586621679302431"><a href="#local-6989586621679302431"><span class="hs-identifier">fail</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#CaseAlt"><span class="hs-identifier hs-var">CaseAlt</span></a><span> </span><a name="local-6989586621679302432"><a href="#local-6989586621679302432"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621679302433"><a href="#local-6989586621679302433"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679302434"><a href="#local-6989586621679302434"><span class="hs-identifier">body_fn</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-319"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679302435"><a href="#local-6989586621679302435"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679302434"><span class="hs-identifier hs-var">body_fn</span></a><span> </span><a href="#local-6989586621679302431"><span class="hs-identifier hs-var">fail</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-320"></a><span>        </span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DConPa"><span class="hs-identifier hs-var">DConPa</span></a><span> </span><a href="#local-6989586621679302432"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a href="#local-6989586621679302433"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302435"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-321"></a><span>
</span><a name="line-322"></a><span>    </span><a name="local-6989586621679302424"><a href="#local-6989586621679302424"><span class="hs-identifier">mk_default</span></a></a><span> </span><a name="local-6989586621679302436"><a href="#local-6989586621679302436"><span class="hs-identifier">all_ctors</span></a></a><span> </span><a name="local-6989586621679302437"><a href="#local-6989586621679302437"><span class="hs-identifier">fail</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679302426"><span class="hs-identifier hs-var">exhaustive_case</span></a><span> </span><a href="#local-6989586621679302436"><span class="hs-identifier hs-var">all_ctors</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-323"></a><span>                              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span> </span><a href="#local-6989586621679302437"><span class="hs-identifier hs-var">fail</span></a><span class="hs-special">]</span><span>
</span><a name="line-324"></a><span>
</span><a name="line-325"></a><span>    </span><a name="local-6989586621679302425"><a href="#local-6989586621679302425"><span class="hs-identifier">mentioned_ctors</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">alt_con</span><span> </span><a href="#local-6989586621679302422"><span class="hs-identifier hs-var">case_alts</span></a><span>
</span><a name="line-326"></a><span>    </span><a name="local-6989586621679302426"><a href="#local-6989586621679302426"><span class="hs-identifier">exhaustive_case</span></a></a><span> </span><a name="local-6989586621679302438"><a href="#local-6989586621679302438"><span class="hs-identifier">all_ctors</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679302438"><span class="hs-identifier hs-var">all_ctors</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">S.isSubsetOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679302425"><span class="hs-identifier hs-var">mentioned_ctors</span></a><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span>    </span><span class="hs-identifier">get_all_ctors</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302430"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302430"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">S.Set</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">)</span><span>
</span><a name="line-329"></a><span>    </span><a name="local-6989586621679302427"><a href="#local-6989586621679302427"><span class="hs-identifier">get_all_ctors</span></a></a><span> </span><a name="local-6989586621679302439"><a href="#local-6989586621679302439"><span class="hs-identifier">con_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-330"></a><span>      </span><a name="local-6989586621679302440"><a href="#local-6989586621679302440"><span class="hs-identifier">ty_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#dataConNameToDataName"><span class="hs-identifier hs-var">dataConNameToDataName</span></a><span> </span><a href="#local-6989586621679302439"><span class="hs-identifier hs-var">con_name</span></a><span>
</span><a name="line-331"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DTyConI"><span class="hs-identifier hs-var">DTyConI</span></a><span> </span><a name="local-6989586621679302441"><a href="#local-6989586621679302441"><span class="hs-identifier">tycon_dec</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Core.html#dsReify"><span class="hs-identifier hs-var">dsReify</span></a><span> </span><a href="#local-6989586621679302440"><span class="hs-identifier hs-var">ty_name</span></a><span>
</span><a name="line-332"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">S.fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679302429"><span class="hs-identifier hs-var">get_con_name</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679302428"><span class="hs-identifier hs-var">get_cons</span></a><span> </span><a href="#local-6989586621679302441"><span class="hs-identifier hs-var">tycon_dec</span></a><span>
</span><a name="line-333"></a><span>
</span><a name="line-334"></a><span>    </span><a name="local-6989586621679302428"><a href="#local-6989586621679302428"><span class="hs-identifier">get_cons</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DDataD"><span class="hs-identifier hs-var">DDataD</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679302442"><a href="#local-6989586621679302442"><span class="hs-identifier">cons</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679302442"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-335"></a><span>    </span><span class="hs-identifier">get_cons</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DDataInstD"><span class="hs-identifier hs-var">DDataInstD</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679302443"><a href="#local-6989586621679302443"><span class="hs-identifier">cons</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679302443"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-336"></a><span>    </span><span class="hs-identifier">get_cons</span><span> </span><span class="hs-identifier">_</span><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span>    </span><a name="local-6989586621679302429"><a href="#local-6989586621679302429"><span class="hs-identifier">get_con_name</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DCon"><span class="hs-identifier hs-var">DCon</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679302444"><a href="#local-6989586621679302444"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679302444"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-339"></a><span>
</span><a name="line-340"></a><span class="hs-identifier">matchEmpty</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302252"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302252"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span class="hs-special">]</span><span>
</span><a name="line-341"></a><a name="matchEmpty"><a href="Language.Haskell.TH.Desugar.Match.html#matchEmpty"><span class="hs-identifier">matchEmpty</span></a></a><span> </span><a name="local-6989586621679302448"><a href="#local-6989586621679302448"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679302449"><span class="hs-identifier hs-var">mk_seq</span></a><span class="hs-special">]</span><span>
</span><a name="line-342"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-343"></a><span>    </span><a name="local-6989586621679302449"><a href="#local-6989586621679302449"><span class="hs-identifier">mk_seq</span></a></a><span> </span><a name="local-6989586621679302450"><a href="#local-6989586621679302450"><span class="hs-identifier">fail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DCaseE"><span class="hs-identifier hs-var">DCaseE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679302448"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span> </span><a href="#local-6989586621679302450"><span class="hs-identifier hs-var">fail</span></a><span class="hs-special">]</span><span>
</span><a name="line-344"></a><span>
</span><a name="line-345"></a><span class="hs-identifier">matchLiterals</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302251"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302251"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>
</span><a name="line-346"></a><a name="matchLiterals"><a href="Language.Haskell.TH.Desugar.Match.html#matchLiterals"><span class="hs-identifier">matchLiterals</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679302451"><a href="#local-6989586621679302451"><span class="hs-identifier">var</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679302452"><a href="#local-6989586621679302452"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679302453"><a href="#local-6989586621679302453"><span class="hs-identifier">sub_groups</span></a></a><span>
</span><a name="line-347"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679302459"><a href="#local-6989586621679302459"><span class="hs-identifier">alts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621679302454"><span class="hs-identifier hs-var">match_group</span></a><span> </span><a href="#local-6989586621679302453"><span class="hs-identifier hs-var">sub_groups</span></a><span>
</span><a name="line-348"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#mkCoPrimCaseMatchResult"><span class="hs-identifier hs-var">mkCoPrimCaseMatchResult</span></a><span> </span><a href="#local-6989586621679302451"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679302459"><span class="hs-identifier hs-var">alts</span></a><span class="hs-special">)</span><span>
</span><a name="line-349"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-350"></a><span>    </span><span class="hs-identifier">match_group</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302455"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302455"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Lit</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span class="hs-special">)</span><span>
</span><a name="line-351"></a><span>    </span><a name="local-6989586621679302454"><a href="#local-6989586621679302454"><span class="hs-identifier">match_group</span></a></a><span> </span><a name="local-6989586621679302456"><a href="#local-6989586621679302456"><span class="hs-identifier">eqns</span></a></a><span>
</span><a name="line-352"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DLitPa"><span class="hs-identifier hs-var">DLitPa</span></a><span> </span><a name="local-6989586621679302457"><a href="#local-6989586621679302457"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#firstPat"><span class="hs-identifier hs-var">firstPat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679302456"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">)</span><span>
</span><a name="line-353"></a><span>           </span><a name="local-6989586621679302458"><a href="#local-6989586621679302458"><span class="hs-identifier">match_result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#simplCase"><span class="hs-identifier hs-var">simplCase</span></a><span> </span><a href="#local-6989586621679302452"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#shiftEqns"><span class="hs-identifier hs-var">shiftEqns</span></a><span> </span><a href="#local-6989586621679302456"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">)</span><span>
</span><a name="line-354"></a><span>           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302457"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679302458"><span class="hs-identifier hs-var">match_result</span></a><span class="hs-special">)</span><span>
</span><a name="line-355"></a><span class="hs-identifier">matchLiterals</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar (matchLiterals)&quot;</span><span>
</span><a name="line-356"></a><span>
</span><a name="line-357"></a><span class="hs-identifier">mkCoPrimCaseMatchResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-comment">-- Scrutinee</span><span>
</span><a name="line-358"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Lit</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-359"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>
</span><a name="line-360"></a><a name="mkCoPrimCaseMatchResult"><a href="Language.Haskell.TH.Desugar.Match.html#mkCoPrimCaseMatchResult"><span class="hs-identifier">mkCoPrimCaseMatchResult</span></a></a><span> </span><a name="local-6989586621679302460"><a href="#local-6989586621679302460"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679302461"><a href="#local-6989586621679302461"><span class="hs-identifier">match_alts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679302462"><span class="hs-identifier hs-var">mk_case</span></a><span>
</span><a name="line-361"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-362"></a><span>    </span><a name="local-6989586621679302462"><a href="#local-6989586621679302462"><span class="hs-identifier">mk_case</span></a></a><span> </span><a name="local-6989586621679302464"><a href="#local-6989586621679302464"><span class="hs-identifier">fail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679302465"><a href="#local-6989586621679302465"><span class="hs-identifier">alts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302463"><span class="hs-identifier hs-var">mk_alt</span></a><span> </span><a href="#local-6989586621679302464"><span class="hs-identifier hs-var">fail</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302461"><span class="hs-identifier hs-var">match_alts</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-363"></a><span>                   </span><a href="Language.Haskell.TH.Desugar.AST.html#DCaseE"><span class="hs-identifier hs-var">DCaseE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679302460"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302465"><span class="hs-identifier hs-var">alts</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DWildPa"><span class="hs-identifier hs-var">DWildPa</span></a><span> </span><a href="#local-6989586621679302464"><span class="hs-identifier hs-var">fail</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-364"></a><span>    </span><a name="local-6989586621679302463"><a href="#local-6989586621679302463"><span class="hs-identifier">mk_alt</span></a></a><span> </span><a name="local-6989586621679302466"><a href="#local-6989586621679302466"><span class="hs-identifier">fail</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679302467"><a href="#local-6989586621679302467"><span class="hs-identifier">lit</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679302468"><a href="#local-6989586621679302468"><span class="hs-identifier">body_fn</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-365"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DMatch"><span class="hs-identifier hs-var">DMatch</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DLitPa"><span class="hs-identifier hs-var">DLitPa</span></a><span> </span><a href="#local-6989586621679302467"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302468"><span class="hs-identifier hs-var">body_fn</span></a><span> </span><a href="#local-6989586621679302466"><span class="hs-identifier hs-var">fail</span></a><span class="hs-special">)</span><span>
</span><a name="line-366"></a><span>
</span><a name="line-367"></a><span class="hs-identifier">matchBangs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302250"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302250"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>
</span><a name="line-368"></a><a name="matchBangs"><a href="Language.Haskell.TH.Desugar.Match.html#matchBangs"><span class="hs-identifier">matchBangs</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679302469"><a href="#local-6989586621679302469"><span class="hs-identifier">var</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679302470"><a href="#local-6989586621679302470"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679302471"><a href="#local-6989586621679302471"><span class="hs-identifier">eqns</span></a></a><span>
</span><a name="line-369"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679302472"><a href="#local-6989586621679302472"><span class="hs-identifier">match_result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#simplCase"><span class="hs-identifier hs-var">simplCase</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302469"><span class="hs-identifier hs-var">var</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679302470"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-370"></a><span>                       </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#decomposeFirstPat"><span class="hs-identifier hs-var">decomposeFirstPat</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#getBangPat"><span class="hs-identifier hs-var">getBangPat</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302471"><span class="hs-identifier hs-var">eqns</span></a><span>
</span><a name="line-371"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#mkEvalMatchResult"><span class="hs-identifier hs-var">mkEvalMatchResult</span></a><span> </span><a href="#local-6989586621679302469"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679302472"><span class="hs-identifier hs-var">match_result</span></a><span class="hs-special">)</span><span>
</span><a name="line-372"></a><span class="hs-identifier">matchBangs</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar (matchBangs)&quot;</span><span>
</span><a name="line-373"></a><span>
</span><a name="line-374"></a><span class="hs-identifier">decomposeFirstPat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span>
</span><a name="line-375"></a><a name="decomposeFirstPat"><a href="Language.Haskell.TH.Desugar.Match.html#decomposeFirstPat"><span class="hs-identifier">decomposeFirstPat</span></a></a><span> </span><a name="local-6989586621679302473"><a href="#local-6989586621679302473"><span class="hs-identifier">extractpat</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-var">EquationInfo</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679302474"><a href="#local-6989586621679302474"><span class="hs-identifier">pat</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679302475"><a href="#local-6989586621679302475"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679302476"><a href="#local-6989586621679302476"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-376"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-var">EquationInfo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302473"><span class="hs-identifier hs-var">extractpat</span></a><span> </span><a href="#local-6989586621679302474"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679302475"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302476"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-377"></a><span class="hs-identifier">decomposeFirstPat</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar (decomposeFirstPat)&quot;</span><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span class="hs-identifier">getBangPat</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span>
</span><a name="line-380"></a><a name="getBangPat"><a href="Language.Haskell.TH.Desugar.Match.html#getBangPat"><span class="hs-identifier">getBangPat</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DBangPa"><span class="hs-identifier hs-var">DBangPa</span></a><span> </span><a name="local-6989586621679302477"><a href="#local-6989586621679302477"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679302477"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-381"></a><span class="hs-identifier">getBangPat</span><span> </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar (getBangPat)&quot;</span><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span class="hs-identifier">mkEvalMatchResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>
</span><a name="line-384"></a><a name="mkEvalMatchResult"><a href="Language.Haskell.TH.Desugar.Match.html#mkEvalMatchResult"><span class="hs-identifier">mkEvalMatchResult</span></a></a><span> </span><a name="local-6989586621679302478"><a href="#local-6989586621679302478"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679302479"><a href="#local-6989586621679302479"><span class="hs-identifier">body_fn</span></a></a><span> </span><a name="local-6989586621679302480"><a href="#local-6989586621679302480"><span class="hs-identifier">fail</span></a></a><span>
</span><a name="line-385"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DAppE"><span class="hs-identifier hs-var">DAppE</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier">seq</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarE"><span class="hs-identifier hs-var">DVarE</span></a><span> </span><a href="#local-6989586621679302478"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679302479"><span class="hs-identifier hs-var">body_fn</span></a><span> </span><a href="#local-6989586621679302480"><span class="hs-identifier hs-var">fail</span></a><span class="hs-special">]</span><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><span class="hs-identifier">matchVariables</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302249"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302249"><span class="hs-identifier hs-type">q</span></a><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>
</span><a name="line-388"></a><a name="matchVariables"><a href="Language.Haskell.TH.Desugar.Match.html#matchVariables"><span class="hs-identifier">matchVariables</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621679302481"><a href="#local-6989586621679302481"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679302482"><a href="#local-6989586621679302482"><span class="hs-identifier">eqns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#simplCase"><span class="hs-identifier hs-var">simplCase</span></a><span> </span><a href="#local-6989586621679302481"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#shiftEqns"><span class="hs-identifier hs-var">shiftEqns</span></a><span> </span><a href="#local-6989586621679302482"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">)</span><span>
</span><a name="line-389"></a><span class="hs-identifier">matchVariables</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Internal error in th-desugar (matchVariables)&quot;</span><span>
</span><a name="line-390"></a><span>
</span><a name="line-391"></a><span class="hs-identifier">shiftEqns</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">]</span><span>
</span><a name="line-392"></a><a name="shiftEqns"><a href="Language.Haskell.TH.Desugar.Match.html#shiftEqns"><span class="hs-identifier">shiftEqns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679302483"><span class="hs-identifier hs-var">shift</span></a><span>
</span><a name="line-393"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-394"></a><span>    </span><a name="local-6989586621679302483"><a href="#local-6989586621679302483"><span class="hs-identifier">shift</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-var">EquationInfo</span></a><span> </span><a name="local-6989586621679302484"><a href="#local-6989586621679302484"><span class="hs-identifier">pats</span></a></a><span> </span><a name="local-6989586621679302485"><a href="#local-6989586621679302485"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#EquationInfo"><span class="hs-identifier hs-var">EquationInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679302484"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302485"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-395"></a><span>
</span><a name="line-396"></a><span>
</span><a name="line-397"></a><span class="hs-identifier">adjustMatchResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DExp"><span class="hs-identifier hs-type">DExp</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>
</span><a name="line-398"></a><a name="adjustMatchResult"><a href="Language.Haskell.TH.Desugar.Match.html#adjustMatchResult"><span class="hs-identifier">adjustMatchResult</span></a></a><span> </span><a name="local-6989586621679302486"><a href="#local-6989586621679302486"><span class="hs-identifier">wrap</span></a></a><span> </span><a name="local-6989586621679302487"><a href="#local-6989586621679302487"><span class="hs-identifier">mr</span></a></a><span> </span><a name="local-6989586621679302488"><a href="#local-6989586621679302488"><span class="hs-identifier">fail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679302486"><span class="hs-identifier hs-var">wrap</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679302487"><span class="hs-identifier hs-var">mr</span></a><span> </span><a href="#local-6989586621679302488"><span class="hs-identifier hs-var">fail</span></a><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span class="hs-comment">-- from DsUtils</span><span>
</span><a name="line-401"></a><span class="hs-identifier">selectMatchVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302248"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302248"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>
</span><a name="line-402"></a><a name="selectMatchVars"><a href="Language.Haskell.TH.Desugar.Match.html#selectMatchVars"><span class="hs-identifier">selectMatchVars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#selectMatchVar"><span class="hs-identifier hs-var">selectMatchVar</span></a><span>
</span><a name="line-403"></a><span>
</span><a name="line-404"></a><span class="hs-comment">-- from DsUtils</span><span>
</span><a name="line-405"></a><span class="hs-identifier">selectMatchVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a><span> </span><a href="#local-6989586621679302247"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.Haskell.TH.Desugar.AST.html#DPat"><span class="hs-identifier hs-type">DPat</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302247"><span class="hs-identifier hs-type">q</span></a><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-406"></a><a name="selectMatchVar"><a href="Language.Haskell.TH.Desugar.Match.html#selectMatchVar"><span class="hs-identifier">selectMatchVar</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DBangPa"><span class="hs-identifier hs-var">DBangPa</span></a><span> </span><a name="local-6989586621679302489"><a href="#local-6989586621679302489"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#selectMatchVar"><span class="hs-identifier hs-var">selectMatchVar</span></a><span> </span><a href="#local-6989586621679302489"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-407"></a><span class="hs-identifier">selectMatchVar</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DTildePa"><span class="hs-identifier hs-var">DTildePa</span></a><span> </span><a name="local-6989586621679302490"><a href="#local-6989586621679302490"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Match.html#selectMatchVar"><span class="hs-identifier hs-var">selectMatchVar</span></a><span> </span><a href="#local-6989586621679302490"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-408"></a><span class="hs-identifier">selectMatchVar</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.AST.html#DVarPa"><span class="hs-identifier hs-var">DVarPa</span></a><span> </span><a name="local-6989586621679302491"><a href="#local-6989586621679302491"><span class="hs-identifier">var</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#newUniqueName"><span class="hs-identifier hs-var">newUniqueName</span></a><span> </span><span class="hs-special">(</span><span class="hs-char">'_'</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">nameBase</span><span> </span><a href="#local-6989586621679302491"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span>
</span><a name="line-409"></a><span class="hs-identifier">selectMatchVar</span><span> </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.Desugar.Util.html#newUniqueName"><span class="hs-identifier hs-var">newUniqueName</span></a><span> </span><span class="hs-string">&quot;_pat&quot;</span><span>
</span><a name="line-410"></a><span>
</span><a name="line-411"></a><span class="hs-comment">-- like GHC's runs</span><span>
</span><a name="line-412"></a><span class="hs-identifier">runs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302246"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679302246"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679302246"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679302246"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-413"></a><a name="runs"><a href="Language.Haskell.TH.Desugar.Match.html#runs"><span class="hs-identifier">runs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-414"></a><span class="hs-identifier">runs</span><span> </span><a name="local-6989586621679302492"><a href="#local-6989586621679302492"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679302493"><a href="#local-6989586621679302493"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679302494"><a href="#local-6989586621679302494"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">span</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302492"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679302493"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679302494"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-415"></a><span>                  </span><span class="hs-special">(</span><a name="local-6989586621679302495"><a href="#local-6989586621679302495"><span class="hs-identifier">first</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679302496"><a href="#local-6989586621679302496"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679302493"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679302495"><span class="hs-identifier hs-var">first</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Desugar.Match.html#runs"><span class="hs-identifier hs-var">runs</span></a><span> </span><a href="#local-6989586621679302492"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679302496"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">)</span><span>
</span><a name="line-416"></a></pre></body></html>