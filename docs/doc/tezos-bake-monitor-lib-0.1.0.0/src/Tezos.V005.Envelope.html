<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><a name="line-5"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Tezos.V005.Envelope</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-comment">-- import Control.DeepSeq (NFData)</span><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Typeable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Typeable</span><span class="hs-special">)</span><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Word</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Generics</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><a href="Tezos.Common.Base58Check.html"><span class="hs-identifier">Tezos.Common.Base58Check</span></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Tezos.Common.Binary.html"><span class="hs-identifier">Tezos.Common.Binary</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">B</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><a href="Tezos.V005.BlockHeader.html"><span class="hs-identifier">Tezos.V005.BlockHeader</span></a><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><a href="Tezos.V005.Operation.html"><span class="hs-identifier">Tezos.V005.Operation</span></a><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-comment">{-
There are no changes to envelope, other than operation changed.
None of the Endorsements structure changed, but because there
duplicated types in V005 that are unchanged this needs to be
done. Operation reuses nothing from V004 when it probably could.

TODO: Maybe we should reimplement less in operation to make this
reimpl unnecessary.
-}</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">data</span><span> </span><a name="Envelope"><a href="Tezos.V005.Envelope.html#Envelope"><span class="hs-identifier">Envelope</span></a></a><span>
</span><a name="line-28"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Envelope_BlockHeader"><a href="Tezos.V005.Envelope.html#Envelope_BlockHeader"><span class="hs-identifier">Envelope_BlockHeader</span></a></a><span> </span><span class="hs-glyph">!</span><a href="Tezos.Common.Base58Check.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a><span> </span><span class="hs-glyph">!</span><a href="Tezos.V004.BlockHeader.html#BlockHeaderFull"><span class="hs-identifier hs-type">BlockHeaderFull</span></a><span>
</span><a name="line-29"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Envelope_Endorsement"><a href="Tezos.V005.Envelope.html#Envelope_Endorsement"><span class="hs-identifier">Envelope_Endorsement</span></a></a><span> </span><span class="hs-glyph">!</span><a href="Tezos.Common.Base58Check.html#ChainId"><span class="hs-identifier hs-type">ChainId</span></a><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="Tezos.V005.Operation.html#Op"><span class="hs-identifier hs-type">Op</span></a><span> </span><span class="hs-special">'</span><a href="Tezos.V005.Operation.html#OpKind_Endorsement"><span class="hs-identifier hs-type">OpKind_Endorsement</span></a><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span class="hs-comment">-- instance NFData Envelope</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span class="hs-keyword">instance</span><span> </span><a href="Tezos.Common.Binary.html#TezosBinary"><span class="hs-identifier hs-type">B.TezosBinary</span></a><span> </span><a href="Tezos.V005.Envelope.html#Envelope"><span class="hs-identifier hs-type">Envelope</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-34"></a><span>  </span><a name="local-8214565720323937599"><a href="Tezos.Common.Binary.html#put"><span class="hs-identifier">put</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-35"></a><span>    </span><a href="Tezos.V005.Envelope.html#Envelope_BlockHeader"><span class="hs-identifier hs-var">Envelope_BlockHeader</span></a><span> </span><a name="local-6989586621680438109"><a href="#local-6989586621680438109"><span class="hs-identifier">chainId</span></a></a><span> </span><a name="local-6989586621680438110"><a href="#local-6989586621680438110"><span class="hs-identifier">blockHeader</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tezos.Common.Binary.html#put"><span class="hs-identifier hs-var">B.put</span></a><span> </span><span class="hs-glyph">@</span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="Tezos.Common.Binary.html#put"><span class="hs-identifier hs-var">B.put</span></a><span> </span><a href="#local-6989586621680438109"><span class="hs-identifier hs-var">chainId</span></a><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="Tezos.Common.Binary.html#put"><span class="hs-identifier hs-var">B.put</span></a><span> </span><span class="hs-special">(</span><a href="Tezos.Common.Binary.html#ToSign"><span class="hs-identifier hs-var">B.ToSign</span></a><span> </span><a href="#local-6989586621680438110"><span class="hs-identifier hs-var">blockHeader</span></a><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span>    </span><a href="Tezos.V005.Envelope.html#Envelope_Endorsement"><span class="hs-identifier hs-var">Envelope_Endorsement</span></a><span> </span><a name="local-6989586621680438111"><a href="#local-6989586621680438111"><span class="hs-identifier">chainId</span></a></a><span> </span><a name="local-6989586621680438112"><a href="#local-6989586621680438112"><span class="hs-identifier">endorsement</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tezos.Common.Binary.html#put"><span class="hs-identifier hs-var">B.put</span></a><span> </span><span class="hs-glyph">@</span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="Tezos.Common.Binary.html#put"><span class="hs-identifier hs-var">B.put</span></a><span> </span><a href="#local-6989586621680438111"><span class="hs-identifier hs-var">chainId</span></a><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="Tezos.Common.Binary.html#put"><span class="hs-identifier hs-var">B.put</span></a><span> </span><span class="hs-special">(</span><a href="Tezos.Common.Binary.html#ToSign"><span class="hs-identifier hs-var">B.ToSign</span></a><span> </span><a href="#local-6989586621680438112"><span class="hs-identifier hs-var">endorsement</span></a><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span>  </span><a name="local-8214565720323937600"><a href="Tezos.Common.Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Tezos.Common.Binary.html#get"><span class="hs-identifier hs-var">B.get</span></a><span> </span><span class="hs-glyph">@</span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-38"></a><span>    </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tezos.V005.Envelope.html#Envelope_BlockHeader"><span class="hs-identifier hs-var">Envelope_BlockHeader</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Tezos.Common.Binary.html#get"><span class="hs-identifier hs-var">B.get</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">B.unToSign</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Tezos.Common.Binary.html#get"><span class="hs-identifier hs-var">B.get</span></a><span class="hs-special">)</span><span>
</span><a name="line-39"></a><span>    </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tezos.V005.Envelope.html#Envelope_Endorsement"><span class="hs-identifier hs-var">Envelope_Endorsement</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Tezos.Common.Binary.html#get"><span class="hs-identifier hs-var">B.get</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">B.unToSign</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Tezos.Common.Binary.html#get"><span class="hs-identifier hs-var">B.get</span></a><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-string">&quot;unknown or unsupported magic byte in envelope&quot;</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a></pre></body></html>